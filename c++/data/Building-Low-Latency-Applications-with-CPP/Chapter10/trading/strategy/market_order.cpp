#include "market_order.h"

namespace Trading
{
// ============================================================================
// MarketOrder::toString() - è¨‚å–®ç‰©ä»¶åºåˆ—åŒ–ç‚ºå­—ä¸²
// ============================================================================
//
// ðŸ“Œ åŠŸèƒ½ï¼šå°‡è¨‚å–®ç‰©ä»¶çš„æ‰€æœ‰æ¬„ä½è½‰æ›ç‚ºäººé¡žå¯è®€çš„å­—ä¸²æ ¼å¼
// ç”¨é€”ï¼š
// 1. æ—¥èªŒè¨˜éŒ„ï¼ˆLoggerï¼‰ï¼šé™¤éŒ¯æ™‚è¿½è¹¤è¨‚å–®ç‹€æ…‹
// 2. å–®å…ƒæ¸¬è©¦ï¼šé©—è­‰è¨‚å–®è³‡æ–™æ­£ç¢ºæ€§
// 3. é™¤éŒ¯è¼¸å‡ºï¼šè§€å¯Ÿè¨‚å–®ç°¿å…§éƒ¨çµæ§‹
//
// âš ï¸ æ•ˆèƒ½è­¦å‘Šï¼š
// - std::stringstreamï¼šå‹•æ…‹è¨˜æ†¶é«”åˆ†é…ï¼ˆheap allocationï¼‰
// - å­—ä¸²æ‹¼æŽ¥ï¼šå¤šæ¬¡è¤‡è£½æ“ä½œ
// - **çµ•å°ä¸å¯åœ¨ç†±è·¯å¾‘ï¼ˆHot Pathï¼‰ä¸­å‘¼å«ï¼**
// - åƒ…é™é™¤éŒ¯ã€æ—¥èªŒè¨˜éŒ„ã€æ¸¬è©¦å ´æ™¯ä½¿ç”¨
//
// ðŸ“Š è¼¸å‡ºæ ¼å¼ç¯„ä¾‹ï¼š
// MarketOrder[oid:12345 side:BUY price:100.50 qty:500 prio:1234567890 prev:12344 next:12346]
//
// æ¬„ä½èªªæ˜Žï¼š
// - oid: è¨‚å–® IDï¼ˆOrder IDï¼‰
// - side: è²·è³£æ–¹å‘ï¼ˆBUY/SELLï¼‰
// - price: è¨‚å–®åƒ¹æ ¼ï¼ˆPriceï¼‰
// - qty: è¨‚å–®æ•¸é‡ï¼ˆQuantityï¼‰
// - prio: å„ªå…ˆæ¬Šï¼ˆPriorityï¼Œé€šå¸¸æ˜¯æŽ¥æ”¶æ™‚é–“æˆ³ï¼‰
// - prev: å‰ä¸€å€‹è¨‚å–®çš„ IDï¼ˆç’°ç‹€é›™å‘éˆçµä¸²åˆ—ï¼‰
// - next: ä¸‹ä¸€å€‹è¨‚å–®çš„ IDï¼ˆç’°ç‹€é›™å‘éˆçµä¸²åˆ—ï¼‰
//
// ðŸ”— ç’°ç‹€éˆçµä¸²åˆ—è³‡è¨Šï¼š
// - prev/next ç”¨æ–¼è¿½è¹¤åŒåƒ¹ä½è¨‚å–®çš„æŽ’åº
// - å¦‚æžœæ˜¯ç’°ç‹€éˆçµä¸²åˆ—çš„é ­ç¯€é»žï¼Œprev å¯èƒ½æŒ‡å‘å°¾ç¯€é»ž
// - OrderId_INVALID è¡¨ç¤ºè©²æ–¹å‘æ²’æœ‰è¨‚å–®ï¼ˆnullptrï¼‰
//
// âš¡ æ•ˆèƒ½æ•¸æ“šï¼š
// - åŸ·è¡Œæ™‚é–“ï¼šç´„ 1-5 Î¼sï¼ˆå¾®ç§’ï¼‰
// - è¨˜æ†¶é«”åˆ†é…ï¼šç´„ 100-200 bytesï¼ˆstringstream ç·©è¡å€ï¼‰
// - èˆ‡ç†±è·¯å¾‘ç›¸æ¯”ï¼šæ…¢ 50-500 å€ï¼ˆç†±è·¯å¾‘ç´„ 10-100 nsï¼‰
//
// ðŸ“Œ ä½¿ç”¨å»ºè­°ï¼š
// - åªåœ¨æ—¥èªŒç´šåˆ¥ç‚º DEBUG æ™‚å‘¼å«
// - ä¸è¦åœ¨è¨‚å–®è™•ç†çš„ä¸»è¿´åœˆä¸­å‘¼å«
// - å¦‚éœ€æ•ˆèƒ½ç›£æŽ§ï¼Œä½¿ç”¨çµæ§‹åŒ–è¼¸å‡ºè€Œéžå­—ä¸²
auto MarketOrder::toString() const -> std::string
{
    std::stringstream ss;
    ss << "MarketOrder" << "["
       << "oid:" << orderIdToString(order_id_) << " "
       << "side:" << sideToString(side_) << " "
       << "price:" << priceToString(price_) << " "
       << "qty:" << qtyToString(qty_) << " "
       << "prio:" << priorityToString(priority_) << " "
       << "prev:" << orderIdToString(prev_order_ ? prev_order_->order_id_ :
                                     OrderId_INVALID) << " "
       << "next:" << orderIdToString(next_order_ ? next_order_->order_id_ :
                                     OrderId_INVALID) << "]";

    return ss.str();
}
}
