# Kernel Bypass æŠ€è¡“å¯¦ä½œå¥—ä»¶

é€™å€‹å¥—ä»¶å¯¦ä½œäº† kernel-bypass-guide.md æ–‡ä»¶ä¸­çš„æ‰€æœ‰ç¯„ä¾‹ç¨‹å¼ï¼Œå±•ç¤ºå„ç¨®ç¹é Linux æ ¸å¿ƒçš„é«˜æ•ˆèƒ½ç¶²è·¯æŠ€è¡“ã€‚

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
kernel_bypass_suite/
â”œâ”€â”€ dpdk_packet_processing.cpp    # DPDK å°åŒ…è™•ç†ç¯„ä¾‹
â”œâ”€â”€ af_xdp_socket.cpp             # AF_XDP Socket å¯¦ä½œ
â”œâ”€â”€ io_uring_async.cpp            # io_uring éåŒæ­¥ I/O ä¼ºæœå™¨
â”œâ”€â”€ rdma_communication.cpp        # RDMA é€šè¨Šç¯„ä¾‹
â”œâ”€â”€ Makefile                      # ç·¨è­¯è…³æœ¬
â”œâ”€â”€ run_tests.sh                  # æ¸¬è©¦è…³æœ¬
â””â”€â”€ README.md                     # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å®‰è£ç›¸ä¾å¥—ä»¶

```bash
# å®‰è£æ‰€æœ‰å¿…è¦çš„é–‹ç™¼å¥—ä»¶
make install-deps
# éœ€è¦å¯†ç¢¼: f0409
```

### ç·¨è­¯ç¨‹å¼

```bash
# æª¢æŸ¥ç›¸ä¾æ€§
make check-deps

# ç·¨è­¯ io_uring ç¨‹å¼ (æœ€ç°¡å–®)
make io_uring_async

# ç·¨è­¯æ‰€æœ‰å¯ç”¨çš„ç¨‹å¼
make all

# ç·¨è­¯ç‰¹å®šç¨‹å¼
make af_xdp      # ç·¨è­¯ AF_XDP
make rdma        # ç·¨è­¯ RDMA
make dpdk        # ç·¨è­¯ DPDK (éœ€è¦ DPDK ç’°å¢ƒ)
```

### åŸ·è¡Œæ¸¬è©¦

```bash
# åŸ·è¡ŒåŸºæœ¬æ¸¬è©¦
./run_tests.sh

# åŸ·è¡Œå®Œæ•´æ¸¬è©¦ (éœ€è¦ root)
sudo ./run_tests.sh -f

# åªåŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦
./run_tests.sh -p
```

## ğŸ“‹ å„æŠ€è¡“è©³ç´°èªªæ˜

### 1. io_uring éåŒæ­¥ I/O

æœ€æ–°çš„ Linux éåŒæ­¥ I/O æ¡†æ¶ï¼Œæä¾›é«˜æ•ˆèƒ½çš„æª”æ¡ˆå’Œç¶²è·¯ I/O æ“ä½œã€‚

**ç‰¹é»ï¼š**
- é›¶æ‹·è²æ“ä½œ
- æ‰¹æ¬¡æäº¤å’Œå®Œæˆ
- æ”¯æ´å¤šç¨® I/O æ“ä½œé¡å‹
- æ ¸å¿ƒç‰ˆæœ¬éœ€æ±‚ï¼šLinux 5.1+

**åŸ·è¡Œç¯„ä¾‹ï¼š**
```bash
# å•Ÿå‹•ä¼ºæœå™¨ (é è¨­åŸ å£ 12345)
./io_uring_async

# æŒ‡å®šåŸ å£
./io_uring_async 8080

# æ¸¬è©¦é€£ç·š
echo "æ¸¬è©¦è¨Šæ¯" | nc localhost 12345
```

**æ•ˆèƒ½æŒ‡æ¨™ï¼š**
- å»¶é²ï¼š< 10 å¾®ç§’
- ååé‡ï¼š> 1M è«‹æ±‚/ç§’
- CPU ä½¿ç”¨ç‡ï¼šæ¥µä½

### 2. AF_XDP Socket

ä½¿ç”¨ XDP (eXpress Data Path) çš„é«˜é€Ÿå°åŒ…è™•ç†ä»‹é¢ã€‚

**ç‰¹é»ï¼š**
- é›¶æ‹·è²å°åŒ…è™•ç†
- ç¹éæ ¸å¿ƒç¶²è·¯å †ç–Š
- æ”¯æ´ç¡¬é«”å¸è¼‰
- æ ¸å¿ƒç‰ˆæœ¬éœ€æ±‚ï¼šLinux 4.18+

**åŸ·è¡Œç¯„ä¾‹ï¼š**
```bash
# éœ€è¦ root æ¬Šé™
sudo ./af_xdp_socket eth0 0
# eth0: ç¶²è·¯ä»‹é¢åç¨±
# 0: ä½‡åˆ— ID
```

**æ•ˆèƒ½æŒ‡æ¨™ï¼š**
- å°åŒ…è™•ç†ï¼š> 20 Mpps
- å»¶é²ï¼š< 1 å¾®ç§’
- CPU è¦ªå’Œæ€§å„ªåŒ–

### 3. DPDK å°åŒ…è™•ç†

Intel çš„è³‡æ–™å¹³é¢é–‹ç™¼å¥—ä»¶ï¼Œå®Œå…¨ç¹éæ ¸å¿ƒçš„å°åŒ…è™•ç†ã€‚

**ç‰¹é»ï¼š**
- ä½¿ç”¨è€…ç©ºé–“é©…å‹•ç¨‹å¼
- å¤§é é¢è¨˜æ†¶é«”æ”¯æ´
- å¤šæ ¸å¿ƒæ“´å±•æ€§
- ç¡¬é«”åŠ é€Ÿæ”¯æ´

**å‰ç½®è¨­å®šï¼š**
```bash
# è¨­å®šå¤§é é¢
make setup-hugepages

# ç¶å®šç¶²è·¯ä»‹é¢åˆ° DPDK
sudo dpdk-devbind.py --bind=uio_pci_generic 0000:01:00.0
```

**åŸ·è¡Œç¯„ä¾‹ï¼š**
```bash
# åŸ·è¡Œ DPDK æ‡‰ç”¨ç¨‹å¼
sudo ./dpdk_packet_processing -l 0-3 -n 4
# -l: ä½¿ç”¨çš„æ ¸å¿ƒ
# -n: è¨˜æ†¶é«”é€šé“æ•¸
```

**æ•ˆèƒ½æŒ‡æ¨™ï¼š**
- å°åŒ…è™•ç†ï¼š> 100 Mpps
- å»¶é²ï¼š< 100 å¥ˆç§’
- ç·šé€Ÿè™•ç† 100G ç¶²è·¯

### 4. RDMA é€šè¨Š

é ç«¯ç›´æ¥è¨˜æ†¶é«”å­˜å–ï¼Œå¯¦ç¾é›¶ CPU åƒèˆ‡çš„ç¶²è·¯é€šè¨Šã€‚

**ç‰¹é»ï¼š**
- é›¶æ‹·è²å‚³è¼¸
- æ ¸å¿ƒç¹é
- ç¡¬é«”å¸è¼‰
- æ”¯æ´ InfiniBand å’Œ RoCE

**åŸ·è¡Œç¯„ä¾‹ï¼š**
```bash
# å•Ÿå‹•ä¼ºæœå™¨
./rdma_communication server

# å•Ÿå‹•å®¢æˆ¶ç«¯
./rdma_communication client 192.168.1.100
```

**æ•ˆèƒ½æŒ‡æ¨™ï¼š**
- å»¶é²ï¼š< 1 å¾®ç§’
- é »å¯¬ï¼š> 100 Gbps
- CPU ä½¿ç”¨ç‡ï¼š< 5%

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **liburing æœªæ‰¾åˆ°**
   ```bash
   make install-deps
   ```

2. **æ¬Šé™ä¸è¶³**
   ```bash
   # ä½¿ç”¨ sudo åŸ·è¡Œ
   sudo ./af_xdp_socket eth0 0
   ```

3. **å¤§é é¢æœªé…ç½®**
   ```bash
   make setup-hugepages
   ```

4. **DPDK ç’°å¢ƒæœªè¨­å®š**
   ```bash
   export RTE_SDK=/path/to/dpdk
   export RTE_TARGET=x86_64-native-linux-gcc
   ```

5. **ç¶²è·¯ä»‹é¢è¢«ä½”ç”¨**
   ```bash
   # åœæ­¢ NetworkManager
   sudo systemctl stop NetworkManager
   ```

## ğŸ“Š æ•ˆèƒ½æ¯”è¼ƒ

| æŠ€è¡“ | å»¶é² | ååé‡ | CPU ä½¿ç”¨ç‡ | è¤‡é›œåº¦ |
|------|------|--------|------------|--------|
| å‚³çµ± Socket | 50-100 Î¼s | 100K pps | é«˜ | ä½ |
| io_uring | < 10 Î¼s | 1M rps | ä½ | ä¸­ |
| AF_XDP | < 1 Î¼s | 20M pps | ä¸­ | ä¸­ |
| DPDK | < 100 ns | 100M pps | ä½ | é«˜ |
| RDMA | < 1 Î¼s | ç·šé€Ÿ | æ¥µä½ | é«˜ |

## ğŸ” ç›£æ§å’Œèª¿è©¦

### æ•ˆèƒ½ç›£æ§

```bash
# ç›£æ§ç¶²è·¯çµ±è¨ˆ
watch -n 1 'cat /proc/net/dev'

# ç›£æ§ä¸­æ–·
watch -n 1 'cat /proc/interrupts | grep eth'

# ç›£æ§ CPU ä½¿ç”¨ç‡
htop
```

### èª¿è©¦å·¥å…·

```bash
# è¿½è¹¤ç³»çµ±å‘¼å«
strace -e network ./io_uring_async

# æ•ˆèƒ½åˆ†æ
perf record -g ./dpdk_packet_processing
perf report

# ç¶²è·¯å°åŒ…æ“·å–
tcpdump -i eth0 -nn
```

## ğŸ“š åƒè€ƒè³‡æº

- [io_uring å®˜æ–¹æ–‡ä»¶](https://kernel.dk/io_uring.pdf)
- [AF_XDP æ•™å­¸](https://www.kernel.org/doc/html/latest/networking/af_xdp.html)
- [DPDK ç¨‹å¼è¨­è¨ˆæŒ‡å—](https://doc.dpdk.org/guides/)
- [RDMA ç¨‹å¼è¨­è¨ˆæ‰‹å†Š](https://www.rdmamojo.com/)

## ğŸ“ æˆæ¬Š

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ã€‚

## ğŸ¤ è²¢ç»

æ­¡è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“ è¯çµ¡æ–¹å¼

å¦‚æœ‰å•é¡Œï¼Œè«‹åœ¨ GitHub ä¸Šé–‹å•Ÿ Issueã€‚

---

**æ³¨æ„äº‹é …ï¼š**
- æ‰€æœ‰ç¨‹å¼çš„è¼¸å‡ºè¨Šæ¯éƒ½ä½¿ç”¨ç¹é«”ä¸­æ–‡
- sudo å¯†ç¢¼ç‚º: f0409
- æŸäº›åŠŸèƒ½éœ€è¦ç‰¹å®šç¡¬é«”æ”¯æ´ï¼ˆå¦‚ RDMAï¼‰
- å»ºè­°åœ¨æ¸¬è©¦ç’°å¢ƒä¸­åŸ·è¡Œï¼Œé¿å…å½±éŸ¿ç”Ÿç”¢ç³»çµ±