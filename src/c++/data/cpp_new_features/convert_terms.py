import os
import glob

# Mapping dictionary: CN (SC/TC) -> TW
term_mapping = {
    # SC
    "软件": "軟體",
    "硬件": "硬體",
    "程序": "程式",
    "代码": "程式碼",
    "变量": "變數",
    "函数": "函式",
    "内存": "記憶體",
    "磁盘": "磁碟",
    "指针": "指標",
    "引用": "參照",
    "构造": "建構",
    "析构": "解構",
    "数组": "陣列",
    "链表": "鏈結串列",
    "宏": "巨集",
    "模板": "樣板",
    "默认": "預設",
    "支持": "支援",
    "接口": "介面",
    "模块": "模組",
    "优化": "最佳化",
    "调试": "除錯",
    "循环": "迴圈",
    "遍历": "走訪",
    "查找": "搜尋",
    "搜索": "搜尋",
    "链接": "連結",
    "视频": "影片",
    "博客": "部落格",
    "打印": "印出",
    "进程": "行程",
    "线程": "執行緒",
    "智能指针": "智慧指標",
    "命名空间": "命名空間",
    "堆栈": "堆疊",
    "队列": "佇列",
    "迭代器": "疊代器",
    "操作系统": "作業系統",
    "数据库": "資料庫",
    "服务器": "伺服器",
    "客户端": "用戶端",
    "浏览器": "瀏覽器",
    "分辨率": "解析度",
    "算法": "演算法",
    "字符串": "字串",
    "头文件": "標頭檔",
    "源文件": "原始檔",
    "源代码": "原始碼",
    "编译": "編譯",
    "解释器": "直譯器",
    "运算符": "運算子",
    "对象": "物件",
    "类": "類別",
    "实例": "實體",
    "信息": "資訊",
    "屏幕": "螢幕",
    "激活": "啟用",
    "卸载": "解除安裝",
    "菜单": "選單",
    "文件夹": "資料夾",
    "剪切板": "剪貼簿",
    "拷贝": "複製",
    "粘贴": "貼上",
    "硬盘": "硬碟",
    "光驱": "光碟機",
    "显卡": "顯示卡",
    "声卡": "音效卡",
    "网卡": "網路卡",
    "鼠标": "滑鼠",
    "键盘": "鍵盤",
    "句柄": "控制代碼",
    "回调": "回呼",
    "移动语义": "移動語意",
    "完美转发": "完美轉送",
    "缺省": "預設",
    "类型": "型別",
    "形参": "形式參數",
    "实参": "實際參數",
    "返回值": "回傳值",
    "成员": "成員",
    "包含": "包含",
    "注释": "註解",
    "项目": "專案",
    "文件": "檔案",
    "文档": "文件",
    "网络": "網路",
    "计算": "計算",
    "计算机": "電腦",
    "云端": "雲端",
    "同步": "同步",
    "异步": "非同步",
    "架构": "架構",
    "配置": "配置",
    "初始化": "初始化",
    "实例化": "實體化",
    "重载": "多載",
    "重写": "覆寫",
    "多态": "多型",
    "继承": "繼承",
    "封装": "封裝",
    "抽象": "抽象",
    "常量": "常數",
    "枚举": "列舉",
    "结构体": "結構",
    "联合体": "聯合",
    "位域": "位元欄",
    "字节": "位元組",
    "位": "位元",
    "互斥锁": "互斥鎖",
    "信号量": "號誌",
    "死锁": "死結",
    "异常": "例外",
    "名字空间": "命名空間",
    "友元": "友元",
    "虚函数": "虛擬函式",
    "纯虚函数": "純虛擬函式",
    "lambda表达式": "lambda表達式",
    "Lambda表达式": "Lambda表達式",

    # TC Variants of Mainland Terms
    "軟件": "軟體",
    "硬件": "硬體",
    "程序": "程式", # Can be ambiguous but usually program
    "代碼": "程式碼",
    "變量": "變數",
    "函數": "函式",
    "內存": "記憶體",
    "磁盤": "磁碟",
    "指針": "指標",
    "構造": "建構",
    "析構": "解構",
    "數組": "陣列",
    "鏈表": "鏈結串列",
    "默認": "預設",
    # "支持": "支援", # Same characters
    # "接口": "介面", # Same char for '接' '口' but '介面' is TW. '接口' is CN.
    "接口": "介面",
    "模塊": "模組",
    "優化": "最佳化",
    "調試": "除錯",
    # "循環": "迴圈", # Same/similar. '环' vs '環'
    "循環": "迴圈",
    "遍歷": "走訪",
    # "查找": "搜尋", # Same
    "查找": "搜尋",
    # "搜索": "搜尋", # Same
    "搜索": "搜尋",
    "鏈接": "連結",
    "視頻": "影片",
    # "博客": "部落格", # Same
    # "打印": "印出", # Same
    "進程": "行程",
    "線程": "執行緒",
    "智能指針": "智慧指標",
    # "命名空間": "命名空間", # Same
    "堆棧": "堆疊",
    "隊列": "佇列",
    "迭代器": "疊代器",
    "操作系統": "作業系統",
    "數據庫": "資料庫",
    "服務器": "伺服器",
    "客戶端": "用戶端",
    # "瀏覽器": "瀏覽器", # Same
    # "分辨率": "解析度", # Same
    "分辨率": "解析度",
    # "算法": "演算法", # Same
    "頭文件": "標頭檔",
    "源文件": "原始檔",
    "源代碼": "原始碼",
    # "編譯": "編譯", # Same
    "解釋器": "直譯器",
    "運算符": "運算子",
    "對象": "物件",
    # "類": "類別", # Be careful
    "實例": "實體",
    # "信息": "資訊", # Same
    "信息": "資訊",
    # "屏幕": "螢幕", # Same
    "屏幕": "螢幕",
    # "激活": "啟用", # Same
    "激活": "啟用",
    "卸載": "解除安裝",
    "菜單": "選單",
    "文件夾": "資料夾",
    "剪切板": "剪貼簿",
    "拷貝": "複製",
    "粘貼": "貼上",
    "硬盤": "硬碟",
    "光驅": "光碟機",
    "顯卡": "顯示卡",
    "聲卡": "音效卡",
    "網卡": "網路卡",
    "鼠標": "滑鼠",
    # "鍵盤": "鍵盤", # Same
    # "句柄": "控制代碼", # Same
    "回調": "回呼",
    "移動語義": "移動語意",
    "完美轉發": "完美轉送",
    "缺省": "預設",
    "類型": "型別",
    "形參": "形式參數",
    "實參": "實際參數",
    "返回值": "回傳值",
    # "成員": "成員", # Same
    "注釋": "註解",
    "項目": "專案",
    # "文檔": "文件", # Same
    "文檔": "文件",
    "網絡": "網路",
    "計算機": "電腦",
    # "雲端": "雲端", # Same
    "異步": "非同步",
    # "架構": "架構", # Same
    # "配置": "配置", # Same
    # "初始化": "初始化", # Same
    "實例化": "實體化",
    "重載": "多載",
    "重寫": "覆寫",
    "多態": "多型",
    # "繼承": "繼承", # Same
    # "封裝": "封裝", # Same
    # "抽象": "抽象", # Same
    # "常量": "常數", # Same
    "枚舉": "列舉",
    "結構體": "結構",
    "聯合體": "聯合",
    "位域": "位元欄",
    "字節": "位元組",
    "互斥鎖": "互斥鎖",
    "信號量": "號誌",
    "死鎖": "死結",
    # "異常": "例外", # Same
    "虛函數": "虛擬函式",
    "純虛函數": "純虛擬函式",
    
    # Extra check for mixed terms
    "Lambda表達式": "Lambda表達式", # Keep
}

# Specific order: longer terms first to avoid partial replacement
sorted_keys = sorted(term_mapping.keys(), key=len, reverse=True)

def convert_text(text):
    for key in sorted_keys:
        text = text.replace(key, term_mapping[key])
    return text

def process_files():
    # Use glob with recursive=True for Python 3.5+
    files = glob.glob('**/*.md', recursive=True)
    
    for file_path in files:
        if file_path == 'plan.md':
            continue
            
        print(f"Processing: {file_path}")
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
            
            new_content = convert_text(content)
            
            if content != new_content:
                with open(file_path, 'w', encoding='utf-8') as f:
                    f.write(new_content)
                print(f"Updated: {file_path}")
            else:
                print(f"No changes: {file_path}")
                
        except Exception as e:
            print(f"Error processing {file_path}: {e}")

if __name__ == '__main__':
    process_files()