# 第7章 設計無鎖的併發數據結構

本章主要內容

- 設計無鎖的併發數據結構
- 無鎖結構中的內存管理
- 設計無鎖結構的簡單指導

上一章瞭解了在設計併發數據結構時會遇到的問題，根據指導意見確定設計的安全性。對一些通用數據結構進行檢查，並瞭解使用互斥鎖對共享數據進行保護的例子。第一組例子就是使用單個互斥量來保護整個數據結構，但之後的例子使用多個鎖來保護數據結構不同的部分，並且允許進行更高級別的併發訪問。

互斥量是一個強大的工具，可以保證在多線程情況下安全的訪問數據結構，且不會有條件競爭或破壞不變量的情況存在。使用互斥量的原因很簡單：就是讓互斥量來保護數據。不過，這並不會如所想的那樣，可以回看一下第3章，回顧一下死鎖形成的原因，再回顧一下基於鎖的隊列和查詢表的例子，看一下細粒度鎖是如何影響併發的。如果能寫出一個無鎖安全的併發數據結構，那就能避免這些問題。

本章中還會使用原子操作(第5章介紹)的內存序，來構建無鎖數據結構。這樣的數據結構不是那麼容易正確實現的，所以要格外小心，並且讓其問題會很難復現。我們將從無鎖數據結構的定義開始，通過幾個例子來了解使用無鎖數據結構的意義，最後給出通用的指導意見。