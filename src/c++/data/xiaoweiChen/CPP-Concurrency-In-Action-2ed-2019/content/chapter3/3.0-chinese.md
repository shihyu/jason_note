# 第3章 共享數據

本章主要內容

- 共享數據的問題
- 使用互斥保護數據
- 保護數據的替代方案

上一章中已經對線程管理有所瞭解，現在來看一下“共享數據的那些事兒”。

試想，你和朋友合租一個公寓，公寓中只有一個廚房和一個衛生間。當你的朋友在衛生間時，你就會不能使用衛生間了。同樣的問題也會出現在廚房，假如：廚房裡有一個烤箱，烤香腸的同時，也在做蛋糕，那就可能得到不想要的食物(香腸味的蛋糕)。此外，在公共空間將一件事做到一半時，發現某些需要的東西被別人拿走，或是離開的一段時間內有些東西變動了地方，這都會令我們不爽。

同樣的問題也困擾著線程。當線程訪問共享數據時，必須定一些規則來限定線程可訪問的數據。一個線程更新了共享數據，需要對其他線程進行通知。從易用性的角度，同一進程中的多個線程進行數據共享有利有弊，錯誤的共享數據是產生bug的主要原因。

本章就以數據共享為主題，避免上述及潛在問題的發生的同時，將共享數據的優勢發揮到最大。