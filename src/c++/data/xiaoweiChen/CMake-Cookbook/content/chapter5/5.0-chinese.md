# 第5章 配置時和構建時的操作

本章的主要內容有：

* 使用平臺無關的文件操作
* 配置時運行自定義命令
* 構建時運行自定義命令:Ⅰ. 使用add_custom_command
* 構建時運行自定義命令:Ⅱ. 使用add_custom_target
* 構建時為特定目標運行自定義命令
* 探究編譯和鏈接命令
* 探究編譯器標誌命令
* 探究可執行命令
* 使用生成器表達式微調配置和編譯

我們將學習如何在配置和構建時，執行自定義操作。先簡單回顧一下，與CMake工作流程相關的時序:

1. **CMake時**或**構建時**：CMake正在運行，並處理項目中的`CMakeLists.txt`文件。
2. **生成時**：生成構建工具(如Makefile或Visual Studio項目文件)。
3. **構建時**：由CMake生成相應平臺的原生構建腳本，在腳本中調用原生工具構建。此時，將調用編譯器在特定的構建目錄中構建目標(可執行文件和庫)。
4. **CTest時**或**測試時**：運行測試套件以檢查目標是否按預期執行。
5. **CDash時**或**報告時**：當測試結果上傳到儀錶板上，與其他開發人員共享測試報告。
6. **安裝時**：當目標、源文件、可執行程序和庫，從構建目錄安裝到相應位置。
7. **CPack時**或**打包時**：將項目打包用以分發時，可以是源碼，也可以是二進制。
8. **包安裝時**：新生成的包在系統範圍內安裝。

完整的工作流程和對應的時序，如下圖所示:

![](../../images/preface/2.png)

本章會介紹在配置和構建時的自定義行為，我們將學習如何使用這些命令:

* **execute_process**，從CMake中執行任意進程，並檢索它們的輸出。
* **add_custom_target**，創建執行自定義命令的目標。
* **add_custom_command**，指定必須執行的命令，以生成文件或在其他目標的特定生成事件中生成。