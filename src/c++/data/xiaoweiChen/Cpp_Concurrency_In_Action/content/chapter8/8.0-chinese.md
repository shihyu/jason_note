# 第8章 併發代碼設計

**本章主要內容**

- 線程間劃分數據的技術<br>
- 影響併發代碼性能的因素<br>
- 性能因素是如何影響數據結構的設計<br>
- 多線程代碼中的異常安全<br>
- 可擴展性<br>
- 並行算法的實現<br>

之前章節著重於介紹使用`C++`11中的新工具來寫併發代碼。在第6、7章中我們瞭解到，如何使用這些工具來設計可併發訪問的基本數據結構。這就好比一個木匠，其不僅要知道如何做一個合頁，一個組合櫃，或一個桌子；併發的代碼的使用，要比使用/設計基本數據結構頻繁的多。要將眼界放寬，就需要構建更大的結構，進行高效的工作。我將使用多線程化的`C++`標準庫算法作為例子，不過這裡的原則也適用於對其他應用程序的擴展。

認真思考如何進行併發化設計，對於每個編程項目來說都很重要。不過，寫多線程代碼的時候，需要考慮的因素比寫序列化代碼多得多。不僅包括一般性因素，例如：封裝，耦合和聚合(這些在很多軟件設計書籍中有很詳細的介紹)，還要考慮哪些數據需要共享，如何同步訪問數據，哪些線程需要等待哪些線程，等等。

本章將會關注這些問題，從高層(但也是基本的)考慮，如何使用線程，哪些代碼應該在哪些線程上執行；以及，這將如何影響代碼的清晰度，並從底層細節上了解，如何構建共享數據來優化性能。

那麼就先來看一下，如何在線程間劃分工作。