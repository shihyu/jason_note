# 第7章 無鎖併發數據結構設計

**本章主要內容**

- 設計無鎖併發數據結構<br>
- 無鎖結構中內存管理技術<br>
- 對無鎖數據結構設計的簡單指導<br>

上一章中，我們瞭解了在設計併發數據結構時會遇到的問題，根據指導意見指引，確定設計的安全性。對一些通用數據結構進行檢查，並查看使用互斥鎖對共享數據進行保護的實現例子。第一組例子就是使用單個互斥量來保護整個數據結構，但之後的例子就會使用多個鎖來保護數據結構的不同部分，並且允許對數據結構進行更高級別的併發訪問。

互斥量是一個強大的工具，其可以保證在多線程情況下可以安全的訪問數據結構，並且不會有條件競爭或破壞不變量的情況存在。對於使用互斥量的代碼，其原因也是很簡單的：就是讓互斥量來保護數據。不過，這並不會如你所想的那樣；你可以回看一下第3章，回顧一下死鎖形成的原因，再回顧一下基於鎖的隊列和查詢表的例子，看一下細粒度鎖是如何影響併發的。如果你能寫出一個無鎖併發安全的數據結構，那麼就能避免這些問題。

在本章中，我們還會使用原子操作(第5章介紹)的“內存序”特性，並使用這個特性來構建無鎖數據結構。設計這樣的數據結構時，要格外的小心，因為這樣的數據機構不是那麼容易正確實現的，並且讓其失敗的條件很難復現。我們將從無鎖數據的定義開始；而後，將繼續通過幾個例子來瞭解使用無鎖數據結構的意義，最後給出一些通用的指導意見。