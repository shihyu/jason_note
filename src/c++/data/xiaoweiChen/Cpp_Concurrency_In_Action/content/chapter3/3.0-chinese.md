# 第3章 線程間共享數據

**本章主要內容**

- 共享數據帶來的問題<br>
- 使用互斥量保護數據<br>
- 數據保護的替代方案<br>

上一章中，我們已經對線程管理有所瞭解了，現在讓我們來看一下“共享數據的那些事”。

想象一下，你和你的朋友合租一個公寓，公寓中只有一個廚房和一個衛生間。當你的朋友在衛生間時，你就會不能使用了(除非你們特別好，好到可以在同時使用一個房間)。這個問題也會出現在廚房，假如:廚房裡有一個組合式烤箱，當在烤香腸的時候，也在做蛋糕，就可能得到我們不想要的食物(香腸味的蛋糕)。此外，在公共空間將一件事做到一半時，發現某些需要的東西被別人借走，或是當離開的一段時間內有些東西被變動了地方，這都會令我們不爽。

同樣的問題，也困擾著線程。當線程在訪問共享數據的時候，必須定一些規矩，用來限定線程可訪問的數據位。還有，一個線程更新了共享數據，需要對其他線程進行通知。從易用性的角度，同一進程中的多個線程進行數據共享，有利有弊。錯誤的共享數據使用是產生併發bug的一個主要原因，並且後果要比香腸味的蛋糕更加嚴重。

本章就以在C++中進行安全的數據共享為主題。避免上述及其他潛在問題的發生的同時，將共享數據的優勢發揮到最大。