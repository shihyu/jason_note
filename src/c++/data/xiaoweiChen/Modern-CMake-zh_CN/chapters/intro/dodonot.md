# CMake 行為準則(Do's and Don'ts)

## CMake 應避免的行為

接下來的兩個列表很大程度上基於優秀的 gist [Effective Modern CMake]. 那個列表更長且更詳細，也非常歡迎你去仔細閱讀它。

* **不要使用具有全局作用域的函數**：這包含 `link_directories`、 `include_libraries` 等相似的函數。
* **不要添加非必要的 PUBLIC 要求**：你應該避免把一些不必要的東西強加給用戶（-Wall）。相比於 **PUBLIC**，更應該把他們聲明為 **PRIVATE**。
* **不要在file函數中添加 GLOB 文件**：如果不重新運行 CMake，Make 或者其他的工具將不會知道你是否添加了某個文件。值得注意的是，CMake 3.12 添加了一個 `CONFIGURE_DEPENDS` 標誌能夠使你更好的完成這件事。
* **將庫直接鏈接到需要構建的目標上**：如果可以的話，總是顯式的將庫鏈接到目標上。
* **當鏈接庫文件時，不要省略 PUBLIC或PRIVATE 關鍵字**：這將會導致後續所有的鏈接都是缺省的。


## CMake 應遵守的規範

* **把 CMake 程序視作代碼**：它是代碼。它應該和其他的代碼一樣，是整潔並且可讀的。
* **建立目標的觀念**：你的目標應該代表一系列的概念。為任何需要保持一致的東西指定一個 （導入型）INTERFACE 目標，然後每次都鏈接到該目標。
* **導出你的接口**：你的 CMake 項目應該可以直接構建或者安裝。
* **為庫書寫一個 Config.cmake 文件**：這是庫作者為支持客戶的體驗而應該做的。
* **聲明一個 ALIAS 目標以保持使用的一致性**：使用 `add_subdirectory` 和 `find_package` 應該提供相同的目標和命名空間。
* **將常見的功能合併到有詳細文檔的函數或宏中**：函數往往是更好的選擇。
* **使用小寫的函數名**： CMake 的函數和宏的名字可以定義為大寫或小寫，但是一般都使用小寫，變量名用大寫。
* **使用 `cmake_policy` 和/或 限定版本號範圍**： 每次改變版本特性 (policy) 都要有據可依。應該只有不得不使用舊特性時才降低特性 (policy) 版本。




[Effective Modern CMake]: https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1
