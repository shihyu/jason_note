#7.5 私有內存

私有內存指的是各工作項內自己所使用的變量，也包括內核參數。原則上，私有數據通常放置到寄存器上，不過寄存器的資源並不是那麼多，當使用的私有內存過多時，一部分數據將會放置到全局內存中。私有內存的分配會影響內核所使用到的寄存器數量。與局部內存一樣，指定的架構中所分配的寄存器數量是固定的。而且，不同架構之間的性能差異也很大。

x86類型的CPU所具有的寄存器數量相當少。不過，因為其緩存較大，一些需要將寄存器上的數據放置到棧上的操作，以及將數據返回寄存器的操作，都會在緩存和寄存器之間交換數據，所以這些操作幾乎沒有什麼延遲。使用寄存器時，需要把使用頻率較高的數據放在寄存器上，這樣這些變量從作用域中的出入將會變的十分高效。

GPU上就不能這樣奢侈的使用緩存。有些設備沒有讀寫緩存，有些有緩存的設備上，緩存也十分有限，因此在寄存器也很有限的情況下，工作項所需要的數據很快會填滿緩存，這樣將會導致有些數據在再需要的時候，在緩存上未命中。設備上的DRAM被填滿時，該設備的性能會急劇惡化。開發應用時，需要儘量避免這種情況的發生。

如果寄存器夠用，寄存器對於GPU上大量的激活線程時，其功能與*局部數據共享*(LDS, local data share)的方式很相似(將在第8章進行詳細描述)。ADM Radeon HD R9 290X架構中，每個計算單元具有256KB寄存器內存。其有4塊(SIMD)寄存器塊，每個寄存器塊具有256個寄存器，每個寄存器的每個通道能夠處理4字節64位寬向量。如果每個工作項使用100個寄存器，那麼對於SIMD來說，只能發送出有2波數據，幾乎沒有什麼指令延遲隱藏。而當每個工作項使用49個寄存器時，那麼就可以發出5波數據，這樣就能很好的隱藏指令延遲。

雖然，數據轉移在寄存器中處理起來更加高效，不過這樣會消耗掉計算核中的一些線程束，無法進行延遲隱藏，並且這樣會導致更多緩存數據交換操作，從而浪費更多GPU計算週期。