#9.4 性能分析

為了展示不同的內核實現對於性能的影響，我們將這些內核都在Radeon HD 7970 GPU上執行了一遍。為了展示對不同數據大小的性能優化，我們也生成除了對應的SURF描述符和集群質心。生成的SURF描述符數量為4096，16384和65536。同時，對應質心的數量為16,64和256。我們選取數量較大的SURF特徵，是因為對於一張高分辨率的圖來說，通常都包含成千上萬個特徵。不過，對於質心來說其數量就相對較少，如果質心的數量過多會影響圖像分類的準確度。

這裡的性能數據是由相應的性能分析工具給出，這裡我們使用了AMD公司的CodeXL，第10章中我們會對該工具進行介紹。本章主要描述對於OpenCL內核代碼進行優化後的性能情況。這裡還需要注意的是，目標平臺的架構對於優化代碼來說也有很大的影響。

##9.4.1 GPU性能

我們將GPU1內核作為OpenCL內核實現的基線。在使用GPU2處理描述符和質心前，我們是用到了矩陣轉置對描述符進行了轉置操作。轉置操作屬於另外一個內核，為了避免這個因素影響我們之後優化的內核，這裡將轉置的時間單獨列出來，在表9.1中展示。那麼第二個內核，也就是直方圖內核的性能數據在表9.2中展示。

表9.1 轉置內核執行的時間

特徵數量 | 轉置內核耗時(ms)
----|-----
4096|0.05
16,384|0.50
65,536|2.14

表9.2 直方圖——不同內核實現的耗時統計

集群數量|SURF描述符數量|GPU1|GPU2|GPU3|GPU4|GPU5
----|-----|-----|-----|----|-----|-----
8|4096|0.41|0.27|0.10|0.17|0.09
8|16,348|3.60|0.28|0.17|0.69|0.19
8|65,536|15.36|1.05|0.59|1.31|0.74
16|4096|0.77|0.53|0.19|0.28|0.14
16|16,348|7.10|0.53|0.32|0.57|0.29
16|65,536|30.41|1.47|1.17|2.26|1.12
64|4096|6.00|3.53|1.34|1.00|0.43
64|16,348|28.28|2.11|1.20|2.96|0.86
64|65,536|122.09|5.80|4.65|9.04|3.87
128|4096|4.96|4.04|1.47|1.95|0.81
128|16,348|55.70|4.27|2.40|5.89|1.61
128|65.536|243.30|11.63|9.29|17.46|6.43
256|4096|10.49|8.06|2.84|4.35|1.57
256|16,348|109.67|8.62|4.77|11.44|3.13
256|65,536|488.54|23.28|18.71|34.73|13.97