#11.3 編譯器的目標 —— OpenCL 2.0

CLamp開源包括以下組件：

- `C++ AMP`編譯器：該項目由Clang和LLVM衍生而出，其編譯器支持`C++ AMP`作為`C++`語言的擴展，並且內核代碼使用OpenCL C或可移植的中間碼錶示。
- `C++ AMP`頭文件：由`C++ AMP`標準定義的一系列頭文件。其對一些OpenCL內置函數進行了包裝，但是有些還是需要再認真的考慮一下。
- `C++ AMP`運行時：用來連接主程序和內核的橋接庫。連接可執行文件，其會加載和構建內核，設置內核參數和運行內核。

SPIR是LLVM中間碼的一個子集，其用可用來表示OpenCL C程序。SPIR是可移植的，其沒有具體設備的特徵。其避免了讓應用開發者只能通過加載文件的方式運行內核代碼，否則開發人員就要管理不同設備上的內核版本。使用正確的SPIR中間碼需要對應OpenCL平臺支持cl_khr_spir擴展，並且有對應的SPIR版本(CL_DEVICE_SPIR_VERSIONS)。為了使用SPIR格式對程序對象進行編譯，我們將使用`clCreateProgramWithBinary()`。

SPIR有兩個可用版本。SPIR 1.2可以對OpenCL C的1.2版本通過LLVM(3.2版)進行編碼，並且SPIR 2.0可以對OpenCL C的2.0版本進行編碼(LLVM版本要求較新)。這樣，我們就將OpenCL C與SPIR聯繫起來。後面章節中，我們將使用具體的中間碼對照相應的OpenCL C源碼，以便讓中間碼具有更好的可讀性。

基於向量相加的示例代碼，剩餘的章節將展示CLamp編譯器重要的組件。與OpenCL無關的部分我們會省略，我們重點關注OpenCL是如何實現`C++ AMP`主要特性。從中我們也能學習到如何使用OpenCL實現對應平臺的`C++ AMP`。