

虽然可以将现有的应用程序迁移到云中运行，但这种迁移不会使应用程序成为云本地应用程序。它将在云中运行，但架构选择仍基于内部部署模型。

简而言之，云原生应用程序本质上是分布式的、松散耦合的、可扩展的。它们不与任何特定的物理基础设施绑定，甚至不需要开发人员考虑特定的基础设施。这类应用程序通常以网络为中心。

本章中，将介绍一些云-本地构建块的例子，并描述一些云-本地模式。

\subsubsubsection{15.2.1\hspace{0.2cm}原生云计算基础}

云原生设计的一个支持者是云原生计算基金会(CNCF)，它主持了Kubernetes项目。CNCF是各种技术的发源地，使得构建独立于云供应商的云本地应用程序变得更加容易。这类技术的例子包括:

\begin{itemize}
\item 
Fluentd，统一的日志记录层

\item 
Jaeger，用于分布式跟踪

\item 
Prometheus，用于监控

\item 
CoreDNS，用于发现服务
\end{itemize}

云本地应用程序通常是用应用程序容器构建的，运行在Kubernetes平台上。然而，这并不是必需的，在Kubernetes和容器之外使用许多CNCF框架完全可能。

\subsubsubsection{15.2.2\hspace{0.2cm}操作系统——云}

云原生设计的主要特点是将各种云资源视为应用程序的构建块。在cloudnative设计中很少使用单独的虚拟机(VM)。使用本地云方法，不是针对运行在某些实例上的给定操作系统，而是直接针对云API(例如，使用FaaS)或一些中间解决方案(如Kubernetes)。从这个意义上说，云可以成为操作系统，因为POSIX API无法进行限制。

由于容器改变了构建和发布软件的方法，现在可以从底层硬件基础设施的思考中解放出来。软件不是独立工作的，因此仍然需要连接不同的服务、监视、控制其生命周期、存储数据或传递机密。这是Kubernetes提供的，也是它变得如此受欢迎的原因之一。

可以想象，云原生应用程序是Web和移动优先的。桌面应用程序也可以从一些云本地组件中受益，但这是一种不常见的用例。

仍然可以在云本地应用程序中使用硬件和其他底层访问。如果工作负载需要使用GPU，这不应该成为转向云本地的阻碍。更重要的是，如果想访问别处不可用的定制硬件，可以在本地构建云本地应用程序。这个术语并不局限于公有云，而是指使用不同资源的方式。

\hspace*{\fill} \\ %插入空行
\noindent
\textbf{负载均衡和服务发现}

负载平衡是分布式应用程序的重要组成部分，不仅在服务集群中传播传入请求(这对于扩展至关重要)，还可以帮助提高应用程序的响应能力和可用性。智能负载均衡器可以收集指标来响应传入流量中的模式，监视其集群中服务器的状态，并将请求转发到负载较低且响应更快的节点——避免使用当前不健康的节点。

负载平衡带来更多的吞吐量和更少的停机时间。通过将请求转发到多个服务器，可以消除单点故障，特别是在使用多个负载均衡器的情况下，例如，在主动-被动方案中。

负载均衡器可以在架构的任何地方使用:可以平衡来自网络的请求，由网络服务器完成的请求到其他服务，缓存或数据库服务器的请求，以及任何适合的需求。

\begin{tcolorbox}[colback=webgreen!5!white,colframe=webgreen!75!black, title=TIP]
\hspace*{0.7cm}引入负载平衡时，有几件事需要记住。其中之一是会话持久性——确保来自同一客户的所有请求都发送到同一服务器，这样精心挑选的粉色细高跟鞋就不会从电子商务网站的购物篮中消失。会话在负载平衡方面可能会变得很棘手:要格外注意不要混合使用会话，这样客户就不会突然开始登录到彼此的配置文件中——之前有无数公司遇到过这个错误，特别是在将缓存添加到混合使用时。将两者结合起来是个好主意，只要确保使用正确的方法即可。
\end{tcolorbox}

\hspace*{\fill} \\ %插入空行
\noindent
\textbf{反向代理}

即使只想部署服务器的一个实例，在它前面添加另一个服务(而不是负载平衡器)也是一个好主意——反向代理。代理通常代表发送请求的客户端进行操作，而反向代理则代表处理这些请求的服务器进行操作。

为什么要用它？使用这种代理的原因和用途如下:

\begin{itemize}
\item 
安全性:服务器地址现在是隐藏的，服务器可以通过代理的DDoS防御功能来保护。

\item 
灵活性和扩展性:可以在需要的时候修改隐藏在代理背后的环境。

\item 
缓存:如果已经知道服务器会给出什么答案，为什么还要麻烦它呢？

\item 
压缩:压缩数据将减少所需的带宽，这可能对连接不良的移动用户特别有用。它还可以降低网络成本(但可能会消耗计算能力)。

\item 
SSL终端:通过承担后端服务器加密和解密网络流量的负担来减少其负载。
\end{itemize}

一个反向代理的例子是NGINX，还提供负载平衡功能、A/B测试等等。它的其他功能之一是发现服务。

\hspace*{\fill} \\ %插入空行
\noindent
\textbf{发现服务}

发现服务(SD)允许自动检测计算机网络中特定服务的实例。调用者必须只指向服务注册中心，而不是硬编码应该承载服务的域名或IP。使用这种方法，架构将变得更加灵活，因为现在可以很容易地找到使用的所有服务。如果设计了一个基于微服务的架构，引入SD确实需要很长一段时间。

实现可持续发展有几种方法。在客户端发现中，调用者直接联系SD实例。每个服务实例都有一个注册客户端，用于注册和注销实例、处理心跳等。虽然非常简单，但在这种方法中，每个客户机都必须实现服务发现逻辑。Netflix的Eureka就是这种方法中服务注册中心的一个例子。

另一种方法是使用服务器端发现。这里还提供了一个服务注册中心，以及每个服务实例中的注册中心客户机。然而，打电话的人不会直接联系它。相反，它们连接到负载均衡器，例如AWS弹性负载均衡器，在将客户端调用分派到特定实例之前调用服务注册表或使用其内置的服务注册表。除了AWS ELB，NGINX和Consul可以用来提供服务器端SD功能。

现在知道了如何有效地查找和使用服务，以及如何良好地部署它们。






