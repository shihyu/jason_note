# 虛擬化作業2

- 在 x86 和 ARM 平臺引入硬件虛擬化技術之後，指令模擬和半虛擬化的技術是否還有存在的意義?

  > 指令模擬和半虛擬化技術仍有存在的意義
  >
  > 1. 當物理主機ISA和虛擬機ISA不同時，不能使用硬件虛擬化技術，只能選擇軟件虛擬化技術
  > 2. 在使用硬件虛擬化技術之後，依然可以組合使用某些軟件技術，提高性能



- 假設有 10 個虛擬機，每個虛擬機有 10 個 vCPU。總共幾個 QEMU 進程?每個進程中有多少個線程(假設 KVM/QEMU 系統，忽略 QEMU 的 iothread)?

  > 總共10個QEMU進程
  >
  > 每個進程中有10個線程



- 在不考慮TLB的情況下，若使用硬件虛擬化裡的第二階段地址翻譯機制實現內存虛擬化，將GVA翻譯到HPA需要經過多少次內存訪問？為什麼？

  > 需要24次內存訪問
  >
  > 因為Stage-1頁表僅能通過HPA訪問，而不能用GPA去訪問。獲取Stage-1每一級頁表地址以及最終的主機物理地址時均需要經歷Stage-2頁表的翻譯



- 請回答以下3個I/O虛擬化的問題。
  1. 在半虛擬化I/O中，Virtio Virtqueue 技術相對於模擬I/O方法的優勢體現在哪裡?
  
     > 1. 性能高，可以通過批處理的方式減少虛擬機下陷的次數
     > 2. 實現複雜度低，安全性高，同一類設備通常共享一組前後端驅動，不再需要為具體設備維護對應的驅動
  
  2. 使用SRIOV設備直通方法具有最佳的I/O性能，請問為什麼目前雲中依然大量使用了半虛擬化I/O技術？
  
     > 因為SRIOV設備的I/O過程完全繞過了VMM，難以支持虛擬機熱遷移以及虛擬機安全自省等功能
  
  3. IOMMU 被廣泛用於連接 I/O 設備和主內存，您能解釋為什麼 IOMMU 對於設備直通的 I/O 虛擬化技術至關重要嗎?如果將物理設備直接分配給一個虛擬機，該設備的 IOMMU 應該翻譯什麼地址(從什麼地址到什麼地址)?
  
     > 1. 因為如果允許虛擬機直接使用主機物理地址與物理設備交互，可能會威脅到整個系統的內存安全
     > 2. 應該翻譯GPA->HPA