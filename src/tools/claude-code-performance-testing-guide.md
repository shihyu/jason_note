# Claude Code 效能測試與正確性驗證完整指南

## 基礎指令結構

### 完整測試指令範例

```bash
# 在你的專案目錄下執行
claude code "請為我的網站建立完整的效能測試和正確性驗證套件，包含以下需求：

1. **專案分析**：
   - 自動掃描我的專案結構和技術棧
   - 識別 API 端點、資料庫連線、前端路由
   - 分析現有的測試配置

2. **效能測試設計**：
   - 建立負載測試腳本（使用 k6 或 Artillery）
   - 資料庫效能測試（查詢分析、索引檢查）
   - 前端效能測試（Lighthouse CI 整合）
   - API 回應時間和吞吐量測試

3. **正確性驗證**：
   - 單元測試覆蓋率檢查
   - 整合測試案例
   - API 端點功能測試
   - 資料完整性驗證

4. **測試自動化**：
   - CI/CD 整合腳本
   - 效能回歸檢測
   - 測試報告生成
   - 告警機制設置

請根據我的專案實際情況客製化測試方案。"
```

## 分階段詳細指令

### 階段一：專案分析和基礎設置

```bash
claude code "
分析我的專案並建立測試基礎設施：

1. **專案掃描**：
   - 掃描 package.json/requirements.txt 了解技術棧
   - 找出所有 API 路由和端點
   - 識別資料庫配置和連線
   - 檢查現有測試文件

2. **測試環境配置**：
   - 建立 Docker 測試環境
   - 配置測試資料庫
   - 設置 CI/CD 測試流程
   - 建立測試資料種子

3. **監控工具整合**：
   - 整合 Prometheus + Grafana
   - 設置應用效能監控 (APM)
   - 配置日誌聚合
   - 建立效能儀表板

輸出詳細的設置步驟和配置文件。
"
```

### 階段二：效能測試實作

```bash
claude code "
為我建立全面的效能測試套件：

1. **負載測試腳本**：
   - k6 腳本涵蓋所有關鍵 API
   - 不同負載模式（漸增、突發、持續）
   - 資料庫壓力測試
   - 併發使用者情境模擬

2. **前端效能測試**：
   - Lighthouse CI 自動化
   - Core Web Vitals 監控
   - 資源載入時間測試
   - JavaScript 效能分析

3. **資料庫效能分析**：
   - 慢查詢檢測腳本
   - 索引使用率分析
   - 查詢執行計畫檢查
   - 連線池效能測試

4. **基準測試**：
   - 建立效能基準線
   - 回歸測試比較
   - 效能趨勢分析
   - 瓶頸識別工具

包含完整的測試腳本、配置文件和執行指南。
"
```

### 階段三：正確性驗證

```bash
claude code "
建立完整的正確性驗證系統：

1. **API 測試覆蓋**：
   - 所有端點的功能測試
   - 邊界條件測試
   - 錯誤處理驗證
   - 資料驗證測試

2. **資料完整性檢查**：
   - 資料庫約束驗證
   - 資料一致性測試
   - 事務完整性檢查
   - 備份恢復測試

3. **安全性測試**：
   - 輸入驗證測試
   - 授權機制檢查
   - SQL 注入防護測試
   - XSS 防護驗證

4. **整合測試**：
   - 端到端測試場景
   - 外部服務整合測試
   - 用戶流程驗證
   - 跨瀏覽器相容性

提供完整的測試案例、斷言邏輯和驗證報告。
"
```

## 針對特定技術棧的指令

### Node.js + Express + MongoDB

```bash
claude code "
針對我的 Node.js Express MongoDB 應用建立效能測試：

技術棧特定需求：
- Express 中間件效能分析
- MongoDB 查詢優化檢查
- Node.js 記憶體洩漏檢測
- 事件循環阻塞監控
- Redis 快取效能測試

請使用適合的工具：Jest, Supertest, k6, MongoDB Profiler
"
```

### Python Django + PostgreSQL

```bash
claude code "
為我的 Django PostgreSQL 應用建立測試套件：

Django 特定測試：
- ORM 查詢優化分析
- Django Debug Toolbar 整合
- PostgreSQL EXPLAIN ANALYZE 自動化
- Celery 任務效能測試
- Django 快取框架測試

使用工具：pytest, locust, django-test-utils, pgbench
"
```

### React + Next.js

```bash
claude code "
為我的 React Next.js 應用建立前端效能測試：

Next.js 特定測試：
- SSR/SSG 效能測試
- Image Optimization 驗證
- Bundle Size 分析
- Core Web Vitals 監控
- API Routes 效能測試

使用工具：Lighthouse CI, Next.js Bundle Analyzer, Playwright
"
```

## 持續監控和報告

```bash
claude code "
建立持續效能監控和報告系統：

1. **自動化測試排程**：
   - 每日效能基準測試
   - 部署前效能檢查
   - 週期性完整測試套件
   - 效能退化自動告警

2. **報告和可視化**：
   - 效能趨勢圖表
   - 測試結果儀表板
   - 自動化測試報告
   - Slack/Email 通知整合

3. **效能預算設定**：
   - 回應時間閾值
   - 資源使用限制
   - 錯誤率上限
   - 可用性目標

4. **測試資料管理**：
   - 測試資料版本控制
   - 效能資料歸檔
   - 測試環境管理
   - 資料清理自動化
"
```

## 最佳實務指令技巧

### ✅ 具體化需求（好的指令）

```bash
claude code "建立 k6 負載測試，測試我的購物車 API，模擬 1000 併發用戶，包含商品搜尋、加入購物車、結帳流程，測試 10 分鐘"
```

### ❌ 模糊指令（避免使用）

```bash
claude code "幫我做效能測試"
```

### ✅ 提供專案上下文

```bash
claude code "
專案背景：電商網站，日活 10萬用戶
技術棧：React + Node.js + PostgreSQL + Redis
關鍵功能：商品搜尋、購物車、支付、用戶管理
目前痛點：高峰時段回應慢、資料庫查詢多

請建立針對性的效能測試和優化建議
"
```

### ✅ 分階段執行策略

```bash
# 第一步：分析
claude code "先分析我的專案結構，識別效能測試的關鍵點"

# 第二步：前端測試（基於第一步結果）
claude code "基於剛才的分析，建立前端效能測試，重點關注 [具體發現的問題]"

# 第三步：後端測試
claude code "建立後端 API 負載測試，特別測試 [識別出的瓶頸 API]"
```

## 測試結果分析和優化

### 結果驗證指令

```bash
claude code "
分析剛才的測試結果並提供優化建議：

1. **結果分析**：
   - 識別效能瓶頸
   - 分析錯誤模式
   - 比較基準線差異
   - 計算改善優先級

2. **優化建議**：
   - 具體的程式碼改善
   - 資料庫查詢優化
   - 架構調整建議
   - 基礎設施改善

3. **實作優化**：
   - 自動實施可自動化的優化
   - 產生優化後的測試腳本
   - 建立 A/B 測試比較
   - 更新效能監控配置
"
```

## 完整測試流程檢查清單

### 測試前準備

- [ ] 確定測試目標和成功標準
- [ ] 準備測試環境（接近生產環境）
- [ ] 設置監控和日誌系統
- [ ] 準備測試資料集

### 執行測試階段

- [ ] 基準效能測試
- [ ] 負載和壓力測試
- [ ] 功能正確性驗證
- [ ] 安全性測試
- [ ] 跨瀏覽器/設備測試

### 測試後分析

- [ ] 分析測試結果和瓶頸
- [ ] 實施優化措施
- [ ] 驗證優化效果
- [ ] 更新測試基準線
- [ ] 建立持續監控

## 常用測試工具整合指令

### 效能測試工具

```bash
claude code "整合以下效能測試工具到我的專案：
- k6 用於 API 負載測試
- Lighthouse CI 用於前端效能
- Artillery 用於複雜場景測試
- Grafana 用於監控視覺化
建立統一的測試執行腳本和報告"
```

### 正確性驗證工具

```bash
claude code "設置完整的測試框架：
- 單元測試框架 (Jest/pytest)
- API 測試 (Supertest/pytest)
- E2E 測試 (Playwright/Cypress)
- 資料庫測試工具
建立完整的 CI/CD 測試流程"
```

## 進階應用場景

### 微服務架構測試

```bash
claude code "
為我的微服務架構建立分散式效能測試：

服務包含：
- API Gateway
- 用戶服務
- 商品服務
- 訂單服務
- 支付服務

測試需求：
- 服務間通訊效能
- 服務降級測試
- 分散式事務測試
- 服務發現效能
- 負載均衡效果驗證
"
```

### 資料庫效能深度分析

```bash
claude code "
建立深度資料庫效能分析：

1. 查詢效能分析：
   - 慢查詢自動檢測
   - 執行計畫分析
   - 索引使用率統計

2. 容量規劃：
   - 資料增長趨勢預測
   - 效能瓶頸預警
   - 擴容建議

3. 優化建議：
   - 自動生成索引建議
   - 查詢重構建議
   - 架構優化方案
"
```

這份指南涵蓋了使用 Claude Code 進行全面效能測試的各個層面，你可以根據自己的專案需求選擇適合的指令模板。