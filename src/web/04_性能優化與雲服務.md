# æ€§èƒ½å„ªåŒ–èˆ‡é›²æœå‹™

> WASM ç·¨è­¯å„ªåŒ–èˆ‡é›²æœå‹™æ•ˆèƒ½é™·é˜±ã€‚

## ğŸš€ WASM æœ€ä½³åŒ–ç·¨è­¯

### ç·¨è­¯æ¸¬è©¦
- [WASM æœ€ä½³åŒ–ç·¨è­¯æ¸¬è©¦](wasm-optimized-build-testing.md)

æ ¸å¿ƒå…§å®¹ï¼š
- ç·¨è­¯å„ªåŒ–é¸é …
- æª”æ¡ˆå¤§å°å„ªåŒ–
- åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦
- æœ€ä½³åŒ–ç­–ç•¥å°æ¯”

## ğŸ“¡ WebAssembly ç›¸å®¹æ€§

### è¼‰å…¥å™¨æŒ‡å—
- [WebAssembly ç›¸å®¹æ€§èˆ‡è¼‰å…¥å™¨å®Œæ•´æŒ‡å—](wasm_compatibility_guide.md)

æ ¸å¿ƒå…§å®¹ï¼š
- ç€è¦½å™¨ç›¸å®¹æ€§
- ä¸åŒè¼‰å…¥æ–¹å¼
- ä¸²æµç·¨è­¯
- é™ç´šæ–¹æ¡ˆ
- éŒ¯èª¤è™•ç†

## â˜ï¸ é›²æœå‹™æ•ˆèƒ½

### æ•ˆèƒ½é™·é˜±
- [é›²æœå‹™æ•ˆèƒ½é™·é˜±å®Œæ•´æŒ‡å—](cloud-performance-pitfalls.md)

æ ¸å¿ƒå…§å®¹ï¼š
- å¸¸è¦‹æ•ˆèƒ½é™·é˜±
- å»¶é²å„ªåŒ–
- é »å¯¬ç®¡ç†
- æˆæœ¬å„ªåŒ–
- æœ€ä½³å¯¦è¸

## ğŸ’¡ WASM å„ªåŒ–æŠ€å·§

### ç·¨è­¯å„ªåŒ–
1. **Release æ¨¡å¼**
   ```bash
   wasm-pack build --release
   ```

2. **å•Ÿç”¨ LTO**
   ```toml
   [profile.release]
   lto = true
   opt-level = 'z'  # å„ªåŒ–å¤§å°
   # opt-level = 3    # å„ªåŒ–é€Ÿåº¦
   ```

3. **ç§»é™¤èª¿è©¦è³‡è¨Š**
   ```bash
   wasm-opt -Oz -o output.wasm input.wasm
   ```

### æª”æ¡ˆå¤§å°å„ªåŒ–
1. **wasm-opt å„ªåŒ–**
   ```bash
   # æ¥µè‡´å£“ç¸®
   wasm-opt -Oz input.wasm -o output.wasm

   # å¹³è¡¡å„ªåŒ–
   wasm-opt -O3 input.wasm -o output.wasm
   ```

2. **ç§»é™¤æœªä½¿ç”¨ç¨‹å¼ç¢¼**
   ```toml
   [profile.release]
   lto = true
   codegen-units = 1
   ```

3. **gzip å£“ç¸®**
   ```bash
   gzip -9 output.wasm
   ```

## ğŸŒ è¼‰å…¥å„ªåŒ–

### ä¸²æµç·¨è­¯
```javascript
// ä½¿ç”¨ instantiateStreaming æ¸›å°‘è¼‰å…¥æ™‚é–“
WebAssembly.instantiateStreaming(fetch('module.wasm'))
  .then(result => {
    // ä½¿ç”¨ WASM æ¨¡çµ„
  });
```

### æ¼¸é€²å¼è¼‰å…¥
```javascript
async function progressiveLoad(url) {
  const response = await fetch(url);
  const reader = response.body.getReader();
  const chunks = [];

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;

    chunks.push(value);
    // é¡¯ç¤ºè¼‰å…¥é€²åº¦
    const loaded = chunks.reduce((acc, c) => acc + c.length, 0);
    updateProgress(loaded);
  }

  const bytes = new Uint8Array(
    chunks.reduce((acc, c) => acc + c.length, 0)
  );
  let offset = 0;
  for (const chunk of chunks) {
    bytes.set(chunk, offset);
    offset += chunk.length;
  }

  return WebAssembly.instantiate(bytes);
}
```

## â˜ï¸ é›²æœå‹™å„ªåŒ–

### CDN éƒ¨ç½²
```javascript
// ä½¿ç”¨ CDN åŠ é€Ÿ WASM è¼‰å…¥
const WASM_CDN = 'https://cdn.example.com/wasm/';

async function loadFromCDN(module) {
  const url = `${WASM_CDN}${module}.wasm`;
  return WebAssembly.instantiateStreaming(fetch(url));
}
```

### å¿«å–ç­–ç•¥
```javascript
// Service Worker å¿«å–
self.addEventListener('fetch', event => {
  if (event.request.url.endsWith('.wasm')) {
    event.respondWith(
      caches.match(event.request).then(response => {
        return response || fetch(event.request).then(response => {
          const responseClone = response.clone();
          caches.open('wasm-cache').then(cache => {
            cache.put(event.request, responseClone);
          });
          return response;
        });
      })
    );
  }
});
```

### æ•ˆèƒ½ç›£æ§
```javascript
// æ¸¬é‡ WASM è¼‰å…¥æ™‚é–“
const start = performance.now();

WebAssembly.instantiateStreaming(fetch('module.wasm'))
  .then(result => {
    const loadTime = performance.now() - start;
    console.log(`WASM loaded in ${loadTime}ms`);

    // ç™¼é€æ•ˆèƒ½æŒ‡æ¨™
    sendMetrics({ wasmLoadTime: loadTime });
  });
```

**æœ€å¾Œæ›´æ–°**: 2025-12-01
