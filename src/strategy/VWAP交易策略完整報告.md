# VWAP交易策略回測報告

## 目錄
1. [策略概述](#策略概述)
2. [VWAP計算說明](#vwap計算說明)
3. [常見使用方法](#常見使用方法)
4. [回測設定](#回測設定)
5. [策略一：價格與VWAP比較](#策略一價格與vwap比較)
6. [策略二：價格偏離度策略](#策略二價格偏離度策略)
7. [策略三：VWAP交叉](#策略三vwap交叉)
8. [策略總結](#策略總結)

---

## 策略概述

**VWAP (Volume Weighted Average Price, 成交量加權平均價格)** 是均線的衍生指標。相較於簡單移動平均線(SMA)僅計算價格平均值，VWAP在計算時納入成交量作為權重，更能反映市場真實的平均成交價格。

### 核心特性

- 比移動平均線更平滑，波動性較低
- 常用於日內交易的小時間級別（5分鐘以下）
- 被視為短時間級別的趨勢指標
- 可理解為市場參與者的平均持倉成本

---

## VWAP計算說明

### 計算公式

```
VWAP = Σ(價格 × 成交量) / Σ成交量
```

### Python實現

```python
# 計算20期VWAP
data['P_X_V'] = data['Close'] * data['Volume']  # 價格×成交量
data['VWAP'] = data['P_X_V'].rolling(20).sum() / data['Volume'].rolling(20).sum()
```

### VWAP是什麼數值？

**VWAP計算出來是一個價格數值**，代表在特定時間區間內的成交量加權平均價格。

#### 數值範例

假設比特幣在某個時間點：

| 項目 | 數值 |
|------|------|
| 當前價格 (Close) | $50,000 |
| 20期VWAP | $49,500 |

**判斷結果：**
- 價格 ($50,000) > VWAP ($49,500) → **做多訊號**
- 代表當前價格高於加權平均成本，市場偏多方

### 與SMA的差異

#### 簡單移動平均線 (SMA)
```
SMA(20) = (P1 + P2 + ... + P20) / 20
```
- 每個價格權重相同
- 不考慮成交量大小

#### 成交量加權平均 (VWAP)
```
VWAP(20) = (P1×V1 + P2×V2 + ... + P20×V20) / (V1 + V2 + ... + V20)
```
- 成交量大的K線權重更高
- 更能反映市場真實的平均成交價格
- 更接近市場參與者的實際成本

### 實際應用意義

VWAP可以理解為：
- **市場參與者的平均持倉成本**
- 價格在VWAP之上 = 大部分人處於獲利狀態
- 價格在VWAP之下 = 大部分人處於虧損狀態

這也是為什麼它被用作趨勢判斷和支撐壓力的依據。

---

## 常見使用方法

### 1. 趨勢跟隨
- 價格站上VWAP → 做多
- 價格跌破VWAP → 做空

### 2. 配合成交量確認
- 突破VWAP時需有大量配合（爆量）
- 從下往上突破 + 大額青色成交量 → 做多
- 從上往下跌破 + 大額紅色成交量 → 做空
- 如何評估爆量？與之前的成交量做對比

### 3. 結合支撐阻力位
- 支撐與阻力是市場共識的價位
- 當價格在支撐位獲得支撐 + 1分鐘級別突破VWAP → 做多進場時機
- 適合捕捉微弱反彈以達到獲利

---

## 回測設定

- **標的**：比特幣 (Bitcoin)
- **期間**：2020年 - 2025年1月1日（5年數據）
- **原則**：避免過度擬合，測試相對簡單的策略
- **測試策略**：
  1. 價格 > VWAP 做多，價格 < VWAP 做空
  2. 價格 / VWAP - 1（偏離度策略）
  3. 兩條VWAP交叉

---

## 策略一：價格與VWAP比較

### 進場邏輯

```python
# 計算VWAP
data['P_X_V'] = data['Close'] * data['Volume']
data['VWAP'] = data['P_X_V'].rolling(20).sum() / data['Volume'].rolling(20).sum()

# 交易邏輯
if 價格 > VWAP:
    做多
elif 價格 < VWAP:
    做空
```

### 回測範圍

- **時間級別**：1分鐘 - 1天
- **VWAP參數**：20 - 200

### 回測發現

VWAP遇到了與移動平均線相同的問題：
- ❌ 同時進行多空策略時無法獲利
- ✅ 只能通過捕捉趨勢來獲利
- ✅ 改為只做多時，策略整體盈利能力提升

### 最佳參數

經過回測後發現最佳組合：

| 參數 | 數值 |
|------|------|
| **時間級別** | 8小時 |
| **VWAP參數** | 120 |
| **交易方向** | 僅做多 |

### 交易圖表說明

- 🔺 紅色三角形 = 開倉進場
- 🔻 藍色三角形 = 平倉出場

### 績效表現

- 藍色線：策略盈虧累計圖
- 橙色線：比特幣現貨買入持有策略
- 策略能夠在趨勢行情中表現優異

---

## 策略二：價格偏離度策略

### 策略邏輯

計算比特幣價格與VWAP的距離，當距離足夠大時（趨勢確認），再進行入場。

### 計算方式

```python
# 計算VWAP
data['P_X_V'] = data['Close'] * data['Volume']
data['VWAP'] = data['P_X_V'].rolling(ma_rolling).sum() / data['Volume'].rolling(ma_rolling).sum()

# 計算偏離度
data['diff'] = data['Close'] / data['VWAP'] - 1
```

### 進場邏輯

```python
if diff > X%:
    做多  # 價格明顯高於VWAP，趨勢確認
elif diff < -X%:
    做空  # 價格明顯低於VWAP，下跌趨勢確認
```

### 回測範圍

- **時間級別**：1小時 - 1天
- **VWAP參數**：30 - 330
- **DIFF閾值參數**：1% - 10%

### 最佳參數

| 參數 | 數值 |
|------|------|
| **時間級別** | 4小時 |
| **VWAP參數** | 260 |
| **DIFF閾值** | > 1% (0.01) |
| **交易方向** | 僅做多 |

### 策略意義

- diff > 1%：價格比VWAP高出1%以上，確認上漲趨勢
- 避免在價格剛突破VWAP時就進場（假突破風險）
- 等待趨勢確認後再進場，提高勝率

---

## 策略三：VWAP交叉

### 策略說明

使用兩條不同參數的VWAP，當快速VWAP向上交叉慢速VWAP時做多，反之做空。

### 回測結果

❌ **回測數據不理想，不建議使用此方式進行交易**

可能原因：
- VWAP本身已經是平滑指標，交叉信號延遲
- 震盪市場中產生過多假信號
- 不如直接使用價格與VWAP的關係

---

## 策略總結

### ✅ 優點

1. **右側交易**
   - 等待趨勢確認後進場
   - 降低逆勢交易風險

2. **擅長捕捉趨勢**
   - 在明確的上漲或下跌趨勢中表現優異
   - 能夠過濾部分雜訊

3. **策略排名**
   1. 🥇 價格 > VWAP（簡單有效）
   2. 🥈 價格 / VWAP - 1（偏離度，提高進場準確度）
   3. 🥉 VWAP交叉（不推薦）

### ❌ 缺點

1. **震盪市場表現不佳**
   - 橫盤震盪時會產生頻繁虧損
   - 需要額外過濾條件或停損機制

2. **無法同時多空**
   - 回測顯示只能做多才能獲利
   - 做空策略效果不佳

3. **需要額外優化**
   - 需要解決震盪市場的虧損問題
   - 可能需要配合其他指標或條件

### 💡 改進建議

1. **加入過濾條件**
   - 配合趨勢指標（如ADX）過濾震盪市場
   - 加入成交量確認機制

2. **優化停損停利**
   - 設定合理的停損點
   - 使用移動停利保護獲利

3. **結合其他技術分析**
   - 支撐阻力位
   - 多時間框架分析
   - 關鍵價格區域

---

## 與其他指標比較

### 常用趨勢指標對比

| 指標 | 特點 | 適用場景 |
|------|------|----------|
| **均線 (MA)** | 簡單直觀 | 趨勢判斷 |
| **布林通道 (BB)** | 提供波動率信息 | 超買超賣、區間突破 |
| **VWAP** | 考慮成交量權重 | 日內交易、機構成本 |

### 選擇建議

根據以下因素選擇合適的指標：
- **交易週期**：日內交易優先考慮VWAP
- **市場環境**：趨勢市場用均線，震盪市場用布林通道
- **交易風格**：主觀交易可多指標結合，程式交易建議單一指標優化

---

## 附錄：Sharp Ratio說明

### Sharp Ratio表現

- 青色圖片：2020-2022年策略表現
- 藍色圖片：2023-2024年策略表現

Sharp Ratio用於衡量風險調整後的報酬率，數值越高代表策略在承擔相同風險下獲得更高的回報。

---

## 結語

VWAP是一個簡單但有效的趨勢跟隨指標，特別適合：
- ✅ 趨勢明確的市場環境
- ✅ 只做多的交易策略
- ✅ 中長時間週期（4-8小時）

但需要注意：
- ⚠️ 震盪市場需要額外過濾
- ⚠️ 不建議用於純粹的多空策略
- ⚠️ 需要配合良好的資金管理

**建議實盤前先進行充分的模擬交易測試！**

---

*本報告基於歷史數據回測，過去績效不代表未來表現。交易有風險，投資需謹慎。*
