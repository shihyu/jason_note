# 台股族群輪動策略回測結果報告

## 📋 專案概述

**回測期間**：2020-01-01 ~ 2026-01-23（約 6 年）

**測試策略**：
1. **策略1：族群相對強弱法**
2. **策略2：族群同步性法**
3. **策略3：綜合法**

**數據來源**：FinLab（台股完整數據）

**Rebalance 頻率**：月度（每月第一個交易日調倉）

---

## ⚠️ 重要說明

### ✅ 回測修正（2026-01-26）

本報告已修正以下問題：

1. **Look-ahead Bias（提前使用當天數據）**
   - 訊號延後一天生效，避免提前享受當天報酬
   - 在 t 日計算的訊號，在 t+1 日才買入

2. **交易成本扣除**
   - 買入手續費：0.1425% × 30%（券商折扣 70% off）= 0.0428%
   - 賣出手續費：0.1425% × 30% = 0.0428%
   - 證交稅：0.3%（賣出時固定）
   - **單次買賣總成本**：約 0.39%

**修正影響**：策略 1 年化報酬從 25.29% 降至 22.02%，但仍表現優異。詳見 `CORRECTION_ANALYSIS.md`。

---

## 🏆 績效總覽

### 三策略對比表

| 策略名稱 | 年化報酬 | Sharpe Ratio | 最大回撤 | 勝率 | 總交易次數 |
|---------|---------|-------------|----------|------|-----------|
| **策略1 相對強弱** 🏆 | **22.02%** | **1.10** | **-29.06%** | **54.15%** | 602 |
| 策略2 同步性 ❌ | -13.72% | -0.69 | -64.88% | 48.88% | 588 |
| 策略3 綜合法 ❌ | -3.93% | -0.05 | -64.16% | 48.32% | 271 |

### 最優策略

🥇 **策略1：族群相對強弱法**

**優勢**：
- ✅ 年化報酬最高（22.02%，扣除交易成本後仍優異）
- ✅ Sharpe Ratio 最佳（1.10，風險調整後報酬優異）
- ✅ 最大回撤最小（-29.06%，風險控制最好）
- ✅ 勝率最高（54.15%，超過一半交易獲利）
- ✅ **抗 Look-ahead Bias 能力強**，策略穩健

**累積報酬**：6 年累積 **220.48%**（約 3.20 倍）

---

### ❌ 策略 2、3 已失效

修正後策略 2 和策略 3 轉為負報酬，**不建議實盤使用**：
- 策略 2：年化 -13.72%，最大回撤 -64.88%
- 策略 3：年化 -3.93%，最大回撤 -64.16%

**原因**：過度依賴技術指標，受 Look-ahead Bias 影響嚴重。

---

## 📊 策略詳細分析

### 策略1：族群相對強弱法

#### 選股邏輯
1. 計算所有族群近 10 日報酬
2. 扣除加權指數同期報酬（相對強度 RS）
3. 選擇 RS 排名 **Top 20%** 的族群
4. 在這些族群中選擇 **PB Ratio 最低**的 10 檔股票

#### 績效指標（已扣除交易成本）
```
年化報酬率（CAGR）        : 22.02%
Sharpe Ratio             : 1.10
最大回撤（Max Drawdown）  : -29.06%
勝率（Win Rate）          : 54.15%
總交易次數                : 602

累積報酬曲線摘要
------------------------------------------------------------
起始日期                  : 2020-01-02
結束日期                  : 2026-01-23
最終累積報酬              : 220.48%

交易成本設定
------------------------------------------------------------
買入手續費                : 0.0428%（0.1425% × 30%）
賣出手續費                : 0.0428%（0.1425% × 30%）
證交稅                    : 0.3%（賣出時）
單次買賣總成本            : 約 0.39%
```

#### 策略特點
- **優勢**：抓住強勢族群的趨勢，價值選股降低風險
- **適用市場**：多頭與震蕩市場
- **風險**：族群輪動失效時可能表現平庸

---

### 策略2：族群同步性法

#### 選股邏輯
1. 計算每個族群內「站上 20MA 的股票比例」
2. 當比例 **≥ 30%** 時，判定族群啟動
3. 在啟動族群中選擇「**補漲股**」（4 個條件）：
   - 價格未創 20 日新高
   - 近 5 日報酬 > 大盤（RS 翻正）
   - 價格位於季線（60MA）～半年線（120MA）之間
   - 成交量 > 20 日均量

#### 績效指標（已扣除交易成本）
```
年化報酬率（CAGR）        : -13.72%
Sharpe Ratio             : -0.69
最大回撤（Max Drawdown）  : -64.88%
勝率（Win Rate）          : 48.88%
總交易次數                : 588

累積報酬曲線摘要
------------------------------------------------------------
起始日期                  : 2020-01-02
結束日期                  : 2026-01-23
最終累積報酬              : -59.13%
```

#### ❌ 策略失效原因
- **Look-ahead Bias 影響嚴重**：複雜技術指標依賴當天數據
- **補漲股邏輯過於嚴格**：錯過主升段
- **交易成本侵蝕報酬**：月度調倉 + 多檔換手
- **風險極高**：最大回撤達 -64.88%
- **不建議實盤使用**

---

### 策略3：綜合法

#### 選股邏輯
結合策略1和策略2的條件（三個條件全部滿足）：
1. 族群相對強弱排名 **Top 30%**（比策略1更寬鬆）
2. 族群同步性 **≥ 30%**
3. 族群 3 日平均成交金額 > 前 20 日均值（**量能確認**）
4. 個股條件：使用策略2的補漲股邏輯

#### 績效指標（已扣除交易成本）
```
年化報酬率（CAGR）        : -3.93%
Sharpe Ratio             : -0.05
最大回撤（Max Drawdown）  : -64.16%
勝率（Win Rate）          : 48.32%
總交易次數                : 271

累積報酬曲線摘要
------------------------------------------------------------
起始日期                  : 2020-01-02
結束日期                  : 2026-01-23
最終累積報酬              : -22.26%
```

#### ❌ 策略失效原因
- **過度優化**：多重條件篩選導致回測過擬合
- **Look-ahead Bias 影響嚴重**：依賴多個當天技術指標
- **選股過少**：交易次數僅 271 次，錯過機會
- **風險極高**：最大回撤達 -64.16%
- **未達到「取長補短」效果**，反而綜合了兩者缺點
- **不建議實盤使用**

---

## 💡 結論與建議

### 主要發現

1. **策略1（相對強弱法）表現最佳** ✅
   - 簡單有效，抓住族群輪動主升段
   - Sharpe Ratio 1.10 表示風險調整後報酬優異
   - **抗 Look-ahead Bias 能力強**，策略穩健
   - 修正後年化報酬仍達 22.02%，適合實盤

2. **策略2（同步性法）修正後失效** ❌
   - 補漲股邏輯過度依賴技術指標
   - Look-ahead Bias 影響嚴重（-9.56%）
   - 最大回撤惡化至 -64.88%，風險極高
   - **不建議實盤使用**

3. **策略3（綜合法）過度優化導致失效** ❌
   - 多重條件篩選導致回測過擬合
   - 修正後轉為負報酬（-3.93%）
   - 最大回撤達 -64.16%
   - **不建議實盤使用**

4. **Look-ahead Bias 和交易成本的影響** ⚠️
   - 簡單策略（策略1）受影響較小（-3.27%）
   - 複雜策略（策略2/3）受影響巨大（-5% ~ -10%）
   - 月度調倉交易成本約 1-2% CAGR

### 實務建議

#### 給投資人
1. ✅ **僅推薦策略1（族群相對強弱法）**
   - 簡單、穩定、回撤可控
   - 年化 22.02% 且 Sharpe 1.10（扣除成本後仍優異）
   - 抗 Look-ahead Bias 能力強，策略穩健

2. ❌ **不推薦策略2、3**
   - 修正後轉為負報酬
   - 最大回撤超過 -60%，風險極高
   - 過度依賴技術指標，實盤失效

3. ⚠️ **風險提醒**
   - 歷史績效不代表未來表現
   - 最大回撤 -29.06% 仍需承受
   - 建議配置不超過總資產 30-50%
   - **實盤可能有滑價、流動性等額外成本**

4. 💡 **優化方向**
   - 可加入停損機制（如 -10%）
   - 可結合大盤趨勢過濾（空頭時降低倉位）
   - 券商折扣建議選擇 60-70% off

#### 給研究者
1. **回測規範（必須遵守）** ⚠️
   - 必須避免 Look-ahead Bias（訊號延後一天生效）
   - 必須扣除交易成本（手續費 + 證交稅）
   - 券商折扣建議使用 60-70% off（保守估計）
   - 詳見 `CORRECTION_ANALYSIS.md`

2. **策略開發建議**
   - **簡單策略 > 複雜策略**
   - 減少對當天多個技術指標的依賴
   - 優先選擇「趨勢型」而非「技術指標型」
   - 避免過度優化（回測過擬合）

3. **成本估算**
   - 月度調倉：年度成本約 1-2% CAGR
   - 週度調倉：年度成本約 4-8% CAGR
   - 日度調倉：不建議（成本過高）

4. **策略2/3 優化方向**（僅供研究）
   - 放寬補漲股條件（如只要求 RS 翻正）
   - 改為「強勢股延續」而非「補漲股」
   - 減少條件數量（如只用 RS + 量能）
   - 考慮「或」邏輯而非「且」邏輯

---

## 📈 關鍵數據對比

### 年化報酬 vs 風險（Sharpe Ratio）

```
策略1：22.02% CAGR / 1.10 Sharpe  ← 高報酬 + 高 Sharpe ✅
策略2：-13.72% CAGR / -0.69 Sharpe ← 負報酬 ❌
策略3：-3.93% CAGR / -0.05 Sharpe  ← 負報酬 ❌
```

**解讀**：策略1 在報酬和風險調整後報酬都是最優，策略2/3 修正後失效

### 最大回撤對比

```
策略1：-29.06%  ← 風險最小 ✅
策略2：-64.88%  ← 風險極高 ❌
策略3：-64.16%  ← 風險極高 ❌
```

**解讀**：策略2/3 修正後回撤惡化嚴重，不適合實盤

### 勝率對比

```
策略1：54.15%  ← 超過一半獲利 ✅
策略2：48.88%
策略3：48.32%
```

**解讀**：策略1 選股邏輯最穩定

---

### 修正前後對比（策略1）

| 指標 | 修正前 | 修正後 | 影響 |
|------|--------|--------|------|
| 年化報酬 | 25.29% | 22.02% | -3.27% |
| Sharpe Ratio | 1.25 | 1.10 | -0.15 |
| 最大回撤 | -27.68% | -29.06% | -1.38% |
| 勝率 | 54.44% | 54.15% | -0.29% |
| 累積報酬 | 283.62% | 220.48% | -63.14% |

**解讀**：Look-ahead Bias + 交易成本影響約 -3.27% CAGR，但策略仍然有效

---

## 🔧 技術實現

### 專案結構
```
sector-rotation-backtest/
├── src/
│   ├── data_loader.py                  # 數據載入模組
│   ├── strategy1_relative_strength.py  # 策略1
│   ├── strategy2_synchronization.py    # 策略2
│   ├── strategy3_combined.py           # 策略3
│   └── backtest_runner.py              # 回測執行器
├── tests/                              # 36 個測試案例
├── results/                            # 回測結果
└── Makefile                            # 自動化建置
```

### 使用方式

```bash
# 1. 安裝依賴
make setup

# 2. 執行測試（驗證程式正確性）
make test

# 3. 執行完整回測
make run

# 4. 查看結果
cat results/comparison.csv              # 對比表格
cat results/strategy1_report.txt        # 策略1詳細報告
```

### 技術特點
- ✅ **TDD 開發**：先寫測試，後寫實作
- ✅ **模組化設計**：三策略獨立實作，易於維護
- ✅ **完整測試**：36 個測試案例，100% 通過
- ✅ **中文文件**：完整註解和報告

---

## 📚 附錄

### 回測參數設定

| 參數 | 策略1 | 策略2 | 策略3 |
|------|-------|-------|-------|
| RS 計算週期 | 10 日 | - | 10 日 |
| 族群篩選比例 | Top 20% | - | Top 30% |
| 同步性閾值 | - | 30% | 30% |
| 量能確認週期 | - | - | 3 日 |
| 選股數量 | 10 檔 | 15 檔 | 15 檔 |
| Rebalance | 月度 | 月度 | 月度 |
| **訊號延遲** | **1 天** | **1 天** | **1 天** |

### 交易成本設定

| 項目 | 費率 | 說明 |
|------|------|------|
| 買入手續費 | 0.1425% | 官方費率 |
| 券商折扣 | 70% off | 實付 0.0428% |
| 賣出手續費 | 0.1425% | 官方費率 |
| 券商折扣 | 70% off | 實付 0.0428% |
| 證交稅 | 0.3% | 賣出時固定 |
| **單次買賣總成本** | **≈ 0.39%** | 買入 0.0428% + 賣出 0.3428% |

### 數據覆蓋

- **族群數量**：30 個台股主要族群
- **股票數量**：全市場 2000+ 檔
- **數據週期**：2020-01-01 ~ 2026-01-23
- **交易日數**：約 1,475 個交易日

### 績效計算方式

```python
# 訊號延遲（避免 Look-ahead Bias）
signals_shifted = signals.shift(1)  # t 日訊號在 t+1 日才執行

# 交易成本計算
buy_cost = 買入股數 × 0.1425% × 30%  # 手續費（券商折扣）
sell_cost = 賣出股數 × (0.1425% × 30% + 0.3%)  # 手續費 + 證交稅
total_cost = (buy_cost + sell_cost) / 持股數量

# 策略報酬（扣除成本後）
strategy_returns = raw_returns - total_cost

# 年化報酬率（CAGR）
CAGR = (最終淨值 / 初始淨值) ^ (1 / 年數) - 1

# Sharpe Ratio（無風險利率假設為 0）
Sharpe = (日均報酬 / 日報酬標準差) * √252

# 最大回撤
Max Drawdown = min((當前淨值 - 歷史最高淨值) / 歷史最高淨值)

# 勝率（僅計算有持倉的日子）
Win Rate = 獲利日數 / 有持倉日數
```

---

## 📞 聯絡資訊

**專案位置**：`/home/shihyu/github/jason_note/src/strategy/sector-rotation-backtest/`

**回測日期**：2026-01-26

**生成工具**：Claude Code + FinLab

**回測修正**：
- ✅ 已修正 Look-ahead Bias（訊號延後一天生效）
- ✅ 已扣除交易成本（手續費 + 證交稅）
- 📄 詳見 `CORRECTION_ANALYSIS.md` 完整修正報告

---

**免責聲明**：本報告僅供研究參考，不構成投資建議。歷史績效不代表未來表現，投資人應自行評估風險。修正後的回測更接近實盤情況，但仍可能存在其他偏差（滑價、流動性、市場衝擊等）。
