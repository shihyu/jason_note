<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>當沖 - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="當沖交易心法與技巧整理-阿魯米"><a class="header" href="#當沖交易心法與技巧整理-阿魯米">當沖交易心法與技巧整理 (阿魯米)</a></h1>
<h2 id="當沖基本原則"><a class="header" href="#當沖基本原則">當沖基本原則</a></h2>
<h3 id="選股條件"><a class="header" href="#選股條件">選股條件</a></h3>
<ol>
<li>選擇平均震幅大的股票
<ul>
<li>近三日或五日平均震幅高於 5%</li>
<li>避免選擇震幅小的股票(如中華電信)</li>
</ul>
</li>
<li>周轉率高的股票
<ul>
<li>代表流動性好</li>
<li>大量但周轉率低的股票(如台積電)不適合</li>
</ul>
</li>
<li>日線處於趨勢發動中或高檔震盪的股票</li>
<li>年輕、股本小且震盪大的股票
<ul>
<li>新上市櫃十年內</li>
<li>法人持股不多</li>
<li>容易有大波段</li>
</ul>
</li>
</ol>
<h3 id="交易基本概念"><a class="header" href="#交易基本概念">交易基本概念</a></h3>
<ol>
<li>
<p>觀察大盤方向</p>
<ul>
<li>大盤是最主要的方向參考</li>
<li>參考期貨,盡量不逆勢操作</li>
<li>台指偏多則選多方名單,空方亦然</li>
</ul>
</li>
<li>
<p>開盤價的重要性</p>
<ul>
<li>不要只看漲跌,要看開盤價位置</li>
<li>在開盤價附近區間脫離一段,基本上就是當天方向</li>
<li>開盤價可視為多空分界</li>
<li>價格在開盤價以下表示當天弱勢,收黑機率大</li>
<li>價格持續在開盤價上方,表示強勢,收紅機率大</li>
</ul>
</li>
<li>
<p>均價線運用</p>
<ul>
<li>均價線代表當天成交平均價格</li>
<li>可視為短期均線概念</li>
<li>在均價線上方逢低接</li>
<li>在均價線下方逢高空</li>
</ul>
</li>
<li>
<p>盤中量能觀察</p>
<ul>
<li>一個方向走一段時間出現大量,通常是極短線高低點</li>
<li>可能出現拉回或反彈(但不代表反轉)</li>
<li>出量位置若不拉回或反彈,則成為支撐壓力區</li>
<li>上漲出量、拉回量縮是多方表現</li>
<li>下跌出量、反彈量縮是空方表現</li>
</ul>
</li>
</ol>
<h2 id="風險控制"><a class="header" href="#風險控制">風險控制</a></h2>
<h3 id="停損原則"><a class="header" href="#停損原則">停損原則</a></h3>
<ol>
<li>停損、停損、停損(重要所以說三次)</li>
<li>收盤前清理虧損部位,不帶回家</li>
<li>每筆交易虧損控制在 2% 以內</li>
<li>遇到重大虧損應:
<ul>
<li>立即減少交易量或停止交易</li>
<li>重點是重拾交易信心,而非急於彌補虧損</li>
<li>避免單量越做越大想一舉翻身</li>
</ul>
</li>
</ol>
<h3 id="心態管理"><a class="header" href="#心態管理">心態管理</a></h3>
<ol>
<li>
<p>保持平靜</p>
<ul>
<li>市場隨時可能重擊</li>
<li>虧損時表示情況不利,不要急躁</li>
<li>大賺大賠都要保持冷靜</li>
</ul>
</li>
<li>
<p>避免衝動交易</p>
<ul>
<li>最糟糕的交易來自衝動</li>
<li>根據既定信號進行交易</li>
<li>不要因一時衝動改變策略</li>
</ul>
</li>
<li>
<p>持續學習檢討</p>
<ul>
<li>每天分析每筆交易</li>
<li>檢討是否有違規情況</li>
<li>分析成功與失敗原因</li>
</ul>
</li>
</ol>
<h2 id="進階技巧"><a class="header" href="#進階技巧">進階技巧</a></h2>
<h3 id="季線理論"><a class="header" href="#季線理論">季線理論</a></h3>
<ol>
<li>股價在季線(60日均線)上徘徊一段時間後</li>
<li>開盤價直接開在季線下至少 2%</li>
<li>通常代表空方力量強大</li>
<li>適合當沖做空</li>
<li>觀察 09:30 前是否拉過平盤</li>
<li>勝率約九成</li>
</ol>
<h3 id="交易時機選擇"><a class="header" href="#交易時機選擇">交易時機選擇</a></h3>
<ol>
<li>等待市場明朗再進場</li>
<li>不預測行情,讓市場告訴方向</li>
<li>選擇萬無一失的機會</li>
<li>策略需具彈性應對市場變化</li>
</ol>
<h3 id="資金管理"><a class="header" href="#資金管理">資金管理</a></h3>
<ol>
<li>操作順利時可適度加碼</li>
<li>情況不佳時減碼或停止交易</li>
<li>著重如何減少虧損,而非如何多賺</li>
<li>避免重倉操作</li>
<li>好倉要耐心持有,壞倉要果斷減碼</li>
</ol>
<h2 id="市場認知"><a class="header" href="#市場認知">市場認知</a></h2>
<h3 id="交易本質"><a class="header" href="#交易本質">交易本質</a></h3>
<ol>
<li>交易是一種對賭遊戲</li>
<li>競爭對手是整體市場參與者</li>
<li>獲利來自對手的錯誤決策</li>
<li>重要的是認清自己,發現並改進錯誤</li>
<li>遵守紀律,提高勝率</li>
</ol>
<h3 id="市場參與者"><a class="header" href="#市場參與者">市場參與者</a></h3>
<ol>
<li>不要高估對手能力</li>
<li>也不要輕視對手</li>
<li>資訊不對稱是主要優勢</li>
<li>主力也會演戲誤導市場</li>
</ol>
<h3 id="長期生存之道"><a class="header" href="#長期生存之道">長期生存之道</a></h3>
<ol>
<li>穩定獲利比單次暴賺重要</li>
<li>交易系統要持之以恆</li>
<li>賺錢時要更加謹慎</li>
<li>重點不是瞬間獲利多寡</li>
<li>而是能賺得長,活得久</li>
</ol>
<h2 id="實戰注意事項"><a class="header" href="#實戰注意事項">實戰注意事項</a></h2>
<ol>
<li>
<p>當沖很難穩定獲利</p>
<ul>
<li>交易成本高</li>
<li>隨機性強</li>
<li>需要長期練習</li>
</ul>
</li>
<li>
<p>不要相信誇大廣告</p>
<ul>
<li>特別是號稱暴賺</li>
<li>無本操作</li>
<li>華麗詞彙包裝</li>
</ul>
</li>
<li>
<p>新手建議</p>
<ul>
<li>不要期待暴賺</li>
<li>先求穩定獲利</li>
<li>逐步提升層次</li>
<li>從基本心法做起</li>
</ul>
</li>
<li>
<p>盈虧比例</p>
<ul>
<li>當沖輸的人多,贏的少</li>
<li>穩定賺錢者極少</li>
<li>要思考自己的優勢在哪</li>
</ul>
</li>
</ol>
<p>注意：本文整理僅供參考，投資一定有風險，須依個人判斷為準。</p>
<hr />
<ul>
<li>做空
<ul>
<li>空頭年(2022年) 找弱勢股拉高隔天空 by 權證小哥</li>
<li>原本基本面很好 突然不好用股期做空 by 非比斯</li>
</ul>
</li>
</ul>
<hr />
<pre><code class="language-python">import os
import json
from loguru import logger
import pandas as pd
import shioaji as sj
import matplotlib.pyplot as plt
from matplotlib.dates import DateFormatter


def load_credentials(file_path):
    """Load API credentials from a JSON file."""
    with open(file_path, "r") as f:
        users = json.load(f)
    return users["Jason"]["api_key"], users["Jason"]["secret_key"]


def login(simulation=False):
    """Login to the Shioaji API."""
    api = sj.Shioaji(simulation=simulation)
    token_file = os.path.expanduser("~/.mybin/shioaji_tokens.json")
    api_key, secret_key = load_credentials(token_file)
    api.login(api_key, secret_key, contracts_timeout=30000)
    return api


def detect_pullback(tick_data, threshold=0.02, lookback=10):
    """
    偵測符合條件的型態：
    1. 低點必須在高點左邊
    2. 高點與低點的差距必須超過 threshold (預設 2%)
    3. 當價格從高點拉回後觸發
    :param tick_data: 含有 'ts' 和 'close' 的 DataFrame
    :param threshold: 高低點差距的百分比門檻 (預設 2%)
    :param lookback: 在多少範圍內尋找高點與低點 (預設 10 個 tick)
    :return: 回傳一個字典，包含觸發與否和相關時間
    """
    for i in range(lookback, len(tick_data)):
        window = tick_data.iloc[i - lookback : i]
        low_idx = window["close"].idxmin()
        high_idx = window["close"].idxmax()
        if low_idx &lt; high_idx:
            price_change = (
                tick_data.loc[high_idx, "close"] - tick_data.loc[low_idx, "close"]
            ) / tick_data.loc[low_idx, "close"]
            if (
                price_change &gt;= threshold
                and tick_data.iloc[i]["close"] &lt; tick_data.loc[high_idx, "close"]
            ):
                return {
                    "triggered": True,
                    "low_time": low_idx,
                    "high_time": high_idx,
                    "pullback_time": tick_data.index[i],
                }
    return {"triggered": False}


def print_usage(api):
    """Print API usage statistics."""
    usage_status = api.usage()
    usage_MB = usage_status.bytes / (1024 * 1024)
    limit_MB = usage_status.limit_bytes / (1024 * 1024)
    remaining_MB = usage_status.remaining_bytes / (1024 * 1024)
    logger.info(
        f"connections={usage_status.connections}, "
        f"usage MB={usage_MB:.2f}, "
        f"limit MB={limit_MB:.2f}, "
        f"remaining MB={remaining_MB:.2f}"
    )


def fetch_and_process_ticks(api, stock_code, date):
    """Fetch and process tick data for a given stock and date."""
    contract = api.Contracts.Stocks[stock_code]
    ticks = api.ticks(contract=contract, date=date)
    df_ticks = pd.DataFrame({**ticks})
    df_ticks["ts"] = pd.to_datetime(df_ticks["ts"])
    df_ticks = df_ticks.set_index("ts")
    return df_ticks[~df_ticks.index.duplicated(keep="last")]


def plot_ticks_with_markers(df_ticks, result):
    """Plot tick data with markers for high, low, and pullback points."""
    plt.figure(figsize=(12, 6))
    plt.plot(df_ticks.index, df_ticks["close"], label="Close Price")

    if result["triggered"]:
        plt.scatter(
            result["low_time"],
            df_ticks.loc[result["low_time"], "close"],
            color="green",
            s=100,
            marker="^",
            label="Low Point",
        )
        plt.scatter(
            result["high_time"],
            df_ticks.loc[result["high_time"], "close"],
            color="red",
            s=100,
            marker="v",
            label="High Point",
        )
        plt.scatter(
            result["pullback_time"],
            df_ticks.loc[result["pullback_time"], "close"],
            color="blue",
            s=100,
            marker="o",
            label="Pullback Point",
        )

    plt.xlabel("Time")
    plt.ylabel("Price")
    plt.title("Tick Data with Pullback Detection")
    plt.legend()

    # Format x-axis to show time
    plt.gca().xaxis.set_major_formatter(DateFormatter("%H:%M:%S"))
    plt.gcf().autofmt_xdate()  # Rotate and align the tick labels

    plt.grid(True)
    plt.tight_layout()
    plt.show()


def main():
    api = login()
    try:
        df_ticks = fetch_and_process_ticks(api, "1316", "2024-02-27")
        print(df_ticks.to_markdown(floatfmt=".2f"))
        result = detect_pullback(df_ticks)
        print(result)
        print_usage(api)

        # Plot the tick data with markers
        plot_ticks_with_markers(df_ticks, result)
    except Exception as e:
        logger.exception(e)
    finally:
        api.logout()


if __name__ == "__main__":
    main()

`
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../strategy/建倉加碼.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../strategy/當沖做空.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../strategy/建倉加碼.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../strategy/當沖做空.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
