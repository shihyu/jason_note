<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rust RESTful API 完整開發指南 - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="完整-rust-restful-api-開發指南"><a class="header" href="#完整-rust-restful-api-開發指南">完整 Rust RESTful API 開發指南</a></h1>
<h2 id="-目錄"><a class="header" href="#-目錄">📋 目錄</a></h2>
<ul>
<li><a href="#%E5%B0%88%E6%A1%88%E6%A6%82%E8%BF%B0">專案概述</a></li>
<li><a href="#%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99">環境準備</a></li>
<li><a href="#%E5%B0%88%E6%A1%88%E7%B5%90%E6%A7%8B">專案結構</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A2%BC">核心代碼</a></li>
<li><a href="#%E5%8A%9F%E8%83%BD%E7%89%B9%E8%89%B2">功能特色</a></li>
<li><a href="#api-%E6%96%87%E6%AA%94">API 文檔</a></li>
<li><a href="#%E6%B8%AC%E8%A9%A6%E6%8C%87%E5%8D%97">測試指南</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97">部署指南</a></li>
<li><a href="#%E6%93%B4%E5%B1%95%E5%BB%BA%E8%AD%B0">擴展建議</a></li>
<li><a href="#%E5%B8%B8%E8%A6%8B%E5%95%8F%E9%A1%8C">常見問題</a></li>
</ul>
<h2 id="專案概述"><a class="header" href="#專案概述">專案概述</a></h2>
<p>這是一個使用 Rust 語言和 Axum 框架開發的完整 RESTful API 專案。專案展示了如何使用現代 Rust 技術棧構建高性能、類型安全的 web 服務。</p>
<h3 id="技術棧"><a class="header" href="#技術棧">技術棧</a></h3>
<ul>
<li><strong>語言</strong>: Rust 1.70+</li>
<li><strong>框架</strong>: Axum 0.7</li>
<li><strong>異步運行時</strong>: Tokio</li>
<li><strong>序列化</strong>: Serde</li>
<li><strong>日誌</strong>: Tracing</li>
<li><strong>測試</strong>: 內建測試框架</li>
</ul>
<h3 id="主要功能"><a class="header" href="#主要功能">主要功能</a></h3>
<ul>
<li>用戶管理（CRUD 操作）</li>
<li>輸入驗證和錯誤處理</li>
<li>結構化日誌記錄</li>
<li>健康檢查端點</li>
<li>完整的測試覆蓋</li>
</ul>
<h2 id="環境準備"><a class="header" href="#環境準備">環境準備</a></h2>
<h3 id="系統要求"><a class="header" href="#系統要求">系統要求</a></h3>
<ul>
<li>Rust 1.70 或更高版本</li>
<li>Cargo 包管理器</li>
<li>curl 或 HTTPie（用於測試）</li>
</ul>
<h3 id="安裝-rust"><a class="header" href="#安裝-rust">安裝 Rust</a></h3>
<pre><code class="language-bash"># 安裝 Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# 更新到最新版本
rustup update

# 驗證安裝
rustc --version
cargo --version
</code></pre>
<h3 id="創建專案"><a class="header" href="#創建專案">創建專案</a></h3>
<pre><code class="language-bash"># 創建新專案
cargo new rust-restful-api
cd rust-restful-api
</code></pre>
<h2 id="專案結構"><a class="header" href="#專案結構">專案結構</a></h2>
<pre><code>rust-restful-api/
├── Cargo.toml              # 依賴配置
├── src/
│   └── main.rs            # 主程式
├── tests/                 # 測試檔案
│   └── integration_tests.rs
├── scripts/               # 腳本檔案
│   └── test_api.sh
├── docker/                # Docker 配置
│   └── Dockerfile
└── README.md              # 專案說明
</code></pre>
<h2 id="核心代碼"><a class="header" href="#核心代碼">核心代碼</a></h2>
<h3 id="1-cargotoml-配置"><a class="header" href="#1-cargotoml-配置">1. Cargo.toml 配置</a></h3>
<pre><code class="language-toml">[package]
name = "rust-restful-api"
version = "0.1.0"
edition = "2021"
description = "A complete RESTful API example in Rust using Axum"

[dependencies]
axum = "0.7"
tokio = { version = "1.0", features = ["full"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
uuid = { version = "1.0", features = ["v4", "serde"] }
tracing = "0.1"
tracing-subscriber = "0.3"
anyhow = "1.0"
chrono = { version = "0.4", features = ["serde"] }
tower = "0.4"

[dev-dependencies]
tower-test = "0.4"
</code></pre>
<h3 id="2-主程式-srcmainrs"><a class="header" href="#2-主程式-srcmainrs">2. 主程式 (src/main.rs)</a></h3>
<pre><pre class="playground"><code class="language-rust">use axum::{
    extract::{Json, Path, State},
    http::StatusCode,
    response::Json as ResponseJson,
    routing::{delete, get, post, put},
    Router,
};
use chrono::{DateTime, Utc};
use serde::{Deserialize, Serialize};
use std::collections::HashMap;
use std::sync::{Arc, Mutex};
use tokio::net::TcpListener;
use tracing::{info, warn, Level};
use uuid::Uuid;

// 數據模型
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct User {
    pub id: Uuid,
    pub name: String,
    pub email: String,
    pub age: u32,
    pub created_at: DateTime&lt;Utc&gt;,
    pub updated_at: DateTime&lt;Utc&gt;,
}

#[derive(Debug, Deserialize)]
pub struct CreateUserRequest {
    pub name: String,
    pub email: String,
    pub age: u32,
}

#[derive(Debug, Deserialize)]
pub struct UpdateUserRequest {
    pub name: Option&lt;String&gt;,
    pub email: Option&lt;String&gt;,
    pub age: Option&lt;u32&gt;,
}

// 響應模型
#[derive(Debug, Serialize)]
pub struct UserResponse {
    pub id: Uuid,
    pub name: String,
    pub email: String,
    pub age: u32,
    pub created_at: DateTime&lt;Utc&gt;,
    pub updated_at: DateTime&lt;Utc&gt;,
}

#[derive(Debug, Serialize)]
pub struct UsersListResponse {
    pub users: Vec&lt;UserResponse&gt;,
    pub total: usize,
}

#[derive(Debug, Serialize)]
pub struct ErrorResponse {
    pub error: String,
    pub code: u16,
    pub timestamp: DateTime&lt;Utc&gt;,
}

#[derive(Debug, Serialize)]
pub struct HealthResponse {
    pub status: String,
    pub timestamp: DateTime&lt;Utc&gt;,
    pub version: String,
}

// 應用狀態
pub type AppState = Arc&lt;Mutex&lt;HashMap&lt;Uuid, User&gt;&gt;&gt;;

// 輔助函數
impl User {
    fn new(name: String, email: String, age: u32) -&gt; Self {
        let now = Utc::now();
        Self {
            id: Uuid::new_v4(),
            name,
            email,
            age,
            created_at: now,
            updated_at: now,
        }
    }
    
    fn update(&amp;mut self, request: UpdateUserRequest) {
        if let Some(name) = request.name {
            self.name = name;
        }
        if let Some(email) = request.email {
            self.email = email;
        }
        if let Some(age) = request.age {
            self.age = age;
        }
        self.updated_at = Utc::now();
    }
}

impl From&lt;User&gt; for UserResponse {
    fn from(user: User) -&gt; Self {
        Self {
            id: user.id,
            name: user.name,
            email: user.email,
            age: user.age,
            created_at: user.created_at,
            updated_at: user.updated_at,
        }
    }
}

// 錯誤處理
fn create_error_response(error: &amp;str, code: u16) -&gt; ErrorResponse {
    ErrorResponse {
        error: error.to_string(),
        code,
        timestamp: Utc::now(),
    }
}

// 輸入驗證
fn validate_create_user_request(request: &amp;CreateUserRequest) -&gt; Result&lt;(), String&gt; {
    if request.name.trim().is_empty() {
        return Err("Name cannot be empty".to_string());
    }
    if request.email.trim().is_empty() {
        return Err("Email cannot be empty".to_string());
    }
    if !request.email.contains('@') {
        return Err("Invalid email format".to_string());
    }
    if request.age &gt; 150 {
        return Err("Age must be reasonable".to_string());
    }
    Ok(())
}

// API 處理器
pub async fn health_check() -&gt; ResponseJson&lt;HealthResponse&gt; {
    ResponseJson(HealthResponse {
        status: "healthy".to_string(),
        timestamp: Utc::now(),
        version: env!("CARGO_PKG_VERSION").to_string(),
    })
}

pub async fn get_all_users(
    State(state): State&lt;AppState&gt;
) -&gt; Result&lt;ResponseJson&lt;UsersListResponse&gt;, (StatusCode, ResponseJson&lt;ErrorResponse&gt;)&gt; {
    let users = state.lock().unwrap();
    let user_list: Vec&lt;UserResponse&gt; = users.values()
        .cloned()
        .map(UserResponse::from)
        .collect();
    
    let total = user_list.len();
    
    Ok(ResponseJson(UsersListResponse {
        users: user_list,
        total,
    }))
}

pub async fn get_user(
    State(state): State&lt;AppState&gt;,
    Path(id): Path&lt;Uuid&gt;,
) -&gt; Result&lt;ResponseJson&lt;UserResponse&gt;, (StatusCode, ResponseJson&lt;ErrorResponse&gt;)&gt; {
    let users = state.lock().unwrap();
    
    match users.get(&amp;id) {
        Some(user) =&gt; {
            info!("Retrieved user: {}", id);
            Ok(ResponseJson(UserResponse::from(user.clone())))
        }
        None =&gt; {
            warn!("User not found: {}", id);
            Err((
                StatusCode::NOT_FOUND,
                ResponseJson(create_error_response("User not found", 404)),
            ))
        }
    }
}

pub async fn create_user(
    State(state): State&lt;AppState&gt;,
    Json(payload): Json&lt;CreateUserRequest&gt;,
) -&gt; Result&lt;(StatusCode, ResponseJson&lt;UserResponse&gt;), (StatusCode, ResponseJson&lt;ErrorResponse&gt;)&gt; {
    // 驗證輸入
    if let Err(error) = validate_create_user_request(&amp;payload) {
        warn!("Invalid user creation request: {}", error);
        return Err((
            StatusCode::BAD_REQUEST,
            ResponseJson(create_error_response(&amp;error, 400)),
        ));
    }

    // 檢查郵箱是否已存在
    {
        let users = state.lock().unwrap();
        if users.values().any(|u| u.email == payload.email) {
            return Err((
                StatusCode::CONFLICT,
                ResponseJson(create_error_response("Email already exists", 409)),
            ));
        }
    }

    let user = User::new(payload.name, payload.email, payload.age);
    let user_id = user.id;

    let mut users = state.lock().unwrap();
    users.insert(user_id, user.clone());

    info!("Created user: {} ({})", user.name, user_id);
    Ok((StatusCode::CREATED, ResponseJson(UserResponse::from(user))))
}

pub async fn update_user(
    State(state): State&lt;AppState&gt;,
    Path(id): Path&lt;Uuid&gt;,
    Json(payload): Json&lt;UpdateUserRequest&gt;,
) -&gt; Result&lt;ResponseJson&lt;UserResponse&gt;, (StatusCode, ResponseJson&lt;ErrorResponse&gt;)&gt; {
    // 檢查郵箱衝突（如果更新郵箱）
    if let Some(ref new_email) = payload.email {
        let users = state.lock().unwrap();
        if users.values().any(|u| u.id != id &amp;&amp; u.email == *new_email) {
            return Err((
                StatusCode::CONFLICT,
                ResponseJson(create_error_response("Email already exists", 409)),
            ));
        }
    }
    
    let mut users = state.lock().unwrap();
    match users.get_mut(&amp;id) {
        Some(user) =&gt; {
            user.update(payload);
            info!("Updated user: {}", id);
            Ok(ResponseJson(UserResponse::from(user.clone())))
        }
        None =&gt; {
            warn!("Attempted to update non-existent user: {}", id);
            Err((
                StatusCode::NOT_FOUND,
                ResponseJson(create_error_response("User not found", 404)),
            ))
        }
    }
}

pub async fn delete_user(
    State(state): State&lt;AppState&gt;,
    Path(id): Path&lt;Uuid&gt;,
) -&gt; Result&lt;StatusCode, (StatusCode, ResponseJson&lt;ErrorResponse&gt;)&gt; {
    let mut users = state.lock().unwrap();
    
    match users.remove(&amp;id) {
        Some(user) =&gt; {
            info!("Deleted user: {} ({})", user.name, id);
            Ok(StatusCode::NO_CONTENT)
        }
        None =&gt; {
            warn!("Attempted to delete non-existent user: {}", id);
            Err((
                StatusCode::NOT_FOUND,
                ResponseJson(create_error_response("User not found", 404)),
            ))
        }
    }
}

// 路由構建
pub fn create_router() -&gt; Router {
    let state = Arc::new(Mutex::new(HashMap::new()));

    Router::new()
        .route("/health", get(health_check))
        .route("/api/users", get(get_all_users))
        .route("/api/users", post(create_user))
        .route("/api/users/:id", get(get_user))
        .route("/api/users/:id", put(update_user))
        .route("/api/users/:id", delete(delete_user))
        .with_state(state)
}

#[tokio::main]
async fn main() -&gt; anyhow::Result&lt;()&gt; {
    // 初始化日誌
    tracing_subscriber::fmt()
        .with_max_level(Level::INFO)
        .init();

    // 創建應用
    let app = create_router();

    // 啟動服務器
    let port = std::env::var("PORT").unwrap_or_else(|_| "3000".to_string());
    let addr = format!("0.0.0.0:{}", port);
    
    info!("🚀 Starting server on {}", addr);
    info!("📚 Health check: http://localhost:{}/health", port);
    
    let listener = TcpListener::bind(&amp;addr).await?;
    axum::serve(listener, app).await?;

    Ok(())
}

// 測試模組
#[cfg(test)]
mod tests {
    use super::*;
    use axum::http::{Method, Request};
    use axum::body::Body;
    use tower::ServiceExt;

    #[tokio::test]
    async fn test_health_check() {
        let app = create_router();
        
        let response = app
            .oneshot(
                Request::builder()
                    .method(Method::GET)
                    .uri("/health")
                    .body(Body::empty())
                    .unwrap(),
            )
            .await
            .unwrap();

        assert_eq!(response.status(), StatusCode::OK);
    }

    #[tokio::test]
    async fn test_create_user() {
        let app = create_router();
        
        let user_data = serde_json::json!({
            "name": "John Doe",
            "email": "john@example.com",
            "age": 30
        });

        let response = app
            .oneshot(
                Request::builder()
                    .method(Method::POST)
                    .uri("/api/users")
                    .header("content-type", "application/json")
                    .body(Body::from(user_data.to_string()))
                    .unwrap(),
            )
            .await
            .unwrap();

        assert_eq!(response.status(), StatusCode::CREATED);
    }

    #[tokio::test]
    async fn test_create_user_invalid_email() {
        let app = create_router();
        
        let user_data = serde_json::json!({
            "name": "John Doe",
            "email": "invalid-email",
            "age": 30
        });

        let response = app
            .oneshot(
                Request::builder()
                    .method(Method::POST)
                    .uri("/api/users")
                    .header("content-type", "application/json")
                    .body(Body::from(user_data.to_string()))
                    .unwrap(),
            )
            .await
            .unwrap();

        assert_eq!(response.status(), StatusCode::BAD_REQUEST);
    }

    #[tokio::test]
    async fn test_get_nonexistent_user() {
        let app = create_router();
        
        let response = app
            .oneshot(
                Request::builder()
                    .method(Method::GET)
                    .uri("/api/users/00000000-0000-0000-0000-000000000000")
                    .body(Body::empty())
                    .unwrap(),
            )
            .await
            .unwrap();

        assert_eq!(response.status(), StatusCode::NOT_FOUND);
    }

    #[tokio::test]
    async fn test_email_uniqueness() {
        let app = create_router();
        
        // 創建第一個用戶
        let user1_data = serde_json::json!({
            "name": "User One",
            "email": "duplicate@example.com",
            "age": 30
        });
        
        let response1 = app
            .clone()
            .oneshot(
                Request::builder()
                    .method(Method::POST)
                    .uri("/api/users")
                    .header("content-type", "application/json")
                    .body(Body::from(user1_data.to_string()))
                    .unwrap(),
            )
            .await
            .unwrap();
        
        assert_eq!(response1.status(), StatusCode::CREATED);
        
        // 嘗試創建具有相同電子郵件的第二個用戶
        let user2_data = serde_json::json!({
            "name": "User Two",
            "email": "duplicate@example.com",
            "age": 25
        });
        
        let response2 = app
            .oneshot(
                Request::builder()
                    .method(Method::POST)
                    .uri("/api/users")
                    .header("content-type", "application/json")
                    .body(Body::from(user2_data.to_string()))
                    .unwrap(),
            )
            .await
            .unwrap();
        
        assert_eq!(response2.status(), StatusCode::CONFLICT);
    }
}</code></pre></pre>
<h2 id="功能特色"><a class="header" href="#功能特色">功能特色</a></h2>
<h3 id="1--類型安全"><a class="header" href="#1--類型安全">1. 🔒 類型安全</a></h3>
<ul>
<li><strong>強類型系統</strong>: 使用 Rust 的類型系統確保編譯時安全</li>
<li><strong>序列化保證</strong>: Serde 自動處理 JSON 序列化/反序列化</li>
<li><strong>UUID 支持</strong>: 唯一標識符保證資料完整性</li>
</ul>
<h3 id="2--高性能"><a class="header" href="#2--高性能">2. ⚡ 高性能</a></h3>
<ul>
<li><strong>異步處理</strong>: 基於 Tokio 的異步運行時</li>
<li><strong>零成本抽象</strong>: Axum 框架提供高效的請求處理</li>
<li><strong>內存安全</strong>: 無垃圾回收，低延遲響應</li>
</ul>
<h3 id="3--錯誤處理"><a class="header" href="#3--錯誤處理">3. 🛡️ 錯誤處理</a></h3>
<ul>
<li><strong>統一錯誤格式</strong>: 所有錯誤響應都包含錯誤碼和時間戳</li>
<li><strong>輸入驗證</strong>: 全面的請求數據驗證</li>
<li><strong>適當的 HTTP 狀態碼</strong>: 符合 REST 標準的響應碼</li>
</ul>
<h3 id="4--日誌記錄"><a class="header" href="#4--日誌記錄">4. 📊 日誌記錄</a></h3>
<ul>
<li><strong>結構化日誌</strong>: 使用 tracing 記錄詳細的操作信息</li>
<li><strong>可配置級別</strong>: 支持不同的日誌級別</li>
<li><strong>性能追蹤</strong>: 異步友好的日誌記錄</li>
</ul>
<h3 id="5--測試覆蓋"><a class="header" href="#5--測試覆蓋">5. 🧪 測試覆蓋</a></h3>
<ul>
<li><strong>單元測試</strong>: 涵蓋所有主要功能</li>
<li><strong>集成測試</strong>: 測試完整的 API 流程</li>
<li><strong>邊界情況</strong>: 包含錯誤情況的測試</li>
</ul>
<h2 id="api-文檔"><a class="header" href="#api-文檔">API 文檔</a></h2>
<h3 id="基本信息"><a class="header" href="#基本信息">基本信息</a></h3>
<ul>
<li><strong>Base URL</strong>: <code>http://localhost:3000</code></li>
<li><strong>Content-Type</strong>: <code>application/json</code></li>
<li><strong>認證</strong>: 無（示例項目）</li>
</ul>
<h3 id="端點列表"><a class="header" href="#端點列表">端點列表</a></h3>
<h4 id="1-健康檢查"><a class="header" href="#1-健康檢查">1. 健康檢查</a></h4>
<pre><code>GET /health
</code></pre>
<p><strong>響應示例</strong>:</p>
<pre><code class="language-json">{
  "status": "healthy",
  "timestamp": "2025-07-17T10:30:00.000Z",
  "version": "0.1.0"
}
</code></pre>
<h4 id="2-獲取所有用戶"><a class="header" href="#2-獲取所有用戶">2. 獲取所有用戶</a></h4>
<pre><code>GET /api/users
</code></pre>
<p><strong>響應示例</strong>:</p>
<pre><code class="language-json">{
  "users": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "張三",
      "email": "zhangsan@example.com",
      "age": 25,
      "created_at": "2025-07-17T10:30:00.000Z",
      "updated_at": "2025-07-17T10:30:00.000Z"
    }
  ],
  "total": 1
}
</code></pre>
<h4 id="3-創建用戶"><a class="header" href="#3-創建用戶">3. 創建用戶</a></h4>
<pre><code>POST /api/users
</code></pre>
<p><strong>請求體</strong>:</p>
<pre><code class="language-json">{
  "name": "張三",
  "email": "zhangsan@example.com",
  "age": 25
}
</code></pre>
<p><strong>響應示例</strong> (201 Created):</p>
<pre><code class="language-json">{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "張三",
  "email": "zhangsan@example.com",
  "age": 25,
  "created_at": "2025-07-17T10:30:00.000Z",
  "updated_at": "2025-07-17T10:30:00.000Z"
}
</code></pre>
<h4 id="4-獲取單個用戶"><a class="header" href="#4-獲取單個用戶">4. 獲取單個用戶</a></h4>
<pre><code>GET /api/users/{id}
</code></pre>
<p><strong>路徑參數</strong>:</p>
<ul>
<li><code>id</code>: 用戶 UUID</li>
</ul>
<p><strong>響應示例</strong>:</p>
<pre><code class="language-json">{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "張三",
  "email": "zhangsan@example.com",
  "age": 25,
  "created_at": "2025-07-17T10:30:00.000Z",
  "updated_at": "2025-07-17T10:30:00.000Z"
}
</code></pre>
<h4 id="5-更新用戶"><a class="header" href="#5-更新用戶">5. 更新用戶</a></h4>
<pre><code>PUT /api/users/{id}
</code></pre>
<p><strong>請求體</strong> (所有字段都是可選的):</p>
<pre><code class="language-json">{
  "name": "李四",
  "email": "lisi@example.com",
  "age": 30
}
</code></pre>
<p><strong>響應示例</strong>:</p>
<pre><code class="language-json">{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "李四",
  "email": "lisi@example.com",
  "age": 30,
  "created_at": "2025-07-17T10:30:00.000Z",
  "updated_at": "2025-07-17T11:00:00.000Z"
}
</code></pre>
<h4 id="6-刪除用戶"><a class="header" href="#6-刪除用戶">6. 刪除用戶</a></h4>
<pre><code>DELETE /api/users/{id}
</code></pre>
<p><strong>響應</strong>: 204 No Content</p>
<h3 id="錯誤響應格式"><a class="header" href="#錯誤響應格式">錯誤響應格式</a></h3>
<p>所有錯誤響應都遵循以下格式：</p>
<pre><code class="language-json">{
  "error": "錯誤訊息",
  "code": 404,
  "timestamp": "2025-07-17T10:30:00.000Z"
}
</code></pre>
<h3 id="http-狀態碼"><a class="header" href="#http-狀態碼">HTTP 狀態碼</a></h3>
<div class="table-wrapper"><table><thead><tr><th>狀態碼</th><th>說明</th></tr></thead><tbody>
<tr><td>200</td><td>OK - 成功獲取資源</td></tr>
<tr><td>201</td><td>Created - 成功創建資源</td></tr>
<tr><td>204</td><td>No Content - 成功刪除資源</td></tr>
<tr><td>400</td><td>Bad Request - 請求格式錯誤</td></tr>
<tr><td>404</td><td>Not Found - 資源不存在</td></tr>
<tr><td>409</td><td>Conflict - 資源衝突（如重複郵箱）</td></tr>
<tr><td>500</td><td>Internal Server Error - 服務器內部錯誤</td></tr>
</tbody></table>
</div>
<h2 id="測試指南"><a class="header" href="#測試指南">測試指南</a></h2>
<h3 id="運行項目"><a class="header" href="#運行項目">運行項目</a></h3>
<pre><code class="language-bash"># 編譯並運行
cargo run

# 在背景運行
cargo run &amp;

# 指定端口
PORT=8080 cargo run
</code></pre>
<h3 id="單元測試"><a class="header" href="#單元測試">單元測試</a></h3>
<pre><code class="language-bash"># 運行所有測試
cargo test

# 運行特定測試
cargo test test_health_check

# 顯示測試輸出
cargo test -- --nocapture

# 運行測試並顯示覆蓋率
cargo test --verbose
</code></pre>
<h3 id="手動測試"><a class="header" href="#手動測試">手動測試</a></h3>
<h4 id="使用-curl"><a class="header" href="#使用-curl">使用 curl</a></h4>
<pre><code class="language-bash"># 1. 健康檢查
curl http://localhost:3000/health

# 2. 創建用戶
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "name": "張三",
    "email": "zhangsan@example.com",
    "age": 25
  }'

# 3. 獲取所有用戶
curl http://localhost:3000/api/users

# 4. 獲取單個用戶 (替換 UUID)
curl http://localhost:3000/api/users/550e8400-e29b-41d4-a716-446655440000

# 5. 更新用戶
curl -X PUT http://localhost:3000/api/users/550e8400-e29b-41d4-a716-446655440000 \
  -H "Content-Type: application/json" \
  -d '{
    "name": "李四",
    "age": 30
  }'

# 6. 刪除用戶
curl -X DELETE http://localhost:3000/api/users/550e8400-e29b-41d4-a716-446655440000
</code></pre>
<h4 id="使用-httpie"><a class="header" href="#使用-httpie">使用 HTTPie</a></h4>
<pre><code class="language-bash"># 安裝 HTTPie
pip install httpie

# 創建用戶
http POST localhost:3000/api/users name="王五" email="wangwu@example.com" age:=28

# 獲取用戶
http GET localhost:3000/api/users

# 更新用戶
http PUT localhost:3000/api/users/USER_ID name="趙六"

# 刪除用戶
http DELETE localhost:3000/api/users/USER_ID
</code></pre>
<h3 id="自動化測試腳本"><a class="header" href="#自動化測試腳本">自動化測試腳本</a></h3>
<p>創建 <code>scripts/test_api.sh</code>:</p>
<pre><code class="language-bash">#!/bin/bash

# 顏色定義
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

BASE_URL="http://localhost:3000"
PASSED=0
FAILED=0

# 測試函數
test_endpoint() {
    local test_name="$1"
    local expected_code="$2"
    local actual_code="$3"
    
    echo -e "\n🧪 測試: $test_name"
    echo "期望狀態碼: $expected_code"
    echo "實際狀態碼: $actual_code"
    
    if [ "$actual_code" = "$expected_code" ]; then
        echo -e "${GREEN}✅ 通過${NC}"
        ((PASSED++))
    else
        echo -e "${RED}❌ 失敗${NC}"
        ((FAILED++))
    fi
}

echo -e "${YELLOW}🚀 開始測試 Rust RESTful API${NC}"

# 檢查服務器
if ! curl -s "$BASE_URL/health" &gt; /dev/null; then
    echo -e "${RED}❌ 服務器未運行${NC}"
    exit 1
fi

# 1. 健康檢查
echo -e "\n1️⃣ 健康檢查"
response=$(curl -s -w "%{http_code}" -o /tmp/health_response "$BASE_URL/health")
status_code="${response: -3}"
test_endpoint "健康檢查" "200" "$status_code"

# 2. 創建用戶
echo -e "\n2️⃣ 創建用戶"
response=$(curl -s -w "%{http_code}" -o /tmp/create_response \
    -X POST "$BASE_URL/api/users" \
    -H "Content-Type: application/json" \
    -d '{"name":"張三","email":"zhangsan@example.com","age":25}')
status_code="${response: -3}"
test_endpoint "創建用戶" "201" "$status_code"

# 提取用戶 ID
USER_ID=$(cat /tmp/create_response | grep -o '"id":"[^"]*"' | cut -d'"' -f4)
echo -e "${YELLOW}用戶 ID: $USER_ID${NC}"

# 3. 獲取所有用戶
echo -e "\n3️⃣ 獲取所有用戶"
response=$(curl -s -w "%{http_code}" -o /tmp/users_response "$BASE_URL/api/users")
status_code="${response: -3}"
test_endpoint "獲取所有用戶" "200" "$status_code"

# 4. 獲取單個用戶
if [ -n "$USER_ID" ]; then
    echo -e "\n4️⃣ 獲取單個用戶"
    response=$(curl -s -w "%{http_code}" -o /tmp/user_response "$BASE_URL/api/users/$USER_ID")
    status_code="${response: -3}"
    test_endpoint "獲取單個用戶" "200" "$status_code"
    
    # 5. 更新用戶
    echo -e "\n5️⃣ 更新用戶"
    response=$(curl -s -w "%{http_code}" -o /tmp/update_response \
        -X PUT "$BASE_URL/api/users/$USER_ID" \
        -H "Content-Type: application/json" \
        -d '{"name":"李四","age":30}')
    status_code="${response: -3}"
    test_endpoint "更新用戶" "200" "$status_code"
    
    # 6. 刪除用戶
    echo -e "\n6️⃣ 刪除用戶"
    response=$(curl -s -w "%{http_code}" -o /tmp/delete_response \
        -X DELETE "$BASE_URL/api/users/$USER_ID")
    status_code="${response: -3}"
    test_endpoint "刪除用戶" "204" "$status_code"
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../rust/cpp-move-vs-rust-ownership.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../rust/Rust-self-Self-與-C++-this-對比指南.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../rust/cpp-move-vs-rust-ownership.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../rust/Rust-self-Self-與-C++-this-對比指南.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
