<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>C++ Move èªç¾© vs Rust æ‰€æœ‰æ¬Šç³»çµ±çš„æ ¸å¿ƒå·®ç•° - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>// C++ Move èªç¾© vs Rust æ‰€æœ‰æ¬Šç³»çµ± æ·±åº¦å°æ¯”
// =============================================</p>
<p>/*
æ ¸å¿ƒå·®ç•°ç¸½çµï¼š</p>
<p>C++ Move:</p>
<ul>
<li>é‹è¡Œæ™‚å„ªåŒ–æ©Ÿåˆ¶</li>
<li>å¯é¸çš„ï¼Œç·¨è­¯å™¨æ±ºå®š</li>
<li>ç§»å‹•å¾Œå°è±¡ä»å­˜åœ¨ä½†è™•æ–¼"å·²ç§»å‹•"ç‹€æ…‹</li>
<li>å¯èƒ½æ„å¤–è¨ªå•å·²ç§»å‹•å°è±¡</li>
<li>éœ€è¦ç¨‹åºå“¡ç†è§£å’Œæ­£ç¢ºä½¿ç”¨</li>
</ul>
<p>Rust Ownership:</p>
<ul>
<li>ç·¨è­¯æ™‚å¼·åˆ¶çš„å…§å­˜å®‰å…¨æ©Ÿåˆ¶</li>
<li>å¿…é ˆçš„ï¼Œç·¨è­¯å™¨å¼·åˆ¶åŸ·è¡Œ</li>
<li>ç§»å‹•å¾ŒåŸè®Šé‡ä¸å¯å†è¨ªå•</li>
<li>ç·¨è­¯å™¨é˜²æ­¢ä»»ä½•èª¤ç”¨</li>
<li>è‡ªå‹•è™•ç†ï¼Œé›¶é‹è¡Œæ™‚é–‹éŠ·
*/</li>
</ul>
<p>// ============================================
// 1. åŸºæœ¬æ¦‚å¿µå°æ¯”
// ============================================</p>
<p>/* C++ Move èªç¾©ç¤ºä¾‹:</p>
<p>#include <iostream>
#include <vector>
#include <string>
#include <utility></p>
<p>class Resource {
private:
std::vector<int> data;
std::string name;</p>
<p>public:
// æ§‹é€ å‡½æ•¸
Resource(const std::string&amp; n) : name(n) {
data.resize(1000, 42);
std::cout &lt;&lt; "è³‡æº " &lt;&lt; name &lt;&lt; " å‰µå»º\n";
}</p>
<pre><code>// è¤‡è£½æ§‹é€ å‡½æ•¸
Resource(const Resource&amp; other) : data(other.data), name(other.name + "_copy") {
    std::cout &lt;&lt; "è³‡æº " &lt;&lt; name &lt;&lt; " è¢«è¤‡è£½\n";
}

// ç§»å‹•æ§‹é€ å‡½æ•¸
Resource(Resource&amp;&amp; other) noexcept 
    : data(std::move(other.data)), name(std::move(other.name)) {
    std::cout &lt;&lt; "è³‡æº " &lt;&lt; name &lt;&lt; " è¢«ç§»å‹•\n";
    // other ä»ç„¶å­˜åœ¨ï¼Œä½†è³‡æºå·²è¢«"å·èµ°"
}

// è¤‡è£½è³¦å€¼
Resource&amp; operator=(const Resource&amp; other) {
    if (this != &amp;other) {
        data = other.data;
        name = other.name + "_assigned";
        std::cout &lt;&lt; "è³‡æº " &lt;&lt; name &lt;&lt; " è¢«è³¦å€¼è¤‡è£½\n";
    }
    return *this;
}

// ç§»å‹•è³¦å€¼
Resource&amp; operator=(Resource&amp;&amp; other) noexcept {
    if (this != &amp;other) {
        data = std::move(other.data);
        name = std::move(other.name);
        std::cout &lt;&lt; "è³‡æº " &lt;&lt; name &lt;&lt; " è¢«è³¦å€¼ç§»å‹•\n";
    }
    return *this;
}

~Resource() {
    std::cout &lt;&lt; "è³‡æº " &lt;&lt; name &lt;&lt; " è¢«éŠ·æ¯€\n";
}

void use_resource() {
    std::cout &lt;&lt; "ä½¿ç”¨è³‡æº " &lt;&lt; name &lt;&lt; " (å¤§å°: " &lt;&lt; data.size() &lt;&lt; ")\n";
}
</code></pre>
<p>};</p>
<p>void cpp_move_examples() {
std::cout &lt;&lt; "=== C++ Move èªç¾© ===\n";</p>
<pre><code>// 1. åŸºæœ¬ç§»å‹•
Resource r1("original");
Resource r2 = std::move(r1);  // ç§»å‹•æ§‹é€ 

// å±éšªï¼šr1 ä»ç„¶å­˜åœ¨ä½†å·²è¢«ç§»å‹•ï¼Œè¨ªå•å¯èƒ½å°è‡´æœªå®šç¾©è¡Œç‚º
// r1.use_resource();  // å¯èƒ½å´©æ½°æˆ–ç”¢ç”ŸéŒ¯èª¤çµæœ

r2.use_resource();  // å®‰å…¨

// 2. å‡½æ•¸åƒæ•¸ç§»å‹•
auto create_resource = []() -&gt; Resource {
    return Resource("temp");  // è‡ªå‹•ç§»å‹•ï¼ˆRVOå¯èƒ½è·³éï¼‰
};

Resource r3 = create_resource();  // ç§»å‹•æˆ–è¤‡è£½

// 3. å®¹å™¨ä¸­çš„ç§»å‹•
std::vector&lt;Resource&gt; resources;
resources.push_back(std::move(r2));  // ç§»å‹•åˆ°å®¹å™¨ä¸­
// r2 ç¾åœ¨è™•æ–¼å·²ç§»å‹•ç‹€æ…‹

// 4. éŒ¯èª¤ï¼šæ„å¤–ä½¿ç”¨å·²ç§»å‹•å°è±¡
// r2.use_resource();  // æœªå®šç¾©è¡Œç‚ºï¼
</code></pre>
<p>}</p>
<p>int main() {
cpp_move_examples();
return 0;
}</p>
<p>*/</p>
<p>// Rust æ‰€æœ‰æ¬Šç³»çµ± - ç›¸åŒåŠŸèƒ½çš„å®‰å…¨å¯¦ç¾
use std::fmt;</p>
<p>#[derive(Debug)]
struct Resource {
data: Vec<i32>,
name: String,
}</p>
<p>impl Resource {
fn new(name: &amp;str) -&gt; Self {
println!("è³‡æº {} å‰µå»º", name);
Resource {
data: vec![42; 1000],
name: name.to_string(),
}
}</p>
<pre><code>fn use_resource(&amp;self) {
    println!("ä½¿ç”¨è³‡æº {} (å¤§å°: {})", self.name, self.data.len());
}

fn use_resource_mut(&amp;mut self) {
    self.data.push(99);
    println!("ä¿®æ”¹è³‡æº {} (æ–°å¤§å°: {})", self.name, self.data.len());
}
</code></pre>
<p>}</p>
<p>impl Drop for Resource {
fn drop(&amp;mut self) {
println!("è³‡æº {} è¢«éŠ·æ¯€", self.name);
}
}</p>
<p>impl Clone for Resource {
fn clone(&amp;self) -&gt; Self {
println!("è³‡æº {} è¢«å…‹éš†", self.name);
Resource {
data: self.data.clone(),
name: format!("{}_clone", self.name),
}
}
}</p>
<p>fn rust_ownership_examples() {
println!("=== Rust æ‰€æœ‰æ¬Šç³»çµ± ===");</p>
<pre><code>// 1. åŸºæœ¬ç§»å‹•ï¼ˆæ‰€æœ‰æ¬Šè½‰ç§»ï¼‰
let r1 = Resource::new("original");
let r2 = r1;  // æ‰€æœ‰æ¬Šç§»å‹•ï¼Œr1 ä¸å†å¯ç”¨

// ç·¨è­¯éŒ¯èª¤ï¼šr1 å·²è¢«ç§»å‹•
// r1.use_resource();  // ç·¨è­¯éŒ¯èª¤ï¼

r2.use_resource();  // å®‰å…¨

// 2. å‡½æ•¸åƒæ•¸æ‰€æœ‰æ¬Šè½‰ç§»
fn take_ownership(resource: Resource) {
    resource.use_resource();
    // resource åœ¨å‡½æ•¸çµæŸæ™‚è¢«éŠ·æ¯€
}

fn borrow_resource(resource: &amp;Resource) {
    resource.use_resource();
    // åªæ˜¯å€Ÿç”¨ï¼Œä¸ç²å–æ‰€æœ‰æ¬Š
}

fn borrow_mut_resource(resource: &amp;mut Resource) {
    resource.use_resource_mut();
    // å¯è®Šå€Ÿç”¨ï¼Œå¯ä»¥ä¿®æ”¹ä½†ä¸ç²å–æ‰€æœ‰æ¬Š
}

let r3 = Resource::new("for_function");

// é¸é …1ï¼šè½‰ç§»æ‰€æœ‰æ¬Š
// take_ownership(r3);  // r3 è¢«ç§»å‹•ï¼Œä¸å†å¯ç”¨

// é¸é …2ï¼šå€Ÿç”¨ï¼ˆæ¨è–¦ï¼‰
borrow_resource(&amp;r3);  // r3 ä»ç„¶å¯ç”¨

// é¸é …3ï¼šå¯è®Šå€Ÿç”¨
let mut r4 = Resource::new("mutable");
borrow_mut_resource(&amp;mut r4);
r4.use_resource();  // ä»ç„¶å¯ç”¨

// 3. å®¹å™¨ä¸­çš„æ‰€æœ‰æ¬Š
let mut resources = Vec::new();
let r5 = Resource::new("for_vector");
resources.push(r5);  // r5 è¢«ç§»å‹•åˆ° vector ä¸­
// r5 ä¸å†å¯ç”¨

// è¨ªå• vector ä¸­çš„è³‡æº
if let Some(resource) = resources.get(0) {
    resource.use_resource();
}

// 4. æ‰€æœ‰æ¬Šæ¢å¾©
let recovered = resources.pop().unwrap();  // å¾ vector ä¸­å–å›æ‰€æœ‰æ¬Š
recovered.use_resource();
</code></pre>
<p>}</p>
<p>// ============================================
// 2. æ·±åº¦å°æ¯”ï¼šè¤‡é›œå ´æ™¯
// ============================================</p>
<p>/* C++ è¤‡é›œç§»å‹•å ´æ™¯çš„å•é¡Œ:</p>
<p>class ComplexResource {
std::unique_ptr&lt;int[]&gt; buffer;
size_t size;
std::string id;</p>
<p>public:
ComplexResource(const std::string&amp; identifier, size_t s)
: buffer(std::make_unique&lt;int[]&gt;(s)), size(s), id(identifier) {}</p>
<pre><code>// ç§»å‹•æ§‹é€ å¾Œï¼ŒåŸå°è±¡ç‹€æ…‹ä¸ä¸€è‡´
ComplexResource(ComplexResource&amp;&amp; other) noexcept
    : buffer(std::move(other.buffer)), size(other.size), id(std::move(other.id)) {
    // å•é¡Œï¼šother.size ä»ç„¶ä¿ç•™åŸå€¼ï¼Œä½† other.buffer ç‚º null
    // é€™å¯èƒ½å°è‡´ä¸ä¸€è‡´ç‹€æ…‹
}

void process() {
    if (buffer) {  // å¿…é ˆæª¢æŸ¥ï¼Œå› ç‚ºå¯èƒ½å·²è¢«ç§»å‹•
        for (size_t i = 0; i &lt; size; ++i) {
            buffer[i] = i;
        }
    } else {
        // å·²è¢«ç§»å‹•çš„å°è±¡è¢«æ„å¤–ä½¿ç”¨
        std::cout &lt;&lt; "éŒ¯èª¤ï¼šå˜—è©¦ä½¿ç”¨å·²ç§»å‹•çš„è³‡æº\n";
    }
}

size_t get_size() const { return size; }  // å¯èƒ½è¿”å›éŒ¯èª¤ä¿¡æ¯
</code></pre>
<p>};</p>
<p>void problematic_move_usage() {
ComplexResource cr1("test", 100);
ComplexResource cr2 = std::move(cr1);</p>
<pre><code>// å±éšªï¼šcr1 è™•æ–¼éƒ¨åˆ†ç§»å‹•ç‹€æ…‹
std::cout &lt;&lt; "cr1 size: " &lt;&lt; cr1.get_size() &lt;&lt; "\n";  // ä»ç„¶è¿”å› 100
cr1.process();  // ä½†å¯¦éš›ä¸Š buffer æ˜¯ nullï¼
</code></pre>
<p>}</p>
<p>*/</p>
<p>// Rust ç­‰åƒ¹å¯¦ç¾ - ç·¨è­¯æ™‚å®‰å…¨
struct ComplexResource {
buffer: Vec<i32>,  // è‡ªå‹•ç®¡ç†å…§å­˜
id: String,
}</p>
<p>impl ComplexResource {
fn new(identifier: &amp;str, size: usize) -&gt; Self {
ComplexResource {
buffer: vec![0; size],
id: identifier.to_string(),
}
}</p>
<pre><code>fn process(&amp;mut self) {
    for (i, item) in self.buffer.iter_mut().enumerate() {
        *item = i as i32;
    }
    println!("è™•ç†å®Œæˆï¼š{} å€‹å…ƒç´ ", self.buffer.len());
}

fn get_size(&amp;self) -&gt; usize {
    self.buffer.len()
}

fn get_id(&amp;self) -&gt; &amp;str {
    &amp;self.id
}
</code></pre>
<p>}</p>
<p>fn safe_ownership_usage() {
let mut cr1 = ComplexResource::new("test", 100);
let cr2 = cr1;  // å®Œæ•´ç§»å‹•ï¼Œcr1 å®Œå…¨ä¸å¯ç”¨</p>
<pre><code>// ç·¨è­¯éŒ¯èª¤ï¼šç„¡æ³•è¨ªå•å·²ç§»å‹•çš„è®Šé‡
// println!("cr1 size: {}", cr1.get_size());  // ç·¨è­¯éŒ¯èª¤ï¼
// cr1.process();  // ç·¨è­¯éŒ¯èª¤ï¼

println!("cr2 size: {}", cr2.get_size());  // å®‰å…¨
// cr2.process();  // éœ€è¦å¯è®Šå¼•ç”¨
</code></pre>
<p>}</p>
<p>// ============================================
// 3. æ€§èƒ½å°æ¯”
// ============================================</p>
<p>fn performance_comparison() {
use std::time::Instant;</p>
<pre><code>println!("\n=== æ€§èƒ½å°æ¯” ===");

// æ¸¬è©¦å¤§é‡æ‰€æœ‰æ¬Šè½‰ç§»
let start = Instant::now();

let mut resources = Vec::new();
for i in 0..10000 {
    let resource = Resource::new(&amp;format!("resource_{}", i));
    resources.push(resource);  // ç§»å‹•ï¼Œé›¶æˆæœ¬
}

// è™•ç†æ‰€æœ‰è³‡æº
for resource in &amp;resources {
    resource.use_resource();
}

let duration = start.elapsed();
println!("Rust æ‰€æœ‰æ¬Šè½‰ç§»è€—æ™‚: {:?}", duration);

// æ¸¬è©¦å€Ÿç”¨æ€§èƒ½
let start = Instant::now();

fn process_by_reference(resources: &amp;[Resource]) {
    for resource in resources {
        resource.use_resource();
    }
}

process_by_reference(&amp;resources);

let duration = start.elapsed();
println!("Rust å€Ÿç”¨è™•ç†è€—æ™‚: {:?}", duration);
</code></pre>
<p>}</p>
<p>// ============================================
// 4. éŒ¯èª¤è™•ç†å’Œå®‰å…¨æ€§
// ============================================</p>
<p>/* C++ ç§»å‹•ç›¸é—œçš„å¸¸è¦‹éŒ¯èª¤:</p>
<p>void common_cpp_move_errors() {
// éŒ¯èª¤1ï¼šä½¿ç”¨å·²ç§»å‹•å°è±¡
std::vector<int> v1 = {1, 2, 3, 4, 5};
std::vector<int> v2 = std::move(v1);
std::cout &lt;&lt; v1.size() &lt;&lt; std::endl;  // å¯èƒ½æ˜¯0ï¼Œä½†ä¸ä¿è­‰</p>
<pre><code>// éŒ¯èª¤2ï¼šç§»å‹•å¾Œå†æ¬¡ç§»å‹•
std::string s1 = "hello";
std::string s2 = std::move(s1);
std::string s3 = std::move(s1);  // ç§»å‹•ç©ºå­—ç¬¦ä¸²

// éŒ¯èª¤3ï¼šåœ¨æ¢ä»¶èªå¥ä¸­ç§»å‹•
std::vector&lt;int&gt; data = {1, 2, 3};
if (some_condition) {
    process(std::move(data));
}
// å¦‚æœæ¢ä»¶ç‚ºå‡ï¼Œdata ä»ç„¶å¯ç”¨ï¼Œä½†å¦‚æœç‚ºçœŸå‰‡ä¸å¯ç”¨
data.push_back(4);  // å¯èƒ½éŒ¯èª¤

// éŒ¯èª¤4ï¼šè¿”å›æœ¬åœ°è®Šé‡çš„ç§»å‹•
auto create_vector = []() {
    std::vector&lt;int&gt; local = {1, 2, 3};
    return std::move(local);  // ä¸å¿…è¦ï¼Œåè€Œå¯èƒ½é˜»æ­¢RVO
};
</code></pre>
<p>}</p>
<p>*/</p>
<p>// Rust ç·¨è­¯æ™‚é˜²æ­¢é€™äº›éŒ¯èª¤
fn rust_compile_time_safety() {
println!("\n=== Rust ç·¨è­¯æ™‚å®‰å…¨æª¢æŸ¥ ===");</p>
<pre><code>// 1. é˜²æ­¢ä½¿ç”¨å·²ç§»å‹•è®Šé‡
let v1 = vec![1, 2, 3, 4, 5];
let v2 = v1;  // v1 è¢«ç§»å‹•
// println!("{}", v1.len());  // ç·¨è­¯éŒ¯èª¤ï¼
println!("v2 é•·åº¦: {}", v2.len());  // å®‰å…¨

// 2. é˜²æ­¢é‡è¤‡ç§»å‹•
let s1 = String::from("hello");
let s2 = s1;  // s1 è¢«ç§»å‹•
// let s3 = s1;  // ç·¨è­¯éŒ¯èª¤ï¼
println!("s2: {}", s2);

// 3. æ¢ä»¶ç§»å‹•çš„å®‰å…¨è™•ç†
let data = vec![1, 2, 3];
let some_condition = true;

let processed_data = if some_condition {
    // ç§»å‹•åˆ°å‡½æ•¸ä¸­è™•ç†
    process_data(data)
} else {
    // å¦‚æœä¸è™•ç†ï¼Œä¿æŒåŸæ¨£
    data
};

// processed_data ç¸½æ˜¯å¯ç”¨çš„
println!("è™•ç†å¾Œæ•¸æ“šé•·åº¦: {}", processed_data.len());

// 4. è¿”å›å€¼å„ªåŒ–æ˜¯è‡ªå‹•çš„
fn create_vector() -&gt; Vec&lt;i32&gt; {
    let local = vec![1, 2, 3];
    local  // è‡ªå‹•ç§»å‹•ï¼Œç„¡éœ€é¡¯å¼ move
}

let result = create_vector();
println!("å‰µå»ºçš„å‘é‡: {:?}", result);
</code></pre>
<p>}</p>
<p>fn process_data(mut data: Vec<i32>) -&gt; Vec<i32> {
data.push(4);
data
}</p>
<p>// ============================================
// 5. é«˜ç´šæ‰€æœ‰æ¬Šæ¨¡å¼
// ============================================</p>
<p>// æ™ºèƒ½æŒ‡é‡å’Œå…±äº«æ‰€æœ‰æ¬Š
use std::rc::Rc;
use std::cell::RefCell;
use std::sync::{Arc, Mutex};</p>
<p>fn advanced_ownership_patterns() {
println!("\n=== é«˜ç´šæ‰€æœ‰æ¬Šæ¨¡å¼ ===");</p>
<pre><code>// 1. å¼•ç”¨è¨ˆæ•¸å…±äº«æ‰€æœ‰æ¬Š (å–®ç·šç¨‹)
{
    let shared_data = Rc::new(vec![1, 2, 3, 4, 5]);
    let reference1 = Rc::clone(&amp;shared_data);
    let reference2 = Rc::clone(&amp;shared_data);
    
    println!("å¼•ç”¨è¨ˆæ•¸: {}", Rc::strong_count(&amp;shared_data));
    println!("å…±äº«æ•¸æ“š: {:?}", shared_data);
    
    // æ‰€æœ‰å¼•ç”¨é›¢é–‹ä½œç”¨åŸŸæ™‚ï¼Œæ•¸æ“šè‡ªå‹•é‡‹æ”¾
}

// 2. å…§éƒ¨å¯è®Šæ€§
{
    let data = Rc::new(RefCell::new(vec![1, 2, 3]));
    let ref1 = Rc::clone(&amp;data);
    let ref2 = Rc::clone(&amp;data);
    
    // é€šéä»»ä½•å¼•ç”¨éƒ½å¯ä»¥ä¿®æ”¹
    ref1.borrow_mut().push(4);
    ref2.borrow_mut().push(5);
    
    println!("ä¿®æ”¹å¾Œçš„æ•¸æ“š: {:?}", data.borrow());
}

// 3. ç·šç¨‹å®‰å…¨çš„å…±äº«æ‰€æœ‰æ¬Š
{
    let shared_counter = Arc::new(Mutex::new(0));
    let mut handles = vec![];
    
    for _ in 0..3 {
        let counter = Arc::clone(&amp;shared_counter);
        let handle = std::thread::spawn(move || {
            let mut num = counter.lock().unwrap();
            *num += 1;
        });
        handles.push(handle);
    }
    
    for handle in handles {
        handle.join().unwrap();
    }
    
    println!("æœ€çµ‚è¨ˆæ•¸: {}", *shared_counter.lock().unwrap());
}
</code></pre>
<p>}</p>
<p>// ============================================
// 6. ç”Ÿå‘½é€±æœŸå’Œå€Ÿç”¨
// ============================================</p>
<p>// ç”Ÿå‘½é€±æœŸåƒæ•¸ç¢ºä¿å¼•ç”¨æœ‰æ•ˆæ€§
fn lifetime_examples() {
println!("\n=== ç”Ÿå‘½é€±æœŸç¤ºä¾‹ ===");</p>
<pre><code>// 1. åŸºæœ¬ç”Ÿå‘½é€±æœŸ
fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;'a str) -&gt; &amp;'a str {
    if x.len() &gt; y.len() {
        x
    } else {
        y
    }
}

let string1 = String::from("long string");
let string2 = "short";
let result = longest(&amp;string1, string2);
println!("æœ€é•·çš„å­—ç¬¦ä¸²: {}", result);

// 2. çµæ§‹é«”ä¸­çš„ç”Ÿå‘½é€±æœŸ
#[derive(Debug)]
struct ImportantExcerpt&lt;'a&gt; {
    part: &amp;'a str,
}

let novel = String::from("Call me Ishmael. Some years ago...");
let first_sentence = novel.split('.').next().expect("Could not find a '.'");
let excerpt = ImportantExcerpt {
    part: first_sentence,
};
println!("æ‘˜éŒ„: {:?}", excerpt);

// 3. è¤‡é›œå€Ÿç”¨å ´æ™¯
fn demonstrate_borrowing() {
    let mut data = vec![1, 2, 3, 4, 5];
    
    // ä¸å¯è®Šå€Ÿç”¨
    let sum: i32 = data.iter().sum();
    println!("ç¸½å’Œ: {}", sum);
    
    // å¯è®Šå€Ÿç”¨
    data.push(6);
    println!("æ·»åŠ å…ƒç´ å¾Œ: {:?}", data);
    
    // åŒæ™‚å­˜åœ¨å¤šå€‹ä¸å¯è®Šå€Ÿç”¨
    let first = &amp;data[0];
    let last = &amp;data[data.len() - 1];
    println!("ç¬¬ä¸€å€‹: {}, æœ€å¾Œä¸€å€‹: {}", first, last);
    
    // ä½†ä¸èƒ½åŒæ™‚å­˜åœ¨å¯è®Šå’Œä¸å¯è®Šå€Ÿç”¨
    // let mut_ref = &amp;mut data;  // ç·¨è­¯éŒ¯èª¤ï¼
}

demonstrate_borrowing();
</code></pre>
<p>}</p>
<p>// ============================================
// ä¸»å‡½æ•¸å’Œæ¸¬è©¦
// ============================================</p>
<p>fn main() {
println!("ğŸ”„ C++ Move vs Rust Ownership æ·±åº¦å°æ¯”");
println!("======================================");</p>
<pre><code>rust_ownership_examples();
safe_ownership_usage();
performance_comparison();
rust_compile_time_safety();
advanced_ownership_patterns();
lifetime_examples();

println!("\nğŸ“Š ç¸½çµå°æ¯”:");
println!("=============");

println!("C++ Moveèªç¾©:");
println!("  âœ… æ€§èƒ½å„ªåŒ–ï¼Œæ¸›å°‘ä¸å¿…è¦çš„è¤‡è£½");
println!("  âŒ é‹è¡Œæ™‚æ¦‚å¿µï¼Œå¯èƒ½èª¤ç”¨å·²ç§»å‹•å°è±¡");
println!("  âŒ éœ€è¦ç¨‹åºå“¡æ‰‹å‹•ç®¡ç†ç§»å‹•èªç¾©");
println!("  âŒ ç§»å‹•å¾Œå°è±¡ç‹€æ…‹å¯èƒ½ä¸ä¸€è‡´");

println!("\nRust æ‰€æœ‰æ¬Šç³»çµ±:");
println!("  âœ… ç·¨è­¯æ™‚ä¿è­‰å…§å­˜å®‰å…¨");
println!("  âœ… é›¶é‹è¡Œæ™‚é–‹éŠ·");
println!("  âœ… è‡ªå‹•ç®¡ç†ï¼Œç„¡éœ€æ‰‹å‹•å¹¹é ");
println!("  âœ… ç§»å‹•å¾ŒåŸè®Šé‡å®Œå…¨ä¸å¯è¨ªå•");
println!("  âœ… å€Ÿç”¨æª¢æŸ¥å™¨é˜²æ­¢æ•¸æ“šç«¶çˆ­");

println!("\nğŸ¯ é—œéµå€åˆ¥:");
println!("  â€¢ C++ Move: å„ªåŒ–æ©Ÿåˆ¶ï¼Œå¯é¸ä½¿ç”¨");
println!("  â€¢ Rust Ownership: å®‰å…¨æ©Ÿåˆ¶ï¼Œå¼·åˆ¶åŸ·è¡Œ");
println!("  â€¢ C++ å´é‡æ€§èƒ½ï¼ŒRust å´é‡å®‰å…¨");
println!("  â€¢ C++ é‹è¡Œæ™‚æª¢æŸ¥ï¼ŒRust ç·¨è­¯æ™‚æª¢æŸ¥");
</code></pre>
<p>}</p>
<p>#[cfg(test)]
mod tests {
use super::*;</p>
<pre><code>#[test]
fn test_ownership_transfer() {
    let resource = Resource::new("test");
    let moved_resource = resource;
    
    // ç¢ºä¿ç§»å‹•å¾Œå¯ä»¥æ­£å¸¸ä½¿ç”¨
    moved_resource.use_resource();
    
    // ä»¥ä¸‹æœƒç·¨è­¯å¤±æ•—ï¼Œè­‰æ˜æ‰€æœ‰æ¬Šå·²è½‰ç§»
    // resource.use_resource();
}

#[test]
fn test_borrowing() {
    let resource = Resource::new("test");
    
    // å¤šæ¬¡å€Ÿç”¨æ‡‰è©²éƒ½å¯ä»¥å·¥ä½œ
    fn use_resource_ref(r: &amp;Resource) {
        r.use_resource();
    }
    
    use_resource_ref(&amp;resource);
    use_resource_ref(&amp;resource);
    
    // åŸå§‹è®Šé‡ä»ç„¶å¯ç”¨
    resource.use_resource();
}

#[test]
fn test_mutable_borrowing() {
    let mut resource = Resource::new("test");
    
    // å¯è®Šå€Ÿç”¨
    fn modify_resource(r: &amp;mut Resource) {
        r.use_resource_mut();
    }
    
    modify_resource(&amp;mut resource);
    
    // å€Ÿç”¨çµæŸå¾Œä»å¯ä½¿ç”¨
    resource.use_resource();
}
</code></pre>
<p>}</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../rust/cpp_vs_rust_comparison.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../rust/Rust-RESTful-API-å®Œæ•´é–‹ç™¼æŒ‡å—.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../rust/cpp_vs_rust_comparison.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../rust/Rust-RESTful-API-å®Œæ•´é–‹ç™¼æŒ‡å—.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
