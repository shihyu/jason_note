# Facebook çˆ¬èŸ² Makefile
# ä½¿ç”¨æ–¹æ³•: make <target>

# è®Šæ•¸è¨­å®š
PYTHON = python3
PIP = pip3
VENV_DIR = venv
SCRIPT = fb_scraper.py
REQUIREMENTS = requirements.txt

# é è¨­ç›®æ¨™
.DEFAULT_GOAL := help

# é¡¯ç¤ºå¹«åŠ©è¨Šæ¯
help:
	@echo "Facebook çˆ¬èŸ² Makefile ä½¿ç”¨èªªæ˜"
	@echo "================================="
	@echo "make setup     - å®Œæ•´ç’°å¢ƒè¨­ç½®ï¼ˆå»ºè­°é¦–æ¬¡ä½¿ç”¨ï¼‰"
	@echo "make venv      - å»ºç«‹è™›æ“¬ç’°å¢ƒ"
	@echo "make install   - å®‰è£å¥—ä»¶ä¾è³´"
	@echo "make run       - åŸ·è¡Œçˆ¬èŸ²ç¨‹å¼"
	@echo "make clean     - æ¸…ç†è¼¸å‡ºæª”æ¡ˆ"
	@echo "make reset     - é‡ç½®ç’°å¢ƒï¼ˆåˆªé™¤è™›æ“¬ç’°å¢ƒï¼‰"
	@echo "make check     - æª¢æŸ¥ç’°å¢ƒç‹€æ…‹"
	@echo "make help      - é¡¯ç¤ºæ­¤å¹«åŠ©è¨Šæ¯"

# å®Œæ•´ç’°å¢ƒè¨­ç½®
setup: venv install
	@echo "âœ… ç’°å¢ƒè¨­ç½®å®Œæˆï¼"
	@echo "ğŸš€ åŸ·è¡Œ 'make run' é–‹å§‹çˆ¬å–è³‡æ–™"

# å»ºç«‹è™›æ“¬ç’°å¢ƒ
venv:
	@echo "ğŸ”§ å»ºç«‹è™›æ“¬ç’°å¢ƒ..."
	$(PYTHON) -m venv $(VENV_DIR)
	@echo "âœ… è™›æ“¬ç’°å¢ƒå»ºç«‹å®Œæˆ"

# å®‰è£å¥—ä»¶ä¾è³´
install: $(REQUIREMENTS)
	@echo "ğŸ“¦ å®‰è£å¥—ä»¶ä¾è³´..."
	@if [ -d "$(VENV_DIR)" ]; then \
		. $(VENV_DIR)/bin/activate && $(PIP) install --upgrade pip && $(PIP) install -r $(REQUIREMENTS); \
	else \
		echo "âŒ è™›æ“¬ç’°å¢ƒä¸å­˜åœ¨ï¼Œè«‹å…ˆåŸ·è¡Œ 'make venv'"; \
		exit 1; \
	fi
	@echo "âœ… å¥—ä»¶å®‰è£å®Œæˆ"

# åŸ·è¡Œçˆ¬èŸ²ç¨‹å¼
run: $(SCRIPT)
	@echo "ğŸš€ é–‹å§‹åŸ·è¡Œ Facebook çˆ¬èŸ²..."
	@if [ -d "$(VENV_DIR)" ]; then \
		. $(VENV_DIR)/bin/activate && $(PYTHON) $(SCRIPT); \
	else \
		echo "âŒ è™›æ“¬ç’°å¢ƒä¸å­˜åœ¨ï¼Œè«‹å…ˆåŸ·è¡Œ 'make setup'"; \
		exit 1; \
	fi

# æª¢æŸ¥ç’°å¢ƒç‹€æ…‹
check:
	@echo "ğŸ” æª¢æŸ¥ç’°å¢ƒç‹€æ…‹..."
	@echo "Python ç‰ˆæœ¬:"
	@$(PYTHON) --version
	@echo "è™›æ“¬ç’°å¢ƒ:"
	@if [ -d "$(VENV_DIR)" ]; then \
		echo "âœ… è™›æ“¬ç’°å¢ƒå­˜åœ¨"; \
	else \
		echo "âŒ è™›æ“¬ç’°å¢ƒä¸å­˜åœ¨"; \
	fi
	@echo "å¿…è¦æª”æ¡ˆ:"
	@if [ -f "$(SCRIPT)" ]; then \
		echo "âœ… $(SCRIPT) å­˜åœ¨"; \
	else \
		echo "âŒ $(SCRIPT) ä¸å­˜åœ¨"; \
	fi
	@if [ -f "$(REQUIREMENTS)" ]; then \
		echo "âœ… $(REQUIREMENTS) å­˜åœ¨"; \
	else \
		echo "âŒ $(REQUIREMENTS) ä¸å­˜åœ¨"; \
	fi

# æ¸…ç†è¼¸å‡ºæª”æ¡ˆ
clean:
	@echo "ğŸ§¹ æ¸…ç†è¼¸å‡ºæª”æ¡ˆ..."
	@rm -f facebook_data.json
	@rm -f *.pyc
	@rm -rf __pycache__
	@echo "âœ… æ¸…ç†å®Œæˆ"

# é‡ç½®ç’°å¢ƒ
reset: clean
	@echo "ğŸ”„ é‡ç½®ç’°å¢ƒ..."
	@rm -rf $(VENV_DIR)
	@echo "âœ… ç’°å¢ƒé‡ç½®å®Œæˆ"

# å¿«é€Ÿé‡å»ºç’°å¢ƒ
rebuild: reset setup
	@echo "âœ… ç’°å¢ƒé‡å»ºå®Œæˆ"

# æŸ¥çœ‹çˆ¬å–çµæœ
show-result:
	@if [ -f "facebook_data.json" ]; then \
		echo "ğŸ“Š Facebook è³‡æ–™çˆ¬å–çµæœ:"; \
		$(PYTHON) -c "import json; data=json.load(open('facebook_data.json')); print(f'ç”¨æˆ¶: {data[\"profile\"][0]}'); print(f'è²¼æ–‡æ•¸: {len(data[\"data\"])}')"; \
	else \
		echo "âŒ æ‰¾ä¸åˆ° facebook_data.jsonï¼Œè«‹å…ˆåŸ·è¡Œ 'make run'"; \
	fi

# å®‰è£é¡å¤–å¥—ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
install-extra:
	@echo "ğŸ“¦ å®‰è£é¡å¤–å¥—ä»¶..."
	@if [ -d "$(VENV_DIR)" ]; then \
		. $(VENV_DIR)/bin/activate && $(PIP) install pandas openpyxl matplotlib; \
	else \
		echo "âŒ è™›æ“¬ç’°å¢ƒä¸å­˜åœ¨ï¼Œè«‹å…ˆåŸ·è¡Œ 'make setup'"; \
	fi

# æ›´æ–°å¥—ä»¶
update:
	@echo "ğŸ”„ æ›´æ–°å¥—ä»¶..."
	@if [ -d "$(VENV_DIR)" ]; then \
		. $(VENV_DIR)/bin/activate && $(PIP) install --upgrade -r $(REQUIREMENTS); \
	else \
		echo "âŒ è™›æ“¬ç’°å¢ƒä¸å­˜åœ¨ï¼Œè«‹å…ˆåŸ·è¡Œ 'make setup'"; \
	fi

# åµéŒ¯æ¨¡å¼åŸ·è¡Œ
debug: $(SCRIPT)
	@echo "ğŸ› åµéŒ¯æ¨¡å¼åŸ·è¡Œ..."
	@if [ -d "$(VENV_DIR)" ]; then \
		. $(VENV_DIR)/bin/activate && $(PYTHON) -u $(SCRIPT); \
	else \
		echo "âŒ è™›æ“¬ç’°å¢ƒä¸å­˜åœ¨ï¼Œè«‹å…ˆåŸ·è¡Œ 'make setup'"; \
	fi

# é˜²æ­¢æª”æ¡ˆåç¨±è¡çª
.PHONY: help setup venv install run check clean reset rebuild show-result install-extra update debug
