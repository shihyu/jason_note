<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Plot - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="how-to-draw-stock-chart-with-python"><a class="header" href="#how-to-draw-stock-chart-with-python">How To Draw Stock Chart With Python</a></h2>
<p>出處: https://pythoninoffice.com/draw-stock-chart-with-python/</p>
<p>In this tutorial, we’ll learn how to draw a stock chart with Python. Static charts are so 1990s, we don’t do it here. Instead, we’ll draw fully interactive charts using plotly.</p>
<p>UPDATED April 8, 2022 – Include a correction to hide non-trading days.</p>
<h2 id="tools-required"><a class="header" href="#tools-required">Tools Required</a></h2>
<p><strong><code>plotly</code></strong> – AWESOME charting library</p>
<p><strong><code>yfinance</code></strong> – download historical market data from Yahoo Finance</p>
<pre><code class="language-bash">pip install plotly
pip install yfinance
</code></pre>
<h2 id="download-historical-price-data-from-yahoo-finance"><a class="header" href="#download-historical-price-data-from-yahoo-finance">Download Historical Price Data From Yahoo Finance</a></h2>
<p>We are going to use the <strong><code>yfinance</code></strong> library to download Tesla stock historical (1 year) price data. <strong><code>yfinance</code></strong> makes it really simple to download stock price data from Yahoo Finance.</p>
<pre><code class="language-python">import yfinance
tsla = yfinance.Ticker('TSLA')
hist = tsla.history(period='1y')
</code></pre>
<p><img src="../images/ngcb20" alt="img" /></p>
<p>Tesla Stock Historical Price Data</p>
<h2 id="start-with-a-simple-stock-chart-using-python"><a class="header" href="#start-with-a-simple-stock-chart-using-python">Start With A Simple Stock Chart Using Python</a></h2>
<p>In a previous tutorial, we talked about how to use <a href="https://pythoninoffice.com/python-data-visualization-exploration-plotly">Plotly Express</a>. However, due to the complexity of our stock chart, we’ll need to use the regular <strong><code>plotly</code></strong> to unlock its true power.</p>
<p>It’s kinda funny that we can use the <strong><code>.Scatter()</code></strong> to draw a line chart. The following code draws a stock price chart using the daily Close price, also note the <strong><code>mode='lines'</code></strong>. It’s also important to remember to <strong><code>.show()</code></strong> the chart after plotting otherwise we can’t see them.</p>
<p>By the way, these charts are interactive, you can hover the mouse over the chart and see the price details.</p>
<pre><code class="language-python">import plotly.graph_objects as go

fig = go.Figure(data=go.Scatter(x=hist.index,y=hist['Close'], mode='lines'))
fig.show()
</code></pre>
<p><img src="../images/ngcb19" alt="img" /></p>
<p>Tesla Stock Historical Price Data</p>
<p>If we set the <strong><code>mode='markers'</code></strong>, then we’ll have a regular scatter (dots) plot. There’s also another <strong><code>mode='lines+markers'</code></strong> that shows both dots and lines like the below.</p>
<pre><code class="language-python">fig = go.Figure(data=go.Scatter(x=hist.index,y=hist['Close'], mode='lines+markers'))
fig.show()
</code></pre>
<p><img src="../images/ngcb18" alt="img" /></p>
<h2 id="add-trading-volume-to-the-stock-chart"><a class="header" href="#add-trading-volume-to-the-stock-chart">Add Trading Volume To The Stock Chart</a></h2>
<p>Let’s add the trading volume to the chart. To do this, we’ll need a <strong><code>subplot</code></strong> and <strong><code>secondary_y</code></strong> axis for the volume data.</p>
<p>In general, we can use the <strong><code>figure.add_trace()</code></strong> method to add a new data series into the graph. This is something the Plotly Express has difficulty with but is very easy to achieve in <strong><code>plotly_objects</code></strong>.</p>
<p>Note that for the <strong>primary y-axis</strong> i.e. the first <strong><code>figure.add_trace()</code></strong> below, we need to include <strong><code>secondary_y=False</code></strong>, or leave it blank (so that it will default to <strong><code>False</code></strong>). For the secondary y-axis, we need to specify that <strong><code>secondary_y=True</code></strong> in the <strong><code>add_trace</code></strong> method.</p>
<pre><code class="language-python">from plotly.subplots import make_subplots

fig2 = make_subplots(specs=[[{"secondary_y": True}]])
fig2.add_trace(go.Scatter(x=hist.index,y=hist['Close'],name='Price'),secondary_y=False)
fig2.add_trace(go.Bar(x=hist.index,y=hist['Volume'],name='Volume'),secondary_y=True)
fig2.show()
</code></pre>
<p><img src="../images/ngcb17" alt="img" /></p>
<p>Although the volume data is on the secondary y-axis (see the label on the right-hand side), some of the bars are way too long and are covering the stock price graph. Let’s scale the volume bars down a little bit by setting a range for the y-axis. We can use the <strong><code>figure.update_yaxes()</code></strong> method to do that. Also, I’m going to hide the number labeling for the volume data. Again, note that we need to specify that we are operating on the secondary y-axis by setting <strong><code>secondary_y=True</code></strong> in the below code.</p>
<pre><code class="language-python">fig2.update_yaxes(range=[0,7000000000],secondary_y=True)
fig2.update_yaxes(visible=False, secondary_y=True)
</code></pre>
<p><img src="../images/ngcb16" alt="img" /></p>
<h2 id="candlestick-chart"><a class="header" href="#candlestick-chart">Candlestick Chart</a></h2>
<p>So really, who looks at a line chart for stocks? Pros look at only the candlestick chart!</p>
<p>No problem, we can do it in the candlestick style. Instead of using the <strong><code>Scatter()</code></strong> plot and passing the ‘Close’ price to the y-axis, now we need to specify each of ‘open’, ‘high’, ‘low’ and ‘close’, also known as the “ohlc”.</p>
<pre><code class="language-python">fig3 = make_subplots(specs=[[{"secondary_y": True}]])
fig3.add_trace(go.Candlestick(x=hist.index,
                              open=hist['Open'],
                              high=hist['High'],
                              low=hist['Low'],
                              close=hist['Close'],
                             ))
</code></pre>
<p><img src="../images/ngcb15" alt="img" /></p>
<p>It’s interesting because, with the Candlestick chart, we now have another smaller chart at the bottom, this is actually called a “range slider”, and we can drag either side to zoom in/out on a certain area of the chart.</p>
<p>Let’s also add back the volume information to the chart. I don’t think the range slider is particularly useful in this case, so I’m going to hide it by using the <strong><code>figure.update_layout()</code></strong> method.</p>
<pre><code class="language-python">fig3.add_trace(go.Bar(x=hist.index, y=hist['Volume'], name='Volume'),secondary_y=True)
fig3.update_layout(xaxis_rangeslider_visible=False)
</code></pre>
<h2 id="indicators"><a class="header" href="#indicators">Indicators</a></h2>
<p>We’ll draw a simple indicator 20 Day Moving Average here to show the concept, theoretically, we can plot any indicator on the chart.</p>
<p><strong><code>pandas</code></strong> provides convenient ways to calculate time series-related metrics such as the moving average. The <strong><code>df.rolling()</code></strong> method provides “moving windows” that we can operate on. To get the average of the moving window, we just need to add the <strong><code>.mean()</code></strong> at the end of the <strong><code>rolling()</code></strong> method.</p>
<pre><code class="language-python">fig3.add_trace(go.Scatter(x=hist.index,y=hist['Close'].rolling(window=20).mean(),marker_color='blue',name='20 Day MA'))
fig3.add_trace(go.Bar(x=hist.index, y=hist['Volume'], name='Volume'),secondary_y=True)
fig3.update_layout(title={'text':'TSLA', 'x':0.5})
fig3.update_yaxes(range=[0,1000000000],secondary_y=True)
fig3.update_yaxes(visible=False, secondary_y=True)
fig3.update_layout(xaxis_rangeslider_visible=False)  #hide range slider
fig3.show()
</code></pre>
<p>We are also going to modify the volume a little bit. Right now the volume bars all have the same color. We can use different colors to distinguish between an up or down day – green for up days, and red for down days.</p>
<p>To do that, we just need to calculate the daily change (positive or negative) then insert a color column into our dataframe. Then we can pass the color information into the volume data series. The <strong><code>marker</code></strong> argument dictates how our scatter plot should look like – color, shape, size, etc.</p>
<pre><code class="language-python">hist['diff'] = hist['Close'] - hist['Open']
hist.loc[hist['diff']&gt;=0, 'color'] = 'green'
hist.loc[hist['diff']&lt;0, 'color'] = 'red'
</code></pre>
<p><img src="../images/ngcb14" alt="img" />Add a column to indicate color</p>
<p>To put everything together:</p>
<pre><code class="language-python">fig3 = make_subplots(specs=[[{"secondary_y": True}]])
fig3.add_trace(go.Candlestick(x=hist.index,
                              open=hist['Open'],
                              high=hist['High'],
                              low=hist['Low'],
                              close=hist['Close'],
                              name='Price'))
fig3.add_trace(go.Scatter(x=hist.index,y=hist['Close'].rolling(window=20).mean(),marker_color='blue',name='20 Day MA'))
fig3.add_trace(go.Bar(x=hist.index, y=hist['Volume'], name='Volume', marker={'color':hist['color']}),secondary_y=True)
fig3.update_yaxes(range=[0,700000000],secondary_y=True)
fig3.update_yaxes(visible=False, secondary_y=True)
fig3.update_layout(xaxis_rangeslider_visible=False)  #hide range slider
fig3.update_layout(title={'text':'TSLA', 'x':0.5})
fig3.show()
</code></pre>
<p><img src="../images/ngcb13" alt="img" /></p>
<p>You might notice that in the above graph, 20 D MA didn’t start from the beginning. That’s because we need 20 days to calculate the first moving average, therefore the first 19 days are essentially blank.</p>
<h2 id="hide-non-trading-days"><a class="header" href="#hide-non-trading-days">Hide Non-trading Days</a></h2>
<p>Stock markets close on weekends and holidays, so there’s no data for those periods. The above chart looks all fine but you kind of see small gaps on the bars at the bottom. If we zoom in more, you’ll see them more clearly.</p>
<p><img src="../images/ngcb12" alt="Zoomed in chart with gaps" />Zoomed in chart with gaps</p>
<p>Thanks Dan for suggesting this correction! Let’s now fix this.</p>
<p>Plotly charts have a <strong>rangebreaks</strong> attribute that we can use to hide certain time periods. This works on both x-axis and y-axis. Also note this attribute is not unique to the candlestick chart, so you can use it to block off time periods for any type of chart with <strong>datetime</strong> data.</p>
<p>All we need is to add another <strong>update_axes(rangebreaks=[…])</strong> to the above code, just before the <strong>fig.show()</strong>.</p>
<ul>
<li><strong>bounds = [‘sat’, ‘mon’]</strong> will hide Saturdays and Sundays</li>
<li><strong>bounds = [16, 9.5]</strong> will hide between 4pm to 9:30am, which are market closed hours</li>
<li><strong>values = [“2021-12-25″,”2022-01-01”]</strong> can hide individual days</li>
</ul>
<pre><code class="language-python">fig3.update_xaxes(rangebreaks = [
                       dict(bounds=['sat','mon']), # hide weekends
                       #dict(bounds=[16, 9.5], pattern='hour'), # for hourly chart, hide non-trading hours (24hr format)
                       dict(values=["2021-12-25","2022-01-01"]) #hide Xmas and New Year
                                ])
</code></pre>
<p>The result is a much smoother graph without gaps.</p>
<p><img src="../images/ngcb1" alt="Zoomed in chart - gaps fixed!" />Zoomed in chart – gaps fixed!</p>
<h2 id="save-plotly-chart"><a class="header" href="#save-plotly-chart">Save Plotly Chart</a></h2>
<p>We can save our stock chart in HTML form, which means all the interactive features will be retained in the graph.</p>
<pre><code class="language-python">fig3.write_html(r'C:\Users\jay\Desktop\PythonInOffice\plotly_stock_chart\graph.html')
</code></pre>
<h2 id="dash"><a class="header" href="#dash">Dash</a></h2>
<p>Although our graph is interactive, it’s still lacking something. For example, if we want to draw a chart for another stock, we have to change the stock ticker inside the code and re-run it. In other words, our graph is not fully interactive yet. With Dash, we can create a graph that takes stock tickers as input and draw the chart accordingly.</p>
<hr />
<pre><code class="language-python">import yfinance as yf
import pandas as pd
import plotly as plotly
import plotly.graph_objects as go
from plotly.subplots import make_subplots

def show_plot(fig, filename):
    plotly.offline.plot(fig, filename=filename)


tsla = yf.Ticker('TSLA')
hist = tsla.history(period='1y')
fig = go.Figure(data=go.Scatter(x=hist.index,y=hist['Close'], mode='lines'))
# 只有線圖
show_plot(fig, 'test.html')

# 線圖+點
fig = go.Figure(data=go.Scatter(x=hist.index,y=hist['Close'], mode='lines+markers'))
show_plot(fig, 'test.html')


# 線圖+點+成交量柱狀圖
fig2 = make_subplots(specs=[[{"secondary_y": True}]])
fig2.add_trace(go.Scatter(x=hist.index,y=hist['Close'],name='Price'),secondary_y=False)
fig2.add_trace(go.Bar(x=hist.index,y=hist['Volume'],name='Volume'),secondary_y=True)
show_plot(fig2, 'test.html')


# 線圖+點+成交量柱狀圖+nornalize
fig2.update_yaxes(range=[0,7000000000],secondary_y=True)
fig2.update_yaxes(visible=False, secondary_y=True)
show_plot(fig2, 'test.html')


# 線圖+點+成交量柱狀圖+蠟燭圖
fig3 = make_subplots(specs=[[{"secondary_y": True}]])
fig3.add_trace(go.Candlestick(x=hist.index,
                              open=hist['Open'],
                              high=hist['High'],
                              low=hist['Low'],
                              close=hist['Close'],
                             ))
show_plot(fig3, 'test.html')


# 成交量柱狀圖+蠟燭圖
fig3.add_trace(go.Bar(x=hist.index, y=hist['Volume'], name='Volume'),secondary_y=True)
fig3.update_layout(xaxis_rangeslider_visible=False)
show_plot(fig3, 'test.html')


fig3.add_trace(go.Scatter(x=hist.index,y=hist['Close'].rolling(window=20).mean(),marker_color='blue',name='20 Day MA'))
fig3.add_trace(go.Bar(x=hist.index, y=hist['Volume'], name='Volume'),secondary_y=True)
fig3.update_layout(title={'text':'TSLA', 'x':0.5})
fig3.update_yaxes(range=[0,1000000000],secondary_y=True)
fig3.update_yaxes(visible=False, secondary_y=True)
fig3.update_layout(xaxis_rangeslider_visible=False)  #hide range slider
show_plot(fig3, 'test.html')

</code></pre>
<h2 id="easy-and-interactive-candlestick-charts-in-python"><a class="header" href="#easy-and-interactive-candlestick-charts-in-python">Easy and Interactive Candlestick Charts in Python</a></h2>
<p>https://medium.com/@dannygrovesn7/using-streamlit-and-plotly-to-create-interactive-candlestick-charts-a2a764ad0d8e</p>
<pre><code class="language-python">import pandas as pd
import yfinance as yf
import plotly.io as pio
import plotly.graph_objects as go
import plotly as plotly
from plotly.subplots import make_subplots

pio.renderers.default = "browser"


def get_candlestick_plot(df: pd.DataFrame, ma1: int, ma2: int, ticker: str):
    """
    Create the candlestick chart with two moving avgs + a plot of the volume
    Parameters
    ----------
    df : pd.DataFrame
        The price dataframe
    ma1 : int
        The length of the first moving average (days)
    ma2 : int
        The length of the second moving average (days)
    ticker : str
        The ticker we are plotting (for the title).
    """

    fig = make_subplots(
        rows=2,
        cols=1,
        shared_xaxes=True,
        vertical_spacing=0.1,
        subplot_titles=(f"{ticker} Stock Price", "Volume Chart"),
        row_width=[0.3, 0.7],
    )

    fig.add_trace(
        go.Candlestick(
            # x=df["Date"],
            x=df.index,
            open=df["Open"],
            high=df["High"],
            low=df["Low"],
            close=df["Close"],
            name="Candlestick chart",
        ),
        row=1,
        col=1,
    )

    fig.add_trace(
        go.Line(x=df.index, y=df[f"{ma1}_ma"], name=f"{ma1} SMA"),
        row=1,
        col=1,
    )

    fig.add_trace(
        go.Line(x=df.index, y=df[f"{ma2}_ma"], name=f"{ma2} SMA"),
        row=1,
        col=1,
    )

    fig.add_trace(
        go.Bar(x=df.index, y=df["Volume"], name="Volume"),
        row=2,
        col=1,
    )

    fig["layout"]["xaxis2"]["title"] = "Date"
    fig["layout"]["yaxis"]["title"] = "Price"
    fig["layout"]["yaxis2"]["title"] = "Volume"

    fig.update_xaxes(
        rangebreaks=[{"bounds": ["sat", "mon"]}],
        rangeslider_visible=False,
    )

    return fig


def show_plot(fig, filename):
    plotly.offline.plot(fig, filename=filename)


if __name__ == "__main__":
    stock = "2630.TW"
    tsla = yf.Ticker(stock)
    df = tsla.history(period="10y")

    df["10_ma"] = df["Close"].rolling(10).mean()
    df["20_ma"] = df["Close"].rolling(20).mean()
    fig = get_candlestick_plot(df[-120:], 10, 20, stock)
    # fig.show()
    show_plot(fig, "tsla.html")
</code></pre>
<h2 id="子圖"><a class="header" href="#子圖">子圖</a></h2>
<pre><code class="language-python">from plotly.subplots import make_subplots
import plotly
import plotly.graph_objects as go

fig = make_subplots(
    rows=2, cols=2,
    specs=[[{"type": "xy", 'secondary_y': True}, {"type": "polar"}],
           [{"type": "domain"}, {"type": "scene"}]],
    y_title='title'
)
'''
也可以為：specs=[[{'type': 'bar'}, {'type': 'barpolar'}],
                [{'type': 'pie'}, {'type': 'scatter3d'}]]
'''

# 使用 secondary_y 參數選擇該圖相對的 y軸座標
fig.add_trace(go.Bar(y=[2, 3, 1]),
              row=1, col=1, secondary_y=False)
fig.add_trace(go.Scatter(x=[0, 1, 2], y=[4, 10, 7]),
              row=1, col=1, secondary_y=True)

fig.add_trace(go.Barpolar(theta=[0, 45, 90], r=[2, 3, 1]),
              row=1, col=2)

fig.add_trace(go.Pie(values=[2, 3, 1]),
              row=2, col=1)

fig.add_trace(go.Scatter3d(x=[2, 3, 1], y=[0, 0, 0],
                           z=[0.5, 1, 2], mode="lines"),
              row=2, col=2)

fig.update_layout(height=700, showlegend=False)

plotly.offline.plot(fig, filename='test.html')
</code></pre>
<p><img src="../images/newplot.png" alt="" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../python/schedule.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../python/plot/dash.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../python/schedule.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../python/plot/dash.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../../ace.js"></script>
        <script src="../../mode-rust.js"></script>
        <script src="../../editor.js"></script>
        <script src="../../theme-dawn.js"></script>
        <script src="../../theme-tomorrow_night.js"></script>

        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>



    </div>
    </body>
</html>
