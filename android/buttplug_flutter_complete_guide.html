<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Flutter Buttplug 完整開發指南 - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="flutter-buttplug-完整開發指南"><a class="header" href="#flutter-buttplug-完整開發指南">Flutter Buttplug 完整開發指南</a></h1>
<h2 id="目錄"><a class="header" href="#目錄">目錄</a></h2>
<ol>
<li><a href="#buttplug-%E6%9E%B6%E6%A7%8B%E6%A6%82%E8%BF%B0">Buttplug 架構概述</a></li>
<li><a href="#intiface-central-vs-buttplug-core">Intiface Central vs Buttplug Core</a></li>
<li><a href="#flutter-%E6%95%B4%E5%90%88%E6%96%B9%E6%A1%88">Flutter 整合方案</a></li>
<li><a href="#%E7%A1%AC%E9%AB%94%E6%94%AF%E6%8F%B4%E6%83%85%E6%B3%81">硬體支援情況</a></li>
<li><a href="#%E5%90%84%E5%AE%B6%E7%94%A2%E5%93%81-bt-%E5%91%BD%E4%BB%A4%E4%BD%8D%E7%BD%AE">各家產品 BT 命令位置</a></li>
<li><a href="#apkipa-%E6%89%93%E5%8C%85%E8%AA%AA%E6%98%8E">APK/IPA 打包說明</a></li>
<li><a href="#%E5%B9%B3%E5%8F%B0%E7%89%B9%E5%AE%9A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85">平台特定注意事項</a></li>
<li><a href="#%E5%AF%A6%E4%BD%9C%E7%AF%84%E4%BE%8B">實作範例</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AF%A6%E8%B8%90%E5%BB%BA%E8%AD%B0">最佳實踐建議</a></li>
</ol>
<hr />
<h2 id="buttplug-架構概述"><a class="header" href="#buttplug-架構概述">Buttplug 架構概述</a></h2>
<p>Buttplug 是一個開源的親密硬體控制標準和軟體專案，支援性玩具、按摩設備等硬體控制。</p>
<h3 id="核心組件"><a class="header" href="#核心組件">核心組件</a></h3>
<pre><code>┌─────────────────────────────────────────┐
│            應用程式層 (您的 Flutter App)     │
├─────────────────────────────────────────┤
│            Buttplug 客戶端              │
├─────────────────────────────────────────┤
│            Buttplug 服務器              │ 
├─────────────────────────────────────────┤
│            硬體通訊層                   │
└─────────────────────────────────────────┘
</code></pre>
<h3 id="技術特色"><a class="header" href="#技術特色">技術特色</a></h3>
<ul>
<li><strong>實作語言</strong>: Rust 核心，提供 C#、JS、Dart 等綁定</li>
<li><strong>支援品牌</strong>: Lovense、Kiiroo、The Handy、WeVibe、OSR-2/SR-6 等</li>
<li><strong>連接方式</strong>: Bluetooth LE、USB、HID、Serial</li>
<li><strong>跨平台</strong>: Desktop、Mobile、Web</li>
<li><strong>開源協議</strong>: BSD 3-Clause</li>
</ul>
<hr />
<h2 id="intiface-central-vs-buttplug-core"><a class="header" href="#intiface-central-vs-buttplug-core">Intiface Central vs Buttplug Core</a></h2>
<h3 id="專案關係"><a class="header" href="#專案關係">專案關係</a></h3>
<div class="table-wrapper"><table><thead><tr><th>專案</th><th>類型</th><th>功能</th><th>使用者</th></tr></thead><tbody>
<tr><td><strong>buttplugio/buttplug</strong></td><td>核心函式庫</td><td>Rust 協議實現</td><td>開發者</td></tr>
<tr><td><strong>intiface/intiface-central</strong></td><td>前端應用</td><td>使用者界面</td><td>一般使用者</td></tr>
</tbody></table>
</div>
<h3 id="倉庫說明"><a class="header" href="#倉庫說明">倉庫說明</a></h3>
<h4 id="buttplugiobuttplug-核心引擎"><a class="header" href="#buttplugiobuttplug-核心引擎">buttplugio/buttplug (核心引擎)</a></h4>
<ul>
<li><strong>功能</strong>: Buttplug 協議的 Rust 核心實現</li>
<li><strong>包含</strong>: 客戶端、服務器、協議規範</li>
<li><strong>路徑結構</strong>:
<pre><code>buttplugio/buttplug/
├── buttplug/              # Rust 核心實現
├── buttplug-schema/       # JSON 協議架構
├── buttplug-device-config/ # 設備配置
└── buttplug_derive/       # 程序宏
</code></pre>
</li>
</ul>
<h4 id="intifaceintiface-central-前端應用"><a class="header" href="#intifaceintiface-central-前端應用">intiface/intiface-central (前端應用)</a></h4>
<ul>
<li><strong>功能</strong>: 跨平台前端應用程式</li>
<li><strong>技術</strong>: Flutter + Rust 混合開發</li>
<li><strong>平台</strong>: Windows、macOS、Linux、Android、iOS</li>
<li><strong>發佈</strong>: 各大應用商店均有上架</li>
</ul>
<hr />
<h2 id="flutter-整合方案"><a class="header" href="#flutter-整合方案">Flutter 整合方案</a></h2>
<h3 id="方案比較"><a class="header" href="#方案比較">方案比較</a></h3>
<div class="table-wrapper"><table><thead><tr><th>方案</th><th>需要 Rust</th><th>複雜度</th><th>推薦度</th><th>應用大小</th></tr></thead><tbody>
<tr><td><strong>Dart buttplug 套件 + Intiface Central</strong></td><td>❌</td><td>低</td><td>⭐⭐⭐⭐⭐</td><td>~30MB</td></tr>
<tr><td><strong>FFI 直接整合</strong></td><td>✅</td><td>高</td><td>⭐⭐</td><td>~120MB</td></tr>
<tr><td><strong>React Native + buttplug-js</strong></td><td>❌</td><td>中</td><td>⭐⭐⭐</td><td>~50MB</td></tr>
</tbody></table>
</div>
<h3 id="官方-dart-套件-推薦"><a class="header" href="#官方-dart-套件-推薦">官方 Dart 套件 (推薦)</a></h3>
<h4 id="安裝"><a class="header" href="#安裝">安裝</a></h4>
<pre><code class="language-yaml"># pubspec.yaml
dependencies:
  flutter:
    sdk: flutter
  buttplug: ^0.0.7  # 最新版本
</code></pre>
<h4 id="特點"><a class="header" href="#特點">特點</a></h4>
<ul>
<li><strong>純 Dart 實現</strong>: 無需 FFI，無需外部依賴</li>
<li><strong>協議支援</strong>: 實現 Buttplug Message Spec v3</li>
<li><strong>跨平台</strong>: 支援所有 Flutter 平台</li>
<li><strong>輕量級</strong>: 不包含硬體協議實現</li>
</ul>
<h4 id="基本使用"><a class="header" href="#基本使用">基本使用</a></h4>
<pre><code class="language-dart">import 'package:buttplug/buttplug.dart';

// 初始化客戶端
final client = ButtplugClient('Flutter App');

// 連接到 Intiface Central
final connector = ButtplugWebsocketConnector(
  Uri.parse('ws://localhost:12345')
);
await client.connect(connector);

// 掃描設備
await client.startScanning();

// 控制設備
for (final device in client.devices) {
  if (device.allowedMessages.containsKey('VibrateCmd')) {
    await device.vibrate(0.5); // 50% 強度
  }
}
</code></pre>
<hr />
<h2 id="硬體支援情況"><a class="header" href="#硬體支援情況">硬體支援情況</a></h2>
<h3 id="dart-套件的硬體支援機制"><a class="header" href="#dart-套件的硬體支援機制">Dart 套件的硬體支援機制</a></h3>
<p><strong>重要</strong>: Dart buttplug 套件本身不包含各家產品的具體協議，硬體支援完全由服務器端 (Intiface Central) 處理。</p>
<pre><code>Flutter App (Dart) 發送: VibrateCmd(0.5)
         ↓
Intiface Central 轉換為設備特定命令:
  - Lovense: "Vibrate:10;"  
  - WeVibe: 特定藍牙封包
  - Kiiroo: 專屬協議格式
         ↓
實際藍牙設備
</code></pre>
<h3 id="支援的設備品牌"><a class="header" href="#支援的設備品牌">支援的設備品牌</a></h3>
<h4 id="主要品牌"><a class="header" href="#主要品牌">主要品牌</a></h4>
<ul>
<li><strong>Lovense</strong>: 全系列產品 (Max, Nora, Lush, Edge, Hush, Domi, Ambi, etc.)</li>
<li><strong>Kiiroo</strong>: Launch, Onyx, Pearl 系列</li>
<li><strong>WeVibe</strong>: Chorus, Sync, Pivot, Melt, Nova 等</li>
<li><strong>The Handy</strong>: 全自動撫摸設備</li>
<li><strong>Satisfyer</strong>: 部分型號 (需特定藍牙適配器)</li>
<li><strong>Magic Motion</strong>: 全系列</li>
<li><strong>Svakom</strong>: Sam, Alex, Iker 等</li>
</ul>
<h4 id="連接方式支援"><a class="header" href="#連接方式支援">連接方式支援</a></h4>
<ul>
<li><strong>Bluetooth LE</strong>: 主要連接方式，支援大部分現代設備</li>
<li><strong>USB</strong>: 直連設備支援</li>
<li><strong>Serial</strong>: 特殊設備如 E-Stim 系統</li>
<li><strong>WebSocket</strong>: 網路設備支援</li>
</ul>
<h3 id="完整設備清單"><a class="header" href="#完整設備清單">完整設備清單</a></h3>
<p>詳細的支援設備清單可查看: https://iostindex.com</p>
<hr />
<h2 id="各家產品-bt-命令位置"><a class="header" href="#各家產品-bt-命令位置">各家產品 BT 命令位置</a></h2>
<h3 id="重要澄清"><a class="header" href="#重要澄清">重要澄清</a></h3>
<p><strong>Dart buttplug 套件不包含各家產品的 BT 命令</strong>，這些實現都在 Rust 後端中。</p>
<h3 id="程式碼結構"><a class="header" href="#程式碼結構">程式碼結構</a></h3>
<h4 id="1-設備配置檔案"><a class="header" href="#1-設備配置檔案">1. 設備配置檔案</a></h4>
<ul>
<li><strong>位置</strong>: <code>https://github.com/buttplugio/buttplug-device-config</code></li>
<li><strong>檔案</strong>: <code>buttplug-device-config.yml</code></li>
<li><strong>內容</strong>: 設備名稱、藍牙服務/特徵值、連接參數</li>
</ul>
<h4 id="2-協議實現-rust"><a class="header" href="#2-協議實現-rust">2. 協議實現 (Rust)</a></h4>
<ul>
<li><strong>位置</strong>: <code>https://github.com/buttplugio/buttplug</code></li>
<li><strong>路徑</strong>: <code>buttplug/src/server/device/protocol/</code></li>
<li><strong>檔案</strong>:
<pre><code>├── lovense.rs          # Lovense 設備協議
├── kiiroo_v2.rs       # Kiiroo 第二代協議
├── kiiroo_v21.rs      # Kiiroo 2.1 協議
├── wevibe.rs          # WeVibe 協議
├── thehandy.rs        # The Handy 協議
├── vorze_sa.rs        # Vorze 協議
└── ... (其他品牌)
</code></pre>
</li>
</ul>
<h4 id="3-藍牙底層支援"><a class="header" href="#3-藍牙底層支援">3. 藍牙底層支援</a></h4>
<ul>
<li><strong>函式庫</strong>: <code>btleplug</code> (跨平台藍牙 LE 庫)</li>
<li><strong>位置</strong>: <code>https://github.com/deviceplug/btleplug</code></li>
</ul>
<h3 id="設備配置範例"><a class="header" href="#設備配置範例">設備配置範例</a></h3>
<pre><code class="language-yaml"># buttplug-device-config.yml 片段
lovense:
  btle:
    names:
      - LVS-*
      - LOVE-*
    services:
      50300011-0023-4bd4-bbd5-a6920e4c5653:
        tx: 50300012-0023-4bd4-bbd5-a6920e4c5653
        rx: 50300013-0023-4bd4-bbd5-a6920e4c5653
</code></pre>
<h3 id="資料流向"><a class="header" href="#資料流向">資料流向</a></h3>
<pre><code>您的 Flutter App (Dart)
         ↓ WebSocket (標準 Buttplug 協議)
    Intiface Central
         ↓
    Buttplug Rust 服務器
         ↓
    協議處理模組 (lovense.rs, kiiroo.rs, etc.)
         ↓
    btleplug (跨平台藍牙庫)
         ↓ 
    實際藍牙設備
</code></pre>
<hr />
<h2 id="apkipa-打包說明"><a class="header" href="#apkipa-打包說明">APK/IPA 打包說明</a></h2>
<h3 id="android-apk"><a class="header" href="#android-apk">Android APK</a></h3>
<h4 id="分離架構-推薦"><a class="header" href="#分離架構-推薦">分離架構 (推薦)</a></h4>
<pre><code>您的 Flutter APK (~30MB)
├── Flutter 框架
├── Dart buttplug 客戶端套件
└── 您的應用程式碼

+ 

Intiface Central APK (單獨安裝 ~30MB)  
├── Flutter 框架
├── buttplug-rs (透過 FFI)
└── 各家設備協議實現
</code></pre>
<p><strong>特點</strong>:</p>
<ul>
<li>✅ 您的 APK 輕量</li>
<li>✅ 開發簡單</li>
<li>✅ 硬體支援由官方維護</li>
<li>❌ 需要安裝兩個應用</li>
</ul>
<h4 id="整合架構-不推薦"><a class="header" href="#整合架構-不推薦">整合架構 (不推薦)</a></h4>
<pre><code>單一 APK (~120MB)
├── Flutter 框架
├── 您的應用程式碼
├── Rust FFI 綁定
└── 完整 buttplug-rs 庫
</code></pre>
<p><strong>設定需求</strong>:</p>
<pre><code class="language-bash"># 添加 Android 目標
rustup target add aarch64-linux-android
rustup target add armv7-linux-androideabi
rustup target add x86_64-linux-android
rustup target add i686-linux-android
</code></pre>
<h3 id="ios-ipa"><a class="header" href="#ios-ipa">iOS IPA</a></h3>
<h4 id="分離架構-推薦-1"><a class="header" href="#分離架構-推薦-1">分離架構 (推薦)</a></h4>
<pre><code>您的 iOS App (~30MB)
├── Flutter 框架  
├── Dart buttplug 客戶端套件
└── 您的應用程式碼

+

Intiface Central iOS App (App Store)
├── Flutter 框架
├── buttplug-rs (透過 FFI) 
└── 各家設備協議實現
</code></pre>
<h4 id="整合架構的額外挑戰"><a class="header" href="#整合架構的額外挑戰">整合架構的額外挑戰</a></h4>
<ul>
<li>⚠️ App Store 審核更嚴格</li>
<li>⚠️ 需要詳細的隱私政策說明</li>
<li>⚠️ 二進制大小限制</li>
<li>⚠️ 沙盒安全模型限制</li>
</ul>
<hr />
<h2 id="平台特定注意事項"><a class="header" href="#平台特定注意事項">平台特定注意事項</a></h2>
<h3 id="android"><a class="header" href="#android">Android</a></h3>
<h4 id="權限配置"><a class="header" href="#權限配置">權限配置</a></h4>
<pre><code class="language-xml">&lt;!-- android/app/src/main/AndroidManifest.xml --&gt;
&lt;uses-permission android:name="android.permission.BLUETOOTH" /&gt;
&lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN" /&gt;
&lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" /&gt;
&lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;
</code></pre>
<h4 id="藍牙使用注意事項"><a class="header" href="#藍牙使用注意事項">藍牙使用注意事項</a></h4>
<ul>
<li>🚫 <strong>不要</strong>在系統設定中配對設備</li>
<li>✅ 讓 Buttplug 直接發現和連接設備</li>
<li>⚠️ WeVibe/Satisfyer/Kiiroo 有特殊配對要求</li>
</ul>
<h3 id="ios"><a class="header" href="#ios">iOS</a></h3>
<h4 id="權限配置-1"><a class="header" href="#權限配置-1">權限配置</a></h4>
<pre><code class="language-xml">&lt;!-- ios/Runner/Info.plist --&gt;
&lt;key&gt;NSBluetoothAlwaysUsageDescription&lt;/key&gt;
&lt;string&gt;This app connects to personal wellness devices via Bluetooth.&lt;/string&gt;
&lt;key&gt;NSBluetoothPeripheralUsageDescription&lt;/key&gt;
&lt;string&gt;This app manages connections to personal devices.&lt;/string&gt;
&lt;key&gt;NSLocationWhenInUseUsageDescription&lt;/key&gt;
&lt;string&gt;Location access is required for Bluetooth device discovery.&lt;/string&gt;
</code></pre>
<h4 id="特殊限制"><a class="header" href="#特殊限制">特殊限制</a></h4>
<ul>
<li>📱 背景執行限制嚴格</li>
<li>🔒 應用程式間通訊受限</li>
<li>⏰ 藍牙連線超時機制</li>
<li>🛡️ 沙盒安全模型</li>
</ul>
<hr />
<h2 id="實作範例"><a class="header" href="#實作範例">實作範例</a></h2>
<h3 id="基本-flutter-整合"><a class="header" href="#基本-flutter-整合">基本 Flutter 整合</a></h3>
<pre><code class="language-dart">import 'package:flutter/material.dart';
import 'package:buttplug/buttplug.dart';

class ButtplugDemo extends StatefulWidget {
  @override
  _ButtplugDemoState createState() =&gt; _ButtplugDemoState();
}

class _ButtplugDemoState extends State&lt;ButtplugDemo&gt; {
  ButtplugClient? _client;
  bool _isConnected = false;
  bool _isScanning = false;
  List&lt;ButtplugClientDevice&gt; _devices = [];
  String _statusMessage = 'Not connected';

  @override
  void initState() {
    super.initState();
    _initializeClient();
  }

  void _initializeClient() {
    _client = ButtplugClient('Flutter Demo Client');
    
    // 設置事件監聽器
    _client!.deviceAdded = (device) {
      setState(() {
        _devices.add(device);
        _statusMessage = 'Device added: ${device.name}';
      });
    };
    
    _client!.deviceRemoved = (device) {
      setState(() {
        _devices.removeWhere((d) =&gt; d.index == device.index);
        _statusMessage = 'Device removed: ${device.name}';
      });
    };
    
    _client!.scanningFinished = () {
      setState(() {
        _isScanning = false;
        _statusMessage = 'Scanning finished';
      });
    };
  }

  Future&lt;void&gt; _connectToServer() async {
    try {
      final connector = ButtplugWebsocketConnector(
        Uri.parse('ws://localhost:12345')
      );
      
      await _client!.connect(connector);
      
      setState(() {
        _isConnected = true;
        _statusMessage = 'Connected to server';
      });
    } catch (e) {
      setState(() {
        _statusMessage = 'Connection failed: $e';
      });
    }
  }

  Future&lt;void&gt; _startScanning() async {
    if (!_isConnected) return;
    
    try {
      setState(() {
        _isScanning = true;
        _statusMessage = 'Scanning for devices...';
      });
      
      await _client!.startScanning();
    } catch (e) {
      setState(() {
        _isScanning = false;
        _statusMessage = 'Scanning failed: $e';
      });
    }
  }

  Future&lt;void&gt; _vibrateDevice(ButtplugClientDevice device, double intensity) async {
    try {
      if (device.allowedMessages.containsKey('VibrateCmd')) {
        await device.vibrate(intensity);
        setState(() {
          _statusMessage = 'Vibrating ${device.name} at ${(intensity * 100).toInt()}%';
        });
      }
    } catch (e) {
      setState(() {
        _statusMessage = 'Vibration failed: $e';
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('Buttplug Flutter Demo')),
      body: Padding(
        padding: EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.stretch,
          children: [
            // 連接狀態卡片
            Card(
              child: Padding(
                padding: EdgeInsets.all(16.0),
                child: Column(
                  children: [
                    Text('Connection Status', 
                         style: Theme.of(context).textTheme.titleLarge),
                    SizedBox(height: 8),
                    Text(_statusMessage,
                         style: TextStyle(
                           color: _isConnected ? Colors.green : Colors.red,
                         )),
                    SizedBox(height: 16),
                    Row(
                      mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                      children: [
                        ElevatedButton(
                          onPressed: _isConnected ? null : _connectToServer,
                          child: Text('Connect'),
                        ),
                        ElevatedButton(
                          onPressed: _isScanning ? null : _startScanning,
                          child: Text('Scan Devices'),
                        ),
                      ],
                    ),
                  ],
                ),
              ),
            ),
            
            // 設備列表
            if (_devices.isNotEmpty)
              Expanded(
                child: ListView.builder(
                  itemCount: _devices.length,
                  itemBuilder: (context, index) {
                    final device = _devices[index];
                    return DeviceCard(
                      device: device,
                      onVibrate: _vibrateDevice,
                    );
                  },
                ),
              ),
          ],
        ),
      ),
    );
  }
}

class DeviceCard extends StatefulWidget {
  final ButtplugClientDevice device;
  final Function(ButtplugClientDevice, double) onVibrate;

  DeviceCard({required this.device, required this.onVibrate});

  @override
  _DeviceCardState createState() =&gt; _DeviceCardState();
}

class _DeviceCardState extends State&lt;DeviceCard&gt; {
  double _intensity = 0.0;

  @override
  Widget build(BuildContext context) {
    return Card(
      margin: EdgeInsets.symmetric(vertical: 4.0),
      child: Padding(
        padding: EdgeInsets.all(12.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(widget.device.name,
                 style: Theme.of(context).textTheme.titleMedium),
            SizedBox(height: 8),
            
            if (widget.device.allowedMessages.containsKey('VibrateCmd')) ...[
              Text('Intensity: ${(_intensity * 100).toInt()}%'),
              Slider(
                value: _intensity,
                onChanged: (value) {
                  setState(() =&gt; _intensity = value);
                  widget.onVibrate(widget.device, value);
                },
              ),
            ],
            
            ElevatedButton(
              onPressed: () =&gt; widget.device.stop(),
              style: ElevatedButton.styleFrom(backgroundColor: Colors.red),
              child: Text('Stop', style: TextStyle(color: Colors.white)),
            ),
          ],
        ),
      ),
    );
  }
}
</code></pre>
<h3 id="使用流程"><a class="header" href="#使用流程">使用流程</a></h3>
<ol>
<li>
<p><strong>安裝 Intiface Central</strong></p>
<ul>
<li>Android: Google Play Store</li>
<li>iOS: Apple App Store</li>
</ul>
</li>
<li>
<p><strong>啟動 Intiface Central</strong></p>
<ul>
<li>開啟應用程式</li>
<li>點擊 "Start Server"</li>
<li>確保在 localhost:12345 運行</li>
</ul>
</li>
<li>
<p><strong>運行您的 Flutter 應用程式</strong></p>
<ul>
<li>點擊 "Connect" 連接服務器</li>
<li>點擊 "Scan Devices" 掃描設備</li>
<li>使用滑桿控制設備</li>
</ul>
</li>
</ol>
<hr />
<h2 id="最佳實踐建議"><a class="header" href="#最佳實踐建議">最佳實踐建議</a></h2>
<h3 id="開發建議"><a class="header" href="#開發建議">開發建議</a></h3>
<ol>
<li>
<p><strong>架構選擇</strong></p>
<ul>
<li>✅ 優先使用 Dart buttplug + Intiface Central 方案</li>
<li>❌ 避免複雜的 FFI 整合</li>
<li>🎯 專注於應用邏輯而非硬體協議</li>
</ul>
</li>
<li>
<p><strong>錯誤處理</strong></p>
<pre><code class="language-dart">try {
  await client.connect(connector);
} catch (e) {
  if (e.toString().contains('Connection refused')) {
    // 提示用戶啟動 Intiface Central
  } else if (e.toString().contains('Bluetooth')) {
    // 提示用戶檢查藍牙權限
  }
}
</code></pre>
</li>
<li>
<p><strong>使用者體驗</strong></p>
<ul>
<li>提供清晰的設定指南</li>
<li>包含 Intiface Central 安裝連結</li>
<li>實現友善的錯誤提示</li>
</ul>
</li>
</ol>
<h3 id="發佈建議"><a class="header" href="#發佈建議">發佈建議</a></h3>
<ol>
<li>
<p><strong>應用商店描述</strong></p>
<ul>
<li>避免過於明確的性相關描述</li>
<li>重點強調「個人健康」、「按摩設備」</li>
<li>提供詳細的隱私政策</li>
</ul>
</li>
<li>
<p><strong>權限說明</strong></p>
<ul>
<li>詳細解釋為什麼需要藍牙權限</li>
<li>說明位置權限的必要性 (iOS 要求)</li>
<li>提供權限設定指南</li>
</ul>
</li>
<li>
<p><strong>相容性測試</strong></p>
<ul>
<li>測試多種設備品牌</li>
<li>驗證不同 Android/iOS 版本</li>
<li>確保 Intiface Central 相容性</li>
</ul>
</li>
</ol>
<h3 id="安全性考慮"><a class="header" href="#安全性考慮">安全性考慮</a></h3>
<ol>
<li>
<p><strong>資料保護</strong></p>
<ul>
<li>不記錄敏感的使用資料</li>
<li>使用本地連接 (WebSocket)</li>
<li>避免雲端資料傳輸</li>
</ul>
</li>
<li>
<p><strong>權限最小化</strong></p>
<ul>
<li>只請求必要的權限</li>
<li>在需要時動態請求權限</li>
<li>提供權限拒絕的降級功能</li>
</ul>
</li>
</ol>
<h3 id="效能優化"><a class="header" href="#效能優化">效能優化</a></h3>
<ol>
<li>
<p><strong>連接管理</strong></p>
<pre><code class="language-dart">// 應用暫停時斷開連接
@override
void didChangeAppLifecycleState(AppLifecycleState state) {
  if (state == AppLifecycleState.paused) {
    client?.disconnect();
  }
}
</code></pre>
</li>
<li>
<p><strong>記憶體管理</strong></p>
<ul>
<li>適當釋放設備引用</li>
<li>取消未完成的異步操作</li>
<li>清理事件監聽器</li>
</ul>
</li>
</ol>
<hr />
<h2 id="總結"><a class="header" href="#總結">總結</a></h2>
<p>使用 <strong>Dart buttplug 套件 + Intiface Central</strong> 的組合是目前在 Flutter 中整合 Buttplug 的最佳方案：</p>
<h3 id="優勢"><a class="header" href="#優勢">優勢</a></h3>
<ul>
<li>✅ <strong>開發簡單</strong>: 純 Dart 實現，無需 Rust 知識</li>
<li>✅ <strong>維護容易</strong>: 硬體支援由官方維護</li>
<li>✅ <strong>檔案小</strong>: 應用程式保持輕量</li>
<li>✅ <strong>跨平台</strong>: Android/iOS 統一體驗</li>
<li>✅ <strong>穩定可靠</strong>: 經過大量用戶驗證</li>
</ul>
<h3 id="注意事項"><a class="header" href="#注意事項">注意事項</a></h3>
<ul>
<li>📱 需要使用者安裝 Intiface Central</li>
<li>🔐 需要適當的權限配置</li>
<li>📋 需要詳細的使用說明</li>
</ul>
<p>這個架構讓您可以專注於創建優秀的使用者體驗，而不需要擔心底層的硬體通訊複雜性。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../android/flutter_ubuntu_guide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../android/buttplug_porting_guide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../android/flutter_ubuntu_guide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../android/buttplug_porting_guide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
