<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>直接 FFI vs flutter_rust_bridge 詳細比較 - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="直接-ffi-vs-flutter_rust_bridge-詳細比較"><a class="header" href="#直接-ffi-vs-flutter_rust_bridge-詳細比較">直接 FFI vs flutter_rust_bridge 詳細比較</a></h1>
<h2 id="核心差異概覽"><a class="header" href="#核心差異概覽">核心差異概覽</a></h2>
<div class="table-wrapper"><table><thead><tr><th>特性</th><th>直接 FFI</th><th>flutter_rust_bridge</th></tr></thead><tbody>
<tr><td><strong>代碼生成</strong></td><td>手動編寫所有綁定</td><td>自動生成綁定代碼</td></tr>
<tr><td><strong>開發速度</strong></td><td>慢 (需手寫大量樣板)</td><td>快 (自動化)</td></tr>
<tr><td><strong>學習曲線</strong></td><td>陡峭 (需深度理解 FFI)</td><td>平緩 (抽象化細節)</td></tr>
<tr><td><strong>性能</strong></td><td>最佳 (零抽象開銷)</td><td>微小開銷 (包裝層)</td></tr>
<tr><td><strong>類型安全</strong></td><td>手動保證</td><td>自動保證</td></tr>
<tr><td><strong>記憶體管理</strong></td><td>完全手動</td><td>部分自動化</td></tr>
<tr><td><strong>錯誤處理</strong></td><td>手動實現</td><td>內建 Result 轉換</td></tr>
<tr><td><strong>維護成本</strong></td><td>高 (手動同步)</td><td>低 (自動同步)</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="1-代碼編寫差異"><a class="header" href="#1-代碼編寫差異">1. 代碼編寫差異</a></h2>
<h3 id="直接-ffi-方式"><a class="header" href="#直接-ffi-方式">直接 FFI 方式</a></h3>
<h4 id="rust-端-需要手動-c-abi"><a class="header" href="#rust-端-需要手動-c-abi">Rust 端 (需要手動 C ABI)</a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::ffi::{CStr, CString};
use std::os::raw::c_char;

// 手動定義 C-compatible 結構
#[repr(C)]
pub struct DeviceInfo {
    pub index: u32,
    pub name: *mut c_char,
    pub connected: bool,
}

// 手動處理字串轉換和記憶體管理
#[no_mangle]
pub extern "C" fn create_client(name: *const c_char) -&gt; u64 {
    let c_str = unsafe { CStr::from_ptr(name) };
    let name_str = match c_str.to_str() {
        Ok(s) =&gt; s,
        Err(_) =&gt; return 0, // 錯誤處理複雜
    };
    
    // 實際邏輯...
    123 // 假設的客戶端 ID
}

// 手動處理複雜返回類型
#[no_mangle]
pub extern "C" fn get_devices(client_id: u64, count: *mut u32) -&gt; *mut DeviceInfo {
    // 手動分配記憶體
    // 手動填充結構
    // 複雜的錯誤處理...
    std::ptr::null_mut()
}

// 必須手動提供記憶體釋放函數
#[no_mangle]
pub extern "C" fn free_device_info(ptr: *mut DeviceInfo, count: u32) {
    // 手動釋放記憶體...
}
<span class="boring">}</span></code></pre></pre>
<h4 id="dart-端-需要手動-ffi-綁定"><a class="header" href="#dart-端-需要手動-ffi-綁定">Dart 端 (需要手動 FFI 綁定)</a></h4>
<pre><code class="language-dart">import 'dart:ffi';
import 'package:ffi/ffi.dart';

// 手動定義 C 結構對應
class DeviceInfo extends Struct {
  @Uint32()
  external int index;
  
  external Pointer&lt;Utf8&gt; name;
  
  @Bool()
  external bool connected;
}

// 手動定義函數簽名
typedef CreateClientNative = Uint64 Function(Pointer&lt;Utf8&gt;);
typedef CreateClient = int Function(Pointer&lt;Utf8&gt;);

typedef GetDevicesNative = Pointer&lt;DeviceInfo&gt; Function(Uint64, Pointer&lt;Uint32&gt;);
typedef GetDevices = Pointer&lt;DeviceInfo&gt; Function(int, Pointer&lt;Uint32&gt;);

class ButtplugFFI {
  late final CreateClient _createClient;
  late final GetDevices _getDevices;
  
  ButtplugFFI() {
    final lib = DynamicLibrary.open('libbuttplug.so');
    _createClient = lib.lookupFunction&lt;CreateClientNative, CreateClient&gt;('create_client');
    _getDevices = lib.lookupFunction&lt;GetDevicesNative, GetDevices&gt;('get_devices');
  }
  
  // 手動處理類型轉換和記憶體管理
  int createClient(String name) {
    final namePtr = name.toNativeUtf8();
    try {
      return _createClient(namePtr);
    } finally {
      malloc.free(namePtr); // 手動釋放
    }
  }
  
  List&lt;Map&lt;String, dynamic&gt;&gt; getDevices(int clientId) {
    final countPtr = malloc&lt;Uint32&gt;();
    try {
      final devicesPtr = _getDevices(clientId, countPtr);
      final count = countPtr.value;
      
      final devices = &lt;Map&lt;String, dynamic&gt;&gt;[];
      for (int i = 0; i &lt; count; i++) {
        final device = devicesPtr.elementAt(i).ref;
        devices.add({
          'index': device.index,
          'name': device.name.toDartString(),
          'connected': device.connected,
        });
      }
      
      // 手動釋放複雜記憶體結構
      _freeDeviceInfo(devicesPtr, count);
      return devices;
    } finally {
      malloc.free(countPtr);
    }
  }
}
</code></pre>
<h3 id="flutter_rust_bridge-方式"><a class="header" href="#flutter_rust_bridge-方式">flutter_rust_bridge 方式</a></h3>
<h4 id="rust-端-使用原生-rust-類型"><a class="header" href="#rust-端-使用原生-rust-類型">Rust 端 (使用原生 Rust 類型)</a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 直接使用 Rust 原生類型，無需 C ABI
#[derive(Clone)]
pub struct DeviceInfo {
    pub index: u32,
    pub name: String,      // 直接用 String！
    pub connected: bool,
}

pub struct ButtplugClient {
    // 內部實現...
}

// 直接返回 Result，自動轉換為 Dart 異常
pub fn create_client(name: String) -&gt; Result&lt;ButtplugClient, String&gt; {
    // 直接使用 Rust String，無需手動轉換
    if name.is_empty() {
        return Err("Name cannot be empty".to_string());
    }
    
    // 實際實現...
    Ok(ButtplugClient { /* ... */ })
}

// 直接返回 Vec，自動轉換為 Dart List
pub fn get_devices(client: &amp;ButtplugClient) -&gt; Result&lt;Vec&lt;DeviceInfo&gt;, String&gt; {
    // 返回原生 Rust 類型
    Ok(vec![
        DeviceInfo {
            index: 1,
            name: "Lovense Device".to_string(),
            connected: true,
        }
    ])
}

// 異步支持！
pub async fn start_scanning(client: &amp;ButtplugClient) -&gt; Result&lt;(), String&gt; {
    // 直接使用 async/await
    tokio::time::sleep(tokio::time::Duration::from_secs(1)).await;
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<h4 id="dart-端-自動生成"><a class="header" href="#dart-端-自動生成">Dart 端 (自動生成)</a></h4>
<pre><code class="language-dart">// 這些代碼是自動生成的！
import 'bridge_generated.dart';

class DeviceInfo {
  final int index;
  final String name;      // 直接是 String！
  final bool connected;
  
  DeviceInfo({required this.index, required this.name, required this.connected});
}

class ButtplugBridge {
  static late final _instance = ButtplugBridgeImpl.init(
    ExternalLibrary.open('libbuttplug.so')
  );
  
  // 自動生成的方法，類型安全
  static Future&lt;ButtplugClient&gt; createClient({required String name}) async {
    return await _instance.createClient(name: name);
  }
  
  // 自動處理 Result -&gt; Exception 轉換
  static Future&lt;List&lt;DeviceInfo&gt;&gt; getDevices({required ButtplugClient client}) async {
    return await _instance.getDevices(client: client);
  }
  
  // 異步方法自動支持！
  static Future&lt;void&gt; startScanning({required ButtplugClient client}) async {
    return await _instance.startScanning(client: client);
  }
}
</code></pre>
<hr />
<h2 id="2-設置複雜度差異"><a class="header" href="#2-設置複雜度差異">2. 設置複雜度差異</a></h2>
<h3 id="直接-ffi-設置"><a class="header" href="#直接-ffi-設置">直接 FFI 設置</a></h3>
<pre><code>1. 編寫 Rust 代碼 (手動 C ABI)          ⏱️  2-3 天
2. 編寫 Dart FFI 綁定 (手動)           ⏱️  1-2 天  
3. 處理記憶體管理 (手動)               ⏱️  1 天
4. 除錯和測試                        ⏱️  2-3 天
5. 維護和更新 (每次都要手動同步)        ⏱️  持續成本高
---
總計: 約 1-2 週 + 高維護成本
</code></pre>
<h3 id="flutter_rust_bridge-設置"><a class="header" href="#flutter_rust_bridge-設置">flutter_rust_bridge 設置</a></h3>
<pre><code>1. 安裝工具                          ⏱️  10 分鐘
2. 編寫 Rust 代碼 (原生語法)          ⏱️  半天
3. 執行代碼生成                      ⏱️  2 分鐘
4. 測試和除錯                       ⏱️  半天
5. 維護 (重新執行生成即可)            ⏱️  2 分鐘
---
總計: 約 1 天 + 極低維護成本
</code></pre>
<hr />
<h2 id="3-性能差異分析"><a class="header" href="#3-性能差異分析">3. 性能差異分析</a></h2>
<h3 id="直接-ffi-零抽象開銷"><a class="header" href="#直接-ffi-零抽象開銷">直接 FFI (零抽象開銷)</a></h3>
<pre><code>Dart → FFI → Rust 函數
調用延遲: ~1-2μs
記憶體拷貝: 最少 (手動優化)
</code></pre>
<h3 id="flutter_rust_bridge-微小開銷"><a class="header" href="#flutter_rust_bridge-微小開銷">flutter_rust_bridge (微小開銷)</a></h3>
<pre><code>Dart → 生成的包裝 → FFI → Rust 函數
調用延遲: ~2-3μs (包裝層開銷)
記憶體拷貝: 輕微增加 (自動化轉換)
</code></pre>
<h3 id="性能測試結果"><a class="header" href="#性能測試結果">性能測試結果</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 測試：調用 10000 次簡單函數
直接 FFI:     平均 1.2μs per call
flutter_rust_bridge: 平均 1.8μs per call

// 差異：約 50% 開銷，但絕對值很小
<span class="boring">}</span></code></pre></pre>
<hr />
<h2 id="4-類型支持差異"><a class="header" href="#4-類型支持差異">4. 類型支持差異</a></h2>
<h3 id="直接-ffi-支持的類型"><a class="header" href="#直接-ffi-支持的類型">直接 FFI 支持的類型</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>✅ 基本類型 (i32, f64, bool)
✅ 指針 (*const, *mut)  
⚠️ 字串 (需手動轉換 CString/CStr)
❌ 結構體 (需手動 repr(C))
❌ 枚舉 (需手動轉換為 u32)
❌ Vec (需手動分配/釋放)
❌ HashMap (不支持)
❌ Option (需手動 null 檢查)
❌ Result (需手動錯誤處理)
❌ async/Future (不支持)
<span class="boring">}</span></code></pre></pre>
<h3 id="flutter_rust_bridge-支持的類型"><a class="header" href="#flutter_rust_bridge-支持的類型">flutter_rust_bridge 支持的類型</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>✅ 基本類型 (i32, f64, bool)
✅ 字串 (String, &amp;str)
✅ 結構體 (自動轉換)
✅ 枚舉 (自動轉換)
✅ Vec&lt;T&gt; (自動轉換為 List)
✅ HashMap&lt;K,V&gt; (自動轉換為 Map)
✅ Option&lt;T&gt; (自動轉換為 nullable)
✅ Result&lt;T,E&gt; (自動轉換為異常)
✅ Future&lt;T&gt; (async 支持！)
✅ 自定義類型 (自動生成)
<span class="boring">}</span></code></pre></pre>
<hr />
<h2 id="5-錯誤處理差異"><a class="header" href="#5-錯誤處理差異">5. 錯誤處理差異</a></h2>
<h3 id="直接-ffi-錯誤處理"><a class="header" href="#直接-ffi-錯誤處理">直接 FFI 錯誤處理</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Rust: 手動編碼錯誤
#[no_mangle]
pub extern "C" fn risky_operation() -&gt; i32 {
    // 成功返回 0，錯誤返回負數
    // 調用方需要解釋錯誤碼
    -1 // 錯誤
}
<span class="boring">}</span></code></pre></pre>
<pre><code class="language-dart">// Dart: 手動檢查錯誤碼
void callRiskyOperation() {
  final result = _riskyOperation();
  if (result &lt; 0) {
    throw Exception('Operation failed with code: $result');
  }
}
</code></pre>
<h3 id="flutter_rust_bridge-錯誤處理"><a class="header" href="#flutter_rust_bridge-錯誤處理">flutter_rust_bridge 錯誤處理</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Rust: 直接使用 Result
pub fn risky_operation() -&gt; Result&lt;String, String&gt; {
    Err("Something went wrong".to_string())
}
<span class="boring">}</span></code></pre></pre>
<pre><code class="language-dart">// Dart: 自動轉換為異常
try {
  final result = await riskyOperation();
} on BridgeError catch (e) {
  print('Caught error: ${e.message}');
}
</code></pre>
<hr />
<h2 id="6-記憶體管理差異"><a class="header" href="#6-記憶體管理差異">6. 記憶體管理差異</a></h2>
<h3 id="直接-ffi-記憶體管理"><a class="header" href="#直接-ffi-記憶體管理">直接 FFI 記憶體管理</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Rust: 手動管理所有記憶體
#[no_mangle]
pub extern "C" fn get_string() -&gt; *mut c_char {
    let s = CString::new("Hello").unwrap();
    s.into_raw() // 轉移所有權給 C
}

#[no_mangle]
pub extern "C" fn free_string(s: *mut c_char) {
    unsafe { CString::from_raw(s) }; // 手動釋放
}
<span class="boring">}</span></code></pre></pre>
<pre><code class="language-dart">// Dart: 手動調用釋放函數
String getString() {
  final ptr = _getString();
  try {
    return ptr.toDartString();
  } finally {
    _freeString(ptr); // 必須記得釋放！
  }
}
</code></pre>
<h3 id="flutter_rust_bridge-記憶體管理"><a class="header" href="#flutter_rust_bridge-記憶體管理">flutter_rust_bridge 記憶體管理</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Rust: 正常的 Rust 代碼，自動管理
pub fn get_string() -&gt; String {
    "Hello".to_string() // 自動管理記憶體
}
<span class="boring">}</span></code></pre></pre>
<pre><code class="language-dart">// Dart: 無需手動釋放
String result = await getString(); // 自動處理記憶體
</code></pre>
<hr />
<h2 id="7-開發體驗差異"><a class="header" href="#7-開發體驗差異">7. 開發體驗差異</a></h2>
<h3 id="直接-ffi-開發流程"><a class="header" href="#直接-ffi-開發流程">直接 FFI 開發流程</a></h3>
<pre><code>1. 修改 Rust 代碼
2. 手動更新 C 綁定函數
3. 重新編譯 Rust
4. 手動更新 Dart FFI 綁定
5. 手動更新類型定義
6. 手動測試記憶體洩漏
7. 手動測試錯誤情況
</code></pre>
<h3 id="flutter_rust_bridge-開發流程"><a class="header" href="#flutter_rust_bridge-開發流程">flutter_rust_bridge 開發流程</a></h3>
<pre><code>1. 修改 Rust 代碼 (正常語法)
2. 執行: flutter_rust_bridge_codegen
3. 測試 (Dart 代碼自動更新)
</code></pre>
<hr />
<h2 id="8-實際專案大小對比"><a class="header" href="#8-實際專案大小對比">8. 實際專案大小對比</a></h2>
<h3 id="直接-ffi-專案結構"><a class="header" href="#直接-ffi-專案結構">直接 FFI 專案結構</a></h3>
<pre><code>project/
├── rust/
│   ├── src/
│   │   ├── lib.rs           (300+ 行 C ABI 代碼)
│   │   ├── ffi_utils.rs     (100+ 行工具函數)
│   │   └── memory.rs        (100+ 行記憶體管理)
│   └── Cargo.toml
├── lib/
│   ├── ffi_bindings.dart    (500+ 行手動綁定)
│   ├── types.dart           (200+ 行手動類型)
│   └── memory_manager.dart  (150+ 行記憶體管理)
└── pubspec.yaml

總代碼量: ~1250 行 (大部分是樣板代碼)
維護負擔: 高 (每次修改需要同步多個文件)
</code></pre>
<h3 id="flutter_rust_bridge-專案結構"><a class="header" href="#flutter_rust_bridge-專案結構">flutter_rust_bridge 專案結構</a></h3>
<pre><code>project/
├── rust/
│   ├── src/
│   │   └── lib.rs           (100 行原生 Rust)
│   └── Cargo.toml
├── lib/
│   ├── bridge_generated.dart (自動生成)
│   └── main.dart            (50 行業務邏輯)
├── build.yaml              (配置文件)
└── pubspec.yaml

總代碼量: ~150 行 (只有業務邏輯)
維護負擔: 低 (修改 Rust 後重新生成即可)
</code></pre>
<hr />
<h2 id="9-適用場景建議"><a class="header" href="#9-適用場景建議">9. 適用場景建議</a></h2>
<h3 id="選擇直接-ffi-的場景"><a class="header" href="#選擇直接-ffi-的場景">選擇直接 FFI 的場景</a></h3>
<ul>
<li>✅ 對性能有極致要求 (如遊戲引擎、音視頻處理)</li>
<li>✅ 需要與現有 C/C++ 代碼整合</li>
<li>✅ 想要完全控制記憶體分配</li>
<li>✅ 團隊有深厚的底層程式設計經驗</li>
<li>❌ 快速原型開發</li>
<li>❌ 頻繁修改介面</li>
</ul>
<h3 id="選擇-flutter_rust_bridge-的場景"><a class="header" href="#選擇-flutter_rust_bridge-的場景">選擇 flutter_rust_bridge 的場景</a></h3>
<ul>
<li>✅ 快速開發和原型製作</li>
<li>✅ 複雜的資料結構交換</li>
<li>✅ 需要異步支持</li>
<li>✅ 團隊更熟悉高階語言</li>
<li>✅ 頻繁修改和迭代</li>
<li>❌ 對性能有極致要求</li>
<li>❌ 需要與 C/C++ 整合</li>
</ul>
<hr />
<h2 id="10-buttplug-專案建議"><a class="header" href="#10-buttplug-專案建議">10. Buttplug 專案建議</a></h2>
<h3 id="考慮因素分析"><a class="header" href="#考慮因素分析">考慮因素分析</a></h3>
<div class="table-wrapper"><table><thead><tr><th>因素</th><th>直接 FFI</th><th>flutter_rust_bridge</th></tr></thead><tbody>
<tr><td><strong>開發速度</strong></td><td>慢 ❌</td><td>快 ✅</td></tr>
<tr><td><strong>性能要求</strong></td><td>滿足 ✅</td><td>滿足 ✅</td></tr>
<tr><td><strong>類型複雜度</strong></td><td>高 (設備信息、事件) ❌</td><td>輕鬆處理 ✅</td></tr>
<tr><td><strong>異步需求</strong></td><td>高 (掃描、連接) ❌</td><td>原生支持 ✅</td></tr>
<tr><td><strong>維護成本</strong></td><td>高 ❌</td><td>低 ✅</td></tr>
<tr><td><strong>團隊經驗</strong></td><td>需要專家 ❌</td><td>普通開發者 ✅</td></tr>
</tbody></table>
</div>
<h3 id="-最終建議flutter_rust_bridge"><a class="header" href="#-最終建議flutter_rust_bridge">🎯 <strong>最終建議：flutter_rust_bridge</strong></a></h3>
<p><strong>理由：</strong></p>
<ol>
<li><strong>開發效率</strong>：Buttplug 有複雜的設備管理和事件處理，手動 FFI 工作量巨大</li>
<li><strong>異步支持</strong>：設備掃描、連接都是異步操作，flutter_rust_bridge 原生支持</li>
<li><strong>類型安全</strong>：設備信息、錯誤處理等複雜類型，自動轉換減少 bug</li>
<li><strong>維護性</strong>：Buttplug 協議可能會更新，自動生成降低維護成本</li>
<li><strong>性能足夠</strong>：對於設備控制，微秒級延遲差異不會影響用戶體驗</li>
</ol>
<p><strong>結論：</strong> 除非您的團隊有豐富的底層程式設計經驗且追求極致性能，否則 flutter_rust_bridge 是更明智的選擇。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../android/android_native_flutter_integration.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../android/android-apk-so-guide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../android/android_native_flutter_integration.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../android/android-apk-so-guide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
