(function(y,ue){typeof exports=="object"&&typeof module<"u"?ue(exports):typeof define=="function"&&define.amd?define(["exports"],ue):(y=typeof globalThis<"u"?globalThis:y||self,ue(y.buttplug={}))})(this,function(y){"use strict";var we;var ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function un(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Pt={exports:{}};(function(s){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function o(w,S,l){this.fn=w,this.context=S,this.once=l||!1}function u(w,S,l,M,h){if(typeof l!="function")throw new TypeError("The listener must be a function");var D=new o(l,M||w,h),L=t?t+S:S;return w._events[L]?w._events[L].fn?w._events[L]=[w._events[L],D]:w._events[L].push(D):(w._events[L]=D,w._eventsCount++),w}function c(w,S){--w._eventsCount===0?w._events=new n:delete w._events[S]}function d(){this._events=new n,this._eventsCount=0}d.prototype.eventNames=function(){var S=[],l,M;if(this._eventsCount===0)return S;for(M in l=this._events)e.call(l,M)&&S.push(t?M.slice(1):M);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(l)):S},d.prototype.listeners=function(S){var l=t?t+S:S,M=this._events[l];if(!M)return[];if(M.fn)return[M.fn];for(var h=0,D=M.length,L=new Array(D);h<D;h++)L[h]=M[h].fn;return L},d.prototype.listenerCount=function(S){var l=t?t+S:S,M=this._events[l];return M?M.fn?1:M.length:0},d.prototype.emit=function(S,l,M,h,D,L){var U=t?t+S:S;if(!this._events[U])return!1;var v=this._events[U],T=arguments.length,P,C;if(v.fn){switch(v.once&&this.removeListener(S,v.fn,void 0,!0),T){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,l),!0;case 3:return v.fn.call(v.context,l,M),!0;case 4:return v.fn.call(v.context,l,M,h),!0;case 5:return v.fn.call(v.context,l,M,h,D),!0;case 6:return v.fn.call(v.context,l,M,h,D,L),!0}for(C=1,P=new Array(T-1);C<T;C++)P[C-1]=arguments[C];v.fn.apply(v.context,P)}else{var Y=v.length,I;for(C=0;C<Y;C++)switch(v[C].once&&this.removeListener(S,v[C].fn,void 0,!0),T){case 1:v[C].fn.call(v[C].context);break;case 2:v[C].fn.call(v[C].context,l);break;case 3:v[C].fn.call(v[C].context,l,M);break;case 4:v[C].fn.call(v[C].context,l,M,h);break;default:if(!P)for(I=1,P=new Array(T-1);I<T;I++)P[I-1]=arguments[I];v[C].fn.apply(v[C].context,P)}}return!0},d.prototype.on=function(S,l,M){return u(this,S,l,M,!1)},d.prototype.once=function(S,l,M){return u(this,S,l,M,!0)},d.prototype.removeListener=function(S,l,M,h){var D=t?t+S:S;if(!this._events[D])return this;if(!l)return c(this,D),this;var L=this._events[D];if(L.fn)L.fn===l&&(!h||L.once)&&(!M||L.context===M)&&c(this,D);else{for(var U=0,v=[],T=L.length;U<T;U++)(L[U].fn!==l||h&&!L[U].once||M&&L[U].context!==M)&&v.push(L[U]);v.length?this._events[D]=v.length===1?v[0]:v:c(this,D)}return this},d.prototype.removeAllListeners=function(S){var l;return S?(l=t?t+S:S,this._events[l]&&c(this,l)):(this._events=new n,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=t,d.EventEmitter=d,s.exports=d})(Pt);var fn=Pt.exports;const Ue=un(fn);/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */var rt=(s=>(s[s.Off=0]="Off",s[s.Error=1]="Error",s[s.Warn=2]="Warn",s[s.Info=3]="Info",s[s.Debug=4]="Debug",s[s.Trace=5]="Trace",s))(rt||{});class Nt{constructor(e,t){const n=new Date,o=n.getHours(),u=n.getMinutes(),c=n.getSeconds();this.timestamp=`${o}:${u}:${c}`,this.logMessage=e,this.logLevel=t}get Message(){return this.logMessage}get LogLevel(){return this.logLevel}get Timestamp(){return this.timestamp}get FormattedMessage(){return`${rt[this.logLevel]} : ${this.timestamp} : ${this.logMessage}`}}const me=class me extends Ue{constructor(){super(),this.maximumConsoleLogLevel=0,this.maximumEventLogLevel=0}static get Logger(){return me.sLogger===void 0&&(me.sLogger=new me),this.sLogger}get MaximumConsoleLogLevel(){return this.maximumConsoleLogLevel}set MaximumConsoleLogLevel(e){this.maximumConsoleLogLevel=e}get MaximumEventLogLevel(){return this.maximumEventLogLevel}set MaximumEventLogLevel(e){this.maximumEventLogLevel=e}Error(e){this.AddLogMessage(e,1)}Warn(e){this.AddLogMessage(e,2)}Info(e){this.AddLogMessage(e,3)}Debug(e){this.AddLogMessage(e,4)}Trace(e){this.AddLogMessage(e,5)}AddLogMessage(e,t){if(t>this.maximumEventLogLevel&&t>this.maximumConsoleLogLevel)return;const n=new Nt(e,t);t<=this.maximumConsoleLogLevel&&console.log(n.FormattedMessage),t<=this.maximumEventLogLevel&&this.emit("log",n)}};me.sLogger=void 0;let ze=me;var E;(function(s){s[s.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",s[s.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",s[s.CLASS_TO_CLASS=2]="CLASS_TO_CLASS"})(E||(E={}));var dn=function(){function s(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return s.prototype.addTypeMetadata=function(e){this._typeMetadatas.has(e.target)||this._typeMetadatas.set(e.target,new Map),this._typeMetadatas.get(e.target).set(e.propertyName,e)},s.prototype.addTransformMetadata=function(e){this._transformMetadatas.has(e.target)||this._transformMetadatas.set(e.target,new Map),this._transformMetadatas.get(e.target).has(e.propertyName)||this._transformMetadatas.get(e.target).set(e.propertyName,[]),this._transformMetadatas.get(e.target).get(e.propertyName).push(e)},s.prototype.addExposeMetadata=function(e){this._exposeMetadatas.has(e.target)||this._exposeMetadatas.set(e.target,new Map),this._exposeMetadatas.get(e.target).set(e.propertyName,e)},s.prototype.addExcludeMetadata=function(e){this._excludeMetadatas.has(e.target)||this._excludeMetadatas.set(e.target,new Map),this._excludeMetadatas.get(e.target).set(e.propertyName,e)},s.prototype.findTransformMetadatas=function(e,t,n){return this.findMetadatas(this._transformMetadatas,e,t).filter(function(o){return!o.options||o.options.toClassOnly===!0&&o.options.toPlainOnly===!0?!0:o.options.toClassOnly===!0?n===E.CLASS_TO_CLASS||n===E.PLAIN_TO_CLASS:o.options.toPlainOnly===!0?n===E.CLASS_TO_PLAIN:!0})},s.prototype.findExcludeMetadata=function(e,t){return this.findMetadata(this._excludeMetadatas,e,t)},s.prototype.findExposeMetadata=function(e,t){return this.findMetadata(this._exposeMetadatas,e,t)},s.prototype.findExposeMetadataByCustomName=function(e,t){return this.getExposedMetadatas(e).find(function(n){return n.options&&n.options.name===t})},s.prototype.findTypeMetadata=function(e,t){return this.findMetadata(this._typeMetadatas,e,t)},s.prototype.getStrategy=function(e){var t=this._excludeMetadatas.get(e),n=t&&t.get(void 0),o=this._exposeMetadatas.get(e),u=o&&o.get(void 0);return n&&u||!n&&!u?"none":n?"excludeAll":"exposeAll"},s.prototype.getExposedMetadatas=function(e){return this.getMetadata(this._exposeMetadatas,e)},s.prototype.getExcludedMetadatas=function(e){return this.getMetadata(this._excludeMetadatas,e)},s.prototype.getExposedProperties=function(e,t){return this.getExposedMetadatas(e).filter(function(n){return!n.options||n.options.toClassOnly===!0&&n.options.toPlainOnly===!0?!0:n.options.toClassOnly===!0?t===E.CLASS_TO_CLASS||t===E.PLAIN_TO_CLASS:n.options.toPlainOnly===!0?t===E.CLASS_TO_PLAIN:!0}).map(function(n){return n.propertyName})},s.prototype.getExcludedProperties=function(e,t){return this.getExcludedMetadatas(e).filter(function(n){return!n.options||n.options.toClassOnly===!0&&n.options.toPlainOnly===!0?!0:n.options.toClassOnly===!0?t===E.CLASS_TO_CLASS||t===E.PLAIN_TO_CLASS:n.options.toPlainOnly===!0?t===E.CLASS_TO_PLAIN:!0}).map(function(n){return n.propertyName})},s.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},s.prototype.getMetadata=function(e,t){var n=e.get(t),o;n&&(o=Array.from(n.values()).filter(function(M){return M.propertyName!==void 0}));for(var u=[],c=0,d=this.getAncestors(t);c<d.length;c++){var w=d[c],S=e.get(w);if(S){var l=Array.from(S.values()).filter(function(M){return M.propertyName!==void 0});u.push.apply(u,l)}}return u.concat(o||[])},s.prototype.findMetadata=function(e,t,n){var o=e.get(t);if(o){var u=o.get(n);if(u)return u}for(var c=0,d=this.getAncestors(t);c<d.length;c++){var w=d[c],S=e.get(w);if(S){var l=S.get(n);if(l)return l}}},s.prototype.findMetadatas=function(e,t,n){var o=e.get(t),u;o&&(u=o.get(n));for(var c=[],d=0,w=this.getAncestors(t);d<w.length;d++){var S=w[d],l=e.get(S);l&&l.has(n)&&c.push.apply(c,l.get(n))}return c.slice().reverse().concat((u||[]).slice().reverse())},s.prototype.getAncestors=function(e){if(!e)return[];if(!this._ancestorsMap.has(e)){for(var t=[],n=Object.getPrototypeOf(e.prototype.constructor);typeof n.prototype<"u";n=Object.getPrototypeOf(n.prototype.constructor))t.push(n);this._ancestorsMap.set(e,t)}return this._ancestorsMap.get(e)},s}(),J=new dn;function hn(){if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;if(typeof window<"u")return window;if(typeof self<"u")return self}function ln(s){return s!==null&&typeof s=="object"&&typeof s.then=="function"}var kt=function(s,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,u;n<o;n++)(u||!(n in e))&&(u||(u=Array.prototype.slice.call(e,0,n)),u[n]=e[n]);return s.concat(u||Array.prototype.slice.call(e))};function pn(s){var e=new s;return!(e instanceof Set)&&!("push"in e)?[]:e}var fe=function(){function s(e,t){this.transformationType=e,this.options=t,this.recursionStack=new Set}return s.prototype.transform=function(e,t,n,o,u,c){var d=this;if(c===void 0&&(c=0),Array.isArray(t)||t instanceof Set){var w=o&&this.transformationType===E.PLAIN_TO_CLASS?pn(o):[];return t.forEach(function(v,T){var P=e?e[T]:void 0;if(!d.options.enableCircularCheck||!d.isCircular(v)){var C=void 0;if(typeof n!="function"&&n&&n.options&&n.options.discriminator&&n.options.discriminator.property&&n.options.discriminator.subTypes){if(d.transformationType===E.PLAIN_TO_CLASS){C=n.options.discriminator.subTypes.find(function(te){return te.name===v[n.options.discriminator.property]});var Y={newObject:w,object:v,property:void 0},I=n.typeFunction(Y);C===void 0?C=I:C=C.value,n.options.keepDiscriminatorProperty||delete v[n.options.discriminator.property]}d.transformationType===E.CLASS_TO_CLASS&&(C=v.constructor),d.transformationType===E.CLASS_TO_PLAIN&&(v[n.options.discriminator.property]=n.options.discriminator.subTypes.find(function(te){return te.value===v.constructor}).name)}else C=n;var z=d.transform(P,v,C,void 0,v instanceof Map,c+1);w instanceof Set?w.add(z):w.push(z)}else d.transformationType===E.CLASS_TO_CLASS&&(w instanceof Set?w.add(v):w.push(v))}),w}else{if(n===String&&!u)return t==null?t:String(t);if(n===Number&&!u)return t==null?t:Number(t);if(n===Boolean&&!u)return t==null?t:!!t;if((n===Date||t instanceof Date)&&!u)return t instanceof Date?new Date(t.valueOf()):t==null?t:new Date(t);if(hn().Buffer&&(n===Buffer||t instanceof Buffer)&&!u)return t==null?t:Buffer.from(t);if(ln(t)&&!u)return new Promise(function(v,T){t.then(function(P){return v(d.transform(void 0,P,n,void 0,void 0,c+1))},T)});if(!u&&t!==null&&typeof t=="object"&&typeof t.then=="function")return t;if(typeof t=="object"&&t!==null){!n&&t.constructor!==Object&&(!Array.isArray(t)&&t.constructor===Array||(n=t.constructor)),!n&&e&&(n=e.constructor),this.options.enableCircularCheck&&this.recursionStack.add(t);var S=this.getKeys(n,t,u),l=e||{};!e&&(this.transformationType===E.PLAIN_TO_CLASS||this.transformationType===E.CLASS_TO_CLASS)&&(u?l=new Map:n?l=new n:l={});for(var M=function(v){if(v==="__proto__"||v==="constructor")return"continue";var T=v,P=v,C=v;if(!h.options.ignoreDecorators&&n){if(h.transformationType===E.PLAIN_TO_CLASS){var Y=J.findExposeMetadataByCustomName(n,v);Y&&(C=Y.propertyName,P=Y.propertyName)}else if(h.transformationType===E.CLASS_TO_PLAIN||h.transformationType===E.CLASS_TO_CLASS){var Y=J.findExposeMetadata(n,v);Y&&Y.options&&Y.options.name&&(P=Y.options.name)}}var I=void 0;h.transformationType===E.PLAIN_TO_CLASS?I=t[T]:t instanceof Map?I=t.get(T):t[T]instanceof Function?I=t[T]():I=t[T];var z=void 0,te=I instanceof Map;if(n&&u)z=n;else if(n){var $=J.findTypeMetadata(n,C);if($){var Lt={newObject:l,object:t,property:C},Ke=$.typeFunction?$.typeFunction(Lt):$.reflectedType;$.options&&$.options.discriminator&&$.options.discriminator.property&&$.options.discriminator.subTypes?t[T]instanceof Array?z=$:(h.transformationType===E.PLAIN_TO_CLASS&&(z=$.options.discriminator.subTypes.find(function(V){if(I&&I instanceof Object&&$.options.discriminator.property in I)return V.name===I[$.options.discriminator.property]}),z===void 0?z=Ke:z=z.value,$.options.keepDiscriminatorProperty||I&&I instanceof Object&&$.options.discriminator.property in I&&delete I[$.options.discriminator.property]),h.transformationType===E.CLASS_TO_CLASS&&(z=I.constructor),h.transformationType===E.CLASS_TO_PLAIN&&I&&(I[$.options.discriminator.property]=$.options.discriminator.subTypes.find(function(V){return V.value===I.constructor}).name)):z=Ke,te=te||$.reflectedType===Map}else if(h.options.targetMaps)h.options.targetMaps.filter(function(V){return V.target===n&&!!V.properties[C]}).forEach(function(V){return z=V.properties[C]});else if(h.options.enableImplicitConversion&&h.transformationType===E.PLAIN_TO_CLASS){var Ve=Reflect.getMetadata("design:type",n.prototype,C);Ve&&(z=Ve)}}var et=Array.isArray(t[T])?h.getReflectedType(n,C):void 0,tt=e?e[T]:void 0;if(l.constructor.prototype){var Ge=Object.getOwnPropertyDescriptor(l.constructor.prototype,P);if((h.transformationType===E.PLAIN_TO_CLASS||h.transformationType===E.CLASS_TO_CLASS)&&(Ge&&!Ge.set||l[P]instanceof Function))return"continue"}if(!h.options.enableCircularCheck||!h.isCircular(I)){var oe=h.transformationType===E.PLAIN_TO_CLASS?P:v,N=void 0;h.transformationType===E.CLASS_TO_PLAIN?(N=t[oe],N=h.applyCustomTransformations(N,n,oe,t,h.transformationType),N=t[oe]===N?I:N,N=h.transform(tt,N,z,et,te,c+1)):I===void 0&&h.options.exposeDefaultValues?N=l[P]:(N=h.transform(tt,I,z,et,te,c+1),N=h.applyCustomTransformations(N,n,oe,t,h.transformationType)),(N!==void 0||h.options.exposeUnsetFields)&&(l instanceof Map?l.set(P,N):l[P]=N)}else if(h.transformationType===E.CLASS_TO_CLASS){var N=I;N=h.applyCustomTransformations(N,n,v,t,h.transformationType),(N!==void 0||h.options.exposeUnsetFields)&&(l instanceof Map?l.set(P,N):l[P]=N)}},h=this,D=0,L=S;D<L.length;D++){var U=L[D];M(U)}return this.options.enableCircularCheck&&this.recursionStack.delete(t),l}else return t}},s.prototype.applyCustomTransformations=function(e,t,n,o,u){var c=this,d=J.findTransformMetadatas(t,n,this.transformationType);return this.options.version!==void 0&&(d=d.filter(function(w){return w.options?c.checkVersion(w.options.since,w.options.until):!0})),this.options.groups&&this.options.groups.length?d=d.filter(function(w){return w.options?c.checkGroups(w.options.groups):!0}):d=d.filter(function(w){return!w.options||!w.options.groups||!w.options.groups.length}),d.forEach(function(w){e=w.transformFn({value:e,key:n,obj:o,type:u,options:c.options})}),e},s.prototype.isCircular=function(e){return this.recursionStack.has(e)},s.prototype.getReflectedType=function(e,t){if(e){var n=J.findTypeMetadata(e,t);return n?n.reflectedType:void 0}},s.prototype.getKeys=function(e,t,n){var o=this,u=J.getStrategy(e);u==="none"&&(u=this.options.strategy||"exposeAll");var c=[];if((u==="exposeAll"||n)&&(t instanceof Map?c=Array.from(t.keys()):c=Object.keys(t)),n)return c;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&e){var d=J.getExposedProperties(e,this.transformationType),w=J.getExcludedProperties(e,this.transformationType);c=kt(kt([],d,!0),w,!0)}if(!this.options.ignoreDecorators&&e){var d=J.getExposedProperties(e,this.transformationType);this.transformationType===E.PLAIN_TO_CLASS&&(d=d.map(function(M){var h=J.findExposeMetadata(e,M);return h&&h.options&&h.options.name?h.options.name:M})),this.options.excludeExtraneousValues?c=d:c=c.concat(d);var S=J.getExcludedProperties(e,this.transformationType);S.length>0&&(c=c.filter(function(M){return!S.includes(M)})),this.options.version!==void 0&&(c=c.filter(function(M){var h=J.findExposeMetadata(e,M);return!h||!h.options?!0:o.checkVersion(h.options.since,h.options.until)})),this.options.groups&&this.options.groups.length?c=c.filter(function(M){var h=J.findExposeMetadata(e,M);return!h||!h.options?!0:o.checkGroups(h.options.groups)}):c=c.filter(function(M){var h=J.findExposeMetadata(e,M);return!h||!h.options||!h.options.groups||!h.options.groups.length})}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(c=c.filter(function(l){return o.options.excludePrefixes.every(function(M){return l.substr(0,M.length)!==M})})),c=c.filter(function(l,M,h){return h.indexOf(l)===M}),c},s.prototype.checkVersion=function(e,t){var n=!0;return n&&e&&(n=this.options.version>=e),n&&t&&(n=this.options.version<t),n},s.prototype.checkGroups=function(e){return e?this.options.groups.some(function(t){return e.includes(t)}):!0},s}(),de={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},X=function(){return X=Object.assign||function(s){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(s[o]=e[o])}return s},X.apply(this,arguments)},gn=function(){function s(){}return s.prototype.instanceToPlain=function(e,t){var n=new fe(E.CLASS_TO_PLAIN,X(X({},de),t));return n.transform(void 0,e,void 0,void 0,void 0,void 0)},s.prototype.classToPlainFromExist=function(e,t,n){var o=new fe(E.CLASS_TO_PLAIN,X(X({},de),n));return o.transform(t,e,void 0,void 0,void 0,void 0)},s.prototype.plainToInstance=function(e,t,n){var o=new fe(E.PLAIN_TO_CLASS,X(X({},de),n));return o.transform(void 0,t,e,void 0,void 0,void 0)},s.prototype.plainToClassFromExist=function(e,t,n){var o=new fe(E.PLAIN_TO_CLASS,X(X({},de),n));return o.transform(e,t,void 0,void 0,void 0,void 0)},s.prototype.instanceToInstance=function(e,t){var n=new fe(E.CLASS_TO_CLASS,X(X({},de),t));return n.transform(void 0,e,void 0,void 0,void 0,void 0)},s.prototype.classToClassFromExist=function(e,t,n){var o=new fe(E.CLASS_TO_CLASS,X(X({},de),n));return o.transform(t,e,void 0,void 0,void 0,void 0)},s.prototype.serialize=function(e,t){return JSON.stringify(this.instanceToPlain(e,t))},s.prototype.deserialize=function(e,t,n){var o=JSON.parse(t);return this.plainToInstance(e,o,n)},s.prototype.deserializeArray=function(e,t,n){var o=JSON.parse(t);return this.plainToInstance(e,o,n)},s}();function st(s,e){return e===void 0&&(e={}),function(t,n){var o=Reflect.getMetadata("design:type",t,n);J.addTypeMetadata({target:t.constructor,propertyName:n,reflectedType:o,typeFunction:s,options:e})}}var Bt=new gn;function yn(s,e){return Bt.instanceToPlain(s,e)}function vn(s,e,t){return Bt.plainToInstance(s,e,t)}/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */var jt;(function(s){(function(e){var t=typeof globalThis=="object"?globalThis:typeof ue=="object"?ue:typeof self=="object"?self:typeof this=="object"?this:d(),n=o(s);typeof t.Reflect<"u"&&(n=o(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=s);function o(w,S){return function(l,M){Object.defineProperty(w,l,{configurable:!0,writable:!0,value:M}),S&&S(l,M)}}function u(){try{return Function("return this;")()}catch{}}function c(){try{return(0,eval)("(function() { return this; })()")}catch{}}function d(){return u()||c()}})(function(e,t){var n=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",u=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",c=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",d=typeof Object.create=="function",w={__proto__:[]}instanceof Array,S=!d&&!w,l={create:d?function(){return Tt(Object.create(null))}:w?function(){return Tt({__proto__:null})}:function(){return Tt({})},has:S?function(r,i){return n.call(r,i)}:function(r,i){return i in r},get:S?function(r,i){return n.call(r,i)?r[i]:void 0}:function(r,i){return r[i]}},M=Object.getPrototypeOf(Function),h=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Tn(),D=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pn(),L=typeof WeakMap=="function"?WeakMap:Nn(),U=o?Symbol.for("@reflect-metadata:registry"):void 0,v=Ln(),T=Rn(v);function P(r,i,a,f){if(O(a)){if(!en(r))throw new TypeError;if(!tn(i))throw new TypeError;return et(r,i)}else{if(!en(r))throw new TypeError;if(!G(i))throw new TypeError;if(!G(f)&&!O(f)&&!Me(f))throw new TypeError;return Me(f)&&(f=void 0),a=ne(a),tt(r,i,a,f)}}e("decorate",P);function C(r,i){function a(f,b){if(!G(f))throw new TypeError;if(!O(b)&&!xn(b))throw new TypeError;Yt(r,i,f,b)}return a}e("metadata",C);function Y(r,i,a,f){if(!G(a))throw new TypeError;return O(f)||(f=ne(f)),Yt(r,i,a,f)}e("defineMetadata",Y);function I(r,i,a){if(!G(i))throw new TypeError;return O(a)||(a=ne(a)),Ge(r,i,a)}e("hasMetadata",I);function z(r,i,a){if(!G(i))throw new TypeError;return O(a)||(a=ne(a)),oe(r,i,a)}e("hasOwnMetadata",z);function te(r,i,a){if(!G(i))throw new TypeError;return O(a)||(a=ne(a)),N(r,i,a)}e("getMetadata",te);function $(r,i,a){if(!G(i))throw new TypeError;return O(a)||(a=ne(a)),V(r,i,a)}e("getOwnMetadata",$);function Lt(r,i){if(!G(r))throw new TypeError;return O(i)||(i=ne(i)),Zt(r,i)}e("getMetadataKeys",Lt);function Ke(r,i){if(!G(r))throw new TypeError;return O(i)||(i=ne(i)),Qt(r,i)}e("getOwnMetadataKeys",Ke);function Ve(r,i,a){if(!G(i))throw new TypeError;if(O(a)||(a=ne(a)),!G(i))throw new TypeError;O(a)||(a=ne(a));var f=We(i,a,!1);return O(f)?!1:f.OrdinaryDeleteMetadata(r,i,a)}e("deleteMetadata",Ve);function et(r,i){for(var a=r.length-1;a>=0;--a){var f=r[a],b=f(i);if(!O(b)&&!Me(b)){if(!tn(b))throw new TypeError;i=b}}return i}function tt(r,i,a,f){for(var b=r.length-1;b>=0;--b){var B=r[b],W=B(i,a,f);if(!O(W)&&!Me(W)){if(!G(W))throw new TypeError;f=W}}return f}function Ge(r,i,a){var f=oe(r,i,a);if(f)return!0;var b=Dt(i);return Me(b)?!1:Ge(r,b,a)}function oe(r,i,a){var f=We(i,a,!1);return O(f)?!1:Vt(f.OrdinaryHasOwnMetadata(r,i,a))}function N(r,i,a){var f=oe(r,i,a);if(f)return V(r,i,a);var b=Dt(i);if(!Me(b))return N(r,b,a)}function V(r,i,a){var f=We(i,a,!1);if(!O(f))return f.OrdinaryGetOwnMetadata(r,i,a)}function Yt(r,i,a,f){var b=We(a,f,!0);b.OrdinaryDefineOwnMetadata(r,i,a,f)}function Zt(r,i){var a=Qt(r,i),f=Dt(r);if(f===null)return a;var b=Zt(f,i);if(b.length<=0)return a;if(a.length<=0)return b;for(var B=new D,W=[],A=0,p=a;A<p.length;A++){var g=p[A],m=B.has(g);m||(B.add(g),W.push(g))}for(var _=0,x=b;_<x.length;_++){var g=x[_],m=B.has(g);m||(B.add(g),W.push(g))}return W}function Qt(r,i){var a=We(r,i,!1);return a?a.OrdinaryOwnMetadataKeys(r,i):[]}function Kt(r){if(r===null)return 1;switch(typeof r){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return r===null?1:6;default:return 6}}function O(r){return r===void 0}function Me(r){return r===null}function On(r){return typeof r=="symbol"}function G(r){return typeof r=="object"?r!==null:typeof r=="function"}function Cn(r,i){switch(Kt(r)){case 0:return r;case 1:return r;case 2:return r;case 3:return r;case 4:return r;case 5:return r}var a="string",f=nn(r,u);if(f!==void 0){var b=f.call(r,a);if(G(b))throw new TypeError;return b}return En(r)}function En(r,i){var a,f,b;{var B=r.toString;if(nt(B)){var f=B.call(r);if(!G(f))return f}var a=r.valueOf;if(nt(a)){var f=a.call(r);if(!G(f))return f}}throw new TypeError}function Vt(r){return!!r}function An(r){return""+r}function ne(r){var i=Cn(r);return On(i)?i:An(i)}function en(r){return Array.isArray?Array.isArray(r):r instanceof Object?r instanceof Array:Object.prototype.toString.call(r)==="[object Array]"}function nt(r){return typeof r=="function"}function tn(r){return typeof r=="function"}function xn(r){switch(Kt(r)){case 3:return!0;case 4:return!0;default:return!1}}function Rt(r,i){return r===i||r!==r&&i!==i}function nn(r,i){var a=r[i];if(a!=null){if(!nt(a))throw new TypeError;return a}}function rn(r){var i=nn(r,c);if(!nt(i))throw new TypeError;var a=i.call(r);if(!G(a))throw new TypeError;return a}function sn(r){return r.value}function on(r){var i=r.next();return i.done?!1:i}function an(r){var i=r.return;i&&i.call(r)}function Dt(r){var i=Object.getPrototypeOf(r);if(typeof r!="function"||r===M||i!==M)return i;var a=r.prototype,f=a&&Object.getPrototypeOf(a);if(f==null||f===Object.prototype)return i;var b=f.constructor;return typeof b!="function"||b===r?i:b}function In(){var r;!O(U)&&typeof t.Reflect<"u"&&!(U in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(r=Dn(t.Reflect));var i,a,f,b=new L,B={registerProvider:W,getProvider:p,setProvider:m};return B;function W(_){if(!Object.isExtensible(B))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case r===_:break;case O(i):i=_;break;case i===_:break;case O(a):a=_;break;case a===_:break;default:f===void 0&&(f=new D),f.add(_);break}}function A(_,x){if(!O(i)){if(i.isProviderFor(_,x))return i;if(!O(a)){if(a.isProviderFor(_,x))return i;if(!O(f))for(var R=rn(f);;){var j=on(R);if(!j)return;var ee=sn(j);if(ee.isProviderFor(_,x))return an(R),ee}}}if(!O(r)&&r.isProviderFor(_,x))return r}function p(_,x){var R=b.get(_),j;return O(R)||(j=R.get(x)),O(j)&&(j=A(_,x),O(j)||(O(R)&&(R=new h,b.set(_,R)),R.set(x,j))),j}function g(_){if(O(_))throw new TypeError;return i===_||a===_||!O(f)&&f.has(_)}function m(_,x,R){if(!g(R))throw new Error("Metadata provider not registered.");var j=p(_,x);if(j!==R){if(!O(j))return!1;var ee=b.get(_);O(ee)&&(ee=new h,b.set(_,ee)),ee.set(x,R)}return!0}}function Ln(){var r;return!O(U)&&G(t.Reflect)&&Object.isExtensible(t.Reflect)&&(r=t.Reflect[U]),O(r)&&(r=In()),!O(U)&&G(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,U,{enumerable:!1,configurable:!1,writable:!1,value:r}),r}function Rn(r){var i=new L,a={isProviderFor:function(g,m){var _=i.get(g);return O(_)?!1:_.has(m)},OrdinaryDefineOwnMetadata:W,OrdinaryHasOwnMetadata:b,OrdinaryGetOwnMetadata:B,OrdinaryOwnMetadataKeys:A,OrdinaryDeleteMetadata:p};return v.registerProvider(a),a;function f(g,m,_){var x=i.get(g),R=!1;if(O(x)){if(!_)return;x=new h,i.set(g,x),R=!0}var j=x.get(m);if(O(j)){if(!_)return;if(j=new h,x.set(m,j),!r.setProvider(g,m,a))throw x.delete(m),R&&i.delete(g),new Error("Wrong provider for target.")}return j}function b(g,m,_){var x=f(m,_,!1);return O(x)?!1:Vt(x.has(g))}function B(g,m,_){var x=f(m,_,!1);if(!O(x))return x.get(g)}function W(g,m,_,x){var R=f(_,x,!0);R.set(g,m)}function A(g,m){var _=[],x=f(g,m,!1);if(O(x))return _;for(var R=x.keys(),j=rn(R),ee=0;;){var cn=on(j);if(!cn)return _.length=ee,_;var kn=sn(cn);try{_[ee]=kn}catch(Bn){try{an(j)}finally{throw Bn}}ee++}}function p(g,m,_){var x=f(m,_,!1);if(O(x)||!x.delete(g))return!1;if(x.size===0){var R=i.get(m);O(R)||(R.delete(_),R.size===0&&i.delete(R))}return!0}}function Dn(r){var i=r.defineMetadata,a=r.hasOwnMetadata,f=r.getOwnMetadata,b=r.getOwnMetadataKeys,B=r.deleteMetadata,W=new L,A={isProviderFor:function(p,g){var m=W.get(p);return!O(m)&&m.has(g)?!0:b(p,g).length?(O(m)&&(m=new D,W.set(p,m)),m.add(g),!0):!1},OrdinaryDefineOwnMetadata:i,OrdinaryHasOwnMetadata:a,OrdinaryGetOwnMetadata:f,OrdinaryOwnMetadataKeys:b,OrdinaryDeleteMetadata:B};return A}function We(r,i,a){var f=v.getProvider(r,i);if(!O(f))return f;if(a){if(v.setProvider(r,i,T))return T;throw new Error("Illegal state.")}}function Tn(){var r={},i=[],a=function(){function A(p,g,m){this._index=0,this._keys=p,this._values=g,this._selector=m}return A.prototype["@@iterator"]=function(){return this},A.prototype[c]=function(){return this},A.prototype.next=function(){var p=this._index;if(p>=0&&p<this._keys.length){var g=this._selector(this._keys[p],this._values[p]);return p+1>=this._keys.length?(this._index=-1,this._keys=i,this._values=i):this._index++,{value:g,done:!1}}return{value:void 0,done:!0}},A.prototype.throw=function(p){throw this._index>=0&&(this._index=-1,this._keys=i,this._values=i),p},A.prototype.return=function(p){return this._index>=0&&(this._index=-1,this._keys=i,this._values=i),{value:p,done:!0}},A}(),f=function(){function A(){this._keys=[],this._values=[],this._cacheKey=r,this._cacheIndex=-2}return Object.defineProperty(A.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),A.prototype.has=function(p){return this._find(p,!1)>=0},A.prototype.get=function(p){var g=this._find(p,!1);return g>=0?this._values[g]:void 0},A.prototype.set=function(p,g){var m=this._find(p,!0);return this._values[m]=g,this},A.prototype.delete=function(p){var g=this._find(p,!1);if(g>=0){for(var m=this._keys.length,_=g+1;_<m;_++)this._keys[_-1]=this._keys[_],this._values[_-1]=this._values[_];return this._keys.length--,this._values.length--,Rt(p,this._cacheKey)&&(this._cacheKey=r,this._cacheIndex=-2),!0}return!1},A.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=r,this._cacheIndex=-2},A.prototype.keys=function(){return new a(this._keys,this._values,b)},A.prototype.values=function(){return new a(this._keys,this._values,B)},A.prototype.entries=function(){return new a(this._keys,this._values,W)},A.prototype["@@iterator"]=function(){return this.entries()},A.prototype[c]=function(){return this.entries()},A.prototype._find=function(p,g){if(!Rt(this._cacheKey,p)){this._cacheIndex=-1;for(var m=0;m<this._keys.length;m++)if(Rt(this._keys[m],p)){this._cacheIndex=m;break}}return this._cacheIndex<0&&g&&(this._cacheIndex=this._keys.length,this._keys.push(p),this._values.push(void 0)),this._cacheIndex},A}();return f;function b(A,p){return A}function B(A,p){return p}function W(A,p){return[A,p]}}function Pn(){var r=function(){function i(){this._map=new h}return Object.defineProperty(i.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),i.prototype.has=function(a){return this._map.has(a)},i.prototype.add=function(a){return this._map.set(a,a),this},i.prototype.delete=function(a){return this._map.delete(a)},i.prototype.clear=function(){this._map.clear()},i.prototype.keys=function(){return this._map.keys()},i.prototype.values=function(){return this._map.keys()},i.prototype.entries=function(){return this._map.entries()},i.prototype["@@iterator"]=function(){return this.keys()},i.prototype[c]=function(){return this.keys()},i}();return r}function Nn(){var r=16,i=l.create(),a=f();return function(){function p(){this._key=f()}return p.prototype.has=function(g){var m=b(g,!1);return m!==void 0?l.has(m,this._key):!1},p.prototype.get=function(g){var m=b(g,!1);return m!==void 0?l.get(m,this._key):void 0},p.prototype.set=function(g,m){var _=b(g,!0);return _[this._key]=m,this},p.prototype.delete=function(g){var m=b(g,!1);return m!==void 0?delete m[this._key]:!1},p.prototype.clear=function(){this._key=f()},p}();function f(){var p;do p="@@WeakMap@@"+A();while(l.has(i,p));return i[p]=!0,p}function b(p,g){if(!n.call(p,a)){if(!g)return;Object.defineProperty(p,a,{value:l.create()})}return p[a]}function B(p,g){for(var m=0;m<g;++m)p[m]=Math.random()*255|0;return p}function W(p){if(typeof Uint8Array=="function"){var g=new Uint8Array(p);return typeof crypto<"u"?crypto.getRandomValues(g):typeof msCrypto<"u"?msCrypto.getRandomValues(g):B(g,p),g}return B(new Array(p),p)}function A(){var p=W(r);p[6]=p[6]&79|64,p[8]=p[8]&191|128;for(var g="",m=0;m<r;++m){var _=p[m];(m===4||m===6||m===8)&&(g+="-"),_<16&&(g+="0"),g+=_.toString(16).toLowerCase()}return g}}function Tt(r){return r.__=void 0,delete r.__,r}})})(jt||(jt={}));var mn=Object.defineProperty,it=(s,e,t,n)=>{for(var o=void 0,u=s.length-1,c;u>=0;u--)(c=s[u])&&(o=c(e,t,o)||o);return o&&mn(e,t,o),o};const K=0,k=1,Ft=4294967295,_e=3;class He{constructor(e){Object.assign(this,e)}update(){var e,t,n,o,u;(e=this.ScalarCmd)==null||e.forEach((c,d)=>c.Index=d),(t=this.RotateCmd)==null||t.forEach((c,d)=>c.Index=d),(n=this.LinearCmd)==null||n.forEach((c,d)=>c.Index=d),(o=this.SensorReadCmd)==null||o.forEach((c,d)=>c.Index=d),(u=this.SensorSubscribeCmd)==null||u.forEach((c,d)=>c.Index=d)}}var ae=(s=>(s.Unknown="Unknown",s.Vibrate="Vibrate",s.Rotate="Rotate",s.Oscillate="Oscillate",s.Constrict="Constrict",s.Inflate="Inflate",s.Position="Position",s))(ae||{}),re=(s=>(s.Unknown="Unknown",s.Battery="Battery",s.RSSI="RSSI",s.Button="Button",s.Pressure="Pressure",s))(re||{});class $t{constructor(e){this.Index=0,Object.assign(this,e)}}class Gt{constructor(e){this.Endpoints=e}}class Wt{constructor(e){this.Index=0,Object.assign(this,e)}}class Q{constructor(e){this.Id=e}get Type(){return this.constructor}toJSON(){return JSON.stringify(this.toProtocolFormat())}toProtocolFormat(){const e={};return e[this.constructor.Name]=yn(this),e}update(){}}class Z extends Q{constructor(e,t){super(t),this.DeviceIndex=e,this.Id=t}}class ce extends Q{constructor(e=K){super(e),this.Id=e}}const ut=class ut extends ce{constructor(e=k){super(e),this.Id=e}};ut.Name="Ok";let he=ut;const ft=class ft extends Q{constructor(e=k){super(e),this.Id=e}};ft.Name="Ping";let Je=ft;var q=(s=>(s[s.ERROR_UNKNOWN=0]="ERROR_UNKNOWN",s[s.ERROR_INIT=1]="ERROR_INIT",s[s.ERROR_PING=2]="ERROR_PING",s[s.ERROR_MSG=3]="ERROR_MSG",s[s.ERROR_DEVICE=4]="ERROR_DEVICE",s))(q||{});let se=(we=class extends Q{constructor(e,t=0,n=k){super(n),this.ErrorMessage=e,this.ErrorCode=t,this.Id=n}get Schemversion(){return 0}},we.Name="Error",we);class qe{constructor(e){Object.assign(this,e)}}it([st(()=>He)],qe.prototype,"DeviceMessages");const dt=class dt extends Q{constructor(e,t=k){super(t),this.Devices=e,this.Id=t}update(){for(const e of this.Devices)e.DeviceMessages.update()}};dt.Name="DeviceList";let Se=dt;it([st(()=>qe)],Se.prototype,"Devices");const ht=class ht extends ce{constructor(e){super(),Object.assign(this,e)}update(){this.DeviceMessages.update()}};ht.Name="DeviceAdded";let le=ht;it([st(()=>He)],le.prototype,"DeviceMessages");const lt=class lt extends ce{constructor(e){super(),this.DeviceIndex=e}};lt.Name="DeviceRemoved";let be=lt;const pt=class pt extends Q{constructor(e=k){super(e),this.Id=e}};pt.Name="RequestDeviceList";let Oe=pt;const gt=class gt extends Q{constructor(e=k){super(e),this.Id=e}};gt.Name="StartScanning";let Ce=gt;const yt=class yt extends Q{constructor(e=k){super(e),this.Id=e}};yt.Name="StopScanning";let Ee=yt;const vt=class vt extends ce{constructor(){super()}};vt.Name="ScanningFinished";let Ae=vt;const mt=class mt extends Q{constructor(e,t=0,n=k){super(n),this.ClientName=e,this.MessageVersion=t,this.Id=n}};mt.Name="RequestServerInfo";let xe=mt;const wt=class wt extends ce{constructor(e,t,n,o=k){super(),this.MessageVersion=e,this.MaxPingTime=t,this.ServerName=n,this.Id=o}};wt.Name="ServerInfo";let Ie=wt;const Mt=class Mt extends Z{constructor(e=-1,t=k){super(e,t),this.DeviceIndex=e,this.Id=t}};Mt.Name="StopDeviceCmd";let Le=Mt;const _t=class _t extends Q{constructor(e=k){super(e),this.Id=e}};_t.Name="StopAllDevices";let Re=_t;class De{constructor(e){this.Index=e}}class Xe extends De{constructor(e,t,n){super(e),this.Scalar=t,this.ActuatorType=n}}const St=class St extends Z{constructor(e,t=-1,n=k){super(t,n),this.Scalars=e,this.DeviceIndex=t,this.Id=n}};St.Name="ScalarCmd";let pe=St;class ot extends De{constructor(e,t,n){super(e),this.Speed=t,this.Clockwise=n}}const Ze=class Ze extends Z{constructor(e,t=-1,n=k){super(t,n),this.Rotations=e,this.DeviceIndex=t,this.Id=n}static Create(e,t){const n=new Array;let o=0;for(const[u,c]of t)n.push(new ot(o,u,c)),++o;return new Ze(n,e)}};Ze.Name="RotateCmd";let ge=Ze;class at extends De{constructor(e,t,n){super(e),this.Position=t,this.Duration=n}}const Qe=class Qe extends Z{constructor(e,t=-1,n=k){super(t,n),this.Vectors=e,this.DeviceIndex=t,this.Id=n}static Create(e,t){const n=new Array;let o=0;for(const u of t)n.push(new at(o,u[0],u[1])),++o;return new Qe(n,e)}};Qe.Name="LinearCmd";let ye=Qe;const bt=class bt extends Z{constructor(e,t,n,o=k){super(e,o),this.DeviceIndex=e,this.SensorIndex=t,this.SensorType=n,this.Id=o}};bt.Name="SensorReadCmd";let Te=bt;const Ot=class Ot extends Z{constructor(e,t,n,o,u=k){super(e,u),this.DeviceIndex=e,this.SensorIndex=t,this.SensorType=n,this.Data=o,this.Id=u}};Ot.Name="SensorReading";let Pe=Ot;const Ct=class Ct extends Z{constructor(e,t,n,o,u=k){super(e,u),this.DeviceIndex=e,this.Endpoint=t,this.ExpectedLength=n,this.Timeout=o,this.Id=u}};Ct.Name="RawReadCmd";let Ne=Ct;const Et=class Et extends Z{constructor(e,t,n,o,u=k){super(e,u),this.DeviceIndex=e,this.Endpoint=t,this.Data=n,this.WriteWithResponse=o,this.Id=u}};Et.Name="RawWriteCmd";let ke=Et;const At=class At extends Z{constructor(e,t,n=k){super(e,n),this.DeviceIndex=e,this.Endpoint=t,this.Id=n}};At.Name="RawSubscribeCmd";let Be=At;const xt=class xt extends Z{constructor(e,t,n=k){super(e,n),this.DeviceIndex=e,this.Endpoint=t,this.Id=n}};xt.Name="RawUnsubscribeCmd";let je=xt;const It=class It extends Z{constructor(e,t,n,o=k){super(e,o),this.DeviceIndex=e,this.Endpoint=t,this.Data=n,this.Id=o}};It.Name="RawReading";let Fe=It;const wn=Object.freeze(Object.defineProperty({__proto__:null,ActuatorType:ae,ButtplugDeviceMessage:Z,ButtplugMessage:Q,ButtplugSystemMessage:ce,DEFAULT_MESSAGE_ID:k,DeviceAdded:le,DeviceInfo:qe,DeviceList:Se,DeviceRemoved:be,Error:se,ErrorClass:q,GenericDeviceMessageAttributes:$t,GenericMessageSubcommand:De,LinearCmd:ye,MAX_ID:Ft,MESSAGE_SPEC_VERSION:_e,MessageAttributes:He,Ok:he,Ping:Je,RawDeviceMessageAttributes:Gt,RawReadCmd:Ne,RawReading:Fe,RawSubscribeCmd:Be,RawUnsubscribeCmd:je,RawWriteCmd:ke,RequestDeviceList:Oe,RequestServerInfo:xe,RotateCmd:ge,RotateSubcommand:ot,SYSTEM_MESSAGE_ID:K,ScalarCmd:pe,ScalarSubcommand:Xe,ScanningFinished:Ae,SensorDeviceMessageAttributes:Wt,SensorReadCmd:Te,SensorReading:Pe,SensorType:re,ServerInfo:Ie,StartScanning:Ce,StopAllDevices:Re,StopDeviceCmd:Le,StopScanning:Ee,VectorSubcommand:at},Symbol.toStringTag,{value:"Module"}));/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */class H extends Error{constructor(e,t,n=K,o){super(e),this.errorClass=q.ERROR_UNKNOWN,this.errorClass=t,this.innerError=o,this.messageId=n}get ErrorClass(){return this.errorClass}get InnerError(){return this.innerError}get Id(){return this.messageId}get ErrorMessage(){return new se(this.message,this.ErrorClass,this.Id)}static LogAndError(e,t,n,o=K){return t.Error(n),new e(n,o)}static FromError(e){switch(e.ErrorCode){case q.ERROR_DEVICE:return new F(e.ErrorMessage,e.Id);case q.ERROR_INIT:return new Ye(e.ErrorMessage,e.Id);case q.ERROR_UNKNOWN:return new zt(e.ErrorMessage,e.Id);case q.ERROR_PING:return new Ut(e.ErrorMessage,e.Id);case q.ERROR_MSG:return new ve(e.ErrorMessage,e.Id);default:throw new Error(`Message type ${e.ErrorCode} not handled`)}}}class Ye extends H{constructor(e,t=K){super(e,q.ERROR_INIT,t)}}class F extends H{constructor(e,t=K){super(e,q.ERROR_DEVICE,t)}}class ve extends H{constructor(e,t=K){super(e,q.ERROR_MSG,t)}}class Ut extends H{constructor(e,t=K){super(e,q.ERROR_PING,t)}}class zt extends H{constructor(e,t=K){super(e,q.ERROR_UNKNOWN,t)}}function Ht(s){for(const e of Object.values(wn))if(typeof e=="function"&&"Name"in e&&e.Name===s)return e;return null}function ie(s){return Ht(Object.getPrototypeOf(s).constructor.Name)}function ct(s){const e=JSON.parse(s),t=[];for(const n of Array.from(e)){const o=Object.getOwnPropertyNames(n)[0],u=Ht(o);if(u){const c=vn(u,n[o]);c.update(),t.push(c)}}return t}class $e extends Ue{constructor(e,t){super(),this._deviceInfo=e,this._sendClosure=t,this.allowedMsgs=new Map,e.DeviceMessages.update()}get name(){return this._deviceInfo.DeviceName}get displayName(){return this._deviceInfo.DeviceDisplayName}get index(){return this._deviceInfo.DeviceIndex}get messageTimingGap(){return this._deviceInfo.DeviceMessageTimingGap}get messageAttributes(){return this._deviceInfo.DeviceMessages}static fromMsg(e,t){return new $e(e,t)}async send(e){return await this._sendClosure(this,e)}async sendExpectOk(e){const t=await this.send(e);switch(ie(t)){case he:return;case se:throw H.FromError(t);default:throw new ve(`Message type ${t.constructor} not handled by SendMsgExpectOk`)}}async scalar(e){Array.isArray(e)?await this.sendExpectOk(new pe(e,this.index)):await this.sendExpectOk(new pe([e],this.index))}async scalarCommandBuilder(e,t){var u;const n=(u=this.messageAttributes.ScalarCmd)==null?void 0:u.filter(c=>c.ActuatorType===t);if(!n||n.length===0)throw new F(`Device ${this.name} has no ${t} capabilities`);const o=[];if(typeof e=="number")n.forEach(c=>o.push(new Xe(c.Index,e,t)));else if(Array.isArray(e)){if(e.length>n.length)throw new F(`${e.length} commands send to a device with ${n.length} vibrators`);n.forEach((c,d)=>{o.push(new Xe(c.Index,e[d],t))})}else throw new F(`${t} can only take numbers or arrays of numbers.`);await this.scalar(o)}get vibrateAttributes(){var e;return((e=this.messageAttributes.ScalarCmd)==null?void 0:e.filter(t=>t.ActuatorType===ae.Vibrate))??[]}async vibrate(e){await this.scalarCommandBuilder(e,ae.Vibrate)}get oscillateAttributes(){var e;return((e=this.messageAttributes.ScalarCmd)==null?void 0:e.filter(t=>t.ActuatorType===ae.Oscillate))??[]}async oscillate(e){await this.scalarCommandBuilder(e,ae.Oscillate)}get rotateAttributes(){return this.messageAttributes.RotateCmd??[]}async rotate(e,t){const n=this.messageAttributes.RotateCmd;if(!n||n.length===0)throw new F(`Device ${this.name} has no Rotate capabilities`);let o;if(typeof e=="number")o=ge.Create(this.index,new Array(n.length).fill([e,t]));else if(Array.isArray(e))o=ge.Create(this.index,e);else throw new F("SendRotateCmd can only take a number and boolean, or an array of number/boolean tuples");await this.sendExpectOk(o)}get linearAttributes(){return this.messageAttributes.LinearCmd??[]}async linear(e,t){const n=this.messageAttributes.LinearCmd;if(!n||n.length===0)throw new F(`Device ${this.name} has no Linear capabilities`);let o;if(typeof e=="number")o=ye.Create(this.index,new Array(n.length).fill([e,t]));else if(Array.isArray(e))o=ye.Create(this.index,e);else throw new F("SendLinearCmd can only take a number and number, or an array of number/number tuples");await this.sendExpectOk(o)}async sensorRead(e,t){const n=await this.send(new Te(this.index,e,t));switch(ie(n)){case Pe:return n.Data;case se:throw H.FromError(n);default:throw new ve(`Message type ${n.constructor} not handled by sensorRead`)}}get hasBattery(){var t;const e=(t=this.messageAttributes.SensorReadCmd)==null?void 0:t.filter(n=>n.SensorType===re.Battery);return e!==void 0&&e.length>0}async battery(){var n;if(!this.hasBattery)throw new F(`Device ${this.name} has no Battery capabilities`);const e=(n=this.messageAttributes.SensorReadCmd)==null?void 0:n.filter(o=>o.SensorType===re.Battery);return(await this.sensorRead(e[0].Index,re.Battery))[0]/100}get hasRssi(){var t;const e=(t=this.messageAttributes.SensorReadCmd)==null?void 0:t.filter(n=>n.SensorType===re.RSSI);return e!==void 0&&e.length===0}async rssi(){var n;if(!this.hasRssi)throw new F(`Device ${this.name} has no RSSI capabilities`);const e=(n=this.messageAttributes.SensorReadCmd)==null?void 0:n.filter(o=>o.SensorType===re.RSSI);return(await this.sensorRead(e[0].Index,re.RSSI))[0]}async rawRead(e,t,n){if(!this.messageAttributes.RawReadCmd)throw new F(`Device ${this.name} has no raw read capabilities`);if(this.messageAttributes.RawReadCmd.Endpoints.indexOf(e)===-1)throw new F(`Device ${this.name} has no raw readable endpoint ${e}`);const o=await this.send(new Ne(this.index,e,t,n));switch(ie(o)){case Fe:return new Uint8Array(o.Data);case se:throw H.FromError(o);default:throw new ve(`Message type ${o.constructor} not handled by rawRead`)}}async rawWrite(e,t,n){if(!this.messageAttributes.RawWriteCmd)throw new F(`Device ${this.name} has no raw write capabilities`);if(this.messageAttributes.RawWriteCmd.Endpoints.indexOf(e)===-1)throw new F(`Device ${this.name} has no raw writable endpoint ${e}`);await this.sendExpectOk(new ke(this.index,e,t,n))}async rawSubscribe(e){if(!this.messageAttributes.RawSubscribeCmd)throw new F(`Device ${this.name} has no raw subscribe capabilities`);if(this.messageAttributes.RawSubscribeCmd.Endpoints.indexOf(e)===-1)throw new F(`Device ${this.name} has no raw subscribable endpoint ${e}`);await this.sendExpectOk(new Be(this.index,e))}async rawUnsubscribe(e){if(!this.messageAttributes.RawSubscribeCmd)throw new F(`Device ${this.name} has no raw unsubscribe capabilities`);if(this.messageAttributes.RawSubscribeCmd.Endpoints.indexOf(e)===-1)throw new F(`Device ${this.name} has no raw unsubscribable endpoint ${e}`);await this.sendExpectOk(new je(this.index,e))}async stop(){await this.sendExpectOk(new Le(this.index))}emitDisconnected(){this.emit("deviceremoved")}}/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */class Jt{constructor(e){this._useCounter=e,this._counter=1,this._waitingMsgs=new Map}PrepareOutgoingMessage(e){this._useCounter&&(e.Id=this._counter,this._counter+=1);let t,n;const o=new Promise((u,c)=>{t=u,n=c});return this._waitingMsgs.set(e.Id,[t,n]),o}ParseIncomingMessages(e){const t=[];for(const n of e)if(n.Id!==K&&this._waitingMsgs.has(n.Id)){const[o,u]=this._waitingMsgs.get(n.Id);if(n.Type===se){u(H.FromError(n));continue}o(n);continue}else t.push(n);return t}}/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */class qt extends H{constructor(e){super(e,q.ERROR_UNKNOWN)}}class Mn extends Ue{constructor(e="Generic Buttplug Client"){super(),this._pingTimer=null,this._connector=null,this._devices=new Map,this._logger=ze.Logger,this._isScanning=!1,this._sorter=new Jt(!0),this.connect=async t=>{this._logger.Info(`ButtplugClient: Connecting using ${t.constructor.name}`),await t.connect(),this._connector=t,this._connector.addListener("message",this.parseMessages),this._connector.addListener("disconnect",this.disconnectHandler),await this.initializeConnection()},this.disconnect=async()=>{this._logger.Debug("ButtplugClient: Disconnect called"),this.checkConnector(),await this.shutdownConnection(),await this._connector.disconnect()},this.startScanning=async()=>{this._logger.Debug("ButtplugClient: StartScanning called"),this._isScanning=!0,await this.sendMsgExpectOk(new Ce)},this.stopScanning=async()=>{this._logger.Debug("ButtplugClient: StopScanning called"),this._isScanning=!1,await this.sendMsgExpectOk(new Ee)},this.stopAllDevices=async()=>{this._logger.Debug("ButtplugClient: StopAllDevices"),await this.sendMsgExpectOk(new Re)},this.disconnectHandler=()=>{this._logger.Info("ButtplugClient: Disconnect event receieved."),this.emit("disconnect")},this.parseMessages=t=>{const n=this._sorter.ParseIncomingMessages(t);for(const o of n)switch(ie(o)){case le:{const u=o,c=$e.fromMsg(u,this.sendDeviceMessageClosure);this._devices.set(u.DeviceIndex,c),this.emit("deviceadded",c);break}case be:{const u=o;if(this._devices.has(u.DeviceIndex)){const c=this._devices.get(u.DeviceIndex);c==null||c.emitDisconnected(),this._devices.delete(u.DeviceIndex),this.emit("deviceremoved",c)}break}case Ae:this._isScanning=!1,this.emit("scanningfinished",o);break}},this.initializeConnection=async()=>{this.checkConnector();const t=await this.sendMessage(new xe(this._clientName,_e));switch(ie(t)){case Ie:{const n=t;if(this._logger.Info(`ButtplugClient: Connected to Server ${n.ServerName}`),n.MaxPingTime,n.MessageVersion<_e)throw await this._connector.disconnect(),H.LogAndError(Ye,this._logger,`Server protocol version ${n.MessageVersion} is older than client protocol version ${_e}. Please update server.`);return await this.requestDeviceList(),!0}case se:{await this._connector.disconnect();const n=t;throw H.LogAndError(Ye,this._logger,`Cannot connect to server. ${n.ErrorMessage}`)}}return!1},this.requestDeviceList=async()=>{this.checkConnector(),this._logger.Debug("ButtplugClient: ReceiveDeviceList called"),(await this.sendMessage(new Oe)).Devices.forEach(n=>{if(this._devices.has(n.DeviceIndex))this._logger.Debug(`ButtplugClient: Device already added: ${n}`);else{const o=$e.fromMsg(n,this.sendDeviceMessageClosure);this._logger.Debug(`ButtplugClient: Adding Device: ${o}`),this._devices.set(n.DeviceIndex,o),this.emit("deviceadded",o)}})},this.shutdownConnection=async()=>{await this.stopAllDevices(),this._pingTimer!==null&&(clearInterval(this._pingTimer),this._pingTimer=null)},this.sendMsgExpectOk=async t=>{const n=await this.sendMessage(t);switch(ie(n)){case he:return;case se:throw H.FromError(n);default:throw H.LogAndError(ve,this._logger,`Message type ${ie(n).constructor} not handled by SendMsgExpectOk`)}},this.sendDeviceMessageClosure=async(t,n)=>await this.sendDeviceMessage(t,n),this._clientName=e,this._logger.Debug(`ButtplugClient: Client ${e} created.`)}get connected(){return this._connector!==null&&this._connector.Connected}get devices(){this.checkConnector();const e=[];return this._devices.forEach(t=>{e.push(t)}),e}get isScanning(){return this._isScanning}async sendDeviceMessage(e,t){if(this.checkConnector(),this._devices.get(e.index)===void 0)throw H.LogAndError(F,this._logger,`Device ${e.index} not available.`);return t.DeviceIndex=e.index,await this.sendMessage(t)}async sendMessage(e){this.checkConnector();const t=this._sorter.PrepareOutgoingMessage(e);return await this._connector.send(e),await t}checkConnector(){if(!this.connected)throw new qt("ButtplugClient not connected")}}class _n extends Ue{constructor(e){super(),this._url=e,this._websocketConstructor=null,this.connect=async()=>new Promise((t,n)=>{const o=new(this._websocketConstructor??WebSocket)(this._url),u=d=>{n(d)},c=d=>n(d.reason);o.addEventListener("open",async()=>{this._ws=o;try{await this.initialize(),this._ws.addEventListener("message",d=>{this.parseIncomingMessage(d)}),this._ws.removeEventListener("close",c),this._ws.removeEventListener("error",u),this._ws.addEventListener("close",this.disconnect),t()}catch(d){n(d)}}),o.addEventListener("error",u),o.addEventListener("close",c)}),this.disconnect=async()=>{this.Connected&&(this._ws.close(),this._ws=void 0,this.emit("disconnect"))},this.initialize=async()=>Promise.resolve()}get Connected(){return this._ws!==void 0}sendMessage(e){if(!this.Connected)throw new Error("ButtplugBrowserWebsocketConnector not connected");this._ws.send("["+e.toJSON()+"]")}parseIncomingMessage(e){if(typeof e.data=="string"){const t=ct(e.data);this.emit("message",t)}else e.data instanceof Blob}onReaderLoad(e){const t=ct(e.target.result);this.emit("message",t)}}class Xt extends _n{constructor(){super(...arguments),this.send=e=>{if(!this.Connected)throw new Error("ButtplugClient not connected");this.sendMessage(e)}}}var Sn=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};class bn extends Xt{constructor(){super(...arguments),this._websocketConstructor=Sn.WebSocket}}y.ActuatorType=ae,y.ButtplugBrowserWebsocketClientConnector=Xt,y.ButtplugClient=Mn,y.ButtplugClientConnectorException=qt,y.ButtplugClientDevice=$e,y.ButtplugDeviceError=F,y.ButtplugDeviceMessage=Z,y.ButtplugError=H,y.ButtplugInitError=Ye,y.ButtplugLogLevel=rt,y.ButtplugLogger=ze,y.ButtplugMessage=Q,y.ButtplugMessageError=ve,y.ButtplugMessageSorter=Jt,y.ButtplugNodeWebsocketClientConnector=bn,y.ButtplugPingError=Ut,y.ButtplugSystemMessage=ce,y.ButtplugUnknownError=zt,y.DEFAULT_MESSAGE_ID=k,y.DeviceAdded=le,y.DeviceInfo=qe,y.DeviceList=Se,y.DeviceRemoved=be,y.Error=se,y.ErrorClass=q,y.GenericDeviceMessageAttributes=$t,y.GenericMessageSubcommand=De,y.LinearCmd=ye,y.LogMessage=Nt,y.MAX_ID=Ft,y.MESSAGE_SPEC_VERSION=_e,y.MessageAttributes=He,y.Ok=he,y.Ping=Je,y.RawDeviceMessageAttributes=Gt,y.RawReadCmd=Ne,y.RawReading=Fe,y.RawSubscribeCmd=Be,y.RawUnsubscribeCmd=je,y.RawWriteCmd=ke,y.RequestDeviceList=Oe,y.RequestServerInfo=xe,y.RotateCmd=ge,y.RotateSubcommand=ot,y.SYSTEM_MESSAGE_ID=K,y.ScalarCmd=pe,y.ScalarSubcommand=Xe,y.ScanningFinished=Ae,y.SensorDeviceMessageAttributes=Wt,y.SensorReadCmd=Te,y.SensorReading=Pe,y.SensorType=re,y.ServerInfo=Ie,y.StartScanning=Ce,y.StopAllDevices=Re,y.StopDeviceCmd=Le,y.StopScanning=Ee,y.VectorSubcommand=at,y.fromJSON=ct,y.getMessageClassFromMessage=ie,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
