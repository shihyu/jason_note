<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>WebAssembly + Rust 實戰教學 - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="webassembly--rust-實戰教學"><a class="header" href="#webassembly--rust-實戰教學">WebAssembly + Rust 實戰教學</a></h1>
<p>這是一個使用 Rust 編譯成 WebAssembly 並在瀏覽器中運行的完整範例專案。本文將介紹如何使用 <code>wasm-bindgen</code> 讓 Rust 程式碼與 JavaScript 互動，並操作 DOM。</p>
<h2 id="目錄"><a class="header" href="#目錄">目錄</a></h2>
<ul>
<li><a href="#%E5%B0%88%E6%A1%88%E7%B5%90%E6%A7%8B">專案結構</a></li>
<li><a href="#%E7%92%B0%E5%A2%83%E9%9C%80%E6%B1%82">環境需求</a></li>
<li><a href="#%E5%AE%89%E8%A3%9D%E6%AD%A5%E9%A9%9F">安裝步驟</a></li>
<li><a href="#%E5%BF%AB%E9%80%9F%E9%96%8B%E5%A7%8B">快速開始</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%8A%80%E8%A1%93%E8%A7%A3%E6%9E%90">核心技術解析</a></li>
<li><a href="#%E7%A8%8B%E5%BC%8F%E7%A2%BC%E8%AA%AA%E6%98%8E">程式碼說明</a></li>
<li><a href="#%E7%B7%A8%E8%AD%AF%E6%B5%81%E7%A8%8B">編譯流程</a></li>
<li><a href="#%E9%96%8B%E7%99%BC%E4%BC%BA%E6%9C%8D%E5%99%A8">開發伺服器</a></li>
<li><a href="#cargo-install-vs-cargo-add">cargo install vs cargo add</a></li>
<li><a href="#%E5%B8%B8%E8%A6%8B%E5%95%8F%E9%A1%8C">常見問題</a></li>
</ul>
<h2 id="專案結構"><a class="header" href="#專案結構">專案結構</a></h2>
<pre><code>wasm-demo/
├── src/
│   └── lib.rs              # Rust 原始碼
├── .cargo/
│   └── config              # Cargo 編譯設定
├── Cargo.toml              # Rust 專案設定
├── package.json            # Node.js 專案設定
├── build.js                # 編譯腳本
├── index.js                # JavaScript 入口
├── webpack.config.js       # Webpack 設定
├── Makefile               # 方便的指令集合
├── wasm_demo.js           # 生成的 JS 綁定（編譯後產生）
├── wasm_demo_bg.js        # 生成的 JS 綁定實作（編譯後產生）
└── wasm_demo_bg.wasm      # 編譯好的 WebAssembly（編譯後產生）
</code></pre>
<h2 id="環境需求"><a class="header" href="#環境需求">環境需求</a></h2>
<ul>
<li><strong>Rust</strong> 工具鏈（rustup + cargo）</li>
<li><strong>Node.js</strong> 和 npm/yarn</li>
<li><strong>wasm-bindgen-cli</strong> 工具</li>
</ul>
<h2 id="安裝步驟"><a class="header" href="#安裝步驟">安裝步驟</a></h2>
<h3 id="1-安裝-rust"><a class="header" href="#1-安裝-rust">1. 安裝 Rust</a></h3>
<p>如果尚未安裝 Rust，請執行：</p>
<pre><code class="language-bash">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
</code></pre>
<h3 id="2-添加-webassembly-編譯目標"><a class="header" href="#2-添加-webassembly-編譯目標">2. 添加 WebAssembly 編譯目標</a></h3>
<pre><code class="language-bash">rustup target add wasm32-unknown-unknown
</code></pre>
<h3 id="3-安裝專案依賴"><a class="header" href="#3-安裝專案依賴">3. 安裝專案依賴</a></h3>
<p>使用 Makefile 一鍵安裝所有依賴：</p>
<pre><code class="language-bash">make install
</code></pre>
<p>這會自動：</p>
<ul>
<li>安裝 Node.js 依賴（webpack、webpack-dev-server 等）</li>
<li>安裝 <code>wasm-bindgen-cli</code>（如果尚未安裝）</li>
</ul>
<p>或手動安裝：</p>
<pre><code class="language-bash"># 安裝 Node.js 依賴
npm install

# 安裝 wasm-bindgen-cli
cargo install wasm-bindgen-cli
</code></pre>
<h2 id="快速開始"><a class="header" href="#快速開始">快速開始</a></h2>
<h3 id="方式一使用-makefile推薦"><a class="header" href="#方式一使用-makefile推薦">方式一：使用 Makefile（推薦）</a></h3>
<pre><code class="language-bash"># 查看所有可用指令
make help

# 編譯專案
make build

# 啟動開發伺服器（自動處理 port 衝突）
make run

# 清理生成檔案
make clean
</code></pre>
<h3 id="方式二使用-npm-scripts"><a class="header" href="#方式二使用-npm-scripts">方式二：使用 npm scripts</a></h3>
<pre><code class="language-bash"># 編譯
npm run build

# 啟動開發伺服器
npm run serve
</code></pre>
<h3 id="訪問應用"><a class="header" href="#訪問應用">訪問應用</a></h3>
<p>開發伺服器啟動後，瀏覽器訪問：</p>
<pre><code>http://localhost:8080
</code></pre>
<p>你將看到網頁上顯示 "Hello from Rust"，這段文字是由 Rust 程式碼透過 WebAssembly 在瀏覽器中動態產生的。</p>
<h2 id="核心技術解析"><a class="header" href="#核心技術解析">核心技術解析</a></h2>
<h3 id="1-wasm-bindgen"><a class="header" href="#1-wasm-bindgen">1. wasm-bindgen</a></h3>
<p><code>wasm-bindgen</code> 是 Rust 與 JavaScript 之間的橋樑，負責：</p>
<ul>
<li><strong>類型轉換</strong>：在 Rust 和 JavaScript 之間自動轉換資料型別</li>
<li><strong>函數綁定</strong>：讓 JavaScript 可以呼叫 Rust 函數</li>
<li><strong>DOM 操作</strong>：透過 <code>web-sys</code> crate 讓 Rust 可以操作瀏覽器 DOM</li>
</ul>
<h3 id="2-web-sys"><a class="header" href="#2-web-sys">2. web-sys</a></h3>
<p><code>web-sys</code> 提供了 Web API 的 Rust 綁定，包括：</p>
<ul>
<li><code>Window</code>、<code>Document</code></li>
<li><code>Element</code>、<code>Node</code>、<code>HtmlElement</code></li>
<li>以及其他瀏覽器 API</li>
</ul>
<h3 id="3-編譯目標"><a class="header" href="#3-編譯目標">3. 編譯目標</a></h3>
<p><code>.cargo/config</code> 設定了預設的編譯目標：</p>
<pre><code class="language-toml">[build]
target = "wasm32-unknown-unknown"
</code></pre>
<p>這告訴 Cargo 編譯成 WebAssembly 格式。</p>
<h2 id="程式碼說明"><a class="header" href="#程式碼說明">程式碼說明</a></h2>
<h3 id="rust-程式碼srclibrs"><a class="header" href="#rust-程式碼srclibrs">Rust 程式碼（src/lib.rs）</a></h3>
<pre><pre class="playground"><code class="language-rust">extern crate wasm_bindgen;
extern crate web_sys;

use wasm_bindgen::prelude::*;

#[wasm_bindgen]
pub fn main() -&gt; Result&lt;(), JsValue&gt; {
    // 獲取 window 物件
    let window = web_sys::window().unwrap();

    // 獲取 document 物件
    let document = window.document().unwrap();

    // 獲取 body 元素
    let body = document.body().unwrap();

    // 建立一個新的 &lt;p&gt; 元素
    let el = document.create_element("p")?;

    // 設定元素的內容
    el.set_inner_html("Hello from Rust");

    // 將元素附加到 body
    AsRef::&lt;web_sys::Node&gt;::as_ref(&amp;body).append_child(el.as_ref())?;

    Ok(())
}</code></pre></pre>
<p><strong>關鍵點說明：</strong></p>
<ol>
<li><strong><code>#[wasm_bindgen]</code> 宏</strong>：標記這個函數應該被導出給 JavaScript 使用</li>
<li><strong><code>JsValue</code></strong>：JavaScript 值的 Rust 表示，用於錯誤處理</li>
<li><strong>DOM 操作</strong>：
<ul>
<li><code>window()</code> → 獲取瀏覽器視窗物件</li>
<li><code>document()</code> → 獲取文檔物件</li>
<li><code>create_element()</code> → 建立新的 HTML 元素</li>
<li><code>append_child()</code> → 將元素加入到 DOM 樹</li>
</ul>
</li>
<li><strong>型別轉換</strong>：使用 <code>AsRef</code> trait 將 <code>HtmlElement</code> 轉換為 <code>Node</code> 類型</li>
</ol>
<h3 id="javascript-入口indexjs"><a class="header" href="#javascript-入口indexjs">JavaScript 入口（index.js）</a></h3>
<pre><code class="language-javascript">const wasm = import('./wasm_demo')

wasm
  .then(m =&gt; {
    m.main()  // 呼叫 Rust 導出的 main 函數
  })
  .catch(console.error)
</code></pre>
<p>這段程式碼：</p>
<ol>
<li>動態 import WebAssembly 模組</li>
<li>模組載入完成後呼叫 Rust 的 <code>main</code> 函數</li>
<li>處理可能發生的錯誤</li>
</ol>
<h3 id="編譯腳本buildjs"><a class="header" href="#編譯腳本buildjs">編譯腳本（build.js）</a></h3>
<pre><code class="language-javascript">const s = require('shelljs')

s.cd(__dirname)
// 編譯 Rust 成 WebAssembly
s.exec('cargo build --release')

// 使用 wasm-bindgen 產生 JavaScript 綁定
s.exec(
  'wasm-bindgen target/wasm32-unknown-unknown/release/wasm_demo.wasm --out-dir .'
)
</code></pre>
<p><strong>編譯流程：</strong></p>
<ol>
<li><strong>Cargo 編譯</strong>：將 Rust 程式碼編譯成 <code>.wasm</code> 檔案</li>
<li><strong>wasm-bindgen 處理</strong>：生成 JavaScript 綁定程式碼（<code>wasm_demo.js</code> 和 <code>wasm_demo_bg.js</code>）</li>
</ol>
<h3 id="webpack-設定webpackconfigjs"><a class="header" href="#webpack-設定webpackconfigjs">Webpack 設定（webpack.config.js）</a></h3>
<pre><code class="language-javascript">const path = require('path')
const HtmlPlugin = require('html-webpack-plugin')

module.exports = {
  entry: './index.js',
  output: {
    path: path.join(__dirname, 'dist'),
    filename: 'bundle.js',
  },
  plugins: [
    new HtmlPlugin({
      title: 'wasm demo',
    }),
  ],
  mode: 'development',
  devtool: 'cheap-module-source-map',
  experiments: {
    asyncWebAssembly: true,  // 啟用 WebAssembly 支援
  },
}
</code></pre>
<p><strong>關鍵設定：</strong></p>
<ul>
<li><code>experiments.asyncWebAssembly: true</code>：啟用 Webpack 5 的 WebAssembly 支援</li>
<li><code>HtmlPlugin</code>：自動產生 HTML 檔案</li>
</ul>
<h2 id="編譯流程"><a class="header" href="#編譯流程">編譯流程</a></h2>
<p>完整的編譯流程如下：</p>
<pre><code>src/lib.rs (Rust 源碼)
    ↓
[cargo build --release]
    ↓
target/wasm32-unknown-unknown/release/wasm_demo.wasm
    ↓
[wasm-bindgen]
    ↓
wasm_demo.js + wasm_demo_bg.js + wasm_demo_bg.wasm
    ↓
[webpack]
    ↓
dist/bundle.js + dist/index.html
</code></pre>
<h3 id="生成的檔案說明"><a class="header" href="#生成的檔案說明">生成的檔案說明</a></h3>
<p>編譯後會產生以下檔案：</p>
<ol>
<li><strong>wasm_demo_bg.wasm</strong> (29KB)：編譯好的 WebAssembly 二進位檔案</li>
<li><strong>wasm_demo.js</strong> (179 bytes)：ES6 模組入口，負責初始化</li>
<li><strong>wasm_demo_bg.js</strong> (4.3KB)：JavaScript 綁定實作，包含：
<ul>
<li>記憶體管理函數</li>
<li>類型轉換邏輯</li>
<li>Web API 綁定（<code>__wbg_*</code> 函數）</li>
<li>導出的 <code>main()</code> 函數</li>
</ul>
</li>
<li><strong>wasm_demo.d.ts</strong> 和 <strong>wasm_demo_bg.wasm.d.ts</strong>：TypeScript 型別定義</li>
</ol>
<h2 id="開發伺服器"><a class="header" href="#開發伺服器">開發伺服器</a></h2>
<h3 id="使用-makefile"><a class="header" href="#使用-makefile">使用 Makefile</a></h3>
<pre><code class="language-bash"># 啟動開發伺服器（預設 port 8080）
make run

# 或
make serve

# 指定不同的 port
PORT=3000 make run
</code></pre>
<p>Makefile 會自動：</p>
<ol>
<li>檢查並終止佔用 port 的進程</li>
<li>啟動 webpack-dev-server</li>
<li>開啟熱重載功能</li>
</ol>
<h3 id="手動啟動"><a class="header" href="#手動啟動">手動啟動</a></h3>
<pre><code class="language-bash">npm run serve
</code></pre>
<p>開發伺服器提供：</p>
<ul>
<li>熱重載（Hot Reload）</li>
<li>Source Map 支援</li>
<li>自動產生 HTML</li>
</ul>
<h2 id="cargo-install-vs-cargo-add"><a class="header" href="#cargo-install-vs-cargo-add">cargo install vs cargo add</a></h2>
<p>在開發 WebAssembly 專案時，新手常常會混淆 <code>cargo install</code> 和 <code>cargo add</code> 的用途。以下詳細說明兩者的區別。</p>
<h3 id="-cargo-install-wasm-bindgen-cli"><a class="header" href="#-cargo-install-wasm-bindgen-cli">📦 <code>cargo install wasm-bindgen-cli</code></a></h3>
<h4 id="這是什麼"><a class="header" href="#這是什麼">這是什麼？</a></h4>
<ul>
<li><strong>命令行工具（CLI Tool）</strong></li>
<li>全局安裝到您的系統</li>
</ul>
<h4 id="做什麼用"><a class="header" href="#做什麼用">做什麼用？</a></h4>
<pre><code class="language-bash"># 安裝後可以在終端使用 wasm-bindgen 命令
$ wasm-bindgen --help

# 用來處理編譯後的 WASM 檔案
$ wasm-bindgen target/wasm32-unknown-unknown/release/my_project.wasm \
  --out-dir ./pkg \
  --target web
</code></pre>
<h4 id="安裝位置"><a class="header" href="#安裝位置">安裝位置</a></h4>
<pre><code>~/.cargo/bin/wasm-bindgen  ← 全局工具
</code></pre>
<hr />
<h3 id="-cargo-add-wasm-bindgen-web-sys"><a class="header" href="#-cargo-add-wasm-bindgen-web-sys">📚 <code>cargo add wasm-bindgen web-sys</code></a></h3>
<h4 id="這是什麼-1"><a class="header" href="#這是什麼-1">這是什麼？</a></h4>
<ul>
<li><strong>專案依賴庫（Library Dependencies）</strong></li>
<li>添加到當前專案的 <code>Cargo.toml</code></li>
</ul>
<h4 id="做什麼用-1"><a class="header" href="#做什麼用-1">做什麼用？</a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 在 Rust 代碼中使用這些庫
use wasm_bindgen::prelude::*;
use web_sys::console;

#[wasm_bindgen]
pub fn greet(name: &amp;str) {
    console::log_1(&amp;format!("Hello, {}!", name).into());
}
<span class="boring">}</span></code></pre></pre>
<h4 id="安裝位置-1"><a class="header" href="#安裝位置-1">安裝位置</a></h4>
<pre><code>your-project/
├── Cargo.toml  ← 添加依賴到這裡
└── src/
    └── lib.rs  ← 代碼中使用這些庫
</code></pre>
<hr />
<h3 id="-清楚的對比"><a class="header" href="#-清楚的對比">🎯 清楚的對比</a></h3>
<div class="table-wrapper"><table><thead><tr><th>項目</th><th><code>cargo install</code></th><th><code>cargo add</code></th></tr></thead><tbody>
<tr><td><strong>類型</strong></td><td>命令行工具</td><td>程式庫</td></tr>
<tr><td><strong>作用範圍</strong></td><td>全局（整個系統）</td><td>單一專案</td></tr>
<tr><td><strong>安裝次數</strong></td><td>一次（全局）</td><td>每個專案都需要</td></tr>
<tr><td><strong>用途</strong></td><td>編譯/處理 WASM</td><td>在代碼中使用</td></tr>
<tr><td><strong>使用方式</strong></td><td>在終端執行命令</td><td>在 Rust 代碼中 import</td></tr>
</tbody></table>
</div>
<hr />
<h3 id="-完整的-wasm-開發流程"><a class="header" href="#-完整的-wasm-開發流程">📋 完整的 WASM 開發流程</a></h3>
<pre><code class="language-bash"># 1️⃣ 安裝全局工具（只需一次）
cargo install wasm-bindgen-cli
cargo install wasm-pack  # 建議也裝這個

# 2️⃣ 創建新專案
cargo new my-wasm-project --lib
cd my-wasm-project

# 3️⃣ 添加專案依賴
cargo add wasm-bindgen
cargo add web-sys --features console,Window

# 4️⃣ 寫代碼
# 編輯 src/lib.rs

# 5️⃣ 編譯
wasm-pack build --target web

# 6️⃣ 使用 wasm-bindgen 工具處理（通常 wasm-pack 會自動做）
</code></pre>
<hr />
<h3 id="-簡單記憶法"><a class="header" href="#-簡單記憶法">💡 簡單記憶法</a></h3>
<ul>
<li><strong><code>install</code></strong> = 裝<strong>工具</strong>（像裝 VS Code）</li>
<li><strong><code>add</code></strong> = 加<strong>材料</strong>（像 npm install 套件）</li>
</ul>
<pre><code>工具 (CLI)         材料 (Library)
    │                  │
    ├─ 處理 WASM       ├─ 寫 Rust 代碼時用
    ├─ 全局安裝        ├─ 每個專案都要加
    └─ 一次性          └─ 在代碼中 use
</code></pre>
<h3 id="-本專案中的使用情況"><a class="header" href="#-本專案中的使用情況">🔍 本專案中的使用情況</a></h3>
<p>在本專案 (<code>wasm-demo</code>) 中：</p>
<p><strong>全局工具（已安裝）：</strong></p>
<pre><code class="language-bash">wasm-bindgen-cli  # 用於生成 JavaScript 綁定
</code></pre>
<p><strong>專案依賴（Cargo.toml）：</strong></p>
<pre><code class="language-toml">[dependencies]
wasm-bindgen = "0.2.75"  # 在 Rust 代碼中使用

[dependencies.web-sys]
version = "0.3.52"        # 在 Rust 代碼中使用
features = ["Window", "Document", "Node", "HtmlElement", "Element"]
</code></pre>
<p><strong>工作流程：</strong></p>
<ol>
<li>使用 <code>wasm-bindgen</code> <strong>庫</strong>在 Rust 代碼中標記要導出的函數</li>
<li><code>cargo build</code> 編譯成 <code>.wasm</code> 檔案</li>
<li>使用 <code>wasm-bindgen</code> <strong>工具</strong>處理 <code>.wasm</code> 檔案，生成 JavaScript 綁定</li>
</ol>
<h2 id="常見問題"><a class="header" href="#常見問題">常見問題</a></h2>
<h3 id="1-編譯錯誤找不到-wasm-bindgen"><a class="header" href="#1-編譯錯誤找不到-wasm-bindgen">1. 編譯錯誤：找不到 wasm-bindgen</a></h3>
<p><strong>錯誤訊息：</strong></p>
<pre><code>error: failed to run custom build command for `wasm-bindgen`
</code></pre>
<p><strong>解決方式：</strong></p>
<pre><code class="language-bash">cargo install wasm-bindgen-cli
# 或
make install
</code></pre>
<h3 id="2-port-被佔用"><a class="header" href="#2-port-被佔用">2. Port 被佔用</a></h3>
<p><strong>錯誤訊息：</strong></p>
<pre><code>Error: listen EADDRINUSE: address already in use :::8080
</code></pre>
<p><strong>解決方式：</strong></p>
<pre><code class="language-bash"># 使用 Makefile 自動處理
make run

# 或手動 kill port
make kill-port
</code></pre>
<h3 id="3-webpack-不支援-webassembly"><a class="header" href="#3-webpack-不支援-webassembly">3. Webpack 不支援 WebAssembly</a></h3>
<p><strong>錯誤訊息：</strong></p>
<pre><code>Module parse failed: magic header not detected
</code></pre>
<p><strong>解決方式：</strong>
確保 <code>webpack.config.js</code> 包含：</p>
<pre><code class="language-javascript">experiments: {
  asyncWebAssembly: true,
}
</code></pre>
<h3 id="4-找不到-wasm-檔案"><a class="header" href="#4-找不到-wasm-檔案">4. 找不到 wasm 檔案</a></h3>
<p><strong>確認步驟：</strong></p>
<pre><code class="language-bash"># 檢查是否已編譯
ls -lh wasm_demo_bg.wasm

# 重新編譯
make build
</code></pre>
<h3 id="5-cargoconfig-棄用警告"><a class="header" href="#5-cargoconfig-棄用警告">5. .cargo/config 棄用警告</a></h3>
<p><strong>警告訊息：</strong></p>
<pre><code>warning: `.cargo/config` is deprecated in favor of `config.toml`
</code></pre>
<p><strong>解決方式：</strong></p>
<pre><code class="language-bash">cd .cargo
mv config config.toml
</code></pre>
<h2 id="cargotoml-說明"><a class="header" href="#cargotoml-說明">Cargo.toml 說明</a></h2>
<pre><code class="language-toml">[package]
name = "wasm-demo"
version = "0.1.0"
authors = ["DanSnow &lt;dododavid006@gmail.com&gt;"]
edition = "2018"

[lib]
crate-type = ["cdylib"]  # 編譯成動態連結庫（WebAssembly 需要）

[dependencies]
wasm-bindgen = "0.2.75"

[dependencies.web-sys]
version = "0.3.52"
# 需要哪些 Web API 就加入對應的 feature
features = ["Window", "Document", "Node", "HtmlElement", "Element"]
</code></pre>
<p><strong>關鍵設定：</strong></p>
<ul>
<li><code>crate-type = ["cdylib"]</code>：編譯成 C 動態連結庫格式，這是 WebAssembly 所需的</li>
<li><code>web-sys</code> features：按需啟用 Web API，減少編譯產物大小</li>
</ul>
<h2 id="packagejson-說明"><a class="header" href="#packagejson-說明">package.json 說明</a></h2>
<pre><code class="language-json">{
  "name": "wasm-demo",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "scripts": {
    "build": "node build.js",
    "serve": "webpack serve"
  },
  "devDependencies": {
    "html-webpack-plugin": "^5.5.0",
    "shelljs": "^0.8.5",
    "webpack": "^5.66.0",
    "webpack-cli": "^4.9.1",
    "webpack-dev-server": "^4.7.3"
  },
  "packageManager": "yarn@3.1.1"
}
</code></pre>
<h2 id="makefile-指令總覽"><a class="header" href="#makefile-指令總覽">Makefile 指令總覽</a></h2>
<pre><code class="language-bash">make help       # 顯示所有可用指令
make install    # 安裝所有依賴
make build      # 編譯 Rust + WebAssembly
make run        # 啟動開發伺服器（自動處理 port）
make serve      # 同 run
make kill-port  # 終止佔用 port 的進程
make clean      # 清理所有生成檔案
make rebuild    # 完整重建（clean + install + build）
</code></pre>
<h2 id="進階應用"><a class="header" href="#進階應用">進階應用</a></h2>
<h3 id="添加更多-web-api"><a class="header" href="#添加更多-web-api">添加更多 Web API</a></h3>
<p>如需使用更多 Web API（例如 <code>console.log</code>），在 <code>Cargo.toml</code> 添加對應的 feature：</p>
<pre><code class="language-toml">[dependencies.web-sys]
version = "0.3.52"
features = [
  "Window",
  "Document",
  "Node",
  "HtmlElement",
  "Element",
  "Console",  # 新增
]
</code></pre>
<p>然後在 Rust 程式碼中使用：</p>
<pre><pre class="playground"><code class="language-rust">use web_sys::console;

#[wasm_bindgen]
pub fn main() -&gt; Result&lt;(), JsValue&gt; {
    console::log_1(&amp;"Hello from Rust console!".into());
    // ... 其他程式碼
    Ok(())
}</code></pre></pre>
<h3 id="從-javascript-傳遞參數到-rust"><a class="header" href="#從-javascript-傳遞參數到-rust">從 JavaScript 傳遞參數到 Rust</a></h3>
<p>Rust 程式碼：</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[wasm_bindgen]
pub fn greet(name: &amp;str) -&gt; String {
    format!("Hello, {}!", name)
}
<span class="boring">}</span></code></pre></pre>
<p>JavaScript 程式碼：</p>
<pre><code class="language-javascript">import('./wasm_demo').then(wasm =&gt; {
  const greeting = wasm.greet("World");
  console.log(greeting); // "Hello, World!"
});
</code></pre>
<h2 id="效能考量"><a class="header" href="#效能考量">效能考量</a></h2>
<ol>
<li><strong>編譯優化</strong>：使用 <code>--release</code> 模式編譯可大幅減少檔案大小並提升效能</li>
<li><strong>Web API feature 精簡</strong>：只啟用需要的 feature，避免不必要的程式碼</li>
<li><strong>記憶體管理</strong>：注意 Rust 和 JavaScript 之間的記憶體傳遞</li>
</ol>
<h2 id="參考資源"><a class="header" href="#參考資源">參考資源</a></h2>
<ul>
<li><a href="https://rustwasm.github.io/wasm-bindgen/">wasm-bindgen 官方文檔</a></li>
<li><a href="https://rustwasm.github.io/wasm-bindgen/api/web_sys/">web-sys API 文檔</a></li>
<li><a href="https://rustwasm.github.io/book/">Rust WebAssembly 書籍</a></li>
<li><a href="https://developer.mozilla.org/zh-TW/docs/WebAssembly">MDN WebAssembly 指南</a></li>
</ul>
<h2 id="授權"><a class="header" href="#授權">授權</a></h2>
<p>MIT License</p>
<h2 id="作者"><a class="header" href="#作者">作者</a></h2>
<p>原作者：DanSnow (dododavid006@gmail.com)</p>
<hr />
<p><strong>祝你使用 Rust + WebAssembly 開發順利！</strong></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../web/webassembly_complete_guide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../web/buttplug_wasm_flow.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../web/webassembly_complete_guide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../web/buttplug_wasm_flow.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../../ace.js"></script>
        <script src="../../mode-rust.js"></script>
        <script src="../../editor.js"></script>
        <script src="../../theme-dawn.js"></script>
        <script src="../../theme-tomorrow_night.js"></script>

        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>



    </div>
    </body>
</html>
