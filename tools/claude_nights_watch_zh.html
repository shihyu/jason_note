<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Claude Nights Watch - 自主任務執行系統 - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="claudenightswatch---自主任務執行系統"><a class="header" href="#claudenightswatch---自主任務執行系統">ClaudeNightsWatch - 自主任務執行系統</a></h1>
<p>基於 Claude CLI 的智能自主任務執行系統，可監控使用時間窗口並自動執行預定義任務。</p>
<h2 id="-核心功能"><a class="header" href="#-核心功能">🌟 核心功能</a></h2>
<ul>
<li><strong>自主執行</strong> - 無需手動干預自動執行任務</li>
<li><strong>任務流程</strong> - 使用簡單的 markdown 文件定義任務</li>
<li><strong>安全規則</strong> - 透過 rules.md 配置安全約束</li>
<li><strong>智能定時</strong> - 使用 ccusage 獲得準確的時間監控</li>
<li><strong>預定開始</strong> - 可配置特定時間開始執行</li>
<li><strong>全面記錄</strong> - 追蹤所有活動和執行歷史</li>
</ul>
<h2 id="-前置要求"><a class="header" href="#-前置要求">📋 前置要求</a></h2>
<h3 id="必需組件"><a class="header" href="#必需組件">必需組件</a></h3>
<ul>
<li><a href="https://docs.anthropic.com/en/docs/claude-code/quickstart">Claude CLI</a> - 已安裝並配置</li>
</ul>
<h3 id="可選組件"><a class="header" href="#可選組件">可選組件</a></h3>
<ul>
<li><a href="https://www.npmjs.com/package/ccusage">ccusage</a> - 提供精確時間監控
<pre><code class="language-bash">npm install -g ccusage
</code></pre>
</li>
</ul>
<h2 id="-快速開始"><a class="header" href="#-快速開始">🚀 快速開始</a></h2>
<h3 id="1-安裝設置"><a class="header" href="#1-安裝設置">1. 安裝設置</a></h3>
<pre><code class="language-bash"># 克隆存儲庫
git clone https://github.com/aniketkarne/ClaudeNightsWatch.git
cd ClaudeNightsWatch

# 使腳本可執行
chmod +x *.sh

# 運行互動式設置
./setup-nights-watch.sh
</code></pre>
<h3 id="2-創建配置文件"><a class="header" href="#2-創建配置文件">2. 創建配置文件</a></h3>
<p><strong>task.md - 任務定義</strong></p>
<pre><code class="language-markdown"># 日常開發任務
1. 對所有源文件運行 linting
2. 更新依賴項到最新版本
3. 運行測試套件
4. 生成覆蓋率報告
5. 創建變更摘要
</code></pre>
<p><strong>rules.md - 安全規則</strong></p>
<pre><code class="language-markdown"># 安全規則
- 在不備份的情況下永不刪除文件
- 只在項目目錄內工作
- 始終為變更創建 feature 分支
- 永不提交敏感信息
</code></pre>
<h2 id="-基本使用"><a class="header" href="#-基本使用">🎮 基本使用</a></h2>
<h3 id="啟動系統"><a class="header" href="#啟動系統">啟動系統</a></h3>
<pre><code class="language-bash"># 立即啟動
./claude-nights-watch-manager.sh start

# 指定時間啟動
./claude-nights-watch-manager.sh start --at "09:00"
./claude-nights-watch-manager.sh start --at "2025-01-28 14:30"
</code></pre>
<h3 id="管理命令"><a class="header" href="#管理命令">管理命令</a></h3>
<pre><code class="language-bash"># 停止守護程序
./claude-nights-watch-manager.sh stop

# 檢查狀態
./claude-nights-watch-manager.sh status

# 重啟守護程序
./claude-nights-watch-manager.sh restart

# 查看任務和規則
./claude-nights-watch-manager.sh task
</code></pre>
<h3 id="日誌管理"><a class="header" href="#日誌管理">日誌管理</a></h3>
<pre><code class="language-bash"># 查看日誌
./claude-nights-watch-manager.sh logs

# 實時跟隨日誌
./claude-nights-watch-manager.sh logs -f

# 互動式日誌查看器
./view-logs.sh
</code></pre>
<h2 id="-系統架構"><a class="header" href="#-系統架構">⚙️ 系統架構</a></h2>
<h3 id="工作原理"><a class="header" href="#工作原理">工作原理</a></h3>
<ol>
<li><strong>監控階段</strong> - 持續監控 Claude 使用時間窗口</li>
<li><strong>定時階段</strong> - 接近 5 小時限制時準備執行</li>
<li><strong>任務準備</strong> - 讀取並組合 rules.md 和 task.md</li>
<li><strong>自主執行</strong> - 使用 <code>claude --dangerously-skip-permissions</code> 執行</li>
<li><strong>記錄階段</strong> - 完整記錄所有活動</li>
</ol>
<h3 id="時間檢測機制"><a class="header" href="#時間檢測機制">時間檢測機制</a></h3>
<div class="table-wrapper"><table><thead><tr><th>情況</th><th>檢測方式</th></tr></thead><tbody>
<tr><td><strong>有 ccusage</strong></td><td>API 獲得準確剩餘時間</td></tr>
<tr><td><strong>沒有 ccusage</strong></td><td>基於時間戳的檢查</td></tr>
</tbody></table>
</div>
<h3 id="自適應檢查間隔"><a class="header" href="#自適應檢查間隔">自適應檢查間隔</a></h3>
<div class="table-wrapper"><table><thead><tr><th>剩餘時間</th><th>檢查頻率</th></tr></thead><tbody>
<tr><td>&gt; 30 分鐘</td><td>每 10 分鐘</td></tr>
<tr><td>5-30 分鐘</td><td>每 2 分鐘</td></tr>
<tr><td>&lt; 5 分鐘</td><td>每 30 秒</td></tr>
</tbody></table>
</div>
<h2 id="-多工任務管理"><a class="header" href="#-多工任務管理">🔄 多工任務管理</a></h2>
<h3 id="claude-多會話能力"><a class="header" href="#claude-多會話能力">Claude 多會話能力</a></h3>
<ul>
<li>✅ <strong>技術上可行</strong> - 一個帳號可同時多個 CLI 會話</li>
<li>⚠️ <strong>共享配額</strong> - 所有會話共用 5 小時使用限制</li>
<li>🎯 <strong>建議策略</strong> - 智慧規劃勝過暴力並行</li>
</ul>
<h3 id="多工執行策略"><a class="header" href="#多工執行策略">多工執行策略</a></h3>
<h4 id="策略一多目錄管理推薦"><a class="header" href="#策略一多目錄管理推薦">策略一：多目錄管理（推薦）</a></h4>
<pre><code class="language-bash">~/claude-tasks/
├── project-a/          # 專案 A 獨立環境
│   ├── task.md
│   ├── rules.md
│   └── claude-nights-watch-*
├── project-b/          # 專案 B 獨立環境
│   ├── task.md
│   ├── rules.md
│   └── claude-nights-watch-*
└── project-c/          # 專案 C 獨立環境
    ├── task.md
    ├── rules.md
    └── claude-nights-watch-*
</code></pre>
<h4 id="策略二時間分段執行"><a class="header" href="#策略二時間分段執行">策略二：時間分段執行</a></h4>
<pre><code class="language-bash"># 早上執行專案 A
./claude-nights-watch-manager.sh start --at "09:00"

# 中午執行專案 B
./claude-nights-watch-manager.sh start --at "13:00"

# 下午執行專案 C
./claude-nights-watch-manager.sh start --at "17:00"
</code></pre>
<h4 id="策略三tmux-並行監控"><a class="header" href="#策略三tmux-並行監控">策略三：tmux 並行監控</a></h4>
<pre><code class="language-bash"># 創建 tmux 會話
tmux new-session -d -s claude-tasks

# 建立多個視窗
tmux new-window -t claude-tasks:1 -n 'project-a'
tmux new-window -t claude-tasks:2 -n 'project-b'
tmux new-window -t claude-tasks:3 -n 'project-c'

# 在各視窗啟動任務
tmux send-keys -t claude-tasks:1 'cd ~/claude-tasks/project-a &amp;&amp; ./claude-nights-watch-manager.sh start' Enter
tmux send-keys -t claude-tasks:2 'cd ~/claude-tasks/project-b &amp;&amp; ./claude-nights-watch-manager.sh start' Enter
tmux send-keys -t claude-tasks:3 'cd ~/claude-tasks/project-c &amp;&amp; ./claude-nights-watch-manager.sh start' Enter
</code></pre>
<h3 id="方案選擇建議"><a class="header" href="#方案選擇建議">方案選擇建議</a></h3>
<h4 id="pro-用戶20月"><a class="header" href="#pro-用戶20月">Pro 用戶（$20/月）</a></h4>
<ul>
<li>🎯 <strong>時間分段執行</strong></li>
<li>🎯 <strong>任務整合到單一 task.md</strong></li>
<li>🎯 <strong>重點單一專案深度工作</strong></li>
</ul>
<h4 id="max-5x-用戶100月"><a class="header" href="#max-5x-用戶100月">Max 5x 用戶（$100/月）</a></h4>
<ul>
<li>🎯 <strong>2-3 個並行會話</strong></li>
<li>🎯 <strong>tmux 分割管理</strong></li>
<li>🎯 <strong>監控配額使用</strong></li>
</ul>
<h4 id="max-20x-用戶200月"><a class="header" href="#max-20x-用戶200月">Max 20x 用戶（$200/月）</a></h4>
<ul>
<li>🎯 <strong>真正多專案並行</strong></li>
<li>🎯 <strong>5+ 個同時會話</strong></li>
<li>🎯 <strong>適合大型團隊</strong></li>
</ul>
<h2 id="-安全注意事項"><a class="header" href="#-安全注意事項">⚠️ 安全注意事項</a></h2>
<h3 id="重要提醒"><a class="header" href="#重要提醒">重要提醒</a></h3>
<blockquote>
<p>此工具使用 <code>--dangerously-skip-permissions</code> 標誌，將不經確認執行任務</p>
</blockquote>
<h3 id="安全建議"><a class="header" href="#安全建議">安全建議</a></h3>
<ul>
<li>✅ 在設置前手動測試所有任務</li>
<li>✅ 使用完整的 rules.md 防止破壞性操作</li>
<li>✅ 從簡單任務開始，逐步增加複雜性</li>
<li>✅ 定期監控日誌確保正確執行</li>
<li>✅ 保留重要數據備份</li>
<li>✅ 在隔離環境中運行</li>
</ul>
<h3 id="推薦安全規則"><a class="header" href="#推薦安全規則">推薦安全規則</a></h3>
<ul>
<li>🔒 限制文件系統訪問到項目目錄</li>
<li>🚫 禁止刪除命令</li>
<li>🛡️ 防止系統修改</li>
<li>🌐 限制網路訪問</li>
<li>📊 設置資源限制</li>
</ul>
<h2 id="-疑難排解"><a class="header" href="#-疑難排解">🐛 疑難排解</a></h2>
<h3 id="檢查清單"><a class="header" href="#檢查清單">檢查清單</a></h3>
<ol>
<li><strong>Claude CLI 安裝</strong> - <code>which claude</code></li>
<li><strong>配置文件存在</strong> - 驗證 task.md 存在</li>
<li><strong>查看日誌</strong> - <code>./claude-nights-watch-manager.sh logs</code></li>
<li><strong>使用量檢查</strong> - <code>ccusage blocks</code></li>
<li><strong>時間設置</strong> - 檢查預定開始時間</li>
<li><strong>文件內容</strong> - 確保 task.md 不為空</li>
<li><strong>精確監控</strong> - 安裝 ccusage 提高準確性</li>
<li><strong>系統時間</strong> - 檢查時間是否正確</li>
</ol>
<h2 id="-項目結構"><a class="header" href="#-項目結構">📁 項目結構</a></h2>
<pre><code>claude-nights-watch/
├── claude-nights-watch-daemon.sh      # 核心守護程序
├── claude-nights-watch-manager.sh     # 管理界面
├── setup-nights-watch.sh              # 設置腳本
├── view-logs.sh                        # 日誌查看器
├── logs/                               # 日誌存儲
├── examples/                           # 示例文件
│   ├── task.example.md
│   └── rules.example.md
└── test/                              # 測試腳本
    ├── test-simple.sh
    ├── test-task-simple.md
    └── test-rules-simple.md
</code></pre>
<h2 id="-測試與驗證"><a class="header" href="#-測試與驗證">🧪 測試與驗證</a></h2>
<pre><code class="language-bash"># 進入測試目錄
cd test

# 運行簡單測試
./test-simple.sh

# 測試即時執行
./test-immediate-execution.sh
</code></pre>
<h2 id="-貢獻指南"><a class="header" href="#-貢獻指南">🤝 貢獻指南</a></h2>
<ol>
<li>Fork 存儲庫</li>
<li>創建 feature 分支</li>
<li>遵循現有代碼風格</li>
<li>優先考慮安全性</li>
<li>更新相關文檔</li>
<li>提供使用示例</li>
<li>確保測試通過</li>
<li>提交 Pull Request</li>
</ol>
<h2 id="-授權資訊"><a class="header" href="#-授權資訊">📄 授權資訊</a></h2>
<ul>
<li><strong>授權</strong> - MIT License</li>
<li><strong>創建者</strong> - <a href="https://github.com/aniketkarne">Aniket Karne</a></li>
<li><strong>基於</strong> - <a href="https://github.com/aniketkarne/CCAutoRenew">CCAutoRenew</a> 專案</li>
</ul>
<hr />
<p><strong>記住</strong>：強大的自動化伴隨重大責任。啟用自主執行前，請務必仔細檢查任務和規則！🚨</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../tools/github-resources-collection.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../tools/claude-nights-watch-setup.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../tools/github-resources-collection.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../tools/claude-nights-watch-setup.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
