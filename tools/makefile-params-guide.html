<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Makefile 編譯參數說明 - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="makefile-編譯參數說明"><a class="header" href="#makefile-編譯參數說明">Makefile 編譯參數說明</a></h1>
<h2 id="makefile-內容"><a class="header" href="#makefile-內容">Makefile 內容</a></h2>
<pre><code class="language-makefile">CC = gcc
CFLAGS = -g -Wall
INCLUDE = -I../include -I../ggml/include
LDFLAGS = -L../build/bin -lllama -lggml -lggml-base -lggml-cpu
RPATH = -Wl,-rpath,../build/bin
</code></pre>
<hr />
<h2 id="各變數詳細說明"><a class="header" href="#各變數詳細說明">各變數詳細說明</a></h2>
<h3 id="cc--gcc"><a class="header" href="#cc--gcc">CC = gcc</a></h3>
<ul>
<li><strong>用途</strong>: 指定編譯器為 gcc（GNU C Compiler）</li>
<li><strong>好處</strong>:
<ul>
<li>統一編譯器版本，確保團隊使用相同工具</li>
<li>方便切換編譯器（改成 <code>clang</code> 就能換編譯器）</li>
</ul>
</li>
</ul>
<h3 id="cflags---g--wall"><a class="header" href="#cflags---g--wall">CFLAGS = -g -Wall</a></h3>
<ul>
<li><strong>用途</strong>: 編譯選項標誌</li>
<li><strong>參數說明</strong>:
<ul>
<li><code>-g</code>: 生成除錯資訊，讓你可以用 gdb 等工具除錯</li>
<li><code>-Wall</code>: 開啟所有常見的編譯警告，幫助發現潛在問題</li>
</ul>
</li>
</ul>
<h3 id="include---iinclude--iggmlinclude"><a class="header" href="#include---iinclude--iggmlinclude">INCLUDE = -I../include -I../ggml/include</a></h3>
<ul>
<li><strong>用途</strong>: 指定標頭檔 (.h) 的搜尋路徑</li>
<li><strong>參數說明</strong>:
<ul>
<li><code>-I../include</code>: 在上層目錄的 include 中尋找標頭檔</li>
<li><code>-I../ggml/include</code>: 在 ggml 函式庫的 include 目錄中尋找標頭檔</li>
</ul>
</li>
<li><strong>作用</strong>: 讓編譯器能找到 <code>#include &lt;xxx.h&gt;</code> 所需的檔案</li>
</ul>
<h3 id="ldflags---lbuildbin--lllama--lggml--lggml-base--lggml-cpu"><a class="header" href="#ldflags---lbuildbin--lllama--lggml--lggml-base--lggml-cpu">LDFLAGS = -L../build/bin -lllama -lggml -lggml-base -lggml-cpu</a></h3>
<ul>
<li><strong>用途</strong>: 連結器選項</li>
<li><strong>參數說明</strong>:
<ul>
<li><code>-L../build/bin</code>: 指定函式庫檔案 (.so/.a) 的搜尋路徑</li>
<li><code>-lllama</code>: 連結 llama 函式庫 (libllama.so)</li>
<li><code>-lggml</code>、<code>-lggml-base</code>、<code>-lggml-cpu</code>: 連結 ggml 相關函式庫</li>
</ul>
</li>
<li><strong>作用</strong>: 這些是執行程式所需的外部函式庫</li>
</ul>
<h3 id="rpath---wl-rpathbuildbin"><a class="header" href="#rpath---wl-rpathbuildbin">RPATH = -Wl,-rpath,../build/bin</a></h3>
<ul>
<li><strong>用途</strong>: 設定執行期函式庫搜尋路徑</li>
<li><strong>參數說明</strong>:
<ul>
<li><code>-Wl</code>: 將後面的參數傳給連結器</li>
<li><code>-rpath,../build/bin</code>: 在執行檔中嵌入函式庫搜尋路徑</li>
</ul>
</li>
<li><strong>重要</strong>: 讓程式執行時能找到 .so 檔，不用設定 <code>LD_LIBRARY_PATH</code> 環境變數</li>
</ul>
<hr />
<h2 id="編譯階段-vs-連結階段"><a class="header" href="#編譯階段-vs-連結階段">編譯階段 vs 連結階段</a></h2>
<h3 id="編譯階段compilation"><a class="header" href="#編譯階段compilation">編譯階段（Compilation）</a></h3>
<p>將 <code>.c</code> 原始碼轉換成 <code>.o</code> 目標檔</p>
<p><strong>使用的參數</strong>:</p>
<pre><code class="language-makefile">CC = gcc                                    # 編譯器
CFLAGS = -g -Wall                          # 編譯選項
INCLUDE = -I../include -I../ggml/include   # 標頭檔搜尋路徑
</code></pre>
<ul>
<li><code>-g</code>, <code>-Wall</code>: 控制如何編譯程式碼</li>
<li><code>-I</code>: 告訴編譯器去哪裡找 <code>#include</code> 的標頭檔</li>
</ul>
<h3 id="連結階段linking"><a class="header" href="#連結階段linking">連結階段（Linking）</a></h3>
<p>將 <code>.o</code> 目標檔和函式庫連結成可執行檔</p>
<p><strong>使用的參數</strong>:</p>
<pre><code class="language-makefile">LDFLAGS = -L../build/bin -lllama -lggml -lggml-base -lggml-cpu  # 連結選項
RPATH = -Wl,-rpath,../build/bin                                  # 執行期路徑
</code></pre>
<ul>
<li><code>-L</code>: 指定函式庫檔案的搜尋路徑</li>
<li><code>-l</code>: 指定要連結哪些函式庫</li>
<li><code>-Wl,-rpath</code>: 設定執行時期的函式庫搜尋路徑（給 linker 的指令）</li>
</ul>
<hr />
<h2 id="編譯命令對比"><a class="header" href="#編譯命令對比">編譯命令對比</a></h2>
<h3 id="目前的-makefile一步完成"><a class="header" href="#目前的-makefile一步完成">目前的 Makefile（一步完成）</a></h3>
<pre><code class="language-bash">gcc -g -Wall -o test_4_so test_4_so.c -I../include -I../ggml/include \
    -L../build/bin -lllama -lggml -lggml-base -lggml-cpu \
    -Wl,-rpath,../build/bin
</code></pre>
<h3 id="分成兩步的方式"><a class="header" href="#分成兩步的方式">分成兩步的方式</a></h3>
<p><strong>步驟 1: 編譯（只用編譯階段參數）</strong></p>
<pre><code class="language-bash">gcc -g -Wall -I../include -I../ggml/include -c test_4_so.c -o test_4_so.o
</code></pre>
<p><strong>步驟 2: 連結（只用連結階段參數）</strong></p>
<pre><code class="language-bash">gcc -o test_4_so test_4_so.o -L../build/bin \
    -lllama -lggml -lggml-base -lggml-cpu \
    -Wl,-rpath,../build/bin
</code></pre>
<hr />
<h2 id="使用變數的好處"><a class="header" href="#使用變數的好處">使用變數的好處</a></h2>
<ol>
<li><strong>可維護性</strong>: 集中管理編譯選項，修改更容易</li>
<li><strong>可讀性</strong>: 清楚分類各種參數，一目了然</li>
<li><strong>可重用性</strong>: 多個目標可以共用相同設定</li>
<li><strong>避免錯誤</strong>: 不用每次都輸入一長串命令</li>
</ol>
<hr />
<h2 id="注意事項"><a class="header" href="#注意事項">注意事項</a></h2>
<ul>
<li>一步完成編譯比較方便，適合小型專案</li>
<li>大型專案通常會分開編譯和連結，以節省重新編譯時間</li>
<li>RPATH 的設定讓程式可以找到動態函式庫，避免執行時找不到 .so 檔的問題</li>
</ul>
<hr />
<h2 id="查看連結資訊的工具"><a class="header" href="#查看連結資訊的工具">查看連結資訊的工具</a></h2>
<h3 id="1-ldd---最簡單直觀"><a class="header" href="#1-ldd---最簡單直觀">1. ldd - 最簡單直觀</a></h3>
<p>查看程式執行時會載入哪些動態函式庫：</p>
<pre><code class="language-bash">ldd test_4_so
</code></pre>
<p>輸出範例：</p>
<pre><code>libllama.so =&gt; ../build/bin/libllama.so (0x00007f...)
libggml.so =&gt; ../build/bin/libggml.so (0x00007f...)
libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f...)
</code></pre>
<h3 id="2-readelf--d---查看動態段最詳細"><a class="header" href="#2-readelf--d---查看動態段最詳細">2. readelf -d - 查看動態段（最詳細）</a></h3>
<pre><code class="language-bash">readelf -d test_4_so
</code></pre>
<p>可以看到：</p>
<ul>
<li><strong>NEEDED</strong>: 連結了哪些函式庫（<code>-l</code> 參數的結果）</li>
<li><strong>RPATH/RUNPATH</strong>: 執行期搜尋路徑（<code>-Wl,-rpath</code> 的結果）</li>
<li><strong>SONAME</strong>: 函式庫的名稱</li>
</ul>
<p>輸出範例：</p>
<pre><code>Dynamic section at offset 0x2d40 contains 28 entries:
  Tag        Type           Name/Value
 0x0000001d (RUNPATH)       Library runpath: [../build/bin]
 0x00000001 (NEEDED)        Shared library: [libllama.so]
 0x00000001 (NEEDED)        Shared library: [libggml.so]
 0x00000001 (NEEDED)        Shared library: [libc.so.6]
</code></pre>
<h3 id="3-objdump--p---查看程式標頭"><a class="header" href="#3-objdump--p---查看程式標頭">3. objdump -p - 查看程式標頭</a></h3>
<pre><code class="language-bash">objdump -p test_4_so | grep -E "NEEDED|RPATH|RUNPATH"
</code></pre>
<p>類似 readelf，但輸出格式不同</p>
<h3 id="4-nm---查看符號表"><a class="header" href="#4-nm---查看符號表">4. nm - 查看符號表</a></h3>
<pre><code class="language-bash">nm -D test_4_so    # 查看動態符號
nm test_4_so       # 查看所有符號
</code></pre>
<p>用途：查看函式庫中定義了哪些函數/變數，但<strong>不顯示 rpath 或 NEEDED</strong></p>
<hr />
<h2 id="工具對照表"><a class="header" href="#工具對照表">工具對照表</a></h2>
<div class="table-wrapper"><table><thead><tr><th>資訊</th><th>最佳工具</th><th>指令</th></tr></thead><tbody>
<tr><td><strong>連結了哪些函式庫</strong> (<code>-l</code>)</td><td><code>ldd</code> 或 <code>readelf -d</code></td><td><code>ldd test_4_so</code></td></tr>
<tr><td><strong>RPATH 路徑</strong> (<code>-Wl,-rpath</code>)</td><td><code>readelf -d</code></td><td><code>readelf -d test_4_so | grep RPATH</code></td></tr>
<tr><td><strong>函式庫搜尋路徑</strong> (<code>-L</code>)</td><td>❌ 無法查看</td><td>編譯期資訊，不會存在執行檔中</td></tr>
<tr><td><strong>符號/函數名稱</strong></td><td><code>nm</code></td><td><code>nm -D libllama.so</code></td></tr>
</tbody></table>
</div>
<hr />
<h2 id="實用指令範例"><a class="header" href="#實用指令範例">實用指令範例</a></h2>
<pre><code class="language-bash"># 快速查看所有動態連結資訊
readelf -d test_4_so

# 只看 RPATH/RUNPATH
readelf -d test_4_so | grep -E "RPATH|RUNPATH"

# 只看連結的函式庫
readelf -d test_4_so | grep NEEDED

# 查看實際載入路徑
ldd test_4_so

# 查看 libllama.so 提供了哪些符號
nm -D ../build/bin/libllama.so | grep " T "  # T = 已定義的函數

# 查看未定義的符號（需要從其他函式庫載入）
nm -D test_4_so | grep " U "  # U = 未定義的符號
</code></pre>
<p><strong>重要提醒</strong>: <code>-L</code> 的路徑只在編譯時使用，不會記錄在執行檔中。只有 RPATH/RUNPATH 會被寫入執行檔！</p>
<hr />
<h2 id="完整測試範例"><a class="header" href="#完整測試範例">完整測試範例</a></h2>
<p>以下是一個完整的測試專案，幫助你驗證所有編譯參數和工具的使用。</p>
<h3 id="建立測試專案腳本"><a class="header" href="#建立測試專案腳本">建立測試專案腳本</a></h3>
<p>將以下內容儲存為 <code>setup_test.sh</code>：</p>
<pre><code class="language-bash">#!/bin/bash
# 建立測試專案結構

echo "=== 建立測試專案 ==="
mkdir -p test_makefile/{lib,include,src,build}
cd test_makefile

# 1. 建立標頭檔
cat &gt; include/mylib.h &lt;&lt; 'EOF'
#ifndef MYLIB_H
#define MYLIB_H

void hello_from_lib(const char* name);
int add_numbers(int a, int b);

#endif
EOF

# 2. 建立函式庫原始碼
cat &gt; lib/mylib.c &lt;&lt; 'EOF'
#include &lt;stdio.h&gt;
#include "mylib.h"

void hello_from_lib(const char* name) {
    printf("Hello %s from mylib!\n", name);
}

int add_numbers(int a, int b) {
    return a + b;
}
EOF

# 3. 建立主程式
cat &gt; src/main.c &lt;&lt; 'EOF'
#include &lt;stdio.h&gt;
#include "mylib.h"

int main() {
    printf("=== Testing Library Functions ===\n");
    hello_from_lib("User");
    
    int result = add_numbers(10, 20);
    printf("10 + 20 = %d\n", result);
    
    return 0;
}
EOF

# 4. 建立 Makefile
cat &gt; Makefile &lt;&lt; 'EOF'
CC = gcc
CFLAGS = -g -Wall -fPIC
INCLUDE = -Iinclude
LDFLAGS = -Lbuild -lmylib
RPATH = -Wl,-rpath,./build

all: build/libmylib.so build/main

# 編譯動態函式庫
build/libmylib.so: lib/mylib.c
	@echo "=== 編譯動態函式庫 ==="
	$(CC) $(CFLAGS) -shared -o $@ $&lt; $(INCLUDE)

# 編譯主程式
build/main: src/main.c build/libmylib.so
	@echo "=== 編譯主程式 ==="
	$(CC) $(CFLAGS) -o $@ $&lt; $(INCLUDE) $(LDFLAGS) $(RPATH)

clean:
	rm -rf build/*

test: all
	@echo ""
	@echo "=== 執行程式 ==="
	./build/main

inspect: all
	@echo ""
	@echo "=========================================="
	@echo "1. 使用 ldd 查看依賴的函式庫"
	@echo "=========================================="
	ldd build/main
	@echo ""
	@echo "=========================================="
	@echo "2. 使用 readelf 查看 NEEDED 和 RPATH"
	@echo "=========================================="
	readelf -d build/main | grep -E "NEEDED|RPATH|RUNPATH"
	@echo ""
	@echo "=========================================="
	@echo "3. 使用 nm 查看函式庫的符號"
	@echo "=========================================="
	@echo "已定義的函數 (T):"
	nm -D build/libmylib.so | grep " T "
	@echo ""
	@echo "=========================================="
	@echo "4. 使用 nm 查看主程式未定義的符號 (需要從函式庫載入)"
	@echo "=========================================="
	nm -D build/main | grep " U " | grep -E "hello|add"
	@echo ""
	@echo "=========================================="
	@echo "5. 使用 objdump 查看動態段"
	@echo "=========================================="
	objdump -p build/main | grep -E "NEEDED|RPATH|RUNPATH"

.PHONY: all clean test inspect
EOF

# 5. 建立測試腳本
cat &gt; test_all.sh &lt;&lt; 'EOF'
#!/bin/bash

echo "======================================"
echo "開始完整測試流程"
echo "======================================"

# 清理並編譯
echo ""
echo "&gt;&gt;&gt; Step 1: 清理舊檔案"
make clean

echo ""
echo "&gt;&gt;&gt; Step 2: 編譯專案"
make all

echo ""
echo "&gt;&gt;&gt; Step 3: 執行程式測試"
make test

echo ""
echo "&gt;&gt;&gt; Step 4: 檢查連結資訊"
make inspect

echo ""
echo "======================================"
echo "測試完成！"
echo "======================================"
EOF

chmod +x test_all.sh

echo ""
echo "✅ 測試專案建立完成！"
echo ""
echo "📁 專案結構："
echo "test_makefile/"
echo "├── include/mylib.h      (標頭檔)"
echo "├── lib/mylib.c          (函式庫原始碼)"
echo "├── src/main.c           (主程式)"
echo "├── build/               (輸出目錄)"
echo "├── Makefile             (建構檔)"
echo "└── test_all.sh          (測試腳本)"
echo ""
echo "🚀 執行測試："
echo "   cd test_makefile"
echo "   ./test_all.sh"
echo ""
echo "或分步執行："
echo "   make all       # 編譯"
echo "   make test      # 執行"
echo "   make inspect   # 檢查連結資訊"
echo "   make clean     # 清理"
</code></pre>
<h3 id="使用方式"><a class="header" href="#使用方式">使用方式</a></h3>
<pre><code class="language-bash"># 1. 儲存並執行建立腳本
chmod +x setup_test.sh
./setup_test.sh

# 2. 進入測試目錄
cd test_makefile

# 3. 執行完整測試
./test_all.sh
</code></pre>
<h3 id="測試專案包含內容"><a class="header" href="#測試專案包含內容">測試專案包含內容</a></h3>
<ul>
<li><strong>自製動態函式庫</strong> (<code>libmylib.so</code>)：包含兩個簡單函數</li>
<li><strong>主程式</strong> (<code>main</code>)：使用該函式庫</li>
<li><strong>完整 Makefile</strong>：展示所有編譯參數的使用</li>
<li><strong>測試腳本</strong>：自動執行並檢查所有工具輸出</li>
</ul>
<h3 id="預期輸出"><a class="header" href="#預期輸出">預期輸出</a></h3>
<p>執行 <code>./test_all.sh</code> 後你會看到：</p>
<ol>
<li><strong>編譯過程</strong>：展示 <code>-I</code>、<code>-L</code>、<code>-l</code>、<code>-Wl,-rpath</code> 的實際使用</li>
<li><strong>程式執行</strong>：驗證函式庫正確連結
<pre><code>=== Testing Library Functions ===
Hello User from mylib!
10 + 20 = 30
</code></pre>
</li>
<li><strong>ldd 輸出</strong>：顯示載入的動態函式庫路徑</li>
<li><strong>readelf 輸出</strong>：顯示 RPATH 和 NEEDED 資訊</li>
<li><strong>nm 輸出</strong>：顯示符號表中的函數</li>
<li><strong>objdump 輸出</strong>：另一種查看方式</li>
</ol>
<h3 id="實驗建議"><a class="header" href="#實驗建議">實驗建議</a></h3>
<pre><code class="language-bash"># 實驗 1: 移除 RPATH 看看會發生什麼
# 在 Makefile 中註解掉 RPATH 這行，重新編譯
# 執行時會找不到 libmylib.so

# 實驗 2: 比較不同工具的輸出
ldd build/main                    # 最直觀
readelf -d build/main             # 最詳細
objdump -p build/main             # 另一種格式
nm -D build/libmylib.so           # 查看符號

# 實驗 3: 查看特定資訊
readelf -d build/main | grep RPATH      # 只看 RPATH
readelf -d build/main | grep NEEDED     # 只看依賴
nm -D build/libmylib.so | grep " T "    # 只看已定義函數
</code></pre>
<h3 id="專案結構說明"><a class="header" href="#專案結構說明">專案結構說明</a></h3>
<pre><code>test_makefile/
├── include/
│   └── mylib.h           # 標頭檔 (對應 -I 參數)
├── lib/
│   └── mylib.c           # 函式庫原始碼
├── src/
│   └── main.c            # 主程式原始碼
├── build/                # 輸出目錄 (對應 -L 和 -rpath)
│   ├── libmylib.so       # 編譯出的動態函式庫
│   └── main              # 編譯出的執行檔
├── Makefile              # 建構腳本
└── test_all.sh           # 測試腳本
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../linux_system/performance.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../linux_system/linux-process-thread-guide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../linux_system/performance.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../linux_system/linux-process-thread-guide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
