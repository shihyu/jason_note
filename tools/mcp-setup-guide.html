<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MCP Setup Guide - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="linux-mcp-服務器完整設置指南"><a class="header" href="#linux-mcp-服務器完整設置指南">Linux MCP 服務器完整設置指南</a></h1>
<h2 id="專案結構"><a class="header" href="#專案結構">專案結構</a></h2>
<pre><code>~/mcp-servers/
└── my-first-server/
    ├── server.py           # MCP 服務器主程式
    ├── requirements.txt    # Python 依賴
    └── venv/              # Python 虛擬環境
</code></pre>
<h2 id="步驟-1創建專案資料夾"><a class="header" href="#步驟-1創建專案資料夾">步驟 1：創建專案資料夾</a></h2>
<pre><code class="language-bash"># 創建 MCP 服務器目錄
mkdir -p ~/mcp-servers/my-first-server
cd ~/mcp-servers/my-first-server
</code></pre>
<h2 id="步驟-2創建-serverpy"><a class="header" href="#步驟-2創建-serverpy">步驟 2：創建 server.py</a></h2>
<pre><code class="language-bash">nano ~/mcp-servers/my-first-server/server.py
</code></pre>
<p>內容：</p>
<pre><code class="language-python">#!/usr/bin/env python3
"""Linux MCP 服務器"""

from mcp.server import Server
import mcp.server.stdio
import mcp.types as types
from datetime import datetime
import os
import subprocess

# 創建服務器實例
server = Server("linux-tools")

# 定義可用的工具
@server.list_tools()
async def list_tools():
    """列出所有可用的工具"""
    return [
        types.Tool(
            name="get_system_info",
            description="獲取 Linux 系統資訊",
            inputSchema={
                "type": "object",
                "properties": {}
            }
        ),
        types.Tool(
            name="list_directory",
            description="列出目錄內容",
            inputSchema={
                "type": "object",
                "properties": {
                    "path": {
                        "type": "string",
                        "description": "目錄路徑",
                        "default": "."
                    }
                },
                "required": []
            }
        ),
        types.Tool(
            name="execute_command",
            description="執行簡單的 Linux 命令",
            inputSchema={
                "type": "object",
                "properties": {
                    "command": {
                        "type": "string",
                        "description": "要執行的命令（安全命令）"
                    }
                },
                "required": ["command"]
            }
        )
    ]

# 處理工具調用
@server.call_tool()
async def call_tool(name: str, arguments: dict):
    """執行具體的工具功能"""
    
    if name == "get_system_info":
        # 獲取系統資訊
        info = []
        try:
            # 系統版本
            with open('/etc/os-release', 'r') as f:
                lines = f.readlines()
                for line in lines[:3]:
                    info.append(line.strip())
            
            # 核心版本
            kernel = subprocess.check_output(['uname', '-r'], text=True).strip()
            info.append(f"Kernel: {kernel}")
            
            # 當前時間
            info.append(f"Time: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
            
        except Exception as e:
            info.append(f"Error: {str(e)}")
        
        return [types.TextContent(
            type="text",
            text="\n".join(info)
        )]
    
    elif name == "list_directory":
        path = arguments.get("path", ".")
        path = os.path.expanduser(path)  # 處理 ~ 符號
        
        try:
            items = os.listdir(path)
            result = f"目錄 {path} 的內容：\n"
            for item in sorted(items):
                full_path = os.path.join(path, item)
                if os.path.isdir(full_path):
                    result += f"📁 {item}/\n"
                else:
                    result += f"📄 {item}\n"
        except Exception as e:
            result = f"錯誤：{str(e)}"
        
        return [types.TextContent(
            type="text",
            text=result
        )]
    
    elif name == "execute_command":
        command = arguments.get("command")
        
        # 安全命令白名單
        safe_commands = ["date", "pwd", "whoami", "hostname", "uptime", "df", "free"]
        cmd_parts = command.split()
        
        if cmd_parts[0] not in safe_commands:
            return [types.TextContent(
                type="text",
                text=f"命令 '{cmd_parts[0]}' 不在安全命令清單中"
            )]
        
        try:
            result = subprocess.check_output(command, shell=True, text=True, timeout=5)
        except subprocess.TimeoutExpired:
            result = "命令執行超時"
        except Exception as e:
            result = f"執行錯誤：{str(e)}"
        
        return [types.TextContent(
            type="text",
            text=result
        )]
    
    else:
        raise ValueError(f"未知的工具: {name}")

# 主程式
async def main():
    """啟動 MCP 服務器"""
    async with mcp.server.stdio.stdio_server() as (read_stream, write_stream):
        await server.run(
            read_stream,
            write_stream,
            server.get_capabilities()
        )

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
</code></pre>
<h2 id="步驟-3設置執行權限"><a class="header" href="#步驟-3設置執行權限">步驟 3：設置執行權限</a></h2>
<pre><code class="language-bash">chmod +x ~/mcp-servers/my-first-server/server.py
</code></pre>
<h2 id="步驟-4創建-requirementstxt"><a class="header" href="#步驟-4創建-requirementstxt">步驟 4：創建 requirements.txt</a></h2>
<pre><code class="language-bash">echo "mcp&gt;=0.1.0" &gt; ~/mcp-servers/my-first-server/requirements.txt
</code></pre>
<h2 id="步驟-5設置-python-虛擬環境"><a class="header" href="#步驟-5設置-python-虛擬環境">步驟 5：設置 Python 虛擬環境</a></h2>
<pre><code class="language-bash"># 進入專案目錄
cd ~/mcp-servers/my-first-server

# 創建虛擬環境
python3 -m venv venv

# 啟動虛擬環境
source venv/bin/activate

# 升級 pip
pip install --upgrade pip

# 安裝 MCP
pip install mcp
</code></pre>
<h2 id="步驟-6配置-claude-desktop"><a class="header" href="#步驟-6配置-claude-desktop">步驟 6：配置 Claude Desktop</a></h2>
<h3 id="配置檔位置"><a class="header" href="#配置檔位置">配置檔位置</a></h3>
<pre><code class="language-bash">~/.config/Claude/claude_desktop_config.json
</code></pre>
<p>完整路徑（假設用戶名為 username）：</p>
<pre><code class="language-bash">/home/username/.config/Claude/claude_desktop_config.json
</code></pre>
<h3 id="創建配置目錄如果不存在"><a class="header" href="#創建配置目錄如果不存在">創建配置目錄（如果不存在）</a></h3>
<pre><code class="language-bash">mkdir -p ~/.config/Claude
</code></pre>
<h3 id="編輯配置檔"><a class="header" href="#編輯配置檔">編輯配置檔</a></h3>
<pre><code class="language-bash">nano ~/.config/Claude/claude_desktop_config.json
</code></pre>
<h3 id="配置檔內容使用虛擬環境"><a class="header" href="#配置檔內容使用虛擬環境">配置檔內容（使用虛擬環境）</a></h3>
<pre><code class="language-json">{
  "mcpServers": {
    "linux-tools": {
      "command": "/home/username/mcp-servers/my-first-server/venv/bin/python",
      "args": ["/home/username/mcp-servers/my-first-server/server.py"],
      "env": {}
    }
  }
}
</code></pre>
<h3 id="動態獲取用戶路徑的配置"><a class="header" href="#動態獲取用戶路徑的配置">動態獲取用戶路徑的配置</a></h3>
<p>如果想要更通用的配置，可以使用環境變數：</p>
<pre><code class="language-json">{
  "mcpServers": {
    "linux-tools": {
      "command": "bash",
      "args": ["-c", "source ~/mcp-servers/my-first-server/venv/bin/activate &amp;&amp; python ~/mcp-servers/my-first-server/server.py"],
      "env": {}
    }
  }
}
</code></pre>
<h2 id="步驟-7驗證設置"><a class="header" href="#步驟-7驗證設置">步驟 7：驗證設置</a></h2>
<pre><code class="language-bash"># 檢查 Python 路徑
which python3

# 檢查虛擬環境 Python
ls -la ~/mcp-servers/my-first-server/venv/bin/python

# 測試服務器（手動）
cd ~/mcp-servers/my-first-server
source venv/bin/activate
python server.py
# Ctrl+C 結束測試
</code></pre>
<h2 id="步驟-8重啟-claude-desktop"><a class="header" href="#步驟-8重啟-claude-desktop">步驟 8：重啟 Claude Desktop</a></h2>
<pre><code class="language-bash"># 如果 Claude 正在運行，先關閉
pkill -f claude

# 重新啟動 Claude Desktop
# (根據你的安裝方式啟動 Claude)
</code></pre>
<h2 id="完整路徑速查表"><a class="header" href="#完整路徑速查表">完整路徑速查表</a></h2>
<p>假設用戶名是 <code>john</code>：</p>
<pre><code class="language-bash"># 專案根目錄
/home/john/mcp-servers/my-first-server/

# 服務器腳本
/home/john/mcp-servers/my-first-server/server.py

# Python 虛擬環境執行檔
/home/john/mcp-servers/my-first-server/venv/bin/python

# Claude 配置檔
/home/john/.config/Claude/claude_desktop_config.json
</code></pre>
<h2 id="多個服務器配置範例"><a class="header" href="#多個服務器配置範例">多個服務器配置範例</a></h2>
<pre><code class="language-json">{
  "mcpServers": {
    "linux-tools": {
      "command": "/home/john/mcp-servers/my-first-server/venv/bin/python",
      "args": ["/home/john/mcp-servers/my-first-server/server.py"]
    },
    "web-scraper": {
      "command": "/home/john/mcp-servers/web-scraper/venv/bin/python",
      "args": ["/home/john/mcp-servers/web-scraper/server.py"]
    },
    "database-tool": {
      "command": "/usr/bin/node",
      "args": ["/home/john/mcp-servers/database/index.js"]
    }
  }
}
</code></pre>
<h2 id="除錯技巧"><a class="header" href="#除錯技巧">除錯技巧</a></h2>
<h3 id="1-查看-claude-日誌"><a class="header" href="#1-查看-claude-日誌">1. 查看 Claude 日誌</a></h3>
<pre><code class="language-bash"># Claude 日誌位置
tail -f ~/.config/Claude/logs/*.log
</code></pre>
<h3 id="2-測試-mcp-服務器"><a class="header" href="#2-測試-mcp-服務器">2. 測試 MCP 服務器</a></h3>
<pre><code class="language-bash"># 直接執行測試
cd ~/mcp-servers/my-first-server
source venv/bin/activate
python -c "import mcp; print('MCP 安裝成功')"
</code></pre>
<h3 id="3-檢查程序是否運行"><a class="header" href="#3-檢查程序是否運行">3. 檢查程序是否運行</a></h3>
<pre><code class="language-bash"># 查看 MCP 相關程序
ps aux | grep -E "mcp|claude"
</code></pre>
<h3 id="4-權限檢查"><a class="header" href="#4-權限檢查">4. 權限檢查</a></h3>
<pre><code class="language-bash"># 確保所有檔案有正確權限
ls -la ~/mcp-servers/my-first-server/
ls -la ~/.config/Claude/
</code></pre>
<h2 id="常見問題解決"><a class="header" href="#常見問題解決">常見問題解決</a></h2>
<h3 id="問題-1找不到-mcp-模組"><a class="header" href="#問題-1找不到-mcp-模組">問題 1：找不到 MCP 模組</a></h3>
<pre><code class="language-bash"># 確保在虛擬環境中安裝
cd ~/mcp-servers/my-first-server
source venv/bin/activate
pip install mcp
</code></pre>
<h3 id="問題-2配置檔不生效"><a class="header" href="#問題-2配置檔不生效">問題 2：配置檔不生效</a></h3>
<pre><code class="language-bash"># 檢查 JSON 格式
python3 -m json.tool ~/.config/Claude/claude_desktop_config.json
</code></pre>
<h3 id="問題-3python-版本問題"><a class="header" href="#問題-3python-版本問題">問題 3：Python 版本問題</a></h3>
<pre><code class="language-bash"># 檢查 Python 版本（需要 3.8+）
python3 --version

# 如果版本太舊，安裝新版
sudo apt update
sudo apt install python3.10 python3.10-venv
</code></pre>
<h2 id="快速安裝腳本"><a class="header" href="#快速安裝腳本">快速安裝腳本</a></h2>
<p>創建一個快速安裝腳本 <code>setup-mcp.sh</code>：</p>
<pre><code class="language-bash">#!/bin/bash

# 設置變數
MCP_DIR="$HOME/mcp-servers/my-first-server"
CONFIG_DIR="$HOME/.config/Claude"

# 創建目錄
mkdir -p "$MCP_DIR"
mkdir -p "$CONFIG_DIR"

# 創建虛擬環境並安裝
cd "$MCP_DIR"
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install mcp

# 創建配置檔
cat &gt; "$CONFIG_DIR/claude_desktop_config.json" &lt;&lt; EOF
{
  "mcpServers": {
    "linux-tools": {
      "command": "$MCP_DIR/venv/bin/python",
      "args": ["$MCP_DIR/server.py"],
      "env": {}
    }
  }
}
EOF

echo "✅ MCP 服務器設置完成！"
echo "📁 服務器位置：$MCP_DIR"
echo "📄 配置檔位置：$CONFIG_DIR/claude_desktop_config.json"
echo "🔄 請重啟 Claude Desktop"
</code></pre>
<p>執行安裝腳本：</p>
<pre><code class="language-bash">chmod +x setup-mcp.sh
./setup-mcp.sh
</code></pre>
<p>這樣就完成了 Linux 上的 MCP 服務器設置！</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../tools/thinking-protocol-zh-tw.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../tools/open_source_licenses_guide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../tools/thinking-protocol-zh-tw.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../tools/open_source_licenses_guide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
