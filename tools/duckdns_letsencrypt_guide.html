<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DuckDNS + Let&#x27;s Encrypt ä¸€éµå®‰è£æŒ‡å— - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="duckdns--lets-encrypt-ä¸€éµå®‰è£æŒ‡å—"><a class="header" href="#duckdns--lets-encrypt-ä¸€éµå®‰è£æŒ‡å—">DuckDNS + Let's Encrypt ä¸€éµå®‰è£æŒ‡å—</a></h1>
<h2 id="-ç°¡ä»‹"><a class="header" href="#-ç°¡ä»‹">ğŸ“– ç°¡ä»‹</a></h2>
<p>é€™å€‹æŒ‡å—æä¾›ä¸€å€‹å®Œæ•´çš„è‡ªå‹•åŒ–è…³æœ¬ï¼Œå¹«ä½ å¿«é€Ÿè¨­å®šï¼š</p>
<ul>
<li><strong>DuckDNS</strong> å…è²»å‹•æ…‹ DNS æœå‹™</li>
<li><strong>Let's Encrypt</strong> å…è²» SSL æ†‘è­‰</li>
<li><strong>Nginx</strong> ç¶²é ä¼ºæœå™¨é…ç½®</li>
<li><strong>è‡ªå‹•åŒ–æ›´æ–°</strong> IP å’Œ SSL æ†‘è­‰</li>
</ul>
<p>å®Œæˆå¾Œä½ å°‡æ“æœ‰ä¸€å€‹å®Œå…¨å…è²»ã€å®‰å…¨çš„ HTTPS ç¶²ç«™ï¼</p>
<hr />
<h2 id="-åŠŸèƒ½ç‰¹è‰²"><a class="header" href="#-åŠŸèƒ½ç‰¹è‰²">ğŸš€ åŠŸèƒ½ç‰¹è‰²</a></h2>
<h3 id="-è‡ªå‹•åŒ–å®‰è£"><a class="header" href="#-è‡ªå‹•åŒ–å®‰è£">âœ… è‡ªå‹•åŒ–å®‰è£</a></h3>
<ul>
<li>ä¸€éµå®‰è£æ‰€æœ‰å¿…è¦å¥—ä»¶</li>
<li>è‡ªå‹•é…ç½®æ‰€æœ‰æœå‹™</li>
<li>æ™ºèƒ½éŒ¯èª¤æª¢æ¸¬å’Œè™•ç†</li>
</ul>
<h3 id="-duckdns-è¨­å®š"><a class="header" href="#-duckdns-è¨­å®š">âœ… DuckDNS è¨­å®š</a></h3>
<ul>
<li>è‡ªå‹•å‰µå»ºæ›´æ–°è…³æœ¬</li>
<li>æ¯ 5 åˆ†é˜è‡ªå‹•æ›´æ–° IP</li>
<li>è©³ç´°çš„é‹è¡Œæ—¥èªŒ</li>
</ul>
<h3 id="-ssl-æ†‘è­‰ç®¡ç†"><a class="header" href="#-ssl-æ†‘è­‰ç®¡ç†">âœ… SSL æ†‘è­‰ç®¡ç†</a></h3>
<ul>
<li>è‡ªå‹•ç”³è«‹ Let's Encrypt æ†‘è­‰</li>
<li>90 å¤©åˆ°æœŸå‰è‡ªå‹•æ›´æ–°</li>
<li>å®Œæ•´çš„ HTTPS é‡å®šå‘</li>
</ul>
<h3 id="-nginx-é…ç½®"><a class="header" href="#-nginx-é…ç½®">âœ… Nginx é…ç½®</a></h3>
<ul>
<li>æœ€ä½³åŒ–çš„å®‰å…¨è¨­å®š</li>
<li>ç¾è§€çš„é è¨­é¦–é </li>
<li>æº–å‚™å¥½çš„åå‘ä»£ç†é…ç½®</li>
</ul>
<hr />
<h2 id="-å‰ç½®æº–å‚™"><a class="header" href="#-å‰ç½®æº–å‚™">ğŸ“‹ å‰ç½®æº–å‚™</a></h2>
<h3 id="1-duckdns-å¸³æˆ¶è¨­å®š"><a class="header" href="#1-duckdns-å¸³æˆ¶è¨­å®š">1. DuckDNS å¸³æˆ¶è¨­å®š</a></h3>
<pre><code class="language-bash"># 1. å‰å¾€ https://www.duckdns.org
# 2. ä½¿ç”¨ GitHub/Google å¸³æˆ¶ç™»å…¥
# 3. å‰µå»ºä¸€å€‹å­ç¶²åŸŸï¼Œä¾‹å¦‚ï¼šmyserver
# 4. è¨˜ä¸‹ä½ çš„ Tokenï¼ˆé¡ä¼¼ï¼ša7c4d0ad-114e-40ef-ba1d-d217904a50f2ï¼‰
</code></pre>
<h3 id="2-ä¼ºæœå™¨éœ€æ±‚"><a class="header" href="#2-ä¼ºæœå™¨éœ€æ±‚">2. ä¼ºæœå™¨éœ€æ±‚</a></h3>
<ul>
<li><strong>ä½œæ¥­ç³»çµ±</strong>ï¼šUbuntu 18.04+ æˆ– Debian 9+</li>
<li><strong>æ¬Šé™</strong>ï¼šsudo æˆ– root å­˜å–æ¬Šé™</li>
<li><strong>ç¶²è·¯</strong>ï¼šå¯é€£æ¥å¤–ç¶²çš„ä¼ºæœå™¨</li>
<li><strong>ç«¯å£</strong>ï¼š80 å’Œ 443 ç«¯å£å°å¤–é–‹æ”¾</li>
</ul>
<hr />
<h2 id="-ä¸€éµå®‰è£è…³æœ¬"><a class="header" href="#-ä¸€éµå®‰è£è…³æœ¬">ğŸ› ï¸ ä¸€éµå®‰è£è…³æœ¬</a></h2>
<h3 id="å‰µå»ºå®‰è£è…³æœ¬"><a class="header" href="#å‰µå»ºå®‰è£è…³æœ¬">å‰µå»ºå®‰è£è…³æœ¬</a></h3>
<p>å‰µå»ºæª”æ¡ˆ <code>setup_duckdns_ssl.sh</code>ï¼š</p>
<pre><code class="language-bash">#!/bin/bash

# DuckDNS + Let's Encrypt è‡ªå‹•åŒ–å®‰è£è…³æœ¬
# ä½¿ç”¨æ–¹æ³•: sudo bash setup_duckdns_ssl.sh

set -e

# é¡è‰²å®šç¾©
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# è¼¸å‡ºå‡½æ•¸
print_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

print_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# æª¢æŸ¥æ˜¯å¦ç‚º root ç”¨æˆ¶
check_root() {
    if [[ $EUID -ne 0 ]]; then
        print_error "æ­¤è…³æœ¬éœ€è¦ root æ¬Šé™é‹è¡Œ"
        print_info "è«‹ä½¿ç”¨: sudo bash $0"
        exit 1
    fi
}

# ç²å–ç”¨æˆ¶è¼¸å…¥
get_user_input() {
    print_info "=== DuckDNS + Let's Encrypt è¨­å®š ==="
    echo
    
    # DuckDNS è¨­å®š
    read -p "è«‹è¼¸å…¥ä½ çš„ DuckDNS å­ç¶²åŸŸåç¨± (ä¸å« .duckdns.org): " DUCKDNS_DOMAIN
    if [[ -z "$DUCKDNS_DOMAIN" ]]; then
        print_error "ç¶²åŸŸåç¨±ä¸èƒ½ç‚ºç©º"
        exit 1
    fi
    
    read -p "è«‹è¼¸å…¥ä½ çš„ DuckDNS Token: " DUCKDNS_TOKEN
    if [[ -z "$DUCKDNS_TOKEN" ]]; then
        print_error "Token ä¸èƒ½ç‚ºç©º"
        exit 1
    fi
    
    # ç”¨æˆ¶è¨­å®š
    read -p "è«‹è¼¸å…¥è¦é‹è¡Œ DuckDNS æ›´æ–°çš„ç”¨æˆ¶åç¨± (é è¨­: $SUDO_USER): " DUCK_USER
    DUCK_USER=${DUCK_USER:-$SUDO_USER}
    if [[ -z "$DUCK_USER" ]]; then
        print_error "ç”¨æˆ¶åç¨±ä¸èƒ½ç‚ºç©º"
        exit 1
    fi
    
    # ç¢ºèªè¨­å®š
    echo
    print_info "=== è¨­å®šç¢ºèª ==="
    echo "ç¶²åŸŸ: ${DUCKDNS_DOMAIN}.duckdns.org"
    echo "Token: ${DUCKDNS_TOKEN:0:8}..."
    echo "ç”¨æˆ¶: $DUCK_USER"
    echo
    read -p "ç¢ºèªä»¥ä¸Šè¨­å®šæ­£ç¢ºå—? (y/N): " confirm
    if [[ ! "$confirm" =~ ^[Yy]$ ]]; then
        print_warning "å®‰è£å·²å–æ¶ˆ"
        exit 0
    fi
}

# å®‰è£å¿…è¦å¥—ä»¶
install_packages() {
    print_info "æ›´æ–°å¥—ä»¶åˆ—è¡¨ä¸¦å®‰è£å¿…è¦å·¥å…·..."
    
    apt update
    apt install -y curl cron certbot python3-certbot-nginx nginx
    
    print_success "å¥—ä»¶å®‰è£å®Œæˆ"
}

# è¨­å®š DuckDNS
setup_duckdns() {
    print_info "è¨­å®š DuckDNS..."
    
    # å–å¾—ç”¨æˆ¶å®¶ç›®éŒ„
    USER_HOME=$(eval echo ~$DUCK_USER)
    DUCKDNS_DIR="$USER_HOME/duckdns"
    
    # å‰µå»ºç›®éŒ„
    mkdir -p "$DUCKDNS_DIR"
    
    # å‰µå»ºæ›´æ–°è…³æœ¬
    cat &gt; "$DUCKDNS_DIR/duck.sh" &lt;&lt; EOF
#!/bin/bash
# DuckDNS è‡ªå‹•æ›´æ–°è…³æœ¬
# ç”± setup_duckdns_ssl.sh è‡ªå‹•ç”Ÿæˆ

DOMAIN="$DUCKDNS_DOMAIN"
TOKEN="$DUCKDNS_TOKEN"
LOG_FILE="\$HOME/duckdns/duck.log"

# è¨˜éŒ„æ™‚é–“
echo "\$(date): é–‹å§‹æ›´æ–° DuckDNS IP" &gt;&gt; "\$LOG_FILE"

# æ›´æ–° IP
curl -s "https://www.duckdns.org/update?domains=\$DOMAIN&amp;token=\$TOKEN" -o "\$LOG_FILE.tmp"

# æª¢æŸ¥çµæœ
if grep -q "OK" "\$LOG_FILE.tmp"; then
    echo "\$(date): IP æ›´æ–°æˆåŠŸ" &gt;&gt; "\$LOG_FILE"
else
    echo "\$(date): IP æ›´æ–°å¤±æ•—" &gt;&gt; "\$LOG_FILE"
    cat "\$LOG_FILE.tmp" &gt;&gt; "\$LOG_FILE"
fi

rm -f "\$LOG_FILE.tmp"
EOF
    
    # è¨­å®šæ¬Šé™
    chmod +x "$DUCKDNS_DIR/duck.sh"
    chown -R $DUCK_USER:$DUCK_USER "$DUCKDNS_DIR"
    
    # åŸ·è¡Œä¸€æ¬¡æ¸¬è©¦
    print_info "æ¸¬è©¦ DuckDNS æ›´æ–°..."
    sudo -u $DUCK_USER "$DUCKDNS_DIR/duck.sh"
    
    if grep -q "OK" "$DUCKDNS_DIR/duck.log"; then
        print_success "DuckDNS è¨­å®šæˆåŠŸ"
    else
        print_error "DuckDNS æ¸¬è©¦å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Token å’Œç¶²åŸŸåç¨±"
        cat "$DUCKDNS_DIR/duck.log"
        exit 1
    fi
}

# è¨­å®š crontab
setup_crontab() {
    print_info "è¨­å®š DuckDNS è‡ªå‹•æ›´æ–° (æ¯5åˆ†é˜)..."
    
    USER_HOME=$(eval echo ~$DUCK_USER)
    CRON_CMD="*/5 * * * * $USER_HOME/duckdns/duck.sh"
    
    # æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„ cron job
    if sudo -u $DUCK_USER crontab -l 2&gt;/dev/null | grep -q "duck.sh"; then
        print_warning "DuckDNS cron job å·²å­˜åœ¨ï¼Œè·³éè¨­å®š"
    else
        # æ·»åŠ  cron job
        (sudo -u $DUCK_USER crontab -l 2&gt;/dev/null; echo "$CRON_CMD") | sudo -u $DUCK_USER crontab -
        print_success "DuckDNS è‡ªå‹•æ›´æ–°å·²è¨­å®š"
    fi
}

# ç­‰å¾… DNS å‚³æ’­
wait_dns_propagation() {
    print_info "ç­‰å¾… DNS è¨˜éŒ„å‚³æ’­..."
    FULL_DOMAIN="${DUCKDNS_DOMAIN}.duckdns.org"
    
    for i in {1..12}; do
        if nslookup "$FULL_DOMAIN" &gt; /dev/null 2&gt;&amp;1; then
            print_success "DNS è¨˜éŒ„å·²ç”Ÿæ•ˆ"
            return 0
        fi
        print_info "ç­‰å¾… DNS å‚³æ’­... ($i/12)"
        sleep 10
    done
    
    print_warning "DNS å‚³æ’­å¯èƒ½éœ€è¦æ›´é•·æ™‚é–“ï¼Œç¹¼çºŒé€²è¡Œ SSL è¨­å®š"
}

# åŸºæœ¬ Nginx è¨­å®š
setup_nginx_basic() {
    print_info "è¨­å®šåŸºæœ¬ Nginx é…ç½®..."
    
    FULL_DOMAIN="${DUCKDNS_DOMAIN}.duckdns.org"
    NGINX_CONF="/etc/nginx/sites-available/$DUCKDNS_DOMAIN"
    
    # å‰µå»ºåŸºæœ¬é…ç½®ï¼ˆHTTP onlyï¼Œç‚ºäº† Let's Encrypt é©—è­‰ï¼‰
    cat &gt; "$NGINX_CONF" &lt;&lt; EOF
server {
    listen 80;
    server_name $FULL_DOMAIN;
    
    # Let's Encrypt é©—è­‰è·¯å¾‘
    location /.well-known/acme-challenge/ {
        root /var/www/html;
    }
    
    # è‡¨æ™‚é¦–é 
    location / {
        root /var/www/html;
        index index.html;
    }
}
EOF
    
    # å‰µå»ºç°¡å–®çš„é¦–é 
    cat &gt; "/var/www/html/index.html" &lt;&lt; EOF
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;$FULL_DOMAIN&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 100px; }
        .container { max-width: 600px; margin: 0 auto; }
        .success { color: #28a745; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1 class="success"&gt;ğŸ‰ ç¶²ç«™è¨­å®šæˆåŠŸï¼&lt;/h1&gt;
        &lt;p&gt;ä½ çš„ç¶²åŸŸ &lt;strong&gt;$FULL_DOMAIN&lt;/strong&gt; å·²ç¶“å¯ä»¥æ­£å¸¸è¨ªå•äº†ã€‚&lt;/p&gt;
        &lt;p&gt;SSL æ†‘è­‰æ­£åœ¨è¨­å®šä¸­...&lt;/p&gt;
        &lt;hr&gt;
        &lt;p&gt;&lt;small&gt;Powered by DuckDNS + Let's Encrypt&lt;/small&gt;&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF
    
    # å•Ÿç”¨ç¶²ç«™
    ln -sf "$NGINX_CONF" "/etc/nginx/sites-enabled/"
    
    # ç§»é™¤é è¨­ç¶²ç«™
    rm -f /etc/nginx/sites-enabled/default
    
    # æ¸¬è©¦é…ç½®
    nginx -t
    systemctl reload nginx
    
    print_success "åŸºæœ¬ Nginx é…ç½®å®Œæˆ"
}

# ç”³è«‹ Let's Encrypt SSL æ†‘è­‰
setup_ssl() {
    print_info "ç”³è«‹ Let's Encrypt SSL æ†‘è­‰..."
    
    FULL_DOMAIN="${DUCKDNS_DOMAIN}.duckdns.org"
    EMAIL="admin@${FULL_DOMAIN}"
    
    # ç”³è«‹æ†‘è­‰
    certbot --nginx \
        --non-interactive \
        --agree-tos \
        --email "$EMAIL" \
        --domains "$FULL_DOMAIN" \
        --redirect
    
    if [[ $? -eq 0 ]]; then
        print_success "SSL æ†‘è­‰ç”³è«‹æˆåŠŸ"
    else
        print_error "SSL æ†‘è­‰ç”³è«‹å¤±æ•—"
        return 1
    fi
}

# è¨­å®š SSL è‡ªå‹•æ›´æ–°
setup_ssl_auto_renewal() {
    print_info "è¨­å®š SSL æ†‘è­‰è‡ªå‹•æ›´æ–°..."
    
    # æª¢æŸ¥æ˜¯å¦å·²æœ‰è‡ªå‹•æ›´æ–°è¨­å®š
    if crontab -l 2&gt;/dev/null | grep -q "certbot renew"; then
        print_warning "SSL è‡ªå‹•æ›´æ–°å·²è¨­å®šï¼Œè·³é"
    else
        # æ·»åŠ è‡ªå‹•æ›´æ–° cron job (æ¯å¤©å‡Œæ™¨3é»æª¢æŸ¥)
        (crontab -l 2&gt;/dev/null; echo "0 3 * * * /usr/bin/certbot renew --quiet --nginx") | crontab -
        print_success "SSL è‡ªå‹•æ›´æ–°å·²è¨­å®š"
    fi
}

# æœ€çµ‚æª¢æŸ¥å’Œå„ªåŒ–
final_optimization() {
    print_info "é€²è¡Œæœ€çµ‚å„ªåŒ–..."
    
    FULL_DOMAIN="${DUCKDNS_DOMAIN}.duckdns.org"
    
    # æ›´æ–°é¦–é ï¼Œç§»é™¤ "SSL è¨­å®šä¸­" è¨Šæ¯
    cat &gt; "/var/www/html/index.html" &lt;&lt; EOF
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;$FULL_DOMAIN&lt;/title&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;style&gt;
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            text-align: center; 
            margin: 0;
            padding: 50px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .success { color: #4CAF50; }
        .badge { 
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin: 10px 5px;
        }
        .info { 
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;ğŸ‰ æ­å–œï¼ç¶²ç«™è¨­å®šå®Œæˆ&lt;/h1&gt;
        &lt;div class="badge"&gt;âœ… HTTPS å·²å•Ÿç”¨&lt;/div&gt;
        &lt;div class="badge"&gt;ğŸ”’ SSL æ†‘è­‰æœ‰æ•ˆ&lt;/div&gt;
        &lt;div class="badge"&gt;ğŸ”„ è‡ªå‹•æ›´æ–°&lt;/div&gt;
        
        &lt;div class="info"&gt;
            &lt;h3&gt;ç¶²ç«™è³‡è¨Š&lt;/h3&gt;
            &lt;p&gt;&lt;strong&gt;ç¶²åŸŸ:&lt;/strong&gt; $FULL_DOMAIN&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;æœå‹™:&lt;/strong&gt; DuckDNS + Let's Encrypt&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;ç‹€æ…‹:&lt;/strong&gt; &lt;span class="success"&gt;é‹è¡Œæ­£å¸¸&lt;/span&gt;&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;p&gt;ä½ çš„ç¶²ç«™ç¾åœ¨å·²ç¶“:&lt;/p&gt;
        &lt;ul style="text-align: left; display: inline-block;"&gt;
            &lt;li&gt;âœ… æ”¯æ´ HTTPS å®‰å…¨é€£ç·š&lt;/li&gt;
            &lt;li&gt;âœ… SSL æ†‘è­‰è‡ªå‹•æ›´æ–°&lt;/li&gt;
            &lt;li&gt;âœ… DuckDNS IP è‡ªå‹•åŒæ­¥&lt;/li&gt;
            &lt;li&gt;âœ… æº–å‚™å¥½éƒ¨ç½²ä½ çš„æ‡‰ç”¨&lt;/li&gt;
        &lt;/ul&gt;
        
        &lt;hr style="margin: 30px 0; border: 1px solid rgba(255,255,255,0.3);"&gt;
        &lt;p&gt;&lt;small&gt;Generated by DuckDNS + Let's Encrypt Auto Setup Script&lt;/small&gt;&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF
    
    # æª¢æŸ¥æœå‹™ç‹€æ…‹
    systemctl enable nginx
    systemctl enable cron
    
    print_success "æœ€çµ‚å„ªåŒ–å®Œæˆ"
}

# é¡¯ç¤ºå®Œæˆè³‡è¨Š
show_completion_info() {
    FULL_DOMAIN="${DUCKDNS_DOMAIN}.duckdns.org"
    USER_HOME=$(eval echo ~$DUCK_USER)
    
    echo
    print_success "=== å®‰è£å®Œæˆï¼ ==="
    echo
    echo "ğŸ“‹ å®‰è£æ‘˜è¦:"
    echo "  ğŸŒ ç¶²åŸŸ: https://$FULL_DOMAIN"
    echo "  ğŸ”’ SSL: Let's Encrypt (90å¤©è‡ªå‹•æ›´æ–°)"
    echo "  ğŸ”„ DuckDNS: æ¯5åˆ†é˜è‡ªå‹•æ›´æ–°IP"
    echo "  ğŸ‘¤ é‹è¡Œç”¨æˆ¶: $DUCK_USER"
    echo
    echo "ğŸ“ é‡è¦æª”æ¡ˆä½ç½®:"
    echo "  DuckDNS è…³æœ¬: $USER_HOME/duckdns/duck.sh"
    echo "  DuckDNS æ—¥èªŒ: $USER_HOME/duckdns/duck.log"
    echo "  Nginx é…ç½®: /etc/nginx/sites-available/$DUCKDNS_DOMAIN"
    echo "  SSL æ†‘è­‰: /etc/letsencrypt/live/$FULL_DOMAIN/"
    echo
    echo "ğŸ”§ å¸¸ç”¨ç®¡ç†æŒ‡ä»¤:"
    echo "  æŸ¥çœ‹ DuckDNS æ—¥èªŒ: tail -f $USER_HOME/duckdns/duck.log"
    echo "  æ‰‹å‹•æ›´æ–° DuckDNS: $USER_HOME/duckdns/duck.sh"
    echo "  æª¢æŸ¥ SSL æ†‘è­‰: certbot certificates"
    echo "  æ‰‹å‹•æ›´æ–° SSL: sudo certbot renew"
    echo "  é‡å•Ÿ Nginx: sudo systemctl restart nginx"
    echo
    echo "ğŸ“… è‡ªå‹•åŒ–ä»»å‹™:"
    echo "  DuckDNS æ›´æ–°: æ¯5åˆ†é˜"
    echo "  SSL æ†‘è­‰æ›´æ–°: æ¯å¤©å‡Œæ™¨3é»æª¢æŸ¥"
    echo
    print_info "ç¾åœ¨å¯ä»¥è¨ªå• https://$FULL_DOMAIN æ¸¬è©¦ä½ çš„ç¶²ç«™ï¼"
    echo
}

# ä¸»è¦åŸ·è¡Œæµç¨‹
main() {
    clear
    print_info "DuckDNS + Let's Encrypt è‡ªå‹•åŒ–å®‰è£è…³æœ¬"
    print_info "æ­¤è…³æœ¬å°‡å¹«ä½ è¨­å®šå…è²»çš„å‹•æ…‹DNSå’ŒSSLæ†‘è­‰"
    echo
    
    check_root
    get_user_input
    
    print_info "é–‹å§‹å®‰è£..."
    install_packages
    setup_duckdns
    setup_crontab
    wait_dns_propagation
    setup_nginx_basic
    setup_ssl
    setup_ssl_auto_renewal
    final_optimization
    
    show_completion_info
}

# åŸ·è¡Œä¸»ç¨‹å¼
main "$@"
</code></pre>
<hr />
<h2 id="-ä½¿ç”¨æ­¥é©Ÿ"><a class="header" href="#-ä½¿ç”¨æ­¥é©Ÿ">ğŸ“± ä½¿ç”¨æ­¥é©Ÿ</a></h2>
<h3 id="1-ä¸‹è¼‰ä¸¦æº–å‚™è…³æœ¬"><a class="header" href="#1-ä¸‹è¼‰ä¸¦æº–å‚™è…³æœ¬">1. ä¸‹è¼‰ä¸¦æº–å‚™è…³æœ¬</a></h3>
<pre><code class="language-bash"># å‰µå»ºè…³æœ¬æª”æ¡ˆ
nano setup_duckdns_ssl.sh

# è¤‡è£½ä¸Šé¢çš„è…³æœ¬å…§å®¹åˆ°æª”æ¡ˆä¸­
# å„²å­˜ä¸¦é€€å‡ºç·¨è¼¯å™¨

# çµ¦äºˆåŸ·è¡Œæ¬Šé™
chmod +x setup_duckdns_ssl.sh
</code></pre>
<h3 id="2-åŸ·è¡Œå®‰è£"><a class="header" href="#2-åŸ·è¡Œå®‰è£">2. åŸ·è¡Œå®‰è£</a></h3>
<pre><code class="language-bash"># ä½¿ç”¨ sudo åŸ·è¡Œè…³æœ¬
sudo bash setup_duckdns_ssl.sh
</code></pre>
<h3 id="3-è¼¸å…¥è¨­å®šè³‡è¨Š"><a class="header" href="#3-è¼¸å…¥è¨­å®šè³‡è¨Š">3. è¼¸å…¥è¨­å®šè³‡è¨Š</a></h3>
<p>è…³æœ¬æœƒä¾åºè©¢å•ï¼š</p>
<ul>
<li><strong>DuckDNS å­ç¶²åŸŸåç¨±</strong>ï¼šä¾‹å¦‚ <code>myserver</code>ï¼ˆä¸è¦åŒ…å« <code>.duckdns.org</code>ï¼‰</li>
<li><strong>DuckDNS Token</strong>ï¼šå¾ä½ çš„ DuckDNS å¸³æˆ¶é é¢è¤‡è£½</li>
<li><strong>é‹è¡Œç”¨æˆ¶</strong>ï¼šé€šå¸¸æŒ‰ Enter ä½¿ç”¨é è¨­å³å¯</li>
</ul>
<h3 id="4-ç¢ºèªè¨­å®šä¸¦ç­‰å¾…å®Œæˆ"><a class="header" href="#4-ç¢ºèªè¨­å®šä¸¦ç­‰å¾…å®Œæˆ">4. ç¢ºèªè¨­å®šä¸¦ç­‰å¾…å®Œæˆ</a></h3>
<ul>
<li>è…³æœ¬æœƒé¡¯ç¤ºè¨­å®šæ‘˜è¦ä¾›ä½ ç¢ºèª</li>
<li>ç¢ºèªå¾Œæœƒè‡ªå‹•å®‰è£å’Œé…ç½®æ‰€æœ‰æœå‹™</li>
<li>æ•´å€‹éç¨‹å¤§ç´„éœ€è¦ 5-10 åˆ†é˜</li>
</ul>
<hr />
<h2 id="-å®Œæˆå¾Œçš„çµæœ"><a class="header" href="#-å®Œæˆå¾Œçš„çµæœ">ğŸ¯ å®Œæˆå¾Œçš„çµæœ</a></h2>
<h3 id="-ä½ å°‡æ“æœ‰"><a class="header" href="#-ä½ å°‡æ“æœ‰">âœ… ä½ å°‡æ“æœ‰</a></h3>
<ul>
<li><strong>å®‰å…¨çš„ HTTPS ç¶²ç«™</strong>ï¼š<code>https://yourname.duckdns.org</code></li>
<li><strong>è‡ªå‹• IP æ›´æ–°</strong>ï¼šæ¯ 5 åˆ†é˜æª¢æŸ¥ä¸¦æ›´æ–° IP åœ°å€</li>
<li><strong>è‡ªå‹• SSL æ›´æ–°</strong>ï¼šæ†‘è­‰åˆ°æœŸå‰è‡ªå‹•æ›´æ–°</li>
<li><strong>ç¾è§€çš„é¦–é </strong>ï¼šå±•ç¤ºå®‰è£æˆåŠŸå’Œç³»çµ±ç‹€æ…‹</li>
</ul>
<h3 id="-é‡è¦æª”æ¡ˆä½ç½®"><a class="header" href="#-é‡è¦æª”æ¡ˆä½ç½®">ğŸ“ é‡è¦æª”æ¡ˆä½ç½®</a></h3>
<pre><code>~/duckdns/duck.sh              # DuckDNS æ›´æ–°è…³æœ¬
~/duckdns/duck.log             # æ›´æ–°æ—¥èªŒæª”æ¡ˆ
/etc/nginx/sites-available/    # Nginx ç¶²ç«™é…ç½®
/etc/letsencrypt/live/         # SSL æ†‘è­‰å„²å­˜ä½ç½®
/var/www/html/index.html       # ç¶²ç«™é¦–é 
</code></pre>
<hr />
<h2 id="-æ—¥å¸¸ç®¡ç†æŒ‡ä»¤"><a class="header" href="#-æ—¥å¸¸ç®¡ç†æŒ‡ä»¤">ğŸ”§ æ—¥å¸¸ç®¡ç†æŒ‡ä»¤</a></h2>
<h3 id="duckdns-ç®¡ç†"><a class="header" href="#duckdns-ç®¡ç†">DuckDNS ç®¡ç†</a></h3>
<pre><code class="language-bash"># æŸ¥çœ‹æ›´æ–°æ—¥èªŒ
tail -f ~/duckdns/duck.log

# æ‰‹å‹•åŸ·è¡Œæ›´æ–°
~/duckdns/duck.sh

# æŸ¥çœ‹ cron ä»»å‹™
crontab -l
</code></pre>
<h3 id="ssl-æ†‘è­‰ç®¡ç†"><a class="header" href="#ssl-æ†‘è­‰ç®¡ç†">SSL æ†‘è­‰ç®¡ç†</a></h3>
<pre><code class="language-bash"># æª¢æŸ¥æ†‘è­‰ç‹€æ…‹
sudo certbot certificates

# æ‰‹å‹•æ›´æ–°æ†‘è­‰
sudo certbot renew

# æ¸¬è©¦è‡ªå‹•æ›´æ–°
sudo certbot renew --dry-run
</code></pre>
<h3 id="nginx-ç®¡ç†"><a class="header" href="#nginx-ç®¡ç†">Nginx ç®¡ç†</a></h3>
<pre><code class="language-bash"># æª¢æŸ¥é…ç½®èªæ³•
sudo nginx -t

# é‡æ–°è¼‰å…¥é…ç½®
sudo systemctl reload nginx

# é‡å•Ÿ Nginx
sudo systemctl restart nginx

# æŸ¥çœ‹ç‹€æ…‹
sudo systemctl status nginx
</code></pre>
<hr />
<h2 id="-éƒ¨ç½²ä½ çš„æ‡‰ç”¨"><a class="header" href="#-éƒ¨ç½²ä½ çš„æ‡‰ç”¨">ğŸš€ éƒ¨ç½²ä½ çš„æ‡‰ç”¨</a></h2>
<p>å®‰è£å®Œæˆå¾Œï¼Œä½ å¯ä»¥å°‡ Django æ‡‰ç”¨éƒ¨ç½²åˆ°é€™å€‹ç’°å¢ƒï¼š</p>
<h3 id="ä¿®æ”¹-nginx-é…ç½®"><a class="header" href="#ä¿®æ”¹-nginx-é…ç½®">ä¿®æ”¹ Nginx é…ç½®</a></h3>
<pre><code class="language-bash"># ç·¨è¼¯ Nginx é…ç½®
sudo nano /etc/nginx/sites-available/yourname

# æ·»åŠ åå‘ä»£ç†åˆ°ä½ çš„ Django æ‡‰ç”¨
location / {
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# é‡æ–°è¼‰å…¥é…ç½®
sudo systemctl reload nginx
</code></pre>
<h3 id="django-è¨­å®š"><a class="header" href="#django-è¨­å®š">Django è¨­å®š</a></h3>
<pre><code class="language-python"># settings.py
ALLOWED_HOSTS = ['yourname.duckdns.org']
SECURE_SSL_REDIRECT = True
SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
</code></pre>
<hr />
<h2 id="-å®‰å…¨æ€§å’Œæœ€ä½³å¯¦è¸"><a class="header" href="#-å®‰å…¨æ€§å’Œæœ€ä½³å¯¦è¸">ğŸ›¡ï¸ å®‰å…¨æ€§å’Œæœ€ä½³å¯¦è¸</a></h2>
<h3 id="è‡ªå‹•åŒ–ä»»å‹™æª¢æŸ¥"><a class="header" href="#è‡ªå‹•åŒ–ä»»å‹™æª¢æŸ¥">è‡ªå‹•åŒ–ä»»å‹™æª¢æŸ¥</a></h3>
<pre><code class="language-bash"># DuckDNS æ›´æ–°ï¼šæ¯5åˆ†é˜
*/5 * * * * /home/user/duckdns/duck.sh

# SSL æ›´æ–°ï¼šæ¯å¤©å‡Œæ™¨3é»
0 3 * * * /usr/bin/certbot renew --quiet --nginx
</code></pre>
<h3 id="é˜²ç«ç‰†è¨­å®š"><a class="header" href="#é˜²ç«ç‰†è¨­å®š">é˜²ç«ç‰†è¨­å®š</a></h3>
<pre><code class="language-bash"># é–‹æ”¾å¿…è¦ç«¯å£
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS
sudo ufw enable
</code></pre>
<h3 id="ç›£æ§å’Œå‚™ä»½"><a class="header" href="#ç›£æ§å’Œå‚™ä»½">ç›£æ§å’Œå‚™ä»½</a></h3>
<pre><code class="language-bash"># è¨­å®šæ—¥èªŒè¼ªè½‰
sudo nano /etc/logrotate.d/duckdns

# å…§å®¹ï¼š
/home/*/duckdns/duck.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
}
</code></pre>
<hr />
<h2 id="-æ•…éšœæ’é™¤"><a class="header" href="#-æ•…éšœæ’é™¤">ğŸ” æ•…éšœæ’é™¤</a></h2>
<h3 id="å¸¸è¦‹å•é¡Œ"><a class="header" href="#å¸¸è¦‹å•é¡Œ">å¸¸è¦‹å•é¡Œ</a></h3>
<p><strong>1. DuckDNS æ›´æ–°å¤±æ•—</strong></p>
<pre><code class="language-bash"># æª¢æŸ¥æ—¥èªŒ
cat ~/duckdns/duck.log

# ç¢ºèª Token å’Œç¶²åŸŸåç¨±æ­£ç¢º
# æ‰‹å‹•æ¸¬è©¦æ›´æ–°
curl "https://www.duckdns.org/update?domains=yourname&amp;token=yourtoken"
</code></pre>
<p><strong>2. SSL æ†‘è­‰ç”³è«‹å¤±æ•—</strong></p>
<pre><code class="language-bash"># æª¢æŸ¥ DNS è§£æ
nslookup yourname.duckdns.org

# ç¢ºèªé˜²ç«ç‰†é–‹æ”¾ 80 ç«¯å£
sudo ufw status

# æ‰‹å‹•ç”³è«‹æ†‘è­‰
sudo certbot --nginx -d yourname.duckdns.org
</code></pre>
<p><strong>3. Nginx é…ç½®éŒ¯èª¤</strong></p>
<pre><code class="language-bash"># æ¸¬è©¦é…ç½®
sudo nginx -t

# æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ
sudo tail -f /var/log/nginx/error.log
</code></pre>
<hr />
<h2 id="-æ”¯æ´å’Œç¤¾ç¾¤"><a class="header" href="#-æ”¯æ´å’Œç¤¾ç¾¤">ğŸ“ æ”¯æ´å’Œç¤¾ç¾¤</a></h2>
<ul>
<li><strong>DuckDNS å®˜ç¶²</strong>ï¼šhttps://www.duckdns.org</li>
<li><strong>Let's Encrypt æ–‡æª”</strong>ï¼šhttps://letsencrypt.org/docs/</li>
<li><strong>Nginx å®˜æ–¹æ–‡æª”</strong>ï¼šhttps://nginx.org/en/docs/</li>
</ul>
<p>é€™å€‹ä¸€éµå®‰è£è…³æœ¬è®“ä½ èƒ½åœ¨å¹¾åˆ†é˜å…§æ“æœ‰ä¸€å€‹å®Œå…¨å…è²»ã€å®‰å…¨ä¸”è‡ªå‹•åŒ–çš„ HTTPS ç¶²ç«™ï¼</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../tools/free_dns_ssl_guide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../tools/buttplug_python_setup.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../tools/free_dns_ssl_guide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../tools/buttplug_python_setup.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
