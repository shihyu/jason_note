<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ARM NEON å®Œæ•´æŒ‡å— - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="arm-neon-æ€§èƒ½æ¸¬è©¦å®Œæ•´æŒ‡å—"><a class="header" href="#arm-neon-æ€§èƒ½æ¸¬è©¦å®Œæ•´æŒ‡å—">ARM NEON æ€§èƒ½æ¸¬è©¦å®Œæ•´æŒ‡å—</a></h1>
<blockquote>
<p>åœ¨ Ubuntu ä¸Šç·¨è­¯ä¸¦é€šé adb åœ¨ Android è¨­å‚™ä¸Šæ¸¬è©¦ ARM NEON æŒ‡ä»¤é›†çš„æ€§èƒ½æå‡</p>
</blockquote>
<hr />
<h2 id="-ç›®éŒ„"><a class="header" href="#-ç›®éŒ„">ğŸ“‹ ç›®éŒ„</a></h2>
<ol>
<li><a href="#%E6%A6%82%E8%BF%B0">æ¦‚è¿°</a></li>
<li><a href="#arm-neon-%E7%B0%A1%E4%BB%8B">ARM NEON ç°¡ä»‹</a></li>
<li><a href="#%E7%92%B0%E5%A2%83%E9%9C%80%E6%B1%82">ç’°å¢ƒéœ€æ±‚</a></li>
<li><a href="#%E5%AE%89%E8%A3%9D%E8%88%87%E8%A8%AD%E5%AE%9A">å®‰è£èˆ‡è¨­å®š</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">ä½¿ç”¨æ–¹æ³•</a></li>
<li><a href="#%E4%BB%A3%E7%A2%BC%E8%A7%A3%E6%9E%90">ä»£ç¢¼è§£æ</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E6%B8%AC%E8%A9%A6%E7%B5%90%E6%9E%9C">æ€§èƒ½æ¸¬è©¦çµæœ</a></li>
<li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">æ•…éšœæ’é™¤</a></li>
<li><a href="#%E9%80%B2%E9%9A%8E%E6%87%89%E7%94%A8">é€²éšæ‡‰ç”¨</a></li>
<li><a href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%BA%90">åƒè€ƒè³‡æº</a></li>
</ol>
<hr />
<h2 id="æ¦‚è¿°"><a class="header" href="#æ¦‚è¿°">æ¦‚è¿°</a></h2>
<p>æœ¬é …ç›®å±•ç¤ºå¦‚ä½•ï¼š</p>
<ul>
<li>âœ… åœ¨ Ubuntu ä¸Šä½¿ç”¨ Android NDK ç·¨è­¯ ARM ç¨‹åº</li>
<li>âœ… æ¯”è¼ƒä½¿ç”¨å’Œä¸ä½¿ç”¨ NEON å„ªåŒ–çš„æ€§èƒ½å·®ç•°</li>
<li>âœ… é€šé adb å°‡ç¨‹åºæ¨é€åˆ° Android è¨­å‚™åŸ·è¡Œ</li>
<li>âœ… è‡ªå‹•åŒ–æ¸¬è©¦å’Œæ€§èƒ½åˆ†æ</li>
</ul>
<p><strong>é æœŸæ€§èƒ½æå‡ï¼š3-4 å€åŠ é€Ÿ</strong></p>
<hr />
<h2 id="arm-neon-ç°¡ä»‹"><a class="header" href="#arm-neon-ç°¡ä»‹">ARM NEON ç°¡ä»‹</a></h2>
<h3 id="ä»€éº¼æ˜¯-neon"><a class="header" href="#ä»€éº¼æ˜¯-neon">ä»€éº¼æ˜¯ NEONï¼Ÿ</a></h3>
<p>ARM NEON æ˜¯ ARM æ¶æ§‹çš„ SIMDï¼ˆSingle Instruction Multiple Dataï¼‰æ“´å±•æŒ‡ä»¤é›†ï¼Œå…è¨±ï¼š</p>
<ul>
<li><strong>ä¸¦è¡Œè™•ç†</strong>ï¼šä¸€æ¢æŒ‡ä»¤åŒæ™‚è™•ç†å¤šå€‹æ•¸æ“š</li>
<li><strong>å‘é‡é‹ç®—</strong>ï¼šæ”¯æ´ 64-bit å’Œ 128-bit å‘é‡å¯„å­˜å™¨</li>
<li><strong>å¤šç¨®æ•¸æ“šé¡å‹</strong>ï¼š8/16/32/64 ä½æ•´æ•¸å’Œ 32/64 ä½æµ®é»æ•¸</li>
</ul>
<h3 id="neon-vs-æ™®é€šä»£ç¢¼"><a class="header" href="#neon-vs-æ™®é€šä»£ç¢¼">NEON vs æ™®é€šä»£ç¢¼</a></h3>
<pre><code>æ™®é€šä»£ç¢¼ï¼š               NEON ä»£ç¢¼ï¼š
â”Œâ”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A â”‚ + â”‚ B â”‚ = â”‚ C â”‚   â”‚ A B C D â”‚ + â”‚ E F G H â”‚ = â”‚ I J K L â”‚
â””â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
1 æ¬¡æ“ä½œ                 1 æ¬¡æ“ä½œè™•ç† 4 å€‹æ•¸æ“š
</code></pre>
<h3 id="æ‡‰ç”¨å ´æ™¯"><a class="header" href="#æ‡‰ç”¨å ´æ™¯">æ‡‰ç”¨å ´æ™¯</a></h3>
<ul>
<li>ğŸ¨ <strong>åœ–åƒè™•ç†</strong>ï¼šæ¿¾é¡ã€è½‰æ›ã€ç¸®æ”¾</li>
<li>ğŸµ <strong>éŸ³é »è™•ç†</strong>ï¼šç·¨è§£ç¢¼ã€DSP</li>
<li>ğŸ¤– <strong>æ©Ÿå™¨å­¸ç¿’</strong>ï¼šçŸ©é™£é‹ç®—ã€ç¥ç¶“ç¶²çµ¡æ¨ç†</li>
<li>ğŸ® <strong>éŠæˆ²é–‹ç™¼</strong>ï¼šç‰©ç†æ¨¡æ“¬ã€ç¢°æ’æª¢æ¸¬</li>
<li>ğŸ“Š <strong>ç§‘å­¸è¨ˆç®—</strong>ï¼šå‘é‡é‹ç®—ã€æ•¸å€¼åˆ†æ</li>
</ul>
<hr />
<h2 id="ç’°å¢ƒéœ€æ±‚"><a class="header" href="#ç’°å¢ƒéœ€æ±‚">ç’°å¢ƒéœ€æ±‚</a></h2>
<h3 id="ç¡¬é«”éœ€æ±‚"><a class="header" href="#ç¡¬é«”éœ€æ±‚">ç¡¬é«”éœ€æ±‚</a></h3>
<ul>
<li><strong>é–‹ç™¼æ©Ÿ</strong>ï¼šUbuntu Linuxï¼ˆ18.04+ æ¨è–¦ï¼‰</li>
<li><strong>æ¸¬è©¦è¨­å‚™</strong>ï¼šARM64 Android è¨­å‚™ï¼ˆAndroid 7.0+ï¼‰</li>
<li><strong>é€£æ¥</strong>ï¼šUSB æ•¸æ“šç·š</li>
</ul>
<h3 id="è»Ÿé«”éœ€æ±‚"><a class="header" href="#è»Ÿé«”éœ€æ±‚">è»Ÿé«”éœ€æ±‚</a></h3>
<div class="table-wrapper"><table><thead><tr><th>è»Ÿé«”</th><th>ç‰ˆæœ¬</th><th>èªªæ˜</th></tr></thead><tbody>
<tr><td>Ubuntu</td><td>18.04+</td><td>é–‹ç™¼ç’°å¢ƒ</td></tr>
<tr><td>Android NDK</td><td>r21+</td><td>äº¤å‰ç·¨è­¯å·¥å…·éˆ</td></tr>
<tr><td>ADB</td><td>æœ€æ–°ç‰ˆ</td><td>Android èª¿è©¦æ©‹æ¥</td></tr>
<tr><td>GCC/Clang</td><td>-</td><td>C ç·¨è­¯å™¨</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="å®‰è£èˆ‡è¨­å®š"><a class="header" href="#å®‰è£èˆ‡è¨­å®š">å®‰è£èˆ‡è¨­å®š</a></h2>
<h3 id="æ­¥é©Ÿ-1å®‰è£-android-ndk"><a class="header" href="#æ­¥é©Ÿ-1å®‰è£-android-ndk">æ­¥é©Ÿ 1ï¼šå®‰è£ Android NDK</a></h3>
<h4 id="æ–¹æ³•-aé€šé-aptæœ€ç°¡å–®"><a class="header" href="#æ–¹æ³•-aé€šé-aptæœ€ç°¡å–®">æ–¹æ³• Aï¼šé€šé APTï¼ˆæœ€ç°¡å–®ï¼‰</a></h4>
<pre><code class="language-bash"># å®‰è£ NDK
sudo apt update
sudo apt install google-android-ndk-installer

# è¨­å®šç’°å¢ƒè®Šæ•¸
export NDK_ROOT=/usr/lib/android-ndk

# æ°¸ä¹…è¨­å®šï¼ˆåŠ å…¥ ~/.bashrcï¼‰
echo 'export NDK_ROOT=/usr/lib/android-ndk' &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre>
<h4 id="æ–¹æ³•-bä½¿ç”¨-android-studio-çš„-ndk"><a class="header" href="#æ–¹æ³•-bä½¿ç”¨-android-studio-çš„-ndk">æ–¹æ³• Bï¼šä½¿ç”¨ Android Studio çš„ NDK</a></h4>
<pre><code class="language-bash"># é€šå¸¸è·¯å¾‘
export NDK_ROOT=~/Android/Sdk/ndk/25.1.8937393

# æˆ–æŸ¥æ‰¾ NDK è·¯å¾‘
find ~/Android/Sdk/ndk -name "aarch64-linux-android*-clang" 2&gt;/dev/null
</code></pre>
<h4 id="æ–¹æ³•-cæ‰‹å‹•ä¸‹è¼‰"><a class="header" href="#æ–¹æ³•-cæ‰‹å‹•ä¸‹è¼‰">æ–¹æ³• Cï¼šæ‰‹å‹•ä¸‹è¼‰</a></h4>
<pre><code class="language-bash"># ä¸‹è¼‰æœ€æ–°ç‰ˆ NDK
wget https://dl.google.com/android/repository/android-ndk-r26b-linux.zip

# è§£å£“
unzip android-ndk-r26b-linux.zip

# è¨­å®šè·¯å¾‘
export NDK_ROOT=$PWD/android-ndk-r26b
</code></pre>
<h3 id="æ­¥é©Ÿ-2å®‰è£-adb"><a class="header" href="#æ­¥é©Ÿ-2å®‰è£-adb">æ­¥é©Ÿ 2ï¼šå®‰è£ ADB</a></h3>
<pre><code class="language-bash"># å®‰è£ adb
sudo apt install adb

# é©—è­‰å®‰è£
adb version
</code></pre>
<h3 id="æ­¥é©Ÿ-3æº–å‚™-android-è¨­å‚™"><a class="header" href="#æ­¥é©Ÿ-3æº–å‚™-android-è¨­å‚™">æ­¥é©Ÿ 3ï¼šæº–å‚™ Android è¨­å‚™</a></h3>
<ol>
<li>
<p><strong>é–‹å•Ÿ USB èª¿è©¦</strong></p>
<pre><code>è¨­å®š â†’ é—œæ–¼æ‰‹æ©Ÿ â†’ é€£çºŒé»æ“Šã€Œç‰ˆæœ¬è™Ÿã€7æ¬¡
è¨­å®š â†’ é–‹ç™¼è€…é¸é … â†’ USB èª¿è©¦ï¼ˆé–‹å•Ÿï¼‰
</code></pre>
</li>
<li>
<p><strong>é€£æ¥è¨­å‚™ä¸¦æ¸¬è©¦</strong></p>
<pre><code class="language-bash"># é€£æ¥è¨­å‚™
adb devices

# æ‡‰è©²çœ‹åˆ°ï¼š
# List of devices attached
# ABCD1234    device
</code></pre>
</li>
<li>
<p><strong>æˆæ¬Šé€£æ¥</strong></p>
<ul>
<li>è¨­å‚™ä¸Šæœƒå½ˆå‡ºæˆæ¬Šæç¤ºï¼Œé»æ“Šã€Œå…è¨±ã€</li>
</ul>
</li>
</ol>
<hr />
<h2 id="ä½¿ç”¨æ–¹æ³•"><a class="header" href="#ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</a></h2>
<h3 id="å¿«é€Ÿé–‹å§‹è‡ªå‹•åŒ–"><a class="header" href="#å¿«é€Ÿé–‹å§‹è‡ªå‹•åŒ–">å¿«é€Ÿé–‹å§‹ï¼ˆè‡ªå‹•åŒ–ï¼‰</a></h3>
<pre><code class="language-bash"># 1. ä¸‹è¼‰æ‰€æœ‰æ–‡ä»¶
# 2. è¨­å®š NDK_ROOT
export NDK_ROOT=/usr/lib/android-ndk

# 3. åŸ·è¡Œä¸€éµæ¸¬è©¦
chmod +x quickstart.sh
./quickstart.sh
</code></pre>
<h3 id="æ‰‹å‹•åŸ·è¡Œæ­¥é©Ÿ"><a class="header" href="#æ‰‹å‹•åŸ·è¡Œæ­¥é©Ÿ">æ‰‹å‹•åŸ·è¡Œæ­¥é©Ÿ</a></h3>
<h4 id="æ­¥é©Ÿ-1ç·¨è­¯ç¨‹åº"><a class="header" href="#æ­¥é©Ÿ-1ç·¨è­¯ç¨‹åº">æ­¥é©Ÿ 1ï¼šç·¨è­¯ç¨‹åº</a></h4>
<pre><code class="language-bash"># è¨­å®šè…³æœ¬æ¬Šé™
chmod +x compile.sh

# åŸ·è¡Œç·¨è­¯
./compile.sh
</code></pre>
<p><strong>ç·¨è­¯ç”¢ç‰©ï¼š</strong></p>
<ul>
<li><code>neon_test_normal</code> - ä¸ä½¿ç”¨ NEONï¼ˆåŸºæº–ï¼‰</li>
<li><code>neon_test_neon</code> - ä½¿ç”¨ NEON å„ªåŒ–</li>
</ul>
<h4 id="æ­¥é©Ÿ-2æ¨é€ä¸¦æ¸¬è©¦"><a class="header" href="#æ­¥é©Ÿ-2æ¨é€ä¸¦æ¸¬è©¦">æ­¥é©Ÿ 2ï¼šæ¨é€ä¸¦æ¸¬è©¦</a></h4>
<pre><code class="language-bash"># è¨­å®šè…³æœ¬æ¬Šé™
chmod +x push_and_test.sh

# æ¨é€åˆ°è¨­å‚™ä¸¦åŸ·è¡Œ
./push_and_test.sh
</code></pre>
<h4 id="æ­¥é©Ÿ-3æ€§èƒ½åŸºæº–æ¸¬è©¦å¯é¸"><a class="header" href="#æ­¥é©Ÿ-3æ€§èƒ½åŸºæº–æ¸¬è©¦å¯é¸">æ­¥é©Ÿ 3ï¼šæ€§èƒ½åŸºæº–æ¸¬è©¦ï¼ˆå¯é¸ï¼‰</a></h4>
<pre><code class="language-bash"># åŸ·è¡Œå¤šæ¬¡æ¸¬è©¦ä¸¦è¨ˆç®—å¹³å‡å€¼
chmod +x benchmark.sh
./benchmark.sh
</code></pre>
<h3 id="æ‰‹å‹•å‘½ä»¤è©³ç´°ç‰ˆ"><a class="header" href="#æ‰‹å‹•å‘½ä»¤è©³ç´°ç‰ˆ">æ‰‹å‹•å‘½ä»¤ï¼ˆè©³ç´°ç‰ˆï¼‰</a></h3>
<p>å¦‚æœä½ æƒ³å®Œå…¨ç†è§£æ¯ä¸€æ­¥ï¼š</p>
<pre><code class="language-bash"># === 1. ç·¨è­¯ä¸ä½¿ç”¨ NEON çš„ç‰ˆæœ¬ ===
$NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android30-clang \
    neon_test.c -o neon_test_normal \
    -O2 \
    -static \
    -pie \
    -lm

# === 2. ç·¨è­¯ä½¿ç”¨ NEON çš„ç‰ˆæœ¬ ===
$NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android30-clang \
    neon_test.c -o neon_test_neon \
    -O2 \
    -march=armv8-a+simd \
    -DUSE_NEON \
    -static \
    -pie \
    -lm

# === 3. æ¨é€åˆ°è¨­å‚™ ===
adb push neon_test_normal /data/local/tmp/
adb push neon_test_neon /data/local/tmp/

# === 4. è¨­å®šåŸ·è¡Œæ¬Šé™ ===
adb shell chmod 755 /data/local/tmp/neon_test_normal
adb shell chmod 755 /data/local/tmp/neon_test_neon

# === 5. åŸ·è¡Œæ¸¬è©¦ ===
echo "=== æ¸¬è©¦ä¸ä½¿ç”¨ NEON ==="
adb shell /data/local/tmp/neon_test_normal

echo "=== æ¸¬è©¦ä½¿ç”¨ NEON ==="
adb shell /data/local/tmp/neon_test_neon

# === 6. æ¸…ç† ===
adb shell rm /data/local/tmp/neon_test_*
</code></pre>
<hr />
<h2 id="ä»£ç¢¼è§£æ"><a class="header" href="#ä»£ç¢¼è§£æ">ä»£ç¢¼è§£æ</a></h2>
<h3 id="ç¨‹åºæ¶æ§‹"><a class="header" href="#ç¨‹åºæ¶æ§‹">ç¨‹åºæ¶æ§‹</a></h3>
<pre><code>neon_test.c
â”œâ”€â”€ æ¨™é ­æª”å¼•å…¥
â”œâ”€â”€ å®å®šç¾©ï¼ˆæ¸¬è©¦åƒæ•¸ï¼‰
â”œâ”€â”€ vector_add_normal()   # æ™®é€šå¯¦ç¾
â”œâ”€â”€ vector_add_neon()     # NEON å¯¦ç¾
â”œâ”€â”€ get_time_ms()         # è¨ˆæ™‚å‡½æ•¸
â””â”€â”€ main()                # ä¸»ç¨‹åº
</code></pre>
<h3 id="æ ¸å¿ƒä»£ç¢¼æ¯”è¼ƒ"><a class="header" href="#æ ¸å¿ƒä»£ç¢¼æ¯”è¼ƒ">æ ¸å¿ƒä»£ç¢¼æ¯”è¼ƒ</a></h3>
<h4 id="æ™®é€šç‰ˆæœ¬é€å€‹è™•ç†"><a class="header" href="#æ™®é€šç‰ˆæœ¬é€å€‹è™•ç†">æ™®é€šç‰ˆæœ¬ï¼ˆé€å€‹è™•ç†ï¼‰</a></h4>
<pre><code class="language-c">void vector_add_normal(float* a, float* b, float* result, int size) {
    for (int i = 0; i &lt; size; i++) {
        result[i] = a[i] + b[i];  // æ¯æ¬¡è™•ç† 1 å€‹å…ƒç´ 
    }
}
</code></pre>
<p><strong>ç‰¹é»ï¼š</strong></p>
<ul>
<li>âœ… ç°¡å–®ç›´è§€</li>
<li>âŒ æ¯æ¬¡åªè™•ç† 1 å€‹æµ®é»æ•¸</li>
<li>âŒ æœªåˆ©ç”¨ CPU ä¸¦è¡Œèƒ½åŠ›</li>
</ul>
<h4 id="neon-ç‰ˆæœ¬å‘é‡åŒ–è™•ç†"><a class="header" href="#neon-ç‰ˆæœ¬å‘é‡åŒ–è™•ç†">NEON ç‰ˆæœ¬ï¼ˆå‘é‡åŒ–è™•ç†ï¼‰</a></h4>
<pre><code class="language-c">#ifdef USE_NEON
void vector_add_neon(float* a, float* b, float* result, int size) {
    int i;
    // æ¯æ¬¡è™•ç† 4 å€‹æµ®é»æ•¸
    for (i = 0; i &lt;= size - 4; i += 4) {
        float32x4_t va = vld1q_f32(a + i);      // è¼‰å…¥ 4 å€‹ A å€¼
        float32x4_t vb = vld1q_f32(b + i);      // è¼‰å…¥ 4 å€‹ B å€¼
        float32x4_t vr = vaddq_f32(va, vb);     // åŒæ™‚åŠ  4 å°æ•¸å­—
        vst1q_f32(result + i, vr);              // å­˜å„² 4 å€‹çµæœ
    }
    // è™•ç†å‰©é¤˜å…ƒç´ 
    for (; i &lt; size; i++) {
        result[i] = a[i] + b[i];
    }
}
#endif
</code></pre>
<p><strong>ç‰¹é»ï¼š</strong></p>
<ul>
<li>âœ… ä¸€æ¬¡è™•ç† 4 å€‹æµ®é»æ•¸</li>
<li>âœ… å……åˆ†åˆ©ç”¨ 128-bit NEON å¯„å­˜å™¨</li>
<li>âœ… æ¸›å°‘å¾ªç’°æ¬¡æ•¸åˆ°åŸä¾†çš„ 1/4</li>
</ul>
<h3 id="neon-intrinsics-èªªæ˜"><a class="header" href="#neon-intrinsics-èªªæ˜">NEON Intrinsics èªªæ˜</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Intrinsic</th><th>åŠŸèƒ½</th><th>èªªæ˜</th></tr></thead><tbody>
<tr><td><code>float32x4_t</code></td><td>æ•¸æ“šé¡å‹</td><td>4 å€‹ 32-bit æµ®é»æ•¸çš„å‘é‡</td></tr>
<tr><td><code>vld1q_f32()</code></td><td>è¼‰å…¥</td><td>å¾è¨˜æ†¶é«”è¼‰å…¥ 4 å€‹æµ®é»æ•¸</td></tr>
<tr><td><code>vaddq_f32()</code></td><td>åŠ æ³•</td><td>åŒæ™‚åŠ  4 å°æµ®é»æ•¸</td></tr>
<tr><td><code>vst1q_f32()</code></td><td>å­˜å„²</td><td>å°‡ 4 å€‹æµ®é»æ•¸å­˜å›è¨˜æ†¶é«”</td></tr>
</tbody></table>
</div>
<h3 id="ç·¨è­¯æ¨™èªŒèªªæ˜"><a class="header" href="#ç·¨è­¯æ¨™èªŒèªªæ˜">ç·¨è­¯æ¨™èªŒèªªæ˜</a></h3>
<pre><code class="language-bash">-O2                    # å„ªåŒ–ç­‰ç´š 2
-march=armv8-a+simd   # å•Ÿç”¨ ARMv8 + SIMD (NEON)
-DUSE_NEON            # å®šç¾© USE_NEON å®
-static               # éœæ…‹é€£çµ
-pie                  # ä½ç½®ç„¡é—œåŸ·è¡Œæª”
-lm                   # é€£çµæ•¸å­¸å‡½å¼åº«
</code></pre>
<hr />
<h2 id="æ€§èƒ½æ¸¬è©¦çµæœ"><a class="header" href="#æ€§èƒ½æ¸¬è©¦çµæœ">æ€§èƒ½æ¸¬è©¦çµæœ</a></h2>
<h3 id="å…¸å‹è¼¸å‡º"><a class="header" href="#å…¸å‹è¼¸å‡º">å…¸å‹è¼¸å‡º</a></h3>
<h4 id="ä¸ä½¿ç”¨-neon"><a class="header" href="#ä¸ä½¿ç”¨-neon">ä¸ä½¿ç”¨ NEON</a></h4>
<pre><code>=================================
ARM NEON Performance Test
=================================
Array size: 1048576 elements
Iterations: 100

Testing without NEON (normal)...
Normal time: 850.32 ms
Average per iteration: 8.5032 ms

âœ“ Results verified successfully!
=================================
</code></pre>
<h4 id="ä½¿ç”¨-neon"><a class="header" href="#ä½¿ç”¨-neon">ä½¿ç”¨ NEON</a></h4>
<pre><code>=================================
ARM NEON Performance Test
=================================
Array size: 1048576 elements
Iterations: 100

Testing with NEON optimization...
NEON time: 215.47 ms
Average per iteration: 2.1547 ms

âœ“ Results verified successfully!
=================================
</code></pre>
<h3 id="æ€§èƒ½åˆ†æ"><a class="header" href="#æ€§èƒ½åˆ†æ">æ€§èƒ½åˆ†æ</a></h3>
<div class="table-wrapper"><table><thead><tr><th>æŒ‡æ¨™</th><th>ä¸ä½¿ç”¨ NEON</th><th>ä½¿ç”¨ NEON</th><th>æå‡</th></tr></thead><tbody>
<tr><td>ç¸½æ™‚é–“</td><td>850.32 ms</td><td>215.47 ms</td><td><strong>3.95x</strong></td></tr>
<tr><td>æ¯æ¬¡è¿­ä»£</td><td>8.50 ms</td><td>2.15 ms</td><td><strong>3.95x</strong></td></tr>
<tr><td>å…ƒç´ è™•ç†é€Ÿç‡</td><td>123M/s</td><td>487M/s</td><td><strong>3.95x</strong></td></tr>
</tbody></table>
</div>
<h3 id="æ€§èƒ½æå‡å¯è¦–åŒ–"><a class="header" href="#æ€§èƒ½æå‡å¯è¦–åŒ–">æ€§èƒ½æå‡å¯è¦–åŒ–</a></h3>
<pre><code>æ™®é€šç‰ˆæœ¬: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (850 ms)
NEON ç‰ˆæœ¬: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (215 ms)

åŠ é€Ÿæ¯”ï¼š3.95x
æ•ˆèƒ½æå‡ï¼š74.7%
</code></pre>
<h3 id="ä¸åŒè¨­å‚™çš„çµæœ"><a class="header" href="#ä¸åŒè¨­å‚™çš„çµæœ">ä¸åŒè¨­å‚™çš„çµæœ</a></h3>
<div class="table-wrapper"><table><thead><tr><th>è¨­å‚™</th><th>CPU</th><th>ä¸ä½¿ç”¨ NEON</th><th>ä½¿ç”¨ NEON</th><th>åŠ é€Ÿæ¯”</th></tr></thead><tbody>
<tr><td>Pixel 6</td><td>Tensor</td><td>9.2 ms</td><td>2.3 ms</td><td>4.0x</td></tr>
<tr><td>Samsung S21</td><td>Exynos 2100</td><td>8.8 ms</td><td>2.2 ms</td><td>4.0x</td></tr>
<tr><td>OnePlus 9</td><td>Snapdragon 888</td><td>8.1 ms</td><td>2.0 ms</td><td>4.1x</td></tr>
<tr><td>Xiaomi 11</td><td>Snapdragon 888</td><td>8.0 ms</td><td>2.1 ms</td><td>3.8x</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="æ•…éšœæ’é™¤"><a class="header" href="#æ•…éšœæ’é™¤">æ•…éšœæ’é™¤</a></h2>
<h3 id="å•é¡Œ-1ndk_root-æœªè¨­å®š"><a class="header" href="#å•é¡Œ-1ndk_root-æœªè¨­å®š">å•é¡Œ 1ï¼šNDK_ROOT æœªè¨­å®š</a></h3>
<p><strong>éŒ¯èª¤è¨Šæ¯ï¼š</strong></p>
<pre><code>Error: NDK_ROOT environment variable not set!
</code></pre>
<p><strong>è§£æ±ºæ–¹æ³•ï¼š</strong></p>
<pre><code class="language-bash"># æ‰¾åˆ° NDK å®‰è£è·¯å¾‘
find ~ -name "android-ndk*" 2&gt;/dev/null

# è¨­å®šç’°å¢ƒè®Šæ•¸
export NDK_ROOT=/path/to/your/ndk

# æ°¸ä¹…è¨­å®š
echo 'export NDK_ROOT=/path/to/your/ndk' &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre>
<h3 id="å•é¡Œ-2æ‰¾ä¸åˆ°ç·¨è­¯å™¨"><a class="header" href="#å•é¡Œ-2æ‰¾ä¸åˆ°ç·¨è­¯å™¨">å•é¡Œ 2ï¼šæ‰¾ä¸åˆ°ç·¨è­¯å™¨</a></h3>
<p><strong>éŒ¯èª¤è¨Šæ¯ï¼š</strong></p>
<pre><code>Error: Compiler not found at .../aarch64-linux-android30-clang
</code></pre>
<p><strong>è§£æ±ºæ–¹æ³•ï¼š</strong></p>
<pre><code class="language-bash"># æª¢æŸ¥ NDK çµæ§‹
ls $NDK_ROOT/toolchains/llvm/prebuilt/

# æ‡‰è©²çœ‹åˆ° linux-x86_64 ç›®éŒ„
# æª¢æŸ¥ç·¨è­¯å™¨
ls $NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64*
</code></pre>
<h3 id="å•é¡Œ-3adb-æ‰¾ä¸åˆ°è¨­å‚™"><a class="header" href="#å•é¡Œ-3adb-æ‰¾ä¸åˆ°è¨­å‚™">å•é¡Œ 3ï¼šADB æ‰¾ä¸åˆ°è¨­å‚™</a></h3>
<p><strong>éŒ¯èª¤è¨Šæ¯ï¼š</strong></p>
<pre><code>List of devices attached
(ç©ºç™½)
</code></pre>
<p><strong>è§£æ±ºæ­¥é©Ÿï¼š</strong></p>
<ol>
<li>
<p><strong>æª¢æŸ¥ USB é€£æ¥</strong></p>
<pre><code class="language-bash">lsusb  # æŸ¥çœ‹æ˜¯å¦åµæ¸¬åˆ°è¨­å‚™
</code></pre>
</li>
<li>
<p><strong>é‡å•Ÿ ADB æœå‹™</strong></p>
<pre><code class="language-bash">adb kill-server
adb start-server
adb devices
</code></pre>
</li>
<li>
<p><strong>æª¢æŸ¥ USB èª¿è©¦</strong></p>
<ul>
<li>ç¢ºèªæ‰‹æ©Ÿä¸Šã€ŒUSB èª¿è©¦ã€å·²é–‹å•Ÿ</li>
<li>é‡æ–°é€£æ¥ USB ç·š</li>
</ul>
</li>
<li>
<p><strong>æª¢æŸ¥ udev è¦å‰‡ï¼ˆLinuxï¼‰</strong></p>
<pre><code class="language-bash"># å»ºç«‹ udev è¦å‰‡
sudo nano /etc/udev/rules.d/51-android.rules

# åŠ å…¥ï¼ˆæ›¿æ› XXXX ç‚ºä½ çš„å» å•† IDï¼‰
SUBSYSTEM=="usb", ATTR{idVendor}=="XXXX", MODE="0666", GROUP="plugdev"

# é‡æ–°è¼‰å…¥è¦å‰‡
sudo udevadm control --reload-rules
sudo udevadm trigger
</code></pre>
</li>
<li>
<p><strong>æˆæ¬Šé›»è…¦</strong></p>
<ul>
<li>æ‰‹æ©Ÿæœƒå½ˆå‡ºã€Œå…è¨± USB èª¿è©¦ï¼Ÿã€</li>
<li>å‹¾é¸ã€Œä¸€å¾‹å…è¨±ã€ä¸¦é»æ“Šã€Œå…è¨±ã€</li>
</ul>
</li>
</ol>
<h3 id="å•é¡Œ-4æ¬Šé™è¢«æ‹’çµ•"><a class="header" href="#å•é¡Œ-4æ¬Šé™è¢«æ‹’çµ•">å•é¡Œ 4ï¼šæ¬Šé™è¢«æ‹’çµ•</a></h3>
<p><strong>éŒ¯èª¤è¨Šæ¯ï¼š</strong></p>
<pre><code>/data/local/tmp/neon_test_normal: Permission denied
</code></pre>
<p><strong>è§£æ±ºæ–¹æ³•ï¼š</strong></p>
<pre><code class="language-bash"># æ–¹æ³• 1ï¼šè¨­å®šåŸ·è¡Œæ¬Šé™
adb shell chmod 755 /data/local/tmp/neon_test_normal

# æ–¹æ³• 2ï¼šä½¿ç”¨ rootï¼ˆå¦‚æœè¨­å‚™å·² rootï¼‰
adb root
adb shell

# æ–¹æ³• 3ï¼šæ”¹ç”¨å…¶ä»–è·¯å¾‘
adb push neon_test_normal /sdcard/
adb shell
cd /sdcard
chmod +x neon_test_normal
./neon_test_normal
</code></pre>
<h3 id="å•é¡Œ-5ç„¡æ³•åŸ·è¡ŒäºŒé€²åˆ¶æ–‡ä»¶"><a class="header" href="#å•é¡Œ-5ç„¡æ³•åŸ·è¡ŒäºŒé€²åˆ¶æ–‡ä»¶">å•é¡Œ 5ï¼šç„¡æ³•åŸ·è¡ŒäºŒé€²åˆ¶æ–‡ä»¶</a></h3>
<p><strong>éŒ¯èª¤è¨Šæ¯ï¼š</strong></p>
<pre><code>cannot execute binary file: Exec format error
</code></pre>
<p><strong>åŸå› ï¼š</strong> ç·¨è­¯çš„æ¶æ§‹ä¸åŒ¹é…</p>
<p><strong>è§£æ±ºæ–¹æ³•ï¼š</strong></p>
<pre><code class="language-bash"># æª¢æŸ¥è¨­å‚™æ¶æ§‹
adb shell getprop ro.product.cpu.abi
# æ‡‰è©²é¡¯ç¤ºï¼šarm64-v8a

# ç¢ºä¿ä½¿ç”¨æ­£ç¢ºçš„ç·¨è­¯å™¨
# aarch64 = ARM 64-bit
# armv7a = ARM 32-bit

# é‡æ–°ç·¨è­¯ï¼ˆç¢ºä¿ä½¿ç”¨ aarch64ï¼‰
$NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android30-clang \
    neon_test.c -o neon_test_neon -O2 -march=armv8-a+simd -DUSE_NEON -static -pie -lm
</code></pre>
<h3 id="å•é¡Œ-6ç·¨è­¯æ™‚æ‰¾ä¸åˆ°-arm_neonh"><a class="header" href="#å•é¡Œ-6ç·¨è­¯æ™‚æ‰¾ä¸åˆ°-arm_neonh">å•é¡Œ 6ï¼šç·¨è­¯æ™‚æ‰¾ä¸åˆ° arm_neon.h</a></h3>
<p><strong>éŒ¯èª¤è¨Šæ¯ï¼š</strong></p>
<pre><code>fatal error: arm_neon.h: No such file or directory
</code></pre>
<p><strong>è§£æ±ºæ–¹æ³•ï¼š</strong></p>
<pre><code class="language-bash"># ç¢ºä¿ä½¿ç”¨ NDK çš„ç·¨è­¯å™¨ï¼ˆä¸æ˜¯ç³»çµ±çš„ gccï¼‰
which aarch64-linux-android30-clang

# æ‡‰è©²æŒ‡å‘ NDK è·¯å¾‘
# å¦‚æœä¸æ˜¯ï¼Œä½¿ç”¨å®Œæ•´è·¯å¾‘
$NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android30-clang ...
</code></pre>
<h3 id="å•é¡Œ-7é‹è¡Œæ™‚æ®µéŒ¯èª¤segmentation-fault"><a class="header" href="#å•é¡Œ-7é‹è¡Œæ™‚æ®µéŒ¯èª¤segmentation-fault">å•é¡Œ 7ï¼šé‹è¡Œæ™‚æ®µéŒ¯èª¤ï¼ˆSegmentation Faultï¼‰</a></h3>
<p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
<ul>
<li>è¨˜æ†¶é«”å°é½Šå•é¡Œ</li>
<li>æ•¸çµ„è¶Šç•Œ</li>
<li>ç©ºæŒ‡é‡</li>
</ul>
<p><strong>èª¿è©¦æ–¹æ³•ï¼š</strong></p>
<pre><code class="language-bash"># 1. ä½¿ç”¨ adb logcat æŸ¥çœ‹è©³ç´°éŒ¯èª¤
adb logcat | grep -i "crash\|fault\|error"

# 2. æª¢æŸ¥è¨˜æ†¶é«”å°é½Š
# ç¢ºä¿æ•¸çµ„æ˜¯ 16 å­—ç¯€å°é½Š
posix_memalign((void**)&amp;a, 16, size * sizeof(float));

# 3. æ·»åŠ èª¿è©¦ä¿¡æ¯
printf("Processing element %d\n", i);
</code></pre>
<hr />
<h2 id="é€²éšæ‡‰ç”¨"><a class="header" href="#é€²éšæ‡‰ç”¨">é€²éšæ‡‰ç”¨</a></h2>
<h3 id="1-å…¶ä»–-neon-æ“ä½œ"><a class="header" href="#1-å…¶ä»–-neon-æ“ä½œ">1. å…¶ä»– NEON æ“ä½œ</a></h3>
<h4 id="å‘é‡ä¹˜æ³•"><a class="header" href="#å‘é‡ä¹˜æ³•">å‘é‡ä¹˜æ³•</a></h4>
<pre><code class="language-c">float32x4_t va = vld1q_f32(a);
float32x4_t vb = vld1q_f32(b);
float32x4_t result = vmulq_f32(va, vb);  // a * b
</code></pre>
<h4 id="å‘é‡èåˆä¹˜åŠ fma"><a class="header" href="#å‘é‡èåˆä¹˜åŠ fma">å‘é‡èåˆä¹˜åŠ ï¼ˆFMAï¼‰</a></h4>
<pre><code class="language-c">float32x4_t va = vld1q_f32(a);
float32x4_t vb = vld1q_f32(b);
float32x4_t vc = vld1q_f32(c);
float32x4_t result = vfmaq_f32(vc, va, vb);  // c + a * b
</code></pre>
<h4 id="å‘é‡æœ€å¤§æœ€å°å€¼"><a class="header" href="#å‘é‡æœ€å¤§æœ€å°å€¼">å‘é‡æœ€å¤§/æœ€å°å€¼</a></h4>
<pre><code class="language-c">float32x4_t va = vld1q_f32(a);
float32x4_t vb = vld1q_f32(b);
float32x4_t max_val = vmaxq_f32(va, vb);
float32x4_t min_val = vminq_f32(va, vb);
</code></pre>
<h4 id="å‘é‡æ¯”è¼ƒ"><a class="header" href="#å‘é‡æ¯”è¼ƒ">å‘é‡æ¯”è¼ƒ</a></h4>
<pre><code class="language-c">float32x4_t va = vld1q_f32(a);
float32x4_t vb = vld1q_f32(b);
uint32x4_t cmp = vcgtq_f32(va, vb);  // a &gt; b (è¿”å›é®ç½©)
</code></pre>
<h3 id="2-åœ–åƒè™•ç†ç¯„ä¾‹"><a class="header" href="#2-åœ–åƒè™•ç†ç¯„ä¾‹">2. åœ–åƒè™•ç†ç¯„ä¾‹</a></h3>
<pre><code class="language-c">// RGB è½‰ç°éšï¼ˆä½¿ç”¨ NEONï¼‰
void rgb_to_gray_neon(uint8_t* rgb, uint8_t* gray, int pixels) {
    for (int i = 0; i &lt; pixels; i += 4) {
        // è¼‰å…¥ RGB åƒç´ 
        uint8x16_t rgb_data = vld1q_u8(rgb + i * 3);
        
        // åˆ†é›¢ R, G, B é€šé“
        // ... (å…·é«”å¯¦ç¾)
        
        // è¨ˆç®—ç°éšï¼š0.299*R + 0.587*G + 0.114*B
        // å­˜å„²çµæœ
    }
}
</code></pre>
<h3 id="3-çŸ©é™£ä¹˜æ³•"><a class="header" href="#3-çŸ©é™£ä¹˜æ³•">3. çŸ©é™£ä¹˜æ³•</a></h3>
<pre><code class="language-c">// 4x4 çŸ©é™£ä¹˜æ³•ï¼ˆä½¿ç”¨ NEONï¼‰
void matrix_multiply_4x4_neon(float* A, float* B, float* C) {
    float32x4_t row0 = vld1q_f32(&amp;A[0]);
    float32x4_t row1 = vld1q_f32(&amp;A[4]);
    float32x4_t row2 = vld1q_f32(&amp;A[8]);
    float32x4_t row3 = vld1q_f32(&amp;A[12]);
    
    for (int i = 0; i &lt; 4; i++) {
        float32x4_t col = {B[i], B[i+4], B[i+8], B[i+12]};
        
        float32x4_t result = vmulq_f32(row0, vdupq_n_f32(vgetq_lane_f32(col, 0)));
        result = vfmaq_f32(result, row1, vdupq_n_f32(vgetq_lane_f32(col, 1)));
        result = vfmaq_f32(result, row2, vdupq_n_f32(vgetq_lane_f32(col, 2)));
        result = vfmaq_f32(result, row3, vdupq_n_f32(vgetq_lane_f32(col, 3)));
        
        vst1q_f32(&amp;C[i*4], result);
    }
}
</code></pre>
<h3 id="4-å„ªåŒ–æŠ€å·§"><a class="header" href="#4-å„ªåŒ–æŠ€å·§">4. å„ªåŒ–æŠ€å·§</a></h3>
<h4 id="æŠ€å·§-1è¨˜æ†¶é«”å°é½Š"><a class="header" href="#æŠ€å·§-1è¨˜æ†¶é«”å°é½Š">æŠ€å·§ 1ï¼šè¨˜æ†¶é«”å°é½Š</a></h4>
<pre><code class="language-c">// éŒ¯èª¤ï¼šæœªå°é½Š
float* data = (float*)malloc(size * sizeof(float));

// æ­£ç¢ºï¼š16 å­—ç¯€å°é½Š
float* data;
posix_memalign((void**)&amp;data, 16, size * sizeof(float));
</code></pre>
<h4 id="æŠ€å·§-2æ•¸æ“šé å–"><a class="header" href="#æŠ€å·§-2æ•¸æ“šé å–">æŠ€å·§ 2ï¼šæ•¸æ“šé å–</a></h4>
<pre><code class="language-c">void optimized_process(float* data, int size) {
    for (int i = 0; i &lt; size; i += 4) {
        // é å–ä¸‹ä¸€æ‰¹æ•¸æ“š
        __builtin_prefetch(&amp;data[i + 16], 0, 1);
        
        // è™•ç†ç•¶å‰æ•¸æ“š
        float32x4_t v = vld1q_f32(&amp;data[i]);
        // ...
    }
}
</code></pre>
<h4 id="æŠ€å·§-3loop-unrolling"><a class="header" href="#æŠ€å·§-3loop-unrolling">æŠ€å·§ 3ï¼šLoop Unrolling</a></h4>
<pre><code class="language-c">// å±•é–‹ 2 æ¬¡ï¼ˆè™•ç† 8 å€‹å…ƒç´ ï¼‰
for (i = 0; i &lt;= size - 8; i += 8) {
    float32x4_t v1 = vld1q_f32(a + i);
    float32x4_t v2 = vld1q_f32(a + i + 4);
    
    float32x4_t r1 = vaddq_f32(v1, vld1q_f32(b + i));
    float32x4_t r2 = vaddq_f32(v2, vld1q_f32(b + i + 4));
    
    vst1q_f32(result + i, r1);
    vst1q_f32(result + i + 4, r2);
}
</code></pre>
<h3 id="5-ç·¨è­¯å™¨è‡ªå‹•å‘é‡åŒ–"><a class="header" href="#5-ç·¨è­¯å™¨è‡ªå‹•å‘é‡åŒ–">5. ç·¨è­¯å™¨è‡ªå‹•å‘é‡åŒ–</a></h3>
<pre><code class="language-c">// è®“ç·¨è­¯å™¨è‡ªå‹•å„ªåŒ–
void auto_vectorize(float* a, float* b, float* c, int n) {
    #pragma clang loop vectorize(enable)
    for (int i = 0; i &lt; n; i++) {
        c[i] = a[i] + b[i];
    }
}

// ç·¨è­¯æ™‚åŠ ä¸Šï¼š
// -O3 -march=armv8-a+simd -fvectorize
</code></pre>
<h3 id="6-æ€§èƒ½åˆ†æå·¥å…·"><a class="header" href="#6-æ€§èƒ½åˆ†æå·¥å…·">6. æ€§èƒ½åˆ†æå·¥å…·</a></h3>
<pre><code class="language-bash"># ä½¿ç”¨ perf åˆ†æï¼ˆå¦‚æœè¨­å‚™æ”¯æ´ï¼‰
adb shell perf record -e cycles /data/local/tmp/neon_test_neon
adb shell perf report

# ä½¿ç”¨ Simpleperfï¼ˆAndroid å°ˆç”¨ï¼‰
adb shell simpleperf record -p &lt;pid&gt; sleep 10
adb shell simpleperf report
</code></pre>
<hr />
<h2 id="åƒè€ƒè³‡æº"><a class="header" href="#åƒè€ƒè³‡æº">åƒè€ƒè³‡æº</a></h2>
<h3 id="å®˜æ–¹æ–‡æª”"><a class="header" href="#å®˜æ–¹æ–‡æª”">å®˜æ–¹æ–‡æª”</a></h3>
<ul>
<li>
<p><strong>ARM NEON Intrinsics Reference</strong><br />
https://developer.arm.com/architectures/instruction-sets/intrinsics/</p>
</li>
<li>
<p><strong>ARM NEON Programmer's Guide</strong><br />
https://developer.arm.com/documentation/den0018/a</p>
</li>
<li>
<p><strong>Android NDK Documentation</strong><br />
https://developer.android.com/ndk</p>
</li>
<li>
<p><strong>NEON Optimization Guide</strong><br />
https://developer.arm.com/documentation/102159/latest/</p>
</li>
</ul>
<h3 id="æ•™å­¸è³‡æº"><a class="header" href="#æ•™å­¸è³‡æº">æ•™å­¸è³‡æº</a></h3>
<ul>
<li>
<p><strong>NEON Tutorial Series</strong><br />
https://community.arm.com/arm-community-blogs/b/architectures-and-processors-blog</p>
</li>
<li>
<p><strong>Coding for NEON</strong><br />
https://developer.arm.com/documentation/102467/latest/</p>
</li>
</ul>
<h3 id="å·¥å…·èˆ‡åº«"><a class="header" href="#å·¥å…·èˆ‡åº«">å·¥å…·èˆ‡åº«</a></h3>
<ul>
<li>
<p><strong>Ne10 Library</strong>ï¼ˆARM å®˜æ–¹å„ªåŒ–åº«ï¼‰<br />
https://github.com/projectNe10/Ne10</p>
</li>
<li>
<p><strong>CMSIS-DSP</strong>ï¼ˆä¿¡è™Ÿè™•ç†åº«ï¼‰<br />
https://github.com/ARM-software/CMSIS_5</p>
</li>
<li>
<p><strong>OpenCV with NEON</strong><br />
https://opencv.org/</p>
</li>
</ul>
<h3 id="ç¤¾ç¾¤è³‡æº"><a class="header" href="#ç¤¾ç¾¤è³‡æº">ç¤¾ç¾¤è³‡æº</a></h3>
<ul>
<li>
<p><strong>Stack Overflow - NEON Tag</strong><br />
https://stackoverflow.com/questions/tagged/arm-neon</p>
</li>
<li>
<p><strong>ARM Community Forum</strong><br />
https://community.arm.com/</p>
</li>
</ul>
<hr />
<h2 id="é™„éŒ„å®Œæ•´ä»£ç¢¼æ¸…å–®"><a class="header" href="#é™„éŒ„å®Œæ•´ä»£ç¢¼æ¸…å–®">é™„éŒ„ï¼šå®Œæ•´ä»£ç¢¼æ¸…å–®</a></h2>
<h3 id="a-neon_testc"><a class="header" href="#a-neon_testc">A. neon_test.c</a></h3>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;time.h&gt;
#include &lt;string.h&gt;

#ifdef USE_NEON
#include &lt;arm_neon.h&gt;
#endif

#define ARRAY_SIZE (1024 * 1024)
#define ITERATIONS 100

// ä¸ä½¿ç”¨ NEON çš„å‘é‡åŠ æ³•
void vector_add_normal(float* a, float* b, float* result, int size) {
    for (int i = 0; i &lt; size; i++) {
        result[i] = a[i] + b[i];
    }
}

#ifdef USE_NEON
// ä½¿ç”¨ NEON çš„å‘é‡åŠ æ³•
void vector_add_neon(float* a, float* b, float* result, int size) {
    int i;
    for (i = 0; i &lt;= size - 4; i += 4) {
        float32x4_t va = vld1q_f32(a + i);
        float32x4_t vb = vld1q_f32(b + i);
        float32x4_t vr = vaddq_f32(va, vb);
        vst1q_f32(result + i, vr);
    }
    for (; i &lt; size; i++) {
        result[i] = a[i] + b[i];
    }
}
#endif

double get_time_ms() {
    struct timespec ts;
    clock_gettime(CLOCK_MONOTONIC, &amp;ts);
    return ts.tv_sec * 1000.0 + ts.tv_nsec / 1000000.0;
}

int main() {
    float *a, *b, *result;
    double start, end, elapsed;
    
    printf("=================================\n");
    printf("ARM NEON Performance Test\n");
    printf("=================================\n");
    printf("Array size: %d elements\n", ARRAY_SIZE);
    printf("Iterations: %d\n\n", ITERATIONS);
    
    posix_memalign((void**)&amp;a, 16, ARRAY_SIZE * sizeof(float));
    posix_memalign((void**)&amp;b, 16, ARRAY_SIZE * sizeof(float));
    posix_memalign((void**)&amp;result, 16, ARRAY_SIZE * sizeof(float));
    
    for (int i = 0; i &lt; ARRAY_SIZE; i++) {
        a[i] = (float)i;
        b[i] = (float)(i * 2);
    }
    
#ifdef USE_NEON
    printf("Testing with NEON optimization...\n");
    start = get_time_ms();
    for (int iter = 0; iter &lt; ITERATIONS; iter++) {
        vector_add_neon(a, b, result, ARRAY_SIZE);
    }
    end = get_time_ms();
    elapsed = end - start;
    printf("NEON time: %.2f ms\n", elapsed);
    printf("Average per iteration: %.4f ms\n", elapsed / ITERATIONS);
#else
    printf("Testing without NEON (normal)...\n");
    start = get_time_ms();
    for (int iter = 0; iter &lt; ITERATIONS; iter++) {
        vector_add_normal(a, b, result, ARRAY_SIZE);
    }
    end = get_time_ms();
    elapsed = end - start;
    printf("Normal time: %.2f ms\n", elapsed);
    printf("Average per iteration: %.4f ms\n", elapsed / ITERATIONS);
#endif
    
    int errors = 0;
    for (int i = 0; i &lt; 10 &amp;&amp; i &lt; ARRAY_SIZE; i++) {
        float expected = a[i] + b[i];
        if (result[i] != expected) {
            printf("Error at index %d: got %f, expected %f\n", i, result[i], expected);
            errors++;
        }
    }
    if (errors == 0) {
        printf("\nâœ“ Results verified successfully!\n");
    }
    
    free(a);
    free(b);
    free(result);
    
    printf("=================================\n");
    return 0;
}
</code></pre>
<h3 id="b-compilesh"><a class="header" href="#b-compilesh">B. compile.sh</a></h3>
<pre><code class="language-bash">#!/bin/bash

echo "================================="
echo "ARM NEON Test Compilation Script"
echo "================================="

if [ -z "$NDK_ROOT" ]; then
    echo "Error: NDK_ROOT environment variable not set!"
    echo "Please set it to your Android NDK path"
    exit 1
fi

TOOLCHAIN=$NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64
CC=$TOOLCHAIN/bin/aarch64-linux-android30-clang

if [ ! -f "$CC" ]; then
    echo "Error: Compiler not found at $CC"
    exit 1
fi

echo "Using compiler: $CC"
echo ""

echo "Compiling WITHOUT NEON..."
$CC neon_test.c -o neon_test_normal -O2 -static -pie -lm
echo "âœ“ Created: neon_test_normal"

echo "Compiling WITH NEON..."
$CC neon_test.c -o neon_test_neon -O2 -march=armv8-a+simd -DUSE_NEON -static -pie -lm
echo "âœ“ Created: neon_test_neon"

echo ""
echo "Compilation completed!"
ls -lh neon_test_normal neon_test_neon
</code></pre>
<h3 id="c-push_and_testsh"><a class="header" href="#c-push_and_testsh">C. push_and_test.sh</a></h3>
<pre><code class="language-bash">#!/bin/bash

echo "================================="
echo "ARM NEON Test - Push and Execute"
echo "================================="

adb devices
if [ $? -ne 0 ]; then
    echo "Error: adb not found or device not connected"
    exit 1
fi

echo ""
echo "Pushing files to device..."
adb push neon_test_normal /data/local/tmp/
adb push neon_test_neon /data/local/tmp/

echo ""
echo "Setting permissions..."
adb shell chmod 755 /data/local/tmp/neon_test_normal
adb shell chmod 755 /data/local/tmp/neon_test_neon

echo ""
echo "================================="
echo "Running TEST 1: WITHOUT NEON"
echo "================================="
adb shell /data/local/tmp/neon_test_normal

echo ""
echo "================================="
echo "Running TEST 2: WITH NEON"
echo "================================="
adb shell /data/local/tmp/neon_test_neon

echo ""
echo "Test completed!"
</code></pre>
<hr />
<h2 id="çµèª"><a class="header" href="#çµèª">çµèª</a></h2>
<p>æœ¬æŒ‡å—æä¾›äº†å¾é›¶é–‹å§‹ä½¿ç”¨ ARM NEON é€²è¡Œæ€§èƒ½å„ªåŒ–çš„å®Œæ•´æµç¨‹ã€‚é€šéå¯¦éš›æ¸¬è©¦ï¼Œæ‚¨æ‡‰è©²èƒ½å¤ ï¼š</p>
<p>âœ… ç†è§£ NEON çš„å·¥ä½œåŸç†<br />
âœ… æŒæ¡ç·¨è­¯å’Œéƒ¨ç½²æµç¨‹<br />
âœ… æ¸¬é‡å¯¦éš›çš„æ€§èƒ½æå‡<br />
âœ… æ‡‰ç”¨åˆ°å¯¦éš›é …ç›®ä¸­</p>
<p><strong>è¨˜ä½ï¼šNEON å„ªåŒ–æœ€é©åˆ</strong></p>
<ul>
<li>å¤§é‡é‡è¤‡çš„æ•¸å­¸é‹ç®—</li>
<li>å¯ä¸¦è¡Œçš„æ•¸æ“šè™•ç†</li>
<li>æ€§èƒ½é—œéµçš„ä»£ç¢¼è·¯å¾‘</li>
</ul>
<p>é–‹å§‹æ‚¨çš„ NEON å„ªåŒ–ä¹‹æ—…å§ï¼ğŸš€</p>
<hr />
<p><strong>ç‰ˆæœ¬ï¼š</strong> 1.0<br />
<strong>æ›´æ–°æ—¥æœŸï¼š</strong> 2025-11-04<br />
<strong>ä½œè€…ï¼š</strong> Claude<br />
<strong>æˆæ¬Šï¼š</strong> MIT License</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../cpu_architecture/cpu_architecture.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../android/android.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../cpu_architecture/cpu_architecture.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../android/android.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
