<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MobileCLIP Android å®Œæ•´éƒ¨ç½²æŒ‡å— - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="mobileclip-android-å®Œæ•´éƒ¨ç½²æŒ‡å—"><a class="header" href="#mobileclip-android-å®Œæ•´éƒ¨ç½²æŒ‡å—">MobileCLIP Android å®Œæ•´éƒ¨ç½²æŒ‡å—</a></h1>
<blockquote>
<p><strong>æ›´æ–°æ—¥æœŸ</strong>ï¼š2025-10-27<br />
<strong>é›£åº¦ç­‰ç´š</strong>ï¼šä¸­ç­‰<br />
<strong>é è¨ˆæ™‚é–“</strong>ï¼š2-3 å°æ™‚</p>
</blockquote>
<hr />
<h2 id="-ç›®éŒ„"><a class="header" href="#-ç›®éŒ„">ğŸ“‹ ç›®éŒ„</a></h2>
<ol>
<li><a href="#1-%E6%96%B9%E6%A1%88%E9%81%B8%E6%93%87">æ–¹æ¡ˆé¸æ“‡</a></li>
<li><a href="#2-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99">ç’°å¢ƒæº–å‚™</a></li>
<li><a href="#3-%E6%96%B9%E6%A1%88-a-onnx-runtime%E6%8E%A8%E8%96%A6">æ–¹æ¡ˆ Aï¼šONNX Runtimeï¼ˆæ¨è–¦ï¼‰</a></li>
<li><a href="#4-%E6%96%B9%E6%A1%88-b-tensorflow-lite">æ–¹æ¡ˆ Bï¼šTensorFlow Lite</a></li>
<li><a href="#5-android-%E5%B0%88%E6%A1%88%E5%AF%A6%E4%BD%9C">Android å°ˆæ¡ˆå¯¦ä½œ</a></li>
<li><a href="#6-%E5%AE%8C%E6%95%B4%E5%95%86%E5%93%81%E6%90%9C%E5%B0%8B-app">å®Œæ•´å•†å“æœå°‹ App</a></li>
<li><a href="#7-%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96">æ•ˆèƒ½å„ªåŒ–</a></li>
<li><a href="#8-%E5%B8%B8%E8%A6%8B%E5%95%8F%E9%A1%8C">å¸¸è¦‹å•é¡Œ</a></li>
</ol>
<hr />
<h2 id="1-æ–¹æ¡ˆé¸æ“‡"><a class="header" href="#1-æ–¹æ¡ˆé¸æ“‡">1. æ–¹æ¡ˆé¸æ“‡</a></h2>
<h3 id="å…©ç¨®éƒ¨ç½²æ–¹æ¡ˆå°æ¯”"><a class="header" href="#å…©ç¨®éƒ¨ç½²æ–¹æ¡ˆå°æ¯”">å…©ç¨®éƒ¨ç½²æ–¹æ¡ˆå°æ¯”</a></h3>
<div class="table-wrapper"><table><thead><tr><th>ç‰¹æ€§</th><th>ONNX Runtime</th><th>TensorFlow Lite</th></tr></thead><tbody>
<tr><td><strong>è½‰æ›è¤‡é›œåº¦</strong></td><td>â­â­ (ç°¡å–®)</td><td>â­â­â­â­ (è¤‡é›œ)</td></tr>
<tr><td><strong>æ•ˆèƒ½</strong></td><td>â­â­â­â­ (å„ª)</td><td>â­â­â­â­â­ (æœ€å„ª)</td></tr>
<tr><td><strong>APK é«”ç©</strong></td><td>+8-15 MB</td><td>+3-8 MB</td></tr>
<tr><td><strong>ç¡¬é«”åŠ é€Ÿ</strong></td><td>NNAPI, CPU</td><td>NNAPI, GPU, EdgeTPU</td></tr>
<tr><td><strong>ç¶­è­·é›£åº¦</strong></td><td>ä½</td><td>ä¸­</td></tr>
<tr><td><strong>æ¨è–¦åº¦</strong></td><td>âœ… <strong>æ¨è–¦æ–°æ‰‹</strong></td><td>é€²éšç”¨æˆ¶</td></tr>
</tbody></table>
</div>
<h3 id="æ¨è–¦æ–¹æ¡ˆ"><a class="header" href="#æ¨è–¦æ–¹æ¡ˆ">æ¨è–¦æ–¹æ¡ˆ</a></h3>
<pre><code>ã€æ¨è–¦ã€‘ONNX Runtime
ç†ç”±ï¼š
âœ… è½‰æ›æ­¥é©Ÿå°‘ï¼ˆPyTorch â†’ ONNXï¼Œä¸€æ­¥åˆ°ä½ï¼‰
âœ… ç¨‹å¼ç¢¼ç°¡å–®
âœ… æ•ˆèƒ½è¶³å¤ å¥½
âœ… ç¶­è­·å®¹æ˜“

ã€é€²éšã€‘TensorFlow Lite
é©åˆï¼š
- éœ€è¦æ¥µè‡´æ•ˆèƒ½
- å·²æœ‰ TFLite ç¶“é©—
- é¡˜æ„èŠ±æ™‚é–“èª¿è©¦
</code></pre>
<hr />
<h2 id="2-ç’°å¢ƒæº–å‚™"><a class="header" href="#2-ç’°å¢ƒæº–å‚™">2. ç’°å¢ƒæº–å‚™</a></h2>
<h3 id="21-é–‹ç™¼ç’°å¢ƒéœ€æ±‚"><a class="header" href="#21-é–‹ç™¼ç’°å¢ƒéœ€æ±‚">2.1 é–‹ç™¼ç’°å¢ƒéœ€æ±‚</a></h3>
<p><strong>é›»è…¦ç«¯ï¼ˆæ¨¡å‹è½‰æ›ï¼‰</strong>ï¼š</p>
<pre><code class="language-bash"># ä½œæ¥­ç³»çµ±
Windows 10/11, macOS, Linux

# Python ç’°å¢ƒ
Python 3.8-3.10

# å¿…è¦å·¥å…·
- Git
- Python pip
- Conda (æ¨è–¦)
</code></pre>
<p><strong>Android é–‹ç™¼ç«¯</strong>ï¼š</p>
<pre><code class="language-bash"># Android Studio
Android Studio Hedgehog | 2023.1.1 æˆ–æ›´æ–°ç‰ˆæœ¬

# SDK ç‰ˆæœ¬
- Min SDK: 24 (Android 7.0)
- Target SDK: 34 (Android 14)
- Compile SDK: 34

# NDK (ONNX Runtime éœ€è¦)
NDK ç‰ˆæœ¬ 25.x æˆ–æ›´æ–°
</code></pre>
<h3 id="22-python-ç’°å¢ƒè¨­ç½®"><a class="header" href="#22-python-ç’°å¢ƒè¨­ç½®">2.2 Python ç’°å¢ƒè¨­ç½®</a></h3>
<pre><code class="language-bash"># å‰µå»ºè™›æ“¬ç’°å¢ƒ
conda create -n mobileclip-android python=3.10
conda activate mobileclip-android

# å®‰è£åŸºç¤å¥—ä»¶
pip install torch torchvision
pip install onnx onnxruntime
pip install pillow numpy

# å®‰è£ MobileCLIP
git clone https://github.com/apple/ml-mobileclip.git
cd ml-mobileclip
pip install -e .

# é©—è­‰å®‰è£
python -c "import mobileclip; print('âœ… MobileCLIP å®‰è£æˆåŠŸ')"
</code></pre>
<hr />
<h2 id="3-æ–¹æ¡ˆ-a-onnx-runtimeæ¨è–¦"><a class="header" href="#3-æ–¹æ¡ˆ-a-onnx-runtimeæ¨è–¦">3. æ–¹æ¡ˆ A: ONNX Runtimeï¼ˆæ¨è–¦ï¼‰</a></h2>
<h3 id="31-æ¨¡å‹è½‰æ›ç‚º-onnx"><a class="header" href="#31-æ¨¡å‹è½‰æ›ç‚º-onnx">3.1 æ¨¡å‹è½‰æ›ç‚º ONNX</a></h3>
<h4 id="æ­¥é©Ÿ-1è½‰æ›è…³æœ¬"><a class="header" href="#æ­¥é©Ÿ-1è½‰æ›è…³æœ¬">æ­¥é©Ÿ 1ï¼šè½‰æ›è…³æœ¬</a></h4>
<p>å‰µå»º <code>convert_to_onnx.py</code>ï¼š</p>
<pre><code class="language-python">#!/usr/bin/env python3
"""
MobileCLIP PyTorch â†’ ONNX è½‰æ›è…³æœ¬
"""

import torch
import mobileclip
import onnx
from onnx import version_converter

def convert_image_encoder(model_name='mobileclip_s2', 
                         model_path='checkpoints/mobileclip_s2.pt',
                         output_path='mobileclip_image_encoder.onnx'):
    """
    è½‰æ›åœ–ç‰‡ç·¨ç¢¼å™¨ç‚º ONNX
    
    Args:
        model_name: æ¨¡å‹åç¨±
        model_path: PyTorch æ¨¡å‹è·¯å¾‘
        output_path: è¼¸å‡º ONNX æª”æ¡ˆè·¯å¾‘
    """
    print(f"ğŸ”„ é–‹å§‹è½‰æ› {model_name} åœ–ç‰‡ç·¨ç¢¼å™¨...")
    
    # è¼‰å…¥æ¨¡å‹
    model, _, preprocess = mobileclip.create_model_and_transforms(
        model_name,
        pretrained=model_path
    )
    model.eval()
    
    # ç²å–åœ–ç‰‡ç·¨ç¢¼å™¨
    image_encoder = model.visual
    
    # å‰µå»ºç¤ºä¾‹è¼¸å…¥ï¼ˆbatch_size=1, channels=3, height=224, width=224ï¼‰
    dummy_input = torch.randn(1, 3, 224, 224)
    
    # å°å‡ºç‚º ONNX
    torch.onnx.export(
        image_encoder,
        dummy_input,
        output_path,
        input_names=['image'],
        output_names=['image_features'],
        dynamic_axes={
            'image': {0: 'batch_size'},
            'image_features': {0: 'batch_size'}
        },
        opset_version=14,  # ONNX Runtime æ”¯æ´è‰¯å¥½çš„ç‰ˆæœ¬
        do_constant_folding=True,
        export_params=True
    )
    
    # é©—è­‰æ¨¡å‹
    onnx_model = onnx.load(output_path)
    onnx.checker.check_model(onnx_model)
    
    print(f"âœ… åœ–ç‰‡ç·¨ç¢¼å™¨è½‰æ›å®Œæˆï¼š{output_path}")
    print(f"   æ¨¡å‹å¤§å°ï¼š{os.path.getsize(output_path) / 1024 / 1024:.2f} MB")
    
    return output_path


def convert_text_encoder(model_name='mobileclip_s2',
                        model_path='checkpoints/mobileclip_s2.pt',
                        output_path='mobileclip_text_encoder.onnx'):
    """
    è½‰æ›æ–‡å­—ç·¨ç¢¼å™¨ç‚º ONNX
    
    Args:
        model_name: æ¨¡å‹åç¨±
        model_path: PyTorch æ¨¡å‹è·¯å¾‘
        output_path: è¼¸å‡º ONNX æª”æ¡ˆè·¯å¾‘
    """
    print(f"ğŸ”„ é–‹å§‹è½‰æ› {model_name} æ–‡å­—ç·¨ç¢¼å™¨...")
    
    # è¼‰å…¥æ¨¡å‹
    model, _, preprocess = mobileclip.create_model_and_transforms(
        model_name,
        pretrained=model_path
    )
    model.eval()
    tokenizer = mobileclip.get_tokenizer(model_name)
    
    # ç²å–æ–‡å­—ç·¨ç¢¼å™¨
    text_encoder = model.text
    
    # å‰µå»ºç¤ºä¾‹è¼¸å…¥ï¼ˆæ–‡å­— tokenï¼‰
    dummy_text = tokenizer(["a photo of a cat"])
    
    # å°å‡ºç‚º ONNX
    torch.onnx.export(
        text_encoder,
        dummy_text,
        output_path,
        input_names=['text'],
        output_names=['text_features'],
        dynamic_axes={
            'text': {0: 'batch_size'},
            'text_features': {0: 'batch_size'}
        },
        opset_version=14,
        do_constant_folding=True,
        export_params=True
    )
    
    # é©—è­‰æ¨¡å‹
    onnx_model = onnx.load(output_path)
    onnx.checker.check_model(onnx_model)
    
    print(f"âœ… æ–‡å­—ç·¨ç¢¼å™¨è½‰æ›å®Œæˆï¼š{output_path}")
    print(f"   æ¨¡å‹å¤§å°ï¼š{os.path.getsize(output_path) / 1024 / 1024:.2f} MB")
    
    return output_path


def optimize_onnx_model(input_path, output_path):
    """
    å„ªåŒ– ONNX æ¨¡å‹ï¼ˆæ¸›å°é«”ç©ã€æå‡é€Ÿåº¦ï¼‰
    
    Args:
        input_path: è¼¸å…¥ ONNX æ¨¡å‹
        output_path: å„ªåŒ–å¾Œçš„è¼¸å‡ºè·¯å¾‘
    """
    print(f"âš¡ å„ªåŒ–æ¨¡å‹ï¼š{input_path}")
    
    from onnxruntime.quantization import quantize_dynamic, QuantType
    
    # å‹•æ…‹é‡åŒ–ï¼ˆFP32 â†’ INT8ï¼‰
    quantize_dynamic(
        input_path,
        output_path,
        weight_type=QuantType.QUInt8  # 8-bit é‡åŒ–
    )
    
    original_size = os.path.getsize(input_path) / 1024 / 1024
    optimized_size = os.path.getsize(output_path) / 1024 / 1024
    
    print(f"âœ… å„ªåŒ–å®Œæˆ")
    print(f"   åŸå§‹å¤§å°ï¼š{original_size:.2f} MB")
    print(f"   å„ªåŒ–å¾Œï¼š{optimized_size:.2f} MB")
    print(f"   å£“ç¸®ç‡ï¼š{(1 - optimized_size/original_size)*100:.1f}%")


def verify_conversion(onnx_path, pytorch_model):
    """
    é©—è­‰è½‰æ›å¾Œçš„ ONNX æ¨¡å‹è¼¸å‡ºæ˜¯å¦æ­£ç¢º
    
    Args:
        onnx_path: ONNX æ¨¡å‹è·¯å¾‘
        pytorch_model: PyTorch æ¨¡å‹
    """
    print("ğŸ” é©—è­‰æ¨¡å‹è¼¸å‡º...")
    
    import onnxruntime as ort
    
    # å‰µå»ºæ¸¬è©¦è¼¸å…¥
    test_input = torch.randn(1, 3, 224, 224)
    
    # PyTorch æ¨è«–
    with torch.no_grad():
        pytorch_output = pytorch_model.visual(test_input).numpy()
    
    # ONNX æ¨è«–
    session = ort.InferenceSession(onnx_path)
    onnx_output = session.run(
        None,
        {'image': test_input.numpy()}
    )[0]
    
    # æ¯”è¼ƒè¼¸å‡º
    diff = np.abs(pytorch_output - onnx_output).max()
    print(f"âœ… æœ€å¤§è¼¸å‡ºå·®ç•°ï¼š{diff:.6f}")
    
    if diff &lt; 1e-5:
        print("âœ… è½‰æ›æ­£ç¢ºï¼")
    else:
        print("âš ï¸  è¼¸å‡ºæœ‰å·®ç•°ï¼Œè«‹æª¢æŸ¥")


if __name__ == '__main__':
    import os
    import sys
    import numpy as np
    
    # é…ç½®
    MODEL_NAME = 'mobileclip_s2'  # å¯æ”¹ç‚º s0, s1, b, blt
    MODEL_PATH = 'checkpoints/mobileclip_s2.pt'
    OUTPUT_DIR = 'android_models'
    
    # å‰µå»ºè¼¸å‡ºç›®éŒ„
    os.makedirs(OUTPUT_DIR, exist_ok=True)
    
    print("=" * 50)
    print("ğŸš€ MobileCLIP â†’ ONNX è½‰æ›å·¥å…·")
    print("=" * 50)
    
    # 1. è½‰æ›åœ–ç‰‡ç·¨ç¢¼å™¨
    image_onnx = convert_image_encoder(
        model_name=MODEL_NAME,
        model_path=MODEL_PATH,
        output_path=f'{OUTPUT_DIR}/mobileclip_image.onnx'
    )
    
    # 2. è½‰æ›æ–‡å­—ç·¨ç¢¼å™¨
    text_onnx = convert_text_encoder(
        model_name=MODEL_NAME,
        model_path=MODEL_PATH,
        output_path=f'{OUTPUT_DIR}/mobileclip_text.onnx'
    )
    
    # 3. å„ªåŒ–æ¨¡å‹ï¼ˆå¯é¸ï¼Œä½†æ¨è–¦ï¼‰
    print("\n" + "=" * 50)
    print("âš¡ é–‹å§‹å„ªåŒ–æ¨¡å‹...")
    print("=" * 50)
    
    optimize_onnx_model(
        image_onnx,
        f'{OUTPUT_DIR}/mobileclip_image_quantized.onnx'
    )
    
    optimize_onnx_model(
        text_onnx,
        f'{OUTPUT_DIR}/mobileclip_text_quantized.onnx'
    )
    
    print("\n" + "=" * 50)
    print("ğŸ‰ æ‰€æœ‰è½‰æ›å®Œæˆï¼")
    print("=" * 50)
    print(f"\nğŸ“ æ¨¡å‹æª”æ¡ˆä½ç½®ï¼š{os.path.abspath(OUTPUT_DIR)}")
    print("\nå¯ç”¨æ¨¡å‹ï¼š")
    print("  1. mobileclip_image.onnx (åŸå§‹)")
    print("  2. mobileclip_image_quantized.onnx (å„ªåŒ–ï¼Œæ¨è–¦)")
    print("  3. mobileclip_text.onnx (åŸå§‹)")
    print("  4. mobileclip_text_quantized.onnx (å„ªåŒ–ï¼Œæ¨è–¦)")
    print("\nğŸ’¡ å»ºè­°ä½¿ç”¨é‡åŒ–ç‰ˆæœ¬ä»¥æ¸›å°‘ APK å¤§å°")
</code></pre>
<h4 id="æ­¥é©Ÿ-2åŸ·è¡Œè½‰æ›"><a class="header" href="#æ­¥é©Ÿ-2åŸ·è¡Œè½‰æ›">æ­¥é©Ÿ 2ï¼šåŸ·è¡Œè½‰æ›</a></h4>
<pre><code class="language-bash"># ç¢ºä¿å·²ä¸‹è¼‰æ¨¡å‹
cd ml-mobileclip
source get_pretrained_models.sh

# åŸ·è¡Œè½‰æ›
python convert_to_onnx.py

# è¼¸å‡ºçµæœ
# âœ… android_models/
#    â”œâ”€â”€ mobileclip_image.onnx          (35MB)
#    â”œâ”€â”€ mobileclip_image_quantized.onnx (9MB) ğŸ‘ˆ æ¨è–¦
#    â”œâ”€â”€ mobileclip_text.onnx           (42MB)
#    â””â”€â”€ mobileclip_text_quantized.onnx (11MB) ğŸ‘ˆ æ¨è–¦
</code></pre>
<h3 id="32-android-å°ˆæ¡ˆè¨­ç½®"><a class="header" href="#32-android-å°ˆæ¡ˆè¨­ç½®">3.2 Android å°ˆæ¡ˆè¨­ç½®</a></h3>
<h4 id="æ­¥é©Ÿ-1å‰µå»º-android-å°ˆæ¡ˆ"><a class="header" href="#æ­¥é©Ÿ-1å‰µå»º-android-å°ˆæ¡ˆ">æ­¥é©Ÿ 1ï¼šå‰µå»º Android å°ˆæ¡ˆ</a></h4>
<pre><code>Android Studio &gt; New Project &gt; Empty Views Activity

å°ˆæ¡ˆè¨­å®šï¼š
- Name: MobileCLIPDemo
- Package: com.example.mobileclip
- Language: Kotlin
- Minimum SDK: API 24 (Android 7.0)
</code></pre>
<h4 id="æ­¥é©Ÿ-2æ·»åŠ ä¾è³´"><a class="header" href="#æ­¥é©Ÿ-2æ·»åŠ ä¾è³´">æ­¥é©Ÿ 2ï¼šæ·»åŠ ä¾è³´</a></h4>
<p><code>app/build.gradle.kts</code>ï¼š</p>
<pre><code class="language-kotlin">plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
}

android {
    namespace = "com.example.mobileclip"
    compileSdk = 34
    
    defaultConfig {
        applicationId = "com.example.mobileclip"
        minSdk = 24
        targetSdk = 34
        versionCode = 1
        versionName = "1.0"
        
        // ONNX Runtime éœ€è¦
        ndk {
            abiFilters += listOf("arm64-v8a", "armeabi-v7a")
        }
    }
    
    buildTypes {
        release {
            isMinifyEnabled = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
    
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }
    
    kotlinOptions {
        jvmTarget = "1.8"
    }
    
    buildFeatures {
        viewBinding = true
    }
}

dependencies {
    // ONNX Runtime
    implementation("com.microsoft.onnxruntime:onnxruntime-android:1.17.0")
    
    // åœ–ç‰‡è™•ç†
    implementation("androidx.camera:camera-camera2:1.3.1")
    implementation("androidx.camera:camera-lifecycle:1.3.1")
    implementation("androidx.camera:camera-view:1.3.1")
    
    // Coroutines
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3")
    
    // ViewModel
    implementation("androidx.lifecycle:lifecycle-viewmodel-ktx:2.7.0")
    implementation("androidx.lifecycle:lifecycle-runtime-ktx:2.7.0")
    
    // UI
    implementation("androidx.core:core-ktx:1.12.0")
    implementation("androidx.appcompat:appcompat:1.6.1")
    implementation("com.google.android.material:material:1.11.0")
    implementation("androidx.constraintlayout:constraintlayout:2.1.4")
}
</code></pre>
<h4 id="æ­¥é©Ÿ-3æ”¾ç½®æ¨¡å‹æª”æ¡ˆ"><a class="header" href="#æ­¥é©Ÿ-3æ”¾ç½®æ¨¡å‹æª”æ¡ˆ">æ­¥é©Ÿ 3ï¼šæ”¾ç½®æ¨¡å‹æª”æ¡ˆ</a></h4>
<pre><code>1. åœ¨ Android Studio ä¸­ï¼š
   å³éµé»æ“Š app &gt; New &gt; Folder &gt; Assets Folder

2. å°‡ ONNX æ¨¡å‹è¤‡è£½åˆ° app/src/main/assets/
   app/src/main/assets/
   â”œâ”€â”€ mobileclip_image_quantized.onnx
   â””â”€â”€ mobileclip_text_quantized.onnx
</code></pre>
<h3 id="33-æ ¸å¿ƒæ¨è«–ç¨‹å¼ç¢¼"><a class="header" href="#33-æ ¸å¿ƒæ¨è«–ç¨‹å¼ç¢¼">3.3 æ ¸å¿ƒæ¨è«–ç¨‹å¼ç¢¼</a></h3>
<p>å‰µå»º <code>MobileCLIPInference.kt</code>ï¼š</p>
<pre><code class="language-kotlin">package com.example.mobileclip

import android.content.Context
import android.graphics.Bitmap
import ai.onnxruntime.*
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext
import java.nio.ByteBuffer
import java.nio.ByteOrder
import java.nio.FloatBuffer

/**
 * MobileCLIP æ¨è«–å¼•æ“
 */
class MobileCLIPInference(private val context: Context) {
    
    private var imageSession: OrtSession? = null
    private var textSession: OrtSession? = null
    private val ortEnvironment = OrtEnvironment.getEnvironment()
    
    companion object {
        private const val IMAGE_MODEL = "mobileclip_image_quantized.onnx"
        private const val TEXT_MODEL = "mobileclip_text_quantized.onnx"
        
        // åœ–ç‰‡é è™•ç†åƒæ•¸
        private const val INPUT_SIZE = 224
        private val MEAN = floatArrayOf(0.48145466f, 0.4578275f, 0.40821073f)
        private val STD = floatArrayOf(0.26862954f, 0.26130258f, 0.27577711f)
        
        // ç‰¹å¾µç¶­åº¦
        private const val FEATURE_DIM = 512
    }
    
    /**
     * åˆå§‹åŒ–æ¨¡å‹
     */
    suspend fun initialize() = withContext(Dispatchers.IO) {
        try {
            // è¼‰å…¥åœ–ç‰‡ç·¨ç¢¼å™¨
            val imageModelBytes = context.assets.open(IMAGE_MODEL).readBytes()
            imageSession = ortEnvironment.createSession(imageModelBytes)
            
            // è¼‰å…¥æ–‡å­—ç·¨ç¢¼å™¨
            val textModelBytes = context.assets.open(TEXT_MODEL).readBytes()
            textSession = ortEnvironment.createSession(textModelBytes)
            
            println("âœ… MobileCLIP æ¨¡å‹è¼‰å…¥æˆåŠŸ")
        } catch (e: Exception) {
            println("âŒ æ¨¡å‹è¼‰å…¥å¤±æ•—: ${e.message}")
            throw e
        }
    }
    
    /**
     * ç·¨ç¢¼åœ–ç‰‡ç‚ºå‘é‡
     */
    suspend fun encodeImage(bitmap: Bitmap): FloatArray = withContext(Dispatchers.Default) {
        requireNotNull(imageSession) { "æ¨¡å‹æœªåˆå§‹åŒ–ï¼Œè«‹å…ˆå‘¼å« initialize()" }
        
        // 1. é è™•ç†åœ–ç‰‡
        val preprocessed = preprocessImage(bitmap)
        
        // 2. å‰µå»º ONNX è¼¸å…¥
        val inputTensor = OnnxTensor.createTensor(
            ortEnvironment,
            FloatBuffer.wrap(preprocessed),
            longArrayOf(1, 3, INPUT_SIZE.toLong(), INPUT_SIZE.toLong())
        )
        
        // 3. åŸ·è¡Œæ¨è«–
        val inputs = mapOf("image" to inputTensor)
        val outputs = imageSession!!.run(inputs)
        
        // 4. ç²å–è¼¸å‡º
        val output = outputs[0].value as Array&lt;FloatArray&gt;
        val features = output[0]
        
        // 5. L2 æ­£è¦åŒ–
        normalizeFeatures(features)
        
        // 6. æ¸…ç†
        inputTensor.close()
        outputs.close()
        
        return@withContext features
    }
    
    /**
     * ç·¨ç¢¼æ–‡å­—ç‚ºå‘é‡
     */
    suspend fun encodeText(text: String): FloatArray = withContext(Dispatchers.Default) {
        requireNotNull(textSession) { "æ¨¡å‹æœªåˆå§‹åŒ–ï¼Œè«‹å…ˆå‘¼å« initialize()" }
        
        // 1. Tokenize æ–‡å­—
        val tokens = tokenize(text)
        
        // 2. å‰µå»º ONNX è¼¸å…¥
        val inputTensor = OnnxTensor.createTensor(
            ortEnvironment,
            tokens,
            longArrayOf(1, tokens.size.toLong())
        )
        
        // 3. åŸ·è¡Œæ¨è«–
        val inputs = mapOf("text" to inputTensor)
        val outputs = textSession!!.run(inputs)
        
        // 4. ç²å–è¼¸å‡º
        val output = outputs[0].value as Array&lt;FloatArray&gt;
        val features = output[0]
        
        // 5. L2 æ­£è¦åŒ–
        normalizeFeatures(features)
        
        // 6. æ¸…ç†
        inputTensor.close()
        outputs.close()
        
        return@withContext features
    }
    
    /**
     * è¨ˆç®—å…©å€‹å‘é‡çš„é¤˜å¼¦ç›¸ä¼¼åº¦
     */
    fun calculateSimilarity(features1: FloatArray, features2: FloatArray): Float {
        require(features1.size == features2.size) { "ç‰¹å¾µç¶­åº¦ä¸åŒ¹é…" }
        
        var dotProduct = 0f
        for (i in features1.indices) {
            dotProduct += features1[i] * features2[i]
        }
        
        return dotProduct
    }
    
    /**
     * åœ–ç‰‡é è™•ç†
     * æ­¥é©Ÿï¼šResize â†’ Center Crop â†’ Normalize
     */
    private fun preprocessImage(bitmap: Bitmap): FloatArray {
        // 1. Resize åˆ° 256x256
        val resized = Bitmap.createScaledBitmap(bitmap, 256, 256, true)
        
        // 2. Center Crop åˆ° 224x224
        val startX = (256 - INPUT_SIZE) / 2
        val startY = (256 - INPUT_SIZE) / 2
        val cropped = Bitmap.createBitmap(resized, startX, startY, INPUT_SIZE, INPUT_SIZE)
        
        // 3. è½‰æ›ç‚º Float Array (CHW format)
        val floatArray = FloatArray(3 * INPUT_SIZE * INPUT_SIZE)
        val pixels = IntArray(INPUT_SIZE * INPUT_SIZE)
        cropped.getPixels(pixels, 0, INPUT_SIZE, 0, 0, INPUT_SIZE, INPUT_SIZE)
        
        for (i in pixels.indices) {
            val pixel = pixels[i]
            
            // RGB å€¼ (0-255)
            val r = ((pixel shr 16) and 0xFF) / 255f
            val g = ((pixel shr 8) and 0xFF) / 255f
            val b = (pixel and 0xFF) / 255f
            
            // æ¨™æº–åŒ–ä¸¦è½‰ç‚º CHW æ ¼å¼
            floatArray[i] = (r - MEAN[0]) / STD[0]  // R channel
            floatArray[INPUT_SIZE * INPUT_SIZE + i] = (g - MEAN[1]) / STD[1]  // G channel
            floatArray[2 * INPUT_SIZE * INPUT_SIZE + i] = (b - MEAN[2]) / STD[2]  // B channel
        }
        
        return floatArray
    }
    
    /**
     * æ–‡å­— Tokenization
     * ç°¡åŒ–ç‰ˆæœ¬ï¼Œå¯¦éš›æ‡‰è©²ä½¿ç”¨å®Œæ•´çš„ CLIP tokenizer
     */
    private fun tokenize(text: String): IntArray {
        // é€™æ˜¯ç°¡åŒ–ç‰ˆæœ¬ï¼Œå¯¦éš›éƒ¨ç½²æ™‚éœ€è¦ä½¿ç”¨å®Œæ•´çš„ tokenizer
        // å¯ä»¥è€ƒæ…®ä½¿ç”¨ Hugging Face tokenizers æˆ–è‡ªå·±å¯¦ä½œ
        
        // æš«æ™‚è¿”å›å›ºå®šé•·åº¦çš„ token array
        val tokens = IntArray(77) { 0 }  // CLIP çš„ context length æ˜¯ 77
        
        // TODO: å¯¦ä½œå®Œæ•´çš„ tokenization
        // 1. è½‰å°å¯«
        // 2. åˆ†è©
        // 3. è½‰ç‚º token ID
        // 4. Padding åˆ° 77
        
        return tokens
    }
    
    /**
     * L2 æ­£è¦åŒ–
     */
    private fun normalizeFeatures(features: FloatArray) {
        var norm = 0f
        for (value in features) {
            norm += value * value
        }
        norm = kotlin.math.sqrt(norm)
        
        for (i in features.indices) {
            features[i] /= norm
        }
    }
    
    /**
     * é‡‹æ”¾è³‡æº
     */
    fun close() {
        imageSession?.close()
        textSession?.close()
    }
}
</code></pre>
<h3 id="34-ç°¡å–®æ¸¬è©¦-activity"><a class="header" href="#34-ç°¡å–®æ¸¬è©¦-activity">3.4 ç°¡å–®æ¸¬è©¦ Activity</a></h3>
<p>å‰µå»º <code>MainActivity.kt</code>ï¼š</p>
<pre><code class="language-kotlin">package com.example.mobileclip

import android.graphics.BitmapFactory
import android.os.Bundle
import android.widget.Button
import android.widget.ImageView
import android.widget.TextView
import androidx.appcompat.app.AppCompatActivity
import androidx.lifecycle.lifecycleScope
import kotlinx.coroutines.launch

class MainActivity : AppCompatActivity() {
    
    private lateinit var mobileCLIP: MobileCLIPInference
    private lateinit var imageView: ImageView
    private lateinit var resultText: TextView
    private lateinit var searchButton: Button
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        
        imageView = findViewById(R.id.imageView)
        resultText = findViewById(R.id.resultText)
        searchButton = findViewById(R.id.searchButton)
        
        // åˆå§‹åŒ– MobileCLIP
        mobileCLIP = MobileCLIPInference(this)
        
        lifecycleScope.launch {
            try {
                resultText.text = "è¼‰å…¥æ¨¡å‹ä¸­..."
                mobileCLIP.initialize()
                resultText.text = "âœ… æ¨¡å‹è¼‰å…¥å®Œæˆï¼"
                searchButton.isEnabled = true
            } catch (e: Exception) {
                resultText.text = "âŒ æ¨¡å‹è¼‰å…¥å¤±æ•—ï¼š${e.message}"
            }
        }
        
        // æ¸¬è©¦æŒ‰éˆ•
        searchButton.setOnClickListener {
            testImageSearch()
        }
    }
    
    private fun testImageSearch() {
        lifecycleScope.launch {
            try {
                resultText.text = "è™•ç†ä¸­..."
                
                // 1. è¼‰å…¥æ¸¬è©¦åœ–ç‰‡ï¼ˆå¾ assets æˆ–ç›¸æ©Ÿï¼‰
                val bitmap = BitmapFactory.decodeResource(resources, R.drawable.test_image)
                imageView.setImageBitmap(bitmap)
                
                // 2. ç·¨ç¢¼åœ–ç‰‡
                val imageFeatures = mobileCLIP.encodeImage(bitmap)
                
                // 3. æº–å‚™å€™é¸æ–‡å­—
                val candidates = listOf(
                    "ä¸€éš»è²“",
                    "ä¸€éš»ç‹—",
                    "ä¸€è¼›è»Š",
                    "ä¸€è‡ºé›»è…¦",
                    "ä¸€æ”¯æ‰‹æ©Ÿ"
                )
                
                // 4. è¨ˆç®—ç›¸ä¼¼åº¦
                val results = mutableListOf&lt;Pair&lt;String, Float&gt;&gt;()
                for (text in candidates) {
                    val textFeatures = mobileCLIP.encodeText(text)
                    val similarity = mobileCLIP.calculateSimilarity(
                        imageFeatures,
                        textFeatures
                    )
                    results.add(text to similarity)
                }
                
                // 5. æ’åºä¸¦é¡¯ç¤ºçµæœ
                results.sortByDescending { it.second }
                val resultString = results.joinToString("\n") { (text, score) -&gt;
                    "$text: ${(score * 100).toInt()}%"
                }
                
                resultText.text = "æœå°‹çµæœï¼š\n$resultString"
                
            } catch (e: Exception) {
                resultText.text = "âŒ è™•ç†å¤±æ•—ï¼š${e.message}"
            }
        }
    }
    
    override fun onDestroy() {
        super.onDestroy()
        mobileCLIP.close()
    }
}
</code></pre>
<h3 id="35-ä½ˆå±€æª”æ¡ˆ"><a class="header" href="#35-ä½ˆå±€æª”æ¡ˆ">3.5 ä½ˆå±€æª”æ¡ˆ</a></h3>
<p><code>res/layout/activity_main.xml</code>ï¼š</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;androidx.constraintlayout.widget.ConstraintLayout 
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="16dp"&gt;
    
    &lt;ImageView
        android:id="@+id/imageView"
        android:layout_width="300dp"
        android:layout_height="300dp"
        android:scaleType="centerCrop"
        android:background="@color/material_grey_300"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        android:contentDescription="æ¸¬è©¦åœ–ç‰‡" /&gt;
    
    &lt;Button
        android:id="@+id/searchButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:text="é–‹å§‹æœå°‹"
        android:enabled="false"
        app:layout_constraintTop_toBottomOf="@id/imageView"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        android:layout_marginTop="16dp" /&gt;
    
    &lt;TextView
        android:id="@+id/resultText"
        android:layout_width="0dp"
        android:layout_height="0dp"
        android:text="åˆå§‹åŒ–ä¸­..."
        android:textSize="16sp"
        android:padding="16dp"
        app:layout_constraintTop_toBottomOf="@id/searchButton"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        android:layout_marginTop="16dp" /&gt;
    
&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;
</code></pre>
<hr />
<h2 id="4-æ–¹æ¡ˆ-b-tensorflow-lite"><a class="header" href="#4-æ–¹æ¡ˆ-b-tensorflow-lite">4. æ–¹æ¡ˆ B: TensorFlow Lite</a></h2>
<h3 id="41-æ¨¡å‹è½‰æ›è¤‡é›œ"><a class="header" href="#41-æ¨¡å‹è½‰æ›è¤‡é›œ">4.1 æ¨¡å‹è½‰æ›ï¼ˆè¤‡é›œï¼‰</a></h3>
<h4 id="æ­¥é©Ÿ-1onnx--tensorflow"><a class="header" href="#æ­¥é©Ÿ-1onnx--tensorflow">æ­¥é©Ÿ 1ï¼šONNX â†’ TensorFlow</a></h4>
<pre><code class="language-python"># å®‰è£è½‰æ›å·¥å…·
pip install onnx-tf tensorflow

# è½‰æ›è…³æœ¬
import onnx
from onnx_tf.backend import prepare

# è¼‰å…¥ ONNX æ¨¡å‹
onnx_model = onnx.load("mobileclip_image.onnx")

# è½‰æ›ç‚º TensorFlow
tf_rep = prepare(onnx_model)

# å„²å­˜
tf_rep.export_graph("mobileclip_image_tf")
</code></pre>
<h4 id="æ­¥é©Ÿ-2tensorflow--tflite"><a class="header" href="#æ­¥é©Ÿ-2tensorflow--tflite">æ­¥é©Ÿ 2ï¼šTensorFlow â†’ TFLite</a></h4>
<pre><code class="language-python">import tensorflow as tf

# è¼‰å…¥ TensorFlow æ¨¡å‹
converter = tf.lite.TFLiteConverter.from_saved_model("mobileclip_image_tf")

# å„ªåŒ–è¨­å®š
converter.optimizations = [tf.lite.Optimize.DEFAULT]
converter.target_spec.supported_types = [tf.float16]

# è½‰æ›
tflite_model = converter.convert()

# å„²å­˜
with open("mobileclip_image.tflite", "wb") as f:
    f.write(tflite_model)
</code></pre>
<h3 id="42-android-æ•´åˆtflite"><a class="header" href="#42-android-æ•´åˆtflite">4.2 Android æ•´åˆï¼ˆTFLiteï¼‰</a></h3>
<p><code>build.gradle.kts</code>ï¼š</p>
<pre><code class="language-kotlin">dependencies {
    // TensorFlow Lite
    implementation("org.tensorflow:tensorflow-lite:2.14.0")
    implementation("org.tensorflow:tensorflow-lite-gpu:2.14.0")
    implementation("org.tensorflow:tensorflow-lite-support:0.4.4")
}
</code></pre>
<p>æ¨è«–ç¨‹å¼ç¢¼ï¼š</p>
<pre><code class="language-kotlin">import org.tensorflow.lite.Interpreter
import java.nio.MappedByteBuffer
import java.nio.channels.FileChannel
import java.io.FileInputStream

class TFLiteMobileCLIP(context: Context) {
    
    private var interpreter: Interpreter? = null
    
    fun initialize() {
        val model = loadModelFile(context, "mobileclip_image.tflite")
        interpreter = Interpreter(model)
    }
    
    fun encodeImage(bitmap: Bitmap): FloatArray {
        val input = preprocessImage(bitmap)
        val output = Array(1) { FloatArray(512) }
        
        interpreter?.run(input, output)
        
        return output[0]
    }
    
    private fun loadModelFile(context: Context, modelPath: String): MappedByteBuffer {
        val fileDescriptor = context.assets.openFd(modelPath)
        val inputStream = FileInputStream(fileDescriptor.fileDescriptor)
        val fileChannel = inputStream.channel
        val startOffset = fileDescriptor.startOffset
        val declaredLength = fileDescriptor.declaredLength
        return fileChannel.map(FileChannel.MapMode.READ_ONLY, startOffset, declaredLength)
    }
}
</code></pre>
<hr />
<h2 id="5-android-å°ˆæ¡ˆå¯¦ä½œ"><a class="header" href="#5-android-å°ˆæ¡ˆå¯¦ä½œ">5. Android å°ˆæ¡ˆå¯¦ä½œ</a></h2>
<h3 id="51-æ¬Šé™è¨­å®š"><a class="header" href="#51-æ¬Šé™è¨­å®š">5.1 æ¬Šé™è¨­å®š</a></h3>
<p><code>AndroidManifest.xml</code>ï¼š</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"&gt;
    
    &lt;!-- ç›¸æ©Ÿæ¬Šé™ --&gt;
    &lt;uses-feature android:name="android.hardware.camera" /&gt;
    &lt;uses-permission android:name="android.permission.CAMERA" /&gt;
    
    &lt;!-- å„²å­˜æ¬Šé™ --&gt;
    &lt;uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" /&gt;
    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;
    
    &lt;!-- ç¶²è·¯æ¬Šé™ï¼ˆå¦‚éœ€ä¸‹è¼‰æ¨¡å‹ï¼‰--&gt;
    &lt;uses-permission android:name="android.permission.INTERNET" /&gt;
    
    &lt;application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:theme="@style/Theme.MobileCLIP"&gt;
        
        &lt;activity
            android:name=".MainActivity"
            android:exported="true"&gt;
            &lt;intent-filter&gt;
                &lt;action android:name="android.intent.action.MAIN" /&gt;
                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
        
    &lt;/application&gt;
    
&lt;/manifest&gt;
</code></pre>
<h3 id="52-ç›¸æ©Ÿæ•´åˆ"><a class="header" href="#52-ç›¸æ©Ÿæ•´åˆ">5.2 ç›¸æ©Ÿæ•´åˆ</a></h3>
<p>å‰µå»º <code>CameraHelper.kt</code>ï¼š</p>
<pre><code class="language-kotlin">package com.example.mobileclip

import android.Manifest
import android.content.Context
import android.content.pm.PackageManager
import android.graphics.Bitmap
import android.graphics.BitmapFactory
import android.graphics.ImageFormat
import android.graphics.Rect
import android.graphics.YuvImage
import androidx.camera.core.*
import androidx.camera.lifecycle.ProcessCameraProvider
import androidx.camera.view.PreviewView
import androidx.core.content.ContextCompat
import androidx.lifecycle.LifecycleOwner
import java.io.ByteArrayOutputStream
import java.util.concurrent.ExecutorService
import java.util.concurrent.Executors

class CameraHelper(
    private val context: Context,
    private val lifecycleOwner: LifecycleOwner,
    private val previewView: PreviewView
) {
    
    private var cameraExecutor: ExecutorService = Executors.newSingleThreadExecutor()
    private var imageAnalyzer: ImageAnalysis? = null
    
    fun startCamera(onImageCaptured: (Bitmap) -&gt; Unit) {
        val cameraProviderFuture = ProcessCameraProvider.getInstance(context)
        
        cameraProviderFuture.addListener({
            val cameraProvider = cameraProviderFuture.get()
            
            // é è¦½
            val preview = Preview.Builder().build().also {
                it.setSurfaceProvider(previewView.surfaceProvider)
            }
            
            // åœ–ç‰‡åˆ†æ
            imageAnalyzer = ImageAnalysis.Builder()
                .setBackpressureStrategy(ImageAnalysis.STRATEGY_KEEP_ONLY_LATEST)
                .build()
                .also {
                    it.setAnalyzer(cameraExecutor, { imageProxy -&gt;
                        val bitmap = imageProxyToBitmap(imageProxy)
                        onImageCaptured(bitmap)
                        imageProxy.close()
                    })
                }
            
            // é¸æ“‡å¾Œç½®é¡é ­
            val cameraSelector = CameraSelector.DEFAULT_BACK_CAMERA
            
            try {
                cameraProvider.unbindAll()
                cameraProvider.bindToLifecycle(
                    lifecycleOwner,
                    cameraSelector,
                    preview,
                    imageAnalyzer
                )
            } catch (e: Exception) {
                e.printStackTrace()
            }
            
        }, ContextCompat.getMainExecutor(context))
    }
    
    private fun imageProxyToBitmap(imageProxy: ImageProxy): Bitmap {
        val yuvImage = YuvImage(
            imageProxy.planes[0].buffer.array(),
            ImageFormat.NV21,
            imageProxy.width,
            imageProxy.height,
            null
        )
        
        val out = ByteArrayOutputStream()
        yuvImage.compressToJpeg(
            Rect(0, 0, imageProxy.width, imageProxy.height),
            100,
            out
        )
        
        val imageBytes = out.toByteArray()
        return BitmapFactory.decodeByteArray(imageBytes, 0, imageBytes.size)
    }
    
    fun shutdown() {
        cameraExecutor.shutdown()
    }
    
    companion object {
        fun hasPermissions(context: Context): Boolean {
            return ContextCompat.checkSelfPermission(
                context,
                Manifest.permission.CAMERA
            ) == PackageManager.PERMISSION_GRANTED
        }
    }
}
</code></pre>
<hr />
<h2 id="6-å®Œæ•´å•†å“æœå°‹-app"><a class="header" href="#6-å®Œæ•´å•†å“æœå°‹-app">6. å®Œæ•´å•†å“æœå°‹ App</a></h2>
<h3 id="61-ç”¢å“è³‡æ–™çµæ§‹"><a class="header" href="#61-ç”¢å“è³‡æ–™çµæ§‹">6.1 ç”¢å“è³‡æ–™çµæ§‹</a></h3>
<pre><code class="language-kotlin">data class Product(
    val id: String,
    val name: String,
    val price: Double,
    val description: String,
    val imageUrl: String,
    val features: FloatArray  // é è¨ˆç®—çš„åœ–ç‰‡ç‰¹å¾µ
)

data class SearchResult(
    val product: Product,
    val similarity: Float
) {
    val confidencePercent: Int get() = (similarity * 100).toInt()
}
</code></pre>
<h3 id="62-ç”¢å“è³‡æ–™åº«ç®¡ç†"><a class="header" href="#62-ç”¢å“è³‡æ–™åº«ç®¡ç†">6.2 ç”¢å“è³‡æ–™åº«ç®¡ç†</a></h3>
<pre><code class="language-kotlin">class ProductDatabase(private val context: Context) {
    
    private val products = mutableListOf&lt;Product&gt;()
    private lateinit var mobileCLIP: MobileCLIPInference
    
    suspend fun initialize() {
        mobileCLIP = MobileCLIPInference(context)
        mobileCLIP.initialize()
        
        // è¼‰å…¥ç”¢å“è³‡æ–™
        loadProducts()
    }
    
    private suspend fun loadProducts() {
        // å¾è³‡æ–™åº«æˆ– assets è¼‰å…¥ç”¢å“
        // é€™è£¡æ˜¯ç¤ºä¾‹è³‡æ–™
        
        val productData = listOf(
            Triple("P001", "Nike é‹å‹•é‹", 3200.0),
            Triple("P002", "Adidas ä¼‘é–’é‹", 2800.0),
            Triple("P003", "iPhone 15", 32900.0),
            // ... æ›´å¤šç”¢å“
        )
        
        for ((id, name, price) in productData) {
            // è¼‰å…¥ç”¢å“åœ–ç‰‡
            val bitmap = loadProductImage(id)
            
            // é è¨ˆç®—ç‰¹å¾µå‘é‡
            val features = mobileCLIP.encodeImage(bitmap)
            
            products.add(Product(
                id = id,
                name = name,
                price = price,
                description = "",
                imageUrl = "",
                features = features
            ))
        }
    }
    
    suspend fun search(queryBitmap: Bitmap, topK: Int = 5): List&lt;SearchResult&gt; {
        // ç·¨ç¢¼æŸ¥è©¢åœ–ç‰‡
        val queryFeatures = mobileCLIP.encodeImage(queryBitmap)
        
        // è¨ˆç®—æ‰€æœ‰ç”¢å“çš„ç›¸ä¼¼åº¦
        val results = products.map { product -&gt;
            val similarity = mobileCLIP.calculateSimilarity(
                queryFeatures,
                product.features
            )
            SearchResult(product, similarity)
        }
        
        // æ’åºä¸¦è¿”å› top-K
        return results.sortedByDescending { it.similarity }.take(topK)
    }
    
    private fun loadProductImage(productId: String): Bitmap {
        // å¾ assets æˆ–ç¶²è·¯è¼‰å…¥ç”¢å“åœ–ç‰‡
        return BitmapFactory.decodeResource(
            context.resources,
            R.drawable.product_placeholder
        )
    }
}
</code></pre>
<h3 id="63-æœå°‹-activity"><a class="header" href="#63-æœå°‹-activity">6.3 æœå°‹ Activity</a></h3>
<pre><code class="language-kotlin">class SearchActivity : AppCompatActivity() {
    
    private lateinit var cameraHelper: CameraHelper
    private lateinit var productDatabase: ProductDatabase
    private lateinit var binding: ActivitySearchBinding
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivitySearchBinding.inflate(layoutInflater)
        setContentView(binding.root)
        
        // åˆå§‹åŒ–
        lifecycleScope.launch {
            showLoading(true)
            productDatabase = ProductDatabase(this@SearchActivity)
            productDatabase.initialize()
            showLoading(false)
            
            startCamera()
        }
        
        // æ‹ç…§æŒ‰éˆ•
        binding.captureButton.setOnClickListener {
            captureAndSearch()
        }
    }
    
    private fun startCamera() {
        if (CameraHelper.hasPermissions(this)) {
            cameraHelper = CameraHelper(this, this, binding.previewView)
            cameraHelper.startCamera { bitmap -&gt;
                // å³æ™‚é è¦½ï¼ˆå¯é¸ï¼‰
            }
        } else {
            requestPermissions(
                arrayOf(Manifest.permission.CAMERA),
                REQUEST_CAMERA_PERMISSION
            )
        }
    }
    
    private fun captureAndSearch() {
        lifecycleScope.launch {
            try {
                showLoading(true)
                
                // å¾ç›¸æ©Ÿç²å–ç•¶å‰ç•«é¢
                val bitmap = getCurrentFrame()
                
                // æœå°‹
                val results = productDatabase.search(bitmap, topK = 3)
                
                // é¡¯ç¤ºçµæœ
                displayResults(results)
                
            } catch (e: Exception) {
                Toast.makeText(this@SearchActivity, "æœå°‹å¤±æ•—ï¼š${e.message}", Toast.LENGTH_SHORT).show()
            } finally {
                showLoading(false)
            }
        }
    }
    
    private fun displayResults(results: List&lt;SearchResult&gt;) {
        binding.resultsRecyclerView.adapter = SearchResultsAdapter(results) { product -&gt;
            // é»æ“Šç”¢å“ï¼Œé¡¯ç¤ºè©³æƒ…
            showProductDetails(product)
        }
    }
    
    private fun showProductDetails(product: Product) {
        // é¡¯ç¤ºç”¢å“è©³æƒ…é é¢
        val intent = Intent(this, ProductDetailActivity::class.java)
        intent.putExtra("PRODUCT_ID", product.id)
        startActivity(intent)
    }
    
    companion object {
        private const val REQUEST_CAMERA_PERMISSION = 100
    }
}
</code></pre>
<h3 id="64-æœå°‹çµæœ-adapter"><a class="header" href="#64-æœå°‹çµæœ-adapter">6.4 æœå°‹çµæœ Adapter</a></h3>
<pre><code class="language-kotlin">class SearchResultsAdapter(
    private val results: List&lt;SearchResult&gt;,
    private val onItemClick: (Product) -&gt; Unit
) : RecyclerView.Adapter&lt;SearchResultsAdapter.ViewHolder&gt;() {
    
    class ViewHolder(view: View) : RecyclerView.ViewHolder(view) {
        val productImage: ImageView = view.findViewById(R.id.productImage)
        val productName: TextView = view.findViewById(R.id.productName)
        val productPrice: TextView = view.findViewById(R.id.productPrice)
        val confidenceBar: ProgressBar = view.findViewById(R.id.confidenceBar)
        val confidenceText: TextView = view.findViewById(R.id.confidenceText)
    }
    
    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_search_result, parent, false)
        return ViewHolder(view)
    }
    
    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        val result = results[position]
        val product = result.product
        
        holder.productName.text = product.name
        holder.productPrice.text = "NT$ ${product.price.toInt()}"
        holder.confidenceBar.progress = result.confidencePercent
        holder.confidenceText.text = "${result.confidencePercent}%"
        
        // è¼‰å…¥åœ–ç‰‡ï¼ˆä½¿ç”¨ Glide æˆ– Coilï¼‰
        // Glide.with(holder.itemView).load(product.imageUrl).into(holder.productImage)
        
        holder.itemView.setOnClickListener {
            onItemClick(product)
        }
    }
    
    override fun getItemCount() = results.size
}
</code></pre>
<hr />
<h2 id="7-æ•ˆèƒ½å„ªåŒ–"><a class="header" href="#7-æ•ˆèƒ½å„ªåŒ–">7. æ•ˆèƒ½å„ªåŒ–</a></h2>
<h3 id="71-æ¨¡å‹é‡åŒ–"><a class="header" href="#71-æ¨¡å‹é‡åŒ–">7.1 æ¨¡å‹é‡åŒ–</a></h3>
<pre><code class="language-python"># æ›´æ¿€é€²çš„é‡åŒ–
from onnxruntime.quantization import quantize_dynamic, QuantType

quantize_dynamic(
    'mobileclip_image.onnx',
    'mobileclip_image_int8.onnx',
    weight_type=QuantType.QInt8  # INT8 é‡åŒ–
)

# çµæœï¼š
# - åŸå§‹ï¼š35 MB â†’ INT8ï¼š9 MBï¼ˆæ¸›å°‘ 74%ï¼‰
# - ç²¾æº–åº¦æå¤±ï¼š&lt; 1%
# - æ¨è«–é€Ÿåº¦ï¼šå¿« 1.5-2 å€
</code></pre>
<h3 id="72-æ‰¹æ¬¡è™•ç†"><a class="header" href="#72-æ‰¹æ¬¡è™•ç†">7.2 æ‰¹æ¬¡è™•ç†</a></h3>
<pre><code class="language-kotlin">suspend fun batchSearch(bitmaps: List&lt;Bitmap&gt;): List&lt;FloatArray&gt; {
    return withContext(Dispatchers.Default) {
        bitmaps.map { bitmap -&gt;
            async { mobileCLIP.encodeImage(bitmap) }
        }.awaitAll()
    }
}
</code></pre>
<h3 id="73-å‘é‡è³‡æ–™åº«åŠ é€Ÿ"><a class="header" href="#73-å‘é‡è³‡æ–™åº«åŠ é€Ÿ">7.3 å‘é‡è³‡æ–™åº«åŠ é€Ÿ</a></h3>
<pre><code class="language-kotlin">class FastProductSearch {
    
    // ä½¿ç”¨ KD-Tree æˆ– HNSW åŠ é€Ÿæœå°‹
    private val index = mutableListOf&lt;Pair&lt;Product, FloatArray&gt;&gt;()
    
    fun buildIndex(products: List&lt;Product&gt;) {
        index.clear()
        products.forEach { product -&gt;
            index.add(product to product.features)
        }
    }
    
    fun search(query: FloatArray, k: Int = 5): List&lt;SearchResult&gt; {
        // ä½¿ç”¨è¿‘ä¼¼æœ€è¿‘é„°æœå°‹ï¼ˆANNï¼‰
        // å°æ–¼ 10,000+ ç”¢å“ï¼Œé€Ÿåº¦æå‡ 10-100 å€
        
        return index
            .map { (product, features) -&gt;
                val similarity = cosineSimilarity(query, features)
                SearchResult(product, similarity)
            }
            .sortedByDescending { it.similarity }
            .take(k)
    }
}
</code></pre>
<h3 id="74-ä½¿ç”¨ç¡¬é«”åŠ é€Ÿ"><a class="header" href="#74-ä½¿ç”¨ç¡¬é«”åŠ é€Ÿ">7.4 ä½¿ç”¨ç¡¬é«”åŠ é€Ÿ</a></h3>
<pre><code class="language-kotlin">// ONNX Runtime ç¡¬é«”åŠ é€Ÿ
val sessionOptions = OrtSession.SessionOptions()

// ä½¿ç”¨ NNAPI (Android Neural Networks API)
sessionOptions.addNNAPI()

// æˆ–ä½¿ç”¨ GPU
sessionOptions.addDirectML(0)

val session = ortEnvironment.createSession(modelBytes, sessionOptions)
</code></pre>
<hr />
<h2 id="8-å¸¸è¦‹å•é¡Œ"><a class="header" href="#8-å¸¸è¦‹å•é¡Œ">8. å¸¸è¦‹å•é¡Œ</a></h2>
<h3 id="q1-æ¨¡å‹æª”æ¡ˆå¤ªå¤§apk-è¶…é-100mb-æ€éº¼è¾¦"><a class="header" href="#q1-æ¨¡å‹æª”æ¡ˆå¤ªå¤§apk-è¶…é-100mb-æ€éº¼è¾¦">Q1: æ¨¡å‹æª”æ¡ˆå¤ªå¤§ï¼ŒAPK è¶…é 100MB æ€éº¼è¾¦ï¼Ÿ</a></h3>
<p><strong>è§£æ±ºæ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨ Android App Bundle</strong></li>
</ol>
<pre><code class="language-gradle">// build.gradle
android {
    bundle {
        language {
            enableSplit = true
        }
        density {
            enableSplit = true
        }
        abi {
            enableSplit = true
        }
    }
}
</code></pre>
<ol start="2">
<li><strong>å‹•æ…‹ä¸‹è¼‰æ¨¡å‹</strong></li>
</ol>
<pre><code class="language-kotlin">// ä½¿ç”¨ Firebase ML Model Downloader
val conditions = CustomModelDownloadConditions.Builder()
    .requireWifi()
    .build()

FirebaseModelDownloader.getInstance()
    .getModel("mobileclip", DownloadType.LOCAL_MODEL, conditions)
    .addOnSuccessListener { model -&gt;
        // ä½¿ç”¨ä¸‹è¼‰çš„æ¨¡å‹
    }
</code></pre>
<ol start="3">
<li><strong>ä½¿ç”¨æ›´å°çš„æ¨¡å‹</strong></li>
</ol>
<ul>
<li>MobileCLIP-S0 (9MB quantized) è€Œé B-LT (40MB)</li>
</ul>
<h3 id="q2-æ¨è«–é€Ÿåº¦å¤ªæ…¢æ€éº¼è¾¦"><a class="header" href="#q2-æ¨è«–é€Ÿåº¦å¤ªæ…¢æ€éº¼è¾¦">Q2: æ¨è«–é€Ÿåº¦å¤ªæ…¢æ€éº¼è¾¦ï¼Ÿ</a></h3>
<p><strong>å„ªåŒ–æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="language-kotlin">// 1. ä½¿ç”¨é‡åŒ–æ¨¡å‹
// 2. é è¨ˆç®—ç”¢å“ç‰¹å¾µ
// 3. ä½¿ç”¨ç¡¬é«”åŠ é€Ÿ
// 4. é™ä½åœ–ç‰‡è§£æåº¦

// å¯¦éš›æ¸¬è©¦ï¼š
// - S0 é‡åŒ– + NNAPIï¼š5-10ms
// - S2 é‡åŒ– + CPUï¼š15-25ms
// - B é‡åŒ– + CPUï¼š40-60ms
</code></pre>
<h3 id="q3-è¨˜æ†¶é«”ä¸è¶³oomæ€éº¼è¾¦"><a class="header" href="#q3-è¨˜æ†¶é«”ä¸è¶³oomæ€éº¼è¾¦">Q3: è¨˜æ†¶é«”ä¸è¶³ï¼ˆOOMï¼‰æ€éº¼è¾¦ï¼Ÿ</a></h3>
<pre><code class="language-kotlin">// 1. åŠæ™‚é‡‹æ”¾ Bitmap
bitmap.recycle()

// 2. ä½¿ç”¨ BitmapFactory.Options
val options = BitmapFactory.Options()
options.inSampleSize = 2  // ç¸®å° 2 å€
options.inPreferredConfig = Bitmap.Config.RGB_565  // æ¸›å°‘è¨˜æ†¶é«”

// 3. åˆ†æ‰¹è™•ç†
products.chunked(50).forEach { batch -&gt;
    processBatch(batch)
    System.gc()
}
</code></pre>
<h3 id="q4-å¦‚ä½•å¯¦ä½œå®Œæ•´çš„-tokenizer"><a class="header" href="#q4-å¦‚ä½•å¯¦ä½œå®Œæ•´çš„-tokenizer">Q4: å¦‚ä½•å¯¦ä½œå®Œæ•´çš„ Tokenizerï¼Ÿ</a></h3>
<pre><code class="language-kotlin">// ç°¡åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨é å…ˆè¨ˆç®—çš„æ–‡å­—ç‰¹å¾µ
class PrecomputedTextFeatures {
    private val textFeatures = mapOf(
        "ç´…è‰²" to floatArrayOf(/* 512 ç¶­å‘é‡ */),
        "é‹å­" to floatArrayOf(/* 512 ç¶­å‘é‡ */),
        // ... æ›´å¤šå¸¸ç”¨è©
    )
    
    fun getFeatures(text: String): FloatArray? {
        return textFeatures[text]
    }
}

// å®Œæ•´æ–¹æ¡ˆï¼šç§»æ¤ CLIP tokenizer
// å¯åƒè€ƒï¼šhttps://github.com/openai/CLIP/blob/main/clip/simple_tokenizer.py
</code></pre>
<h3 id="q5-android-60-ä»¥ä¸‹æ”¯æ´å—"><a class="header" href="#q5-android-60-ä»¥ä¸‹æ”¯æ´å—">Q5: Android 6.0 ä»¥ä¸‹æ”¯æ´å—ï¼Ÿ</a></h3>
<pre><code class="language-kotlin">// æœ€ä½æ”¯æ´åˆ° API 24 (Android 7.0)
// å¦‚éœ€æ”¯æ´æ›´èˆŠç‰ˆæœ¬ï¼š

android {
    defaultConfig {
        minSdk = 21  // Android 5.0
        
        // ä½†éœ€è¦è™•ç†ç›¸å®¹æ€§
        ndk {
            abiFilters += listOf("armeabi-v7a", "arm64-v8a")
        }
    }
}

// æ³¨æ„ï¼šæŸäº›ç¡¬é«”åŠ é€ŸåŠŸèƒ½å¯èƒ½ä¸å¯ç”¨
</code></pre>
<hr />
<h2 id="é™„éŒ„"><a class="header" href="#é™„éŒ„">é™„éŒ„</a></h2>
<h3 id="a-å®Œæ•´å°ˆæ¡ˆçµæ§‹"><a class="header" href="#a-å®Œæ•´å°ˆæ¡ˆçµæ§‹">A. å®Œæ•´å°ˆæ¡ˆçµæ§‹</a></h3>
<pre><code>MobileCLIPDemo/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mobileclip_image_quantized.onnx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ mobileclip_text_quantized.onnx
â”‚   â”‚   â”‚   â”œâ”€â”€ java/com/example/mobileclip/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MainActivity.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SearchActivity.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MobileCLIPInference.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProductDatabase.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CameraHelper.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SearchResultsAdapter.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ res/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ activity_main.xml
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ activity_search.xml
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ item_search_result.xml
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ values/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ strings.xml
â”‚   â”‚   â”‚   â””â”€â”€ AndroidManifest.xml
â”‚   â”‚   â””â”€â”€ build.gradle.kts
â”‚   â””â”€â”€ build.gradle.kts
â””â”€â”€ gradle.properties
</code></pre>
<h3 id="b-æ¸¬è©¦-checklist"><a class="header" href="#b-æ¸¬è©¦-checklist">B. æ¸¬è©¦ Checklist</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
æ¨¡å‹æˆåŠŸè¼‰å…¥</li>
<li><input disabled="" type="checkbox"/>
åœ–ç‰‡é è™•ç†æ­£ç¢º</li>
<li><input disabled="" type="checkbox"/>
æ¨è«–çµæœåˆç†</li>
<li><input disabled="" type="checkbox"/>
è¨˜æ†¶é«”ä½¿ç”¨æ­£å¸¸ï¼ˆ&lt; 200MBï¼‰</li>
<li><input disabled="" type="checkbox"/>
æ¨è«–é€Ÿåº¦å¯æ¥å—ï¼ˆ&lt; 100msï¼‰</li>
<li><input disabled="" type="checkbox"/>
ç›¸æ©Ÿæ¬Šé™æ­£å¸¸</li>
<li><input disabled="" type="checkbox"/>
æœå°‹çµæœæ­£ç¢º</li>
<li><input disabled="" type="checkbox"/>
UI éŸ¿æ‡‰æµæš¢</li>
</ul>
<h3 id="c-æ•ˆèƒ½åŸºæº–"><a class="header" href="#c-æ•ˆèƒ½åŸºæº–">C. æ•ˆèƒ½åŸºæº–</a></h3>
<div class="table-wrapper"><table><thead><tr><th>è£ç½®</th><th>æ¨¡å‹</th><th>æ¨è«–æ™‚é–“</th><th>è¨˜æ†¶é«”</th></tr></thead><tbody>
<tr><td>Pixel 7</td><td>S2-Quant + NNAPI</td><td>8ms</td><td>80MB</td></tr>
<tr><td>Samsung S21</td><td>S2-Quant + CPU</td><td>22ms</td><td>95MB</td></tr>
<tr><td>å°ç±³ 11</td><td>B-Quant + CPU</td><td>55ms</td><td>150MB</td></tr>
</tbody></table>
</div>
<h3 id="d-åƒè€ƒè³‡æº"><a class="header" href="#d-åƒè€ƒè³‡æº">D. åƒè€ƒè³‡æº</a></h3>
<ul>
<li><strong>ONNX Runtime Android</strong>ï¼šhttps://onnxruntime.ai/docs/tutorials/mobile/</li>
<li><strong>TensorFlow Lite</strong>ï¼šhttps://www.tensorflow.org/lite</li>
<li><strong>CameraX</strong>ï¼šhttps://developer.android.com/training/camerax</li>
<li><strong>MobileCLIP è«–æ–‡</strong>ï¼šhttps://arxiv.org/abs/2311.17049</li>
</ul>
<hr />
<h2 id="çµèª"><a class="header" href="#çµèª">çµèª</a></h2>
<p>æ­å–œï¼ğŸ‰ ä½ å·²ç¶“æŒæ¡äº†å°‡ MobileCLIP éƒ¨ç½²åˆ° Android çš„å®Œæ•´æµç¨‹ã€‚</p>
<p><strong>é—œéµè¦é»</strong>ï¼š</p>
<ol>
<li>âœ… ONNX Runtime æ˜¯æœ€ç°¡å–®çš„æ–¹æ¡ˆ</li>
<li>âš¡ é‡åŒ–æ¨¡å‹å¯æ¸›å°‘ 70% é«”ç©</li>
<li>ğŸ“± é è¨ˆç®—ç”¢å“ç‰¹å¾µæ˜¯é—œéµå„ªåŒ–</li>
<li>ğŸš€ ç¡¬é«”åŠ é€Ÿå¯æå‡ 3-5 å€é€Ÿåº¦</li>
</ol>
<p><strong>ä¸‹ä¸€æ­¥</strong>ï¼š</p>
<ul>
<li>å¯¦ä½œå®Œæ•´çš„å•†å“è³‡æ–™åº«</li>
<li>åŠ å…¥æ–‡å­—æœå°‹åŠŸèƒ½</li>
<li>å„ªåŒ– UI/UX</li>
<li>ä¸Šæ¶ Google Play</li>
</ul>
<p>ç¥ä½ é–‹ç™¼é †åˆ©ï¼æœ‰å•é¡Œæ­¡è¿éš¨æ™‚è©¢å• ğŸ˜Š</p>
<hr />
<p><strong>æ–‡ä»¶ç‰ˆæœ¬</strong>ï¼šv1.0<br />
<strong>ä½œè€…</strong>ï¼šClaude<br />
<strong>æœ€å¾Œæ›´æ–°</strong>ï¼š2025-10-27</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../cv/MobileCLIP_å®Œæ•´æŒ‡å—.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../cv/mobileclip-complete-guide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../cv/MobileCLIP_å®Œæ•´æŒ‡å—.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../cv/mobileclip-complete-guide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
