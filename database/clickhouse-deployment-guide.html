<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ClickHouse éƒ¨ç½²æŒ‡å— - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="clickhouse-docker-å®Œæ•´éƒ¨ç½²æŒ‡å—"><a class="header" href="#clickhouse-docker-å®Œæ•´éƒ¨ç½²æŒ‡å—">ClickHouse Docker å®Œæ•´éƒ¨ç½²æŒ‡å—</a></h1>
<h2 id="-ç›®éŒ„"><a class="header" href="#-ç›®éŒ„">ğŸ“‹ ç›®éŒ„</a></h2>
<ul>
<li><a href="#%E7%B3%BB%E7%B5%B1%E9%9C%80%E6%B1%82">ç³»çµ±éœ€æ±‚</a></li>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%9D">å¿«é€Ÿå®‰è£</a></li>
<li><a href="#%E7%94%9F%E7%94%A2%E7%92%B0%E5%A2%83%E9%85%8D%E7%BD%AE">ç”Ÿç”¢ç’°å¢ƒé…ç½®</a></li>
<li><a href="#%E8%87%AA%E5%8B%95%E5%82%99%E4%BB%BD%E8%A8%AD%E7%BD%AE">è‡ªå‹•å‚™ä»½è¨­ç½®</a></li>
<li><a href="#%E6%B8%AC%E8%A9%A6%E7%AF%84%E4%BE%8B">æ¸¬è©¦ç¯„ä¾‹</a></li>
<li><a href="#%E7%9B%A3%E6%8E%A7%E8%88%87%E7%B6%AD%E8%AD%B7">ç›£æ§èˆ‡ç¶­è­·</a></li>
<li><a href="#%E5%B8%B8%E8%A6%8B%E5%95%8F%E9%A1%8C">å¸¸è¦‹å•é¡Œ</a></li>
</ul>
<h2 id="ç³»çµ±éœ€æ±‚"><a class="header" href="#ç³»çµ±éœ€æ±‚">ç³»çµ±éœ€æ±‚</a></h2>
<h3 id="æœ€ä½é…ç½®"><a class="header" href="#æœ€ä½é…ç½®">æœ€ä½é…ç½®</a></h3>
<ul>
<li>CPU: 4 æ ¸å¿ƒ</li>
<li>RAM: 8 GB</li>
<li>Storage: 100 GB SSD</li>
<li>OS: Linux (Ubuntu 20.04+ / CentOS 7+)</li>
<li>Docker: 20.10+</li>
<li>Docker Compose: 2.0+</li>
</ul>
<h3 id="å»ºè­°é…ç½®"><a class="header" href="#å»ºè­°é…ç½®">å»ºè­°é…ç½®</a></h3>
<ul>
<li>CPU: 8+ æ ¸å¿ƒ</li>
<li>RAM: 32+ GB</li>
<li>Storage: NVMe SSD (è¶Šå¿«è¶Šå¥½)</li>
<li>Network: 1 Gbps+</li>
</ul>
<h2 id="å¿«é€Ÿå®‰è£"><a class="header" href="#å¿«é€Ÿå®‰è£">å¿«é€Ÿå®‰è£</a></h2>
<h3 id="1-å®‰è£-docker-ubuntu-ç‚ºä¾‹"><a class="header" href="#1-å®‰è£-docker-ubuntu-ç‚ºä¾‹">1. å®‰è£ Docker (Ubuntu ç‚ºä¾‹)</a></h3>
<pre><code class="language-bash"># æ›´æ–°ç³»çµ±
sudo apt-get update
sudo apt-get upgrade -y

# å®‰è£ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£ Docker Compose (æ³¨æ„ï¼šéœ€è¦æŒ‡å®šç‰ˆæœ¬ï¼Œä¸è¦ç”¨ latest)
sudo curl -L "https://github.com/docker/compose/releases/download/v2.30.3/docker-compose-Linux-x86_64" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# å°‡ç•¶å‰ç”¨æˆ¶åŠ å…¥ docker ç¾¤çµ„
sudo usermod -aG docker $USER
newgrp docker

# é©—è­‰å®‰è£
docker --version
docker-compose --version
</code></pre>
<h3 id="2-å»ºç«‹å°ˆæ¡ˆç›®éŒ„çµæ§‹"><a class="header" href="#2-å»ºç«‹å°ˆæ¡ˆç›®éŒ„çµæ§‹">2. å»ºç«‹å°ˆæ¡ˆç›®éŒ„çµæ§‹</a></h3>
<pre><code class="language-bash"># å»ºç«‹ç›®éŒ„
mkdir -p ~/clickhouse-docker/{config,data,logs,backup,scripts}
cd ~/clickhouse-docker

# å»ºç«‹å¿…è¦çš„ç›®éŒ„æ¬Šé™
sudo mkdir -p /data/clickhouse
sudo chown -R $USER:$USER /data/clickhouse
</code></pre>
<h2 id="ç”Ÿç”¢ç’°å¢ƒé…ç½®"><a class="header" href="#ç”Ÿç”¢ç’°å¢ƒé…ç½®">ç”Ÿç”¢ç’°å¢ƒé…ç½®</a></h2>
<h3 id="3-å‰µå»ºå„ªåŒ–çš„-docker-composeyml"><a class="header" href="#3-å‰µå»ºå„ªåŒ–çš„-docker-composeyml">3. å‰µå»ºå„ªåŒ–çš„ docker-compose.yml</a></h3>
<pre><code class="language-yaml"># ~/clickhouse-docker/docker-compose.yml
# æ³¨æ„ï¼šversion å±¬æ€§åœ¨æ–°ç‰ˆ Docker Compose ä¸­å·²æ£„ç”¨ï¼Œå¯ä»¥çœç•¥

services:
  clickhouse:
    image: clickhouse/clickhouse-server:24.8-alpine
    container_name: clickhouse-server
    hostname: clickhouse-server
    
    # ç¶²è·¯é…ç½®ï¼ˆç”Ÿç”¢ç’°å¢ƒå¯è€ƒæ…® host æ¨¡å¼ï¼Œæ¸¬è©¦ç’°å¢ƒå»ºè­°ç”¨æ©‹æ¥ï¼‰
    ports:
      - "8123:8123"  # HTTP interface
      - "9000:9000"  # Native client
      - "9009:9009"  # Interserver HTTP
    
    # ç’°å¢ƒè®Šæ•¸
    environment:
      # åˆå§‹è³‡æ–™åº«è¨­ç½®
      CLICKHOUSE_DB: market_data
      CLICKHOUSE_USER: trader
      CLICKHOUSE_PASSWORD: SecurePass123!
      CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT: 1
      # æ•ˆèƒ½ç›¸é—œ
      CLICKHOUSE_MAX_MEMORY_USAGE: 10000000000  # 10GB
      CLICKHOUSE_MAX_MEMORY_USAGE_FOR_USER: 10000000000
      
    # è³‡æºé™åˆ¶
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 16G
        reservations:
          cpus: '2'
          memory: 8G
    
    # æ›è¼‰è¨­å®š
    volumes:
      # è³‡æ–™ç›®éŒ„ - ä½¿ç”¨æœ¬åœ° SSD
      - type: bind
        source: /data/clickhouse
        target: /var/lib/clickhouse
      # æ—¥èªŒç›®éŒ„
      - type: bind
        source: ./logs
        target: /var/log/clickhouse-server
      # è‡ªå®šç¾©é…ç½®
      - type: bind
        source: ./config
        target: /etc/clickhouse-server/config.d
        read_only: true
      # å‚™ä»½ç›®éŒ„
      - type: bind
        source: ./backup
        target: /backups
    
    # ç³»çµ±é™åˆ¶å„ªåŒ–
    ulimits:
      nofile:
        soft: 262144
        hard: 262144
      memlock:
        soft: -1
        hard: -1
      nproc:
        soft: 131072
        hard: 131072
    
    # å¥åº·æª¢æŸ¥
    healthcheck:
      test: ["CMD", "clickhouse-client", "--host", "localhost", "--query", "SELECT 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 30s
    
    # è‡ªå‹•é‡å•Ÿ
    restart: unless-stopped
    
    # æ—¥èªŒè¨­ç½®
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "3"
</code></pre>
<h3 id="4-å‰µå»ºè‡ªå®šç¾©é…ç½®æ–‡ä»¶"><a class="header" href="#4-å‰µå»ºè‡ªå®šç¾©é…ç½®æ–‡ä»¶">4. å‰µå»ºè‡ªå®šç¾©é…ç½®æ–‡ä»¶</a></h3>
<h4 id="å„²å­˜å„ªåŒ–é…ç½®"><a class="header" href="#å„²å­˜å„ªåŒ–é…ç½®">å„²å­˜å„ªåŒ–é…ç½®</a></h4>
<pre><code class="language-xml">&lt;!-- ~/clickhouse-docker/config/storage.xml --&gt;
&lt;?xml version="1.0"?&gt;
&lt;clickhouse&gt;
    &lt;storage_configuration&gt;
        &lt;disks&gt;
            &lt;default&gt;
                &lt;path&gt;/var/lib/clickhouse/&lt;/path&gt;
            &lt;/default&gt;
            &lt;fast_ssd&gt;
                &lt;path&gt;/var/lib/clickhouse/fast/&lt;/path&gt;
            &lt;/fast_ssd&gt;
        &lt;/disks&gt;
        &lt;policies&gt;
            &lt;tiered&gt;
                &lt;volumes&gt;
                    &lt;hot&gt;
                        &lt;disk&gt;fast_ssd&lt;/disk&gt;
                        &lt;max_data_part_size_bytes&gt;10737418240&lt;/max_data_part_size_bytes&gt;
                    &lt;/hot&gt;
                    &lt;cold&gt;
                        &lt;disk&gt;default&lt;/disk&gt;
                    &lt;/cold&gt;
                &lt;/volumes&gt;
                &lt;move_factor&gt;0.2&lt;/move_factor&gt;
            &lt;/tiered&gt;
        &lt;/policies&gt;
    &lt;/storage_configuration&gt;
    
    &lt;!-- å£“ç¸®è¨­ç½® --&gt;
    &lt;compression&gt;
        &lt;case&gt;
            &lt;method&gt;lz4hc&lt;/method&gt;
            &lt;level&gt;12&lt;/level&gt;
        &lt;/case&gt;
    &lt;/compression&gt;
&lt;/clickhouse&gt;
</code></pre>
<h4 id="æ•ˆèƒ½å„ªåŒ–é…ç½®é¸ç”¨é è¨­é…ç½®é€šå¸¸å·²è¶³å¤ "><a class="header" href="#æ•ˆèƒ½å„ªåŒ–é…ç½®é¸ç”¨é è¨­é…ç½®é€šå¸¸å·²è¶³å¤ ">æ•ˆèƒ½å„ªåŒ–é…ç½®ï¼ˆé¸ç”¨ï¼Œé è¨­é…ç½®é€šå¸¸å·²è¶³å¤ ï¼‰</a></h4>
<pre><code class="language-xml">&lt;!-- ~/clickhouse-docker/config/performance.xml --&gt;
&lt;!-- è­¦å‘Šï¼šè‡ªå®šç¾©é…ç½®å®¹æ˜“å‡ºéŒ¯ï¼Œå»ºè­°å…ˆä½¿ç”¨é è¨­é…ç½®æ¸¬è©¦ --&gt;
&lt;?xml version="1.0"?&gt;
&lt;clickhouse&gt;
    &lt;!-- ç¶²è·¯å„ªåŒ– --&gt;
    &lt;max_concurrent_queries&gt;100&lt;/max_concurrent_queries&gt;
    &lt;max_connections&gt;4096&lt;/max_connections&gt;

    &lt;!-- èƒŒæ™¯ä»»å‹™å„ªåŒ– --&gt;
    &lt;background_pool_size&gt;16&lt;/background_pool_size&gt;
    &lt;background_schedule_pool_size&gt;16&lt;/background_schedule_pool_size&gt;

    &lt;!-- MergeTree å„ªåŒ– --&gt;
    &lt;merge_tree&gt;
        &lt;max_suspicious_broken_parts&gt;5&lt;/max_suspicious_broken_parts&gt;
        &lt;max_parts_in_total&gt;100000&lt;/max_parts_in_total&gt;
    &lt;/merge_tree&gt;

    &lt;!-- User profiles è¨­å®šï¼ˆuser-level è¨­å®šå¿…é ˆæ”¾åœ¨ profiles å€å¡Šï¼‰ --&gt;
    &lt;profiles&gt;
        &lt;default&gt;
            &lt;max_threads&gt;8&lt;/max_threads&gt;
            &lt;max_memory_usage&gt;10000000000&lt;/max_memory_usage&gt;
            &lt;max_memory_usage_for_user&gt;10000000000&lt;/max_memory_usage_for_user&gt;
            &lt;max_bytes_before_external_group_by&gt;5000000000&lt;/max_bytes_before_external_group_by&gt;
        &lt;/default&gt;
    &lt;/profiles&gt;
&lt;/clickhouse&gt;
</code></pre>
<h2 id="è‡ªå‹•å‚™ä»½è¨­ç½®"><a class="header" href="#è‡ªå‹•å‚™ä»½è¨­ç½®">è‡ªå‹•å‚™ä»½è¨­ç½®</a></h2>
<h3 id="5-å‚™ä»½è…³æœ¬"><a class="header" href="#5-å‚™ä»½è…³æœ¬">5. å‚™ä»½è…³æœ¬</a></h3>
<h4 id="ä¸»å‚™ä»½è…³æœ¬"><a class="header" href="#ä¸»å‚™ä»½è…³æœ¬">ä¸»å‚™ä»½è…³æœ¬</a></h4>
<pre><code class="language-bash">#!/bin/bash
# ~/clickhouse-docker/scripts/backup.sh

# è¨­å®šè®Šæ•¸
BACKUP_DIR="/home/$USER/clickhouse-docker/backup"
CONTAINER_NAME="clickhouse-server"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=7
LOG_FILE="$BACKUP_DIR/backup.log"

# é¡è‰²è¼¸å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# æ—¥èªŒå‡½æ•¸
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# éŒ¯èª¤è™•ç†
error_exit() {
    echo -e "${RED}[ERROR]${NC} $1" | tee -a "$LOG_FILE"
    exit 1
}

# æª¢æŸ¥å®¹å™¨æ˜¯å¦é‹è¡Œ
check_container() {
    if ! docker ps --format '{{.Names}}' | grep -q "^${CONTAINER_NAME}$"; then
        error_exit "Container ${CONTAINER_NAME} is not running!"
    fi
}

# åŸ·è¡Œå‚™ä»½
perform_backup() {
    log "Starting backup..."
    
    # æ–¹æ³• 1: ä½¿ç”¨ ClickHouse åŸç”Ÿå‚™ä»½ï¼ˆæ¨è–¦ï¼‰
    log "Creating ClickHouse native backup..."
    
    # å‰µå»ºæ‰€æœ‰è¡¨çš„å‚™ä»½
    docker exec $CONTAINER_NAME clickhouse-client --query "
        SELECT concat('BACKUP TABLE ', database, '.', name, ' TO Disk(''backups'', ''', '${DATE}/', database, '_', name, ''');')
        FROM system.tables 
        WHERE database NOT IN ('system', 'information_schema', 'INFORMATION_SCHEMA')
    " | while read backup_cmd; do
        if [ ! -z "$backup_cmd" ]; then
            docker exec $CONTAINER_NAME clickhouse-client --query "$backup_cmd" || log "Warning: Failed to backup a table"
        fi
    done
    
    # æ–¹æ³• 2: ç‰©ç†å‚™ä»½ï¼ˆå®Œæ•´å‚™ä»½ï¼‰
    log "Creating physical backup..."
    docker exec $CONTAINER_NAME bash -c "
        tar czf /backups/physical_backup_${DATE}.tar.gz \
        --exclude='/var/lib/clickhouse/preprocessed_configs' \
        --exclude='/var/lib/clickhouse/tmp' \
        /var/lib/clickhouse/data \
        /var/lib/clickhouse/metadata
    " || error_exit "Physical backup failed"
    
    # å‚™ä»½é…ç½®æ–‡ä»¶
    log "Backing up configuration..."
    tar czf "$BACKUP_DIR/config_backup_${DATE}.tar.gz" \
        -C ~/clickhouse-docker config/ docker-compose.yml \
        || error_exit "Config backup failed"
    
    log "Backup completed successfully!"
}

# æ¸…ç†èˆŠå‚™ä»½
cleanup_old_backups() {
    log "Cleaning up old backups (older than $RETENTION_DAYS days)..."
    
    # æ¸…ç†æœ¬åœ°å‚™ä»½
    find "$BACKUP_DIR" -name "*.tar.gz" -type f -mtime +$RETENTION_DAYS -delete
    
    # æ¸…ç†å®¹å™¨å…§å‚™ä»½
    docker exec $CONTAINER_NAME bash -c "
        find /backups -name '*.tar.gz' -type f -mtime +$RETENTION_DAYS -delete
    "
    
    log "Cleanup completed"
}

# é¡¯ç¤ºå‚™ä»½è³‡è¨Š
show_backup_info() {
    echo -e "${GREEN}=== Backup Information ===${NC}"
    echo "Backup Location: $BACKUP_DIR"
    echo "Latest Backups:"
    ls -lah "$BACKUP_DIR" | grep -E "*.tar.gz" | tail -5
    
    # é¡¯ç¤ºå‚™ä»½å¤§å°çµ±è¨ˆ
    total_size=$(du -sh "$BACKUP_DIR" 2&gt;/dev/null | cut -f1)
    echo -e "\nTotal backup size: ${YELLOW}$total_size${NC}"
}

# ä¸»ç¨‹åº
main() {
    echo -e "${GREEN}=== ClickHouse Backup Script ===${NC}"
    
    # å‰µå»ºå‚™ä»½ç›®éŒ„
    mkdir -p "$BACKUP_DIR"
    
    # åŸ·è¡Œå‚™ä»½æµç¨‹
    check_container
    perform_backup
    cleanup_old_backups
    show_backup_info
    
    echo -e "${GREEN}âœ… Backup process completed!${NC}"
}

# åŸ·è¡Œä¸»ç¨‹åº
main
</code></pre>
<h4 id="é‚„åŸè…³æœ¬"><a class="header" href="#é‚„åŸè…³æœ¬">é‚„åŸè…³æœ¬</a></h4>
<pre><code class="language-bash">#!/bin/bash
# ~/clickhouse-docker/scripts/restore.sh

# è¨­å®šè®Šæ•¸
BACKUP_DIR="/home/$USER/clickhouse-docker/backup"
CONTAINER_NAME="clickhouse-server"

# é¡è‰²è¼¸å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# åˆ—å‡ºå¯ç”¨å‚™ä»½
list_backups() {
    echo -e "${GREEN}=== Available Backups ===${NC}"
    ls -la "$BACKUP_DIR" | grep -E "physical_backup.*tar.gz" | nl
}

# é‚„åŸå‚™ä»½
restore_backup() {
    list_backups
    
    echo -e "${YELLOW}Enter the number of backup to restore:${NC}"
    read backup_num
    
    backup_file=$(ls "$BACKUP_DIR" | grep -E "physical_backup.*tar.gz" | sed -n "${backup_num}p")
    
    if [ -z "$backup_file" ]; then
        echo -e "${RED}Invalid selection!${NC}"
        exit 1
    fi
    
    echo -e "${YELLOW}âš ï¸  WARNING: This will stop ClickHouse and restore data!${NC}"
    echo "Restore from: $backup_file"
    echo "Continue? (yes/no)"
    read confirm
    
    if [ "$confirm" != "yes" ]; then
        echo "Restore cancelled"
        exit 0
    fi
    
    # åœæ­¢å®¹å™¨
    echo "Stopping ClickHouse..."
    docker-compose -f ~/clickhouse-docker/docker-compose.yml down
    
    # å‚™ä»½ç•¶å‰æ•¸æ“šï¼ˆå®‰å…¨èµ·è¦‹ï¼‰
    echo "Backing up current data..."
    sudo mv /data/clickhouse /data/clickhouse.old.$(date +%Y%m%d_%H%M%S)
    sudo mkdir -p /data/clickhouse
    
    # è§£å£“å‚™ä»½
    echo "Restoring backup..."
    sudo tar xzf "$BACKUP_DIR/$backup_file" -C / --strip-components=2
    
    # ä¿®æ­£æ¬Šé™
    sudo chown -R 101:101 /data/clickhouse
    
    # é‡å•Ÿå®¹å™¨
    echo "Starting ClickHouse..."
    docker-compose -f ~/clickhouse-docker/docker-compose.yml up -d
    
    # ç­‰å¾…æœå‹™å•Ÿå‹•
    sleep 10
    
    # æª¢æŸ¥æœå‹™ç‹€æ…‹
    docker exec $CONTAINER_NAME clickhouse-client --query "SELECT 'Restore completed successfully!'"
    
    echo -e "${GREEN}âœ… Restore completed!${NC}"
}

# ä¸»ç¨‹åº
restore_backup
</code></pre>
<h3 id="6-è¨­ç½®-crontab-è‡ªå‹•å‚™ä»½"><a class="header" href="#6-è¨­ç½®-crontab-è‡ªå‹•å‚™ä»½">6. è¨­ç½® Crontab è‡ªå‹•å‚™ä»½</a></h3>
<pre><code class="language-bash"># ä½¿è…³æœ¬å¯åŸ·è¡Œ
chmod +x ~/clickhouse-docker/scripts/*.sh

# è¨­ç½®æ¯æ—¥è‡ªå‹•å‚™ä»½ (æ¯å¤©å‡Œæ™¨ 2 é»)
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ
0 2 * * * /home/$USER/clickhouse-docker/scripts/backup.sh &gt;&gt; /home/$USER/clickhouse-docker/backup/cron.log 2&gt;&amp;1
</code></pre>
<h2 id="æ¸¬è©¦ç¯„ä¾‹"><a class="header" href="#æ¸¬è©¦ç¯„ä¾‹">æ¸¬è©¦ç¯„ä¾‹</a></h2>
<h3 id="7-ä½¿ç”¨-makefile-ç®¡ç†æ¨è–¦"><a class="header" href="#7-ä½¿ç”¨-makefile-ç®¡ç†æ¨è–¦">7. ä½¿ç”¨ Makefile ç®¡ç†ï¼ˆæ¨è–¦ï¼‰</a></h3>
<p>å‰µå»º Makefile ç°¡åŒ–æ“ä½œï¼š</p>
<pre><code class="language-makefile"># å¿«é€Ÿé–‹å§‹
make quick-start   # ä¸€éµå®‰è£ä¸¦å•Ÿå‹•

# æ—¥å¸¸æ“ä½œ
make up           # å•Ÿå‹•æœå‹™
make down         # åœæ­¢æœå‹™
make status       # æŸ¥çœ‹ç‹€æ…‹
make shell        # é€²å…¥ CLI
make backup       # åŸ·è¡Œå‚™ä»½
make restore      # é‚„åŸå‚™ä»½
make reset        # å®Œå…¨é‡ç½®
</code></pre>
<p>æ‰‹å‹•æ“ä½œï¼š</p>
<pre><code class="language-bash">cd ~/clickhouse-docker
docker-compose up -d

# æª¢æŸ¥ç‹€æ…‹
docker-compose ps
docker logs clickhouse-server --tail 50
</code></pre>
<h3 id="8-å‰µå»ºæ¸¬è©¦è¡¨ä¸¦å°å…¥æ•¸æ“š"><a class="header" href="#8-å‰µå»ºæ¸¬è©¦è¡¨ä¸¦å°å…¥æ•¸æ“š">8. å‰µå»ºæ¸¬è©¦è¡¨ä¸¦å°å…¥æ•¸æ“š</a></h3>
<h4 id="å‰µå»ºåŸºæœ¬è¡¨çµæ§‹"><a class="header" href="#å‰µå»ºåŸºæœ¬è¡¨çµæ§‹">å‰µå»ºåŸºæœ¬è¡¨çµæ§‹</a></h4>
<pre><code class="language-sql"># é€£æ¥åˆ° ClickHouse
docker exec -it clickhouse-server clickhouse-client --user trader --password SecurePass123!

-- å‰µå»ºè³‡æ–™åº«
CREATE DATABASE IF NOT EXISTS market_data;
USE market_data;

-- å‰µå»º tick æ•¸æ“šè¡¨ï¼ˆç°¡åŒ–ç‰ˆï¼Œé¿å…è¤‡é›œç·¨ç¢¼å•é¡Œï¼‰
CREATE TABLE market_ticks (
    ts DateTime64(3),
    symbol String,
    close Decimal32(2),
    volume UInt32,
    bid_price Decimal32(2),
    bid_volume UInt32,
    ask_price Decimal32(2),
    ask_volume UInt32,
    tick_type UInt8
) ENGINE = MergeTree()
PARTITION BY toYYYYMM(ts)
ORDER BY (symbol, ts);

-- æŸ¥çœ‹éŒ¶çµæ§‹
DESCRIBE TABLE market_ticks;
</code></pre>
<h4 id="å°å…¥æ¸¬è©¦æ•¸æ“š"><a class="header" href="#å°å…¥æ¸¬è©¦æ•¸æ“š">å°å…¥æ¸¬è©¦æ•¸æ“š</a></h4>
<pre><code class="language-bash"># å‰µå»ºæ¸¬è©¦ CSV æ–‡ä»¶
cat &gt; ~/clickhouse-docker/test_data.csv &lt;&lt; 'EOF'
ts,symbol,close,volume,bid_price,bid_volume,ask_price,ask_volume,tick_type
2025-09-25 17:25:00.044,AAPL,1325.0,7,1320.0,160,1325.0,22,1
2025-09-25 17:25:02.207,AAPL,1325.0,1,1320.0,160,1325.0,22,1
2025-09-25 17:25:03.125,AAPL,1325.0,1,1320.0,161,1325.0,21,1
2025-09-25 17:25:47.863,AAPL,1325.0,1,1320.0,162,1325.0,21,1
2025-09-25 17:26:14.894,TSLA,1325.0,1,1320.0,181,1325.0,18,1
2025-09-25 17:26:51.365,TSLA,1325.0,1,1320.0,181,1325.0,27,1
2025-09-25 17:29:59.655,TSLA,1325.0,3,1320.0,177,1325.0,31,1
2025-09-25 17:30:06.262,NVDA,1325.0,1,1320.0,180,1325.0,28,1
2025-09-25 17:30:14.542,NVDA,1325.0,3,1320.0,183,1325.0,27,1
2025-09-25 17:30:52.600,NVDA,1320.0,2,1320.0,185,1325.0,22,2
EOF

# å°å…¥æ•¸æ“š
docker exec -i clickhouse-server clickhouse-client \
    --user trader --password SecurePass123! \
    --query "INSERT INTO market_data.market_ticks FORMAT CSVWithNames" \
    &lt; ~/clickhouse-docker/test_data.csv
</code></pre>
<h3 id="9-æ¸¬è©¦æŸ¥è©¢"><a class="header" href="#9-æ¸¬è©¦æŸ¥è©¢">9. æ¸¬è©¦æŸ¥è©¢</a></h3>
<h4 id="åŸºæœ¬æŸ¥è©¢æ¸¬è©¦"><a class="header" href="#åŸºæœ¬æŸ¥è©¢æ¸¬è©¦">åŸºæœ¬æŸ¥è©¢æ¸¬è©¦</a></h4>
<pre><code class="language-sql">-- é€£æ¥åˆ°è³‡æ–™åº«
docker exec -it clickhouse-server clickhouse-client \
    --user trader --password SecurePass123! \
    --database market_data

-- æŸ¥è©¢è¨˜éŒ„æ•¸
SELECT count(*) FROM market_ticks;

-- æŸ¥çœ‹æœ€æ–°æ•¸æ“š
SELECT * FROM market_ticks ORDER BY ts DESC LIMIT 5;

-- æŒ‰ symbol èšåˆ
SELECT 
    symbol,
    count(*) as tick_count,
    avg(close) as avg_price,
    max(volume) as max_volume
FROM market_ticks
GROUP BY symbol;

-- æ™‚é–“ç¯„åœæŸ¥è©¢
SELECT *
FROM market_ticks
WHERE ts &gt;= '2025-09-25 17:25:00'
  AND ts &lt;= '2025-09-25 17:30:00'
ORDER BY ts;

-- æŸ¥çœ‹å£“ç¸®æ•ˆæœ
SELECT 
    formatReadableSize(sum(data_compressed_bytes)) as compressed,
    formatReadableSize(sum(data_uncompressed_bytes)) as uncompressed,
    round(sum(data_uncompressed_bytes) / sum(data_compressed_bytes), 2) as ratio
FROM system.parts
WHERE database = 'market_data' AND table = 'market_ticks';
</code></pre>
<h4 id="æ•ˆèƒ½æ¸¬è©¦"><a class="header" href="#æ•ˆèƒ½æ¸¬è©¦">æ•ˆèƒ½æ¸¬è©¦</a></h4>
<pre><code class="language-sql">-- æ’å…¥å¤§é‡æ¸¬è©¦æ•¸æ“šï¼ˆä½¿ç”¨ rand() å‡½æ•¸é¿å…é¡å‹å•é¡Œï¼‰
INSERT INTO market_ticks
SELECT
    now() - toIntervalSecond(toUInt32(rand() % 86400)) as ts,
    arrayElement(['AAPL', 'GOOGL', 'MSFT', 'TSLA', 'NVDA'], (rand() % 5) + 1) as symbol,
    1000 + (rand() % 100) as close,
    toUInt32((rand() % 1000) + 1) as volume,
    1000 + (rand() % 100) - 50 as bid_price,
    toUInt32((rand() % 500) + 1) as bid_volume,
    1000 + (rand() % 100) as ask_price,
    toUInt32((rand() % 500) + 1) as ask_volume,
    toUInt8((rand() % 3) + 1) as tick_type
FROM numbers(1000000);

-- æ¸¬è©¦æŸ¥è©¢æ•ˆèƒ½
SELECT 
    symbol,
    toStartOfMinute(ts) as minute,
    avg(close) as avg_price,
    sum(volume) as total_volume
FROM market_ticks
WHERE ts &gt;= now() - INTERVAL 1 DAY
GROUP BY symbol, minute
ORDER BY minute DESC, symbol
LIMIT 100
FORMAT Null;

-- é¡¯ç¤ºæŸ¥è©¢çµ±è¨ˆ
SHOW PROCESSLIST;
</code></pre>
<h2 id="ç›£æ§èˆ‡ç¶­è­·"><a class="header" href="#ç›£æ§èˆ‡ç¶­è­·">ç›£æ§èˆ‡ç¶­è­·</a></h2>
<h3 id="10-ç›£æ§è…³æœ¬"><a class="header" href="#10-ç›£æ§è…³æœ¬">10. ç›£æ§è…³æœ¬</a></h3>
<pre><code class="language-bash">#!/bin/bash
# ~/clickhouse-docker/scripts/monitor.sh

echo "=== ClickHouse Monitoring Dashboard ==="
echo "======================================="

# ç³»çµ±è³‡æºä½¿ç”¨
echo -e "\nğŸ“Š Resource Usage:"
docker stats clickhouse-server --no-stream

# è³‡æ–™åº«å¤§å°
echo -e "\nğŸ’¾ Database Size:"
docker exec clickhouse-server clickhouse-client --user trader --password SecurePass123! --query "
SELECT 
    database,
    formatReadableSize(sum(bytes_on_disk)) as size,
    formatReadableQuantity(sum(rows)) as rows,
    count() as tables
FROM system.parts
WHERE active
GROUP BY database
FORMAT Pretty"

# æŸ¥è©¢æ•ˆèƒ½
echo -e "\nâš¡ Recent Queries:"
docker exec clickhouse-server clickhouse-client --user trader --password SecurePass123! --query "
SELECT 
    substring(query, 1, 50) as query_preview,
    formatReadableSize(memory_usage) as memory,
    query_duration_ms,
    read_rows,
    written_rows
FROM system.query_log
WHERE type = 'QueryFinish'
ORDER BY event_time DESC
LIMIT 5
FORMAT Pretty"

# ç³»çµ±å¥åº·ç‹€æ…‹
echo -e "\nâœ… Health Check:"
docker exec clickhouse-server clickhouse-client --query "SELECT 'ClickHouse is running OK!'"
</code></pre>
<h3 id="11-æ—¥å¸¸ç¶­è­·å‘½ä»¤"><a class="header" href="#11-æ—¥å¸¸ç¶­è­·å‘½ä»¤">11. æ—¥å¸¸ç¶­è­·å‘½ä»¤</a></h3>
<pre><code class="language-bash"># å„ªåŒ–è¡¨ï¼ˆæ•´ç†ç¢ç‰‡ï¼‰
docker exec clickhouse-server clickhouse-client --user trader --password SecurePass123! \
    --query "OPTIMIZE TABLE market_data.market_ticks FINAL"

# æ¸…ç†èˆŠåˆ†å€
docker exec clickhouse-server clickhouse-client --user trader --password SecurePass123! \
    --query "ALTER TABLE market_data.market_ticks DROP PARTITION '202501'"

# æŸ¥çœ‹æ…¢æŸ¥è©¢
docker exec clickhouse-server clickhouse-client --user trader --password SecurePass123! \
    --query "
    SELECT 
        query,
        query_duration_ms,
        memory_usage
    FROM system.query_log
    WHERE query_duration_ms &gt; 1000
    ORDER BY query_duration_ms DESC
    LIMIT 10"

# é‡å•Ÿæœå‹™
docker-compose restart

# å‡ç´š ClickHouse
docker-compose pull
docker-compose up -d
</code></pre>
<h2 id="å¸¸è¦‹å•é¡Œ"><a class="header" href="#å¸¸è¦‹å•é¡Œ">å¸¸è¦‹å•é¡Œ</a></h2>
<h3 id="q1-è¨˜æ†¶é«”ä¸è¶³éŒ¯èª¤"><a class="header" href="#q1-è¨˜æ†¶é«”ä¸è¶³éŒ¯èª¤">Q1: è¨˜æ†¶é«”ä¸è¶³éŒ¯èª¤</a></h3>
<pre><code class="language-bash"># èª¿æ•´è¨˜æ†¶é«”é™åˆ¶
docker exec clickhouse-server clickhouse-client --query "
SET max_memory_usage = 5000000000;
SET max_memory_usage_for_user = 5000000000;"
</code></pre>
<h3 id="q2-ç£ç¢Ÿç©ºé–“ä¸è¶³"><a class="header" href="#q2-ç£ç¢Ÿç©ºé–“ä¸è¶³">Q2: ç£ç¢Ÿç©ºé–“ä¸è¶³</a></h3>
<pre><code class="language-bash"># æª¢æŸ¥ç©ºé–“ä½¿ç”¨
df -h /data/clickhouse

# æ¸…ç†èˆŠæ•¸æ“š
docker exec clickhouse-server clickhouse-client --query "
ALTER TABLE market_data.market_ticks 
DROP PARTITION WHERE toYYYYMM(ts) &lt; toYYYYMM(now() - INTERVAL 6 MONTH)"
</code></pre>
<h3 id="q3-é€£æ¥è¢«æ‹’çµ•"><a class="header" href="#q3-é€£æ¥è¢«æ‹’çµ•">Q3: é€£æ¥è¢«æ‹’çµ•</a></h3>
<pre><code class="language-bash"># æª¢æŸ¥å®¹å™¨ç‹€æ…‹
docker ps | grep clickhouse

# æŸ¥çœ‹æ—¥èªŒ
docker logs clickhouse-server --tail 100

# é‡å•Ÿå®¹å™¨
docker-compose restart
</code></pre>
<h3 id="q4-æŸ¥è©¢å¤ªæ…¢"><a class="header" href="#q4-æŸ¥è©¢å¤ªæ…¢">Q4: æŸ¥è©¢å¤ªæ…¢</a></h3>
<pre><code class="language-sql">-- åˆ†ææŸ¥è©¢è¨ˆç•«
EXPLAIN SELECT * FROM market_ticks WHERE symbol = 'AAPL';

-- å‰µå»ºç´¢å¼•
ALTER TABLE market_ticks ADD INDEX idx_symbol (symbol) TYPE minmax GRANULARITY 4;
</code></pre>
<h2 id="å„ªåŒ–è¡¨è¨­è¨ˆé©ç”¨æ–¼å¤§é‡-tick-æ•¸æ“š"><a class="header" href="#å„ªåŒ–è¡¨è¨­è¨ˆé©ç”¨æ–¼å¤§é‡-tick-æ•¸æ“š">å„ªåŒ–è¡¨è¨­è¨ˆï¼ˆé©ç”¨æ–¼å¤§é‡ Tick æ•¸æ“šï¼‰</a></h2>
<h3 id="å‰µå»ºå„ªåŒ–çš„è¡¨çµæ§‹"><a class="header" href="#å‰µå»ºå„ªåŒ–çš„è¡¨çµæ§‹">å‰µå»ºå„ªåŒ–çš„è¡¨çµæ§‹</a></h3>
<pre><code class="language-sql">-- ä¸»è¦ tick æ•¸æ“šè¡¨ï¼ˆå„ªåŒ–ç‰ˆï¼‰
CREATE TABLE tick_data_optimized (
    timestamp DateTime64(3) CODEC(DoubleDelta),
    symbol LowCardinality(String),
    exchange LowCardinality(String),
    price Decimal64(4),
    volume UInt64 CODEC(T64),
    side Enum8('buy' = 1, 'sell' = 2),
    bid_price Decimal64(4),
    ask_price Decimal64(4),
    bid_volume UInt32 CODEC(T64),
    ask_volume UInt32 CODEC(T64)
) ENGINE = MergeTree()
PARTITION BY toYYYYMM(timestamp)
ORDER BY (symbol, timestamp)
PRIMARY KEY (symbol, timestamp)
TTL toDateTime(timestamp) + INTERVAL 90 DAY
SETTINGS index_granularity = 8192;

-- æ·»åŠ ç´¢å¼•
ALTER TABLE tick_data_optimized
    ADD INDEX idx_price price TYPE minmax GRANULARITY 4,
    ADD INDEX idx_symbol symbol TYPE bloom_filter(0.01) GRANULARITY 1;
</code></pre>
<h3 id="å‰µå»ºç‰©åŒ–è¦–åœ–é èšåˆ"><a class="header" href="#å‰µå»ºç‰©åŒ–è¦–åœ–é èšåˆ">å‰µå»ºç‰©åŒ–è¦–åœ–ï¼ˆé èšåˆï¼‰</a></h3>
<pre><code class="language-sql">-- 1åˆ†é˜Kç·šç‰©åŒ–è¦–åœ–
CREATE MATERIALIZED VIEW tick_1min_mv
ENGINE = AggregatingMergeTree()
PARTITION BY toYYYYMM(minute)
ORDER BY (symbol, minute)
AS SELECT
    symbol,
    toStartOfMinute(timestamp) as minute,
    argMinState(price, timestamp) as open,
    maxState(price) as high,
    minState(price) as low,
    argMaxState(price, timestamp) as close,
    sumState(toUInt64(volume)) as volume,
    countState() as tick_count
FROM tick_data_optimized
GROUP BY symbol, minute;
</code></pre>
<h2 id="æ•ˆèƒ½èª¿å„ªå»ºè­°"><a class="header" href="#æ•ˆèƒ½èª¿å„ªå»ºè­°">æ•ˆèƒ½èª¿å„ªå»ºè­°</a></h2>
<ol>
<li><strong>ä½¿ç”¨ SSD/NVMe</strong> - I/O æ˜¯æœ€å¤§ç“¶é ¸</li>
<li><strong>é©ç•¶åˆ†å€</strong> - æŒ‰æœˆåˆ†å€å° tick æ•¸æ“šæœ€åˆé©</li>
<li><strong>æ‰¹é‡æ’å…¥</strong> - å–®ç­†æ’å…¥æ•ˆèƒ½å·®ï¼Œå»ºè­°æ‰¹é‡ 10000+ ç­†</li>
<li><strong>å®šæœŸ OPTIMIZE</strong> - æ¯é€±åŸ·è¡Œä¸€æ¬¡ OPTIMIZE TABLE</li>
<li><strong>ç›£æ§è¨˜æ†¶é«”</strong> - ClickHouse æ˜¯è¨˜æ†¶é«”å¯†é›†å‹è³‡æ–™åº«</li>
<li><strong>ä½¿ç”¨ç‰©åŒ–è¦–åœ–</strong> - é èšåˆå¸¸ç”¨æŸ¥è©¢ï¼Œå¤§å¹…æå‡æ•ˆèƒ½</li>
<li><strong>é¸æ“‡æ­£ç¢ºçš„ç·¨ç¢¼</strong> - DoubleDelta ç”¨æ–¼æ™‚é–“æˆ³ï¼ŒT64 ç”¨æ–¼æ•´æ•¸</li>
<li><strong>ä½¿ç”¨ LowCardinality</strong> - å°é‡è¤‡å€¼å¤šçš„å­—ä¸²æ¬„ä½</li>
</ol>
<h2 id="å®‰å…¨å»ºè­°"><a class="header" href="#å®‰å…¨å»ºè­°">å®‰å…¨å»ºè­°</a></h2>
<ol>
<li><strong>ä¿®æ”¹é è¨­å¯†ç¢¼</strong> - ç«‹å³ä¿®æ”¹ docker-compose.yml ä¸­çš„å¯†ç¢¼</li>
<li><strong>é™åˆ¶ç¶²è·¯å­˜å–</strong> - ä½¿ç”¨é˜²ç«ç‰†é™åˆ¶ 8123/9000 ç«¯å£</li>
<li><strong>å®šæœŸå‚™ä»½</strong> - ç¢ºä¿è‡ªå‹•å‚™ä»½æ­£å¸¸é‹è¡Œ</li>
<li><strong>ç›£æ§æ—¥èªŒ</strong> - å®šæœŸæª¢æŸ¥ç•°å¸¸å­˜å–</li>
<li><strong>æ›´æ–°ç‰ˆæœ¬</strong> - é—œæ³¨å®‰å…¨æ›´æ–°</li>
</ol>
<h2 id="é‡è¦æ³¨æ„äº‹é …"><a class="header" href="#é‡è¦æ³¨æ„äº‹é …">é‡è¦æ³¨æ„äº‹é …</a></h2>
<h3 id="å¯¦æ¸¬ç™¼ç¾çš„å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ"><a class="header" href="#å¯¦æ¸¬ç™¼ç¾çš„å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ">å¯¦æ¸¬ç™¼ç¾çš„å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ</a></h3>
<ol>
<li>
<p><strong>Docker Compose å®‰è£</strong></p>
<ul>
<li>ä½¿ç”¨å…·é«”ç‰ˆæœ¬è™Ÿè€Œé <code>latest</code>ï¼Œé¿å…ä¸‹è¼‰å¤±æ•—</li>
<li>Ubuntu 24.04 å¯èƒ½æ²’æœ‰ docker-compose-plugin å¥—ä»¶</li>
</ul>
</li>
<li>
<p><strong>é…ç½®æª”å•é¡Œ</strong></p>
<ul>
<li>user-level è¨­å®šï¼ˆå¦‚ max_threadsï¼‰å¿…é ˆæ”¾åœ¨ <code>&lt;profiles&gt;</code> å€å¡Šä¸­</li>
<li>è¤‡é›œçš„å£“ç¸®ç·¨ç¢¼ï¼ˆå¦‚ Gorilla + LZ4ï¼‰å¯èƒ½å°è‡´éŒ¯èª¤</li>
<li>å»ºè­°å…ˆä½¿ç”¨é è¨­é…ç½®ï¼Œç¢ºèªé‹è¡Œæ­£å¸¸å¾Œå†å„ªåŒ–</li>
</ul>
</li>
<li>
<p><strong>éš¨æ©Ÿå‡½æ•¸ä½¿ç”¨</strong></p>
<ul>
<li>ä½¿ç”¨ <code>rand()</code> è€Œé <code>randUniform()</code> æˆ– <code>randNormal()</code></li>
<li>æ³¨æ„é¡å‹è½‰æ›ï¼ˆä½¿ç”¨ toUInt32ã€toUInt8 ç­‰ï¼‰</li>
</ul>
</li>
<li>
<p><strong>ç¶²è·¯æ¨¡å¼</strong></p>
<ul>
<li>æ¸¬è©¦ç’°å¢ƒå»ºè­°ä½¿ç”¨æ©‹æ¥æ¨¡å¼é…ç½®ç«¯å£</li>
<li>ç”Ÿç”¢ç’°å¢ƒå¯è€ƒæ…® host æ¨¡å¼ä»¥ç²å¾—æ›´å¥½æ•ˆèƒ½</li>
</ul>
</li>
<li>
<p><strong>å‚™ä»½é…ç½®</strong></p>
<ul>
<li>åŸç”Ÿå‚™ä»½éœ€è¦é¡å¤–é…ç½® <code>backups.allowed_disk</code> åƒæ•¸</li>
<li>ç‰©ç†å‚™ä»½å¯ä»¥æ­£å¸¸é‹ä½œ</li>
<li>é‚„åŸåŠŸèƒ½å»ºè­°ä½¿ç”¨ ClickHouse åŸç”Ÿ BACKUP/RESTORE å‘½ä»¤</li>
</ul>
</li>
<li>
<p><strong>å„ªåŒ–è¡¨è¨­è¨ˆæ³¨æ„äº‹é …</strong></p>
<ul>
<li>Gorilla ç·¨ç¢¼ä¸é©ç”¨æ–¼ Decimal é¡å‹</li>
<li>TTL ä½¿ç”¨ DateTime64 éœ€è¦è½‰æ›ç‚º DateTime</li>
<li>ç‰©åŒ–è¦–åœ–ä½¿ç”¨ State å‡½æ•¸èšåˆï¼ŒæŸ¥è©¢æ™‚ç”¨ Merge å‡½æ•¸</li>
<li>bloom_filter ç´¢å¼•å°å­—ä¸²æŸ¥è©¢æ•ˆèƒ½æå‡é¡¯è‘—</li>
</ul>
</li>
</ol>
<h2 id="æ”¯æ´è³‡æº"><a class="header" href="#æ”¯æ´è³‡æº">æ”¯æ´è³‡æº</a></h2>
<ul>
<li><a href="https://clickhouse.com/docs">å®˜æ–¹æ–‡æª”</a></li>
<li><a href="https://hub.docker.com/r/clickhouse/clickhouse-server">Docker Hub</a></li>
<li><a href="https://github.com/ClickHouse/ClickHouse/issues">GitHub Issues</a></li>
<li><a href="https://clickhouse.com/community">ç¤¾ç¾¤è«–å£‡</a></li>
</ul>
<h2 id="å¯¦æ¸¬é©—è­‰é …ç›®"><a class="header" href="#å¯¦æ¸¬é©—è­‰é …ç›®">å¯¦æ¸¬é©—è­‰é …ç›®</a></h2>
<p>ç¶“éå®Œæ•´æ¸¬è©¦é©—è­‰çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>âœ… Docker Compose éƒ¨ç½²</li>
<li>âœ… Makefile è‡ªå‹•åŒ–ç®¡ç†</li>
<li>âœ… åŸºæœ¬è¡¨å»ºç«‹èˆ‡æŸ¥è©¢</li>
<li>âœ… å„ªåŒ–è¡¨çµæ§‹ï¼ˆtick_data_optimizedï¼‰</li>
<li>âœ… ç‰©åŒ–è¦–åœ–ï¼ˆ1åˆ†é˜ã€5åˆ†é˜Kç·šï¼‰</li>
<li>âœ… ç´¢å¼•å„ªåŒ–ï¼ˆbloom_filterã€minmaxï¼‰</li>
<li>âœ… å‚™ä»½åŠŸèƒ½</li>
<li>âš ï¸ é‚„åŸåŠŸèƒ½ï¼ˆéœ€è¦æ”¹é€²ï¼‰</li>
</ul>
<hr />
<p><strong>æœ€å¾Œæ›´æ–°</strong>: 2025-09-27
<strong>ç‰ˆæœ¬</strong>: ClickHouse 24.8
<strong>ä½œè€…</strong>: DevOps Team
<strong>å¯¦æ¸¬é©—è­‰</strong>: 2025-09-27 æˆåŠŸéƒ¨ç½²æ–¼ Ubuntu ç’°å¢ƒï¼ŒåŒ…å«å„ªåŒ–è¡¨è¨­è¨ˆ</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../database/mysql_ubuntu_guide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../mq/kafka.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../database/mysql_ubuntu_guide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../mq/kafka.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
