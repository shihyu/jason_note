<!DOCTYPE HTML>
<html lang="zh" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>sherpa-onnx 完整指南 - Jason Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_note" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sherpa-onnx-完整指南"><a class="header" href="#sherpa-onnx-完整指南">sherpa-onnx 完整指南</a></h1>
<h2 id="目錄"><a class="header" href="#目錄">目錄</a></h2>
<ul>
<li><a href="#%E4%BB%80%E9%BA%BC%E6%98%AF-sherpa-onnx">什麼是 sherpa-onnx</a></li>
<li><a href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD">主要功能</a></li>
<li><a href="#%E6%94%AF%E6%8F%B4%E5%B9%B3%E5%8F%B0">支援平台</a></li>
<li><a href="#webassembly-%E6%87%89%E7%94%A8">WebAssembly 應用</a></li>
<li><a href="#python-%E5%BF%AB%E9%80%9F%E9%A9%97%E8%AD%89">Python 快速驗證</a></li>
<li><a href="#%E5%AE%8C%E6%95%B4%E6%B8%AC%E8%A9%A6%E8%85%B3%E6%9C%AC">完整測試腳本</a></li>
<li><a href="#%E4%B8%AD%E6%96%87-tts-%E5%B7%A5%E5%85%B7">中文 TTS 工具</a> ⭐</li>
<li><a href="#%E5%B8%B8%E8%A6%8B%E5%95%8F%E9%A1%8C">常見問題</a></li>
<li><a href="#%E6%9B%B4%E5%A4%9A%E8%B3%87%E6%BA%90">更多資源</a></li>
</ul>
<hr />
<h2 id="什麼是-sherpa-onnx"><a class="header" href="#什麼是-sherpa-onnx">什麼是 sherpa-onnx</a></h2>
<p><strong>sherpa-onnx</strong> 是一個開源的語音處理工具庫，使用 ONNX Runtime 和 Next-gen Kaldi 框架開發。</p>
<h3 id="核心特色"><a class="header" href="#核心特色">核心特色</a></h3>
<ul>
<li>✅ <strong>完全離線運行</strong>：不需要網路連線</li>
<li>✅ <strong>跨平台支援</strong>：支援 Windows、Linux、macOS、Android、iOS、嵌入式系統</li>
<li>✅ <strong>多語言支援</strong>：中文、英文、日文、韓文、粵語、俄語等</li>
<li>✅ <strong>多種編程語言</strong>：支援 12 種編程語言（Python、C++、Java、JavaScript、Swift 等）</li>
<li>✅ <strong>高性能</strong>：使用 ONNX Runtime 優化，執行效率高</li>
</ul>
<hr />
<h2 id="主要功能"><a class="header" href="#主要功能">主要功能</a></h2>
<h3 id="1-語音轉文字speech-to-text-asr"><a class="header" href="#1-語音轉文字speech-to-text-asr">1. 語音轉文字（Speech-to-Text, ASR）</a></h3>
<ul>
<li>即時語音識別</li>
<li>支援串流（streaming）和批次（batch）處理</li>
<li>多語言模型可選</li>
</ul>
<h3 id="2-文字轉語音text-to-speech-tts"><a class="header" href="#2-文字轉語音text-to-speech-tts">2. 文字轉語音（Text-to-Speech, TTS）</a></h3>
<ul>
<li>自然流暢的語音合成</li>
<li>可調整語速、音調</li>
<li>多種說話人（speaker）選擇</li>
</ul>
<h3 id="3-說話人分離speaker-diarization"><a class="header" href="#3-說話人分離speaker-diarization">3. 說話人分離（Speaker Diarization）</a></h3>
<ul>
<li>識別「誰在何時說話」</li>
<li>適用於會議記錄、訪談分析</li>
</ul>
<h3 id="4-語音活動檢測vad"><a class="header" href="#4-語音活動檢測vad">4. 語音活動檢測（VAD）</a></h3>
<ul>
<li>自動偵測語音片段</li>
<li>過濾靜音和噪音</li>
</ul>
<h3 id="5-語音增強speech-enhancement"><a class="header" href="#5-語音增強speech-enhancement">5. 語音增強（Speech Enhancement）</a></h3>
<ul>
<li>改善語音品質</li>
<li>降噪處理</li>
</ul>
<h3 id="6-聲源分離source-separation"><a class="header" href="#6-聲源分離source-separation">6. 聲源分離（Source Separation）</a></h3>
<ul>
<li>分離混合音頻中的不同聲音來源</li>
</ul>
<hr />
<h2 id="支援平台"><a class="header" href="#支援平台">支援平台</a></h2>
<h3 id="作業系統"><a class="header" href="#作業系統">作業系統</a></h3>
<ul>
<li>Windows</li>
<li>Linux</li>
<li>macOS</li>
<li>Android</li>
<li>iOS</li>
<li>HarmonyOS</li>
</ul>
<h3 id="嵌入式系統"><a class="header" href="#嵌入式系統">嵌入式系統</a></h3>
<ul>
<li>Raspberry Pi</li>
<li>RISC-V</li>
<li>RK3588</li>
<li>Jetson (NVIDIA)</li>
</ul>
<h3 id="編程語言"><a class="header" href="#編程語言">編程語言</a></h3>
<p>Python、C++、Java、JavaScript、TypeScript、C#、Go、Swift、Kotlin、Dart、Rust、C</p>
<hr />
<h2 id="webassembly-應用"><a class="header" href="#webassembly-應用">WebAssembly 應用</a></h2>
<h3 id="什麼是-webassembly-版本"><a class="header" href="#什麼是-webassembly-版本">什麼是 WebAssembly 版本？</a></h3>
<p>sherpa-onnx 的 WebAssembly 版本讓語音處理功能可以<strong>直接在網頁瀏覽器中執行</strong>，無需後端伺服器。</p>
<h3 id="主要優勢"><a class="header" href="#主要優勢">主要優勢</a></h3>
<h4 id="1-完全在瀏覽器運行"><a class="header" href="#1-完全在瀏覽器運行">1. 完全在瀏覽器運行</a></h4>
<ul>
<li>使用 Emscripten 編譯器將 C++ 程式碼編譯成 WebAssembly</li>
<li>接近原生應用的性能表現</li>
<li>無需安裝額外軟體</li>
</ul>
<h4 id="2-隱私保護"><a class="header" href="#2-隱私保護">2. 隱私保護</a></h4>
<ul>
<li>所有處理都在客戶端完成</li>
<li>語音資料不會傳送到伺服器</li>
<li>適合處理敏感資訊</li>
</ul>
<h4 id="3-離線運作"><a class="header" href="#3-離線運作">3. 離線運作</a></h4>
<ul>
<li>模型載入後可完全離線使用</li>
<li>不受網路狀況影響</li>
</ul>
<h4 id="4-跨平台相容"><a class="header" href="#4-跨平台相容">4. 跨平台相容</a></h4>
<ul>
<li>只需現代瀏覽器即可執行</li>
<li>支援桌面和行動裝置</li>
</ul>
<h3 id="webassembly-應用場景"><a class="header" href="#webassembly-應用場景">WebAssembly 應用場景</a></h3>
<ol>
<li>
<p><strong>網頁語音識別</strong></p>
<ul>
<li>線上會議字幕</li>
<li>語音筆記工具</li>
<li>客服系統</li>
</ul>
</li>
<li>
<p><strong>網頁文字轉語音</strong></p>
<ul>
<li>電子書朗讀</li>
<li>學習輔助工具</li>
<li>無障礙功能</li>
</ul>
</li>
<li>
<p><strong>語音互動網頁</strong></p>
<ul>
<li>語音助手</li>
<li>語音遊戲</li>
<li>教育平台</li>
</ul>
</li>
<li>
<p><strong>隱私敏感應用</strong></p>
<ul>
<li>醫療記錄語音輸入</li>
<li>法律文件聽寫</li>
<li>私人日記語音記錄</li>
</ul>
</li>
</ol>
<h3 id="線上體驗hugging-face-spaces"><a class="header" href="#線上體驗hugging-face-spaces">線上體驗（Hugging Face Spaces）</a></h3>
<p>你可以直接在瀏覽器中試用：</p>
<ul>
<li><strong>英文語音識別</strong>: https://huggingface.co/spaces/k2-fsa/web-assembly-asr-sherpa-onnx-en</li>
<li><strong>中英雙語識別</strong>: https://huggingface.co/spaces/k2-fsa/web-assembly-asr-sherpa-onnx-zh-en</li>
<li><strong>中文、粵語、英文</strong>: https://huggingface.co/spaces/k2-fsa/web-assembly-asr-sherpa-onnx-zh-cantonese-en-paraformer</li>
<li><strong>英文文字轉語音</strong>: https://huggingface.co/spaces/k2-fsa/web-assembly-tts-sherpa-onnx-en</li>
</ul>
<hr />
<h2 id="python-快速驗證"><a class="header" href="#python-快速驗證">Python 快速驗證</a></h2>
<h3 id="前置準備"><a class="header" href="#前置準備">前置準備</a></h3>
<p><strong>無需麥克風！</strong> 我們使用音頻檔案來測試。</p>
<h3 id="安裝"><a class="header" href="#安裝">安裝</a></h3>
<pre><code class="language-bash">pip install sherpa-onnx numpy
</code></pre>
<hr />
<h2 id="方案一使用-vits-模型的-tts-測試推薦"><a class="header" href="#方案一使用-vits-模型的-tts-測試推薦">方案一：使用 VITS 模型的 TTS 測試（推薦）</a></h2>
<h3 id="步驟-1-下載模型"><a class="header" href="#步驟-1-下載模型">步驟 1: 下載模型</a></h3>
<p>sherpa-onnx 需要手動下載模型文件（不會自動下載）。</p>
<pre><code class="language-bash"># 下載 VITS 模型
wget https://github.com/k2-fsa/sherpa-onnx/releases/download/tts-models/vits-piper-en_US-lessac-medium.tar.bz2

# 解壓縮
tar -xjf vits-piper-en_US-lessac-medium.tar.bz2
</code></pre>
<h3 id="步驟-2-程式碼srcsherpa_onnxsimple_tts_examplepy"><a class="header" href="#步驟-2-程式碼srcsherpa_onnxsimple_tts_examplepy">步驟 2: 程式碼：<code>src/sherpa_onnx/simple_tts_example.py</code></a></h3>
<pre><code class="language-python">#!/usr/bin/env python3
"""sherpa-onnx TTS 測試範例"""

import sherpa_onnx

print("正在配置模型...")

# 配置 TTS 模型
tts_config = sherpa_onnx.OfflineTtsConfig(
    model=sherpa_onnx.OfflineTtsModelConfig(
        vits=sherpa_onnx.OfflineTtsVitsModelConfig(
            model="vits-piper-en_US-lessac-medium/en_US-lessac-medium.onnx",
            lexicon="",
            data_dir="vits-piper-en_US-lessac-medium/espeak-ng-data",
            tokens="vits-piper-en_US-lessac-medium/tokens.txt",
        ),
        provider="cpu",
        debug=False,
        num_threads=1,
    ),
    rule_fsts="",
    max_num_sentences=1,
)

# 驗證配置
if not tts_config.validate():
    raise ValueError("配置驗證失敗！請檢查模型路徑")

print("正在載入模型...")
tts = sherpa_onnx.OfflineTts(tts_config)

print("正在生成語音...")
audio = tts.generate("Hello! This is sherpa o n n x speaking.", sid=0, speed=1.0)

# 儲存為 WAV 檔案
sherpa_onnx.write_wave("hello.wav", audio.samples, audio.sample_rate)

print("✓ 完成！語音已儲存到 hello.wav")
print(f"  採樣率: {audio.sample_rate} Hz")
print(f"  長度: {len(audio.samples)/audio.sample_rate:.2f} 秒")
</code></pre>
<h3 id="執行"><a class="header" href="#執行">執行</a></h3>
<pre><code class="language-bash">python src/sherpa_onnx/simple_tts_example.py
</code></pre>
<h3 id="預期結果"><a class="header" href="#預期結果">預期結果</a></h3>
<ul>
<li>生成 <code>hello.wav</code> 檔案（約 2-3 秒的語音）</li>
<li>採樣率：22050 Hz</li>
<li>用任何播放器播放該檔案，應該能聽到英文語音</li>
</ul>
<hr />
<h2 id="方案二語音識別測試"><a class="header" href="#方案二語音識別測試">方案二：語音識別測試</a></h2>
<p><strong>注意</strong>：ASR（語音識別）需要額外下載和配置模型，不支持自動下載。</p>
<p>詳細的 ASR 配置請參考官方文檔：https://k2-fsa.github.io/sherpa/onnx/pretrained_models/index.html</p>
<h3 id="簡化範例使用-from_transducer"><a class="header" href="#簡化範例使用-from_transducer">簡化範例：使用 from_transducer</a></h3>
<pre><code class="language-python">#!/usr/bin/env python3
"""簡單的語音識別測試（需要先下載模型）"""

from sherpa_onnx import OnlineRecognizer
import wave
import numpy as np

# 注意：這個範例假設你已經下載了對應的模型文件
# 下載說明：https://k2-fsa.github.io/sherpa/onnx/pretrained_models/online-transducer/index.html

print("正在載入模型...")
recognizer = OnlineRecognizer.from_transducer(
    encoder="模型路徑/encoder.onnx",
    decoder="模型路徑/decoder.onnx",
    joiner="模型路徑/joiner.onnx",
    tokens="模型路徑/tokens.txt",
)

# 讀取音頻檔案（需要準備一個 WAV 檔案）
audio_file = "test.wav"  # 替換成你的音頻檔案

print(f"正在讀取音頻: {audio_file}")
with wave.open(audio_file, 'rb') as wf:
    sample_rate = wf.getframerate()
    audio_data = wf.readframes(wf.getnframes())
    samples = np.frombuffer(audio_data, dtype=np.int16).astype(np.float32) / 32768.0
    
    # 如果是雙聲道，轉為單聲道
    if wf.getnchannels() == 2:
        samples = samples.reshape(-1, 2).mean(axis=1)

print("正在識別...")
stream = recognizer.create_stream()
stream.accept_waveform(sample_rate, samples)

while recognizer.is_ready(stream):
    recognizer.decode_stream(stream)

result = recognizer.get_result(stream)
print(f"✓ 識別結果: {result}")
</code></pre>
<h3 id="測試音頻下載"><a class="header" href="#測試音頻下載">測試音頻下載</a></h3>
<p>如果沒有自己的音頻檔案：</p>
<pre><code class="language-bash"># 中文測試音頻
wget https://github.com/k2-fsa/sherpa-onnx/raw/master/sherpa-onnx/python/tests/test_data/zh.wav

# 英文測試音頻
wget https://github.com/k2-fsa/sherpa-onnx/raw/master/sherpa-onnx/python/tests/test_data/en.wav
</code></pre>
<hr />
<h2 id="完整測試腳本"><a class="header" href="#完整測試腳本">完整測試腳本</a></h2>
<h3 id="程式碼srcsherpa_onnxtest_tts_validationpy"><a class="header" href="#程式碼srcsherpa_onnxtest_tts_validationpy">程式碼：<code>src/sherpa_onnx/test_tts_validation.py</code></a></h3>
<pre><code class="language-python">#!/usr/bin/env python3
"""
sherpa-onnx 完整測試腳本
測試 TTS 和 ASR 功能
"""

import os
import sys
import wave
import numpy as np

def test_tts():
    """測試文字轉語音"""
    print("\n=== 測試文字轉語音（TTS）===")

    try:
        import sherpa_onnx

        # 配置 TTS 模型
        tts_config = sherpa_onnx.OfflineTtsConfig(
            model=sherpa_onnx.OfflineTtsModelConfig(
                vits=sherpa_onnx.OfflineTtsVitsModelConfig(
                    model="vits-piper-en_US-lessac-medium/en_US-lessac-medium.onnx",
                    lexicon="",
                    data_dir="vits-piper-en_US-lessac-medium/espeak-ng-data",
                    tokens="vits-piper-en_US-lessac-medium/tokens.txt",
                ),
                provider="cpu",
                debug=False,
                num_threads=1,
            ),
            rule_fsts="",
            max_num_sentences=1,
        )

        if not tts_config.validate():
            raise ValueError("配置驗證失敗")

        tts = sherpa_onnx.OfflineTts(tts_config)

        text = "Hello! This is a test of sherpa-onnx text to speech."
        print(f"正在生成語音: {text}")

        audio = tts.generate(text, sid=0, speed=1.0)

        output_file = "output_tts.wav"
        sherpa_onnx.write_wave(output_file, audio.samples, audio.sample_rate)

        print(f"✓ 成功生成語音檔案: {output_file}")
        print(f"  採樣率: {audio.sample_rate} Hz")
        print(f"  長度: {len(audio.samples)/audio.sample_rate:.2f} 秒")

        return output_file

    except Exception as e:
        print(f"✗ TTS 測試失敗: {e}")
        return None


def test_audio_file_info(audio_file):
    """顯示音頻檔案資訊"""
    print("\n=== 音頻檔案資訊 ===")

    try:
        if not os.path.exists(audio_file):
            print(f"✗ 檔案不存在: {audio_file}")
            return

        file_size = os.path.getsize(audio_file)
        print(f"檔案: {audio_file}")
        print(f"大小: {file_size / 1024:.2f} KB")

        with wave.open(audio_file, 'rb') as wf:
            channels = wf.getnchannels()
            sample_width = wf.getsampwidth()
            framerate = wf.getframerate()
            n_frames = wf.getnframes()
            duration = n_frames / framerate

            print(f"採樣率: {framerate} Hz")
            print(f"聲道數: {channels}")
            print(f"位元深度: {sample_width * 8} bit")
            print(f"長度: {duration:.2f} 秒")

        print("✓ 音頻檔案驗證通過")

    except Exception as e:
        print(f"✗ 讀取音頻檔案失敗: {e}")


def main():
    print("=" * 60)
    print("sherpa-onnx TTS 測試")
    print("=" * 60)

    try:
        import sherpa_onnx
        print(f"✓ sherpa-onnx 已安裝 (版本: {sherpa_onnx.__version__})")
    except ImportError:
        print("✗ sherpa-onnx 未安裝")
        print("\n請執行: pip install sherpa-onnx")
        sys.exit(1)

    # 測試 TTS
    tts_output = test_tts()

    # 顯示音頻檔案資訊
    if tts_output:
        test_audio_file_info(tts_output)

    print("\n" + "=" * 60)
    print("測試完成！")
    print("=" * 60)


if __name__ == "__main__":
    main()
</code></pre>
<hr />
<h2 id="常見問題"><a class="header" href="#常見問題">常見問題</a></h2>
<h3 id="q1-第一次執行很慢"><a class="header" href="#q1-第一次執行很慢">Q1: 第一次執行很慢？</a></h3>
<p><strong>A:</strong> 是的，第一次需要下載模型檔案（100-300 MB），之後就會很快。</p>
<h3 id="q2-模型下載到哪裡"><a class="header" href="#q2-模型下載到哪裡">Q2: 模型下載到哪裡？</a></h3>
<p><strong>A:</strong> 預設位置：</p>
<ul>
<li>Linux/macOS: <code>~/.cache/sherpa-onnx/</code> 或 <code>~/.local/share/sherpa-onnx/</code></li>
<li>Windows: <code>C:\Users\用戶名\.cache\sherpa-onnx\</code></li>
</ul>
<h3 id="q3-可以完全離線使用嗎"><a class="header" href="#q3-可以完全離線使用嗎">Q3: 可以完全離線使用嗎？</a></h3>
<p><strong>A:</strong> 可以！模型下載後就完全不需要網路連線。</p>
<h3 id="q4-支援哪些語言"><a class="header" href="#q4-支援哪些語言">Q4: 支援哪些語言？</a></h3>
<p><strong>A:</strong></p>
<ul>
<li>中文（普通話、粵語、各種方言）</li>
<li>英文</li>
<li>日文</li>
<li>韓文</li>
<li>俄文</li>
<li>西班牙文</li>
<li>德文</li>
<li>法文</li>
<li>等多種語言</li>
</ul>
<h3 id="q5-音頻格式有什麼要求"><a class="header" href="#q5-音頻格式有什麼要求">Q5: 音頻格式有什麼要求？</a></h3>
<p><strong>A:</strong> 最佳格式：</p>
<ul>
<li>採樣率：16 kHz</li>
<li>位元深度：16-bit PCM</li>
<li>聲道：單聲道（mono）</li>
<li>格式：WAV</li>
</ul>
<p>但系統會自動處理其他格式的轉換。</p>
<h3 id="q6-需要-gpu-嗎"><a class="header" href="#q6-需要-gpu-嗎">Q6: 需要 GPU 嗎？</a></h3>
<p><strong>A:</strong> 不需要！CPU 就能跑，但如果有 GPU 會更快。支援 CUDA、NNAPI、CoreML 等加速。</p>
<h3 id="q7-可以用在商業項目嗎"><a class="header" href="#q7-可以用在商業項目嗎">Q7: 可以用在商業項目嗎？</a></h3>
<p><strong>A:</strong> 請查看具體模型的授權。sherpa-onnx 本身是 Apache 2.0 授權，但不同的預訓練模型可能有不同的授權條款。</p>
<h3 id="q8-識別準確率如何"><a class="header" href="#q8-識別準確率如何">Q8: 識別準確率如何？</a></h3>
<p><strong>A:</strong> 取決於：</p>
<ul>
<li>選用的模型</li>
<li>音頻品質</li>
<li>語言/口音</li>
<li>背景噪音</li>
</ul>
<p>一般來說，清晰的錄音可以達到 90%+ 的準確率。</p>
<h3 id="q9-可以自訂模型嗎"><a class="header" href="#q9-可以自訂模型嗎">Q9: 可以自訂模型嗎？</a></h3>
<p><strong>A:</strong> 可以！你可以：</p>
<ul>
<li>使用自己訓練的模型</li>
<li>Fine-tune 現有模型</li>
<li>轉換其他框架的模型為 ONNX 格式</li>
</ul>
<h3 id="q10-如何選擇模型"><a class="header" href="#q10-如何選擇模型">Q10: 如何選擇模型？</a></h3>
<p><strong>A:</strong> 考慮因素：</p>
<ul>
<li><strong>語言</strong>：選擇支援目標語言的模型</li>
<li><strong>大小</strong>：小模型執行快但準確率較低</li>
<li><strong>用途</strong>：串流（streaming）vs 批次（batch）</li>
<li><strong>裝置</strong>：嵌入式系統選擇小模型</li>
</ul>
<hr />
<h2 id="實際應用案例"><a class="header" href="#實際應用案例">實際應用案例</a></h2>
<h3 id="1-智能音箱"><a class="header" href="#1-智能音箱">1. 智能音箱</a></h3>
<ul>
<li>小愛音箱自定義喚醒詞</li>
<li>離線語音控制</li>
</ul>
<h3 id="2-語音助手"><a class="header" href="#2-語音助手">2. 語音助手</a></h3>
<ul>
<li>Windows/Linux 桌面語音助手</li>
<li>類 Jarvis 系統</li>
</ul>
<h3 id="3-會議記錄"><a class="header" href="#3-會議記錄">3. 會議記錄</a></h3>
<ul>
<li>自動語音轉文字</li>
<li>說話人識別</li>
</ul>
<h3 id="4-教育應用"><a class="header" href="#4-教育應用">4. 教育應用</a></h3>
<ul>
<li>語言學習工具</li>
<li>發音評測</li>
<li>聽力練習</li>
</ul>
<h3 id="5-無障礙輔助"><a class="header" href="#5-無障礙輔助">5. 無障礙輔助</a></h3>
<ul>
<li>視障者閱讀輔助</li>
<li>聽障者語音轉字幕</li>
<li>智能眼鏡應用</li>
</ul>
<h3 id="6-遊戲應用"><a class="header" href="#6-遊戲應用">6. 遊戲應用</a></h3>
<ul>
<li>語音聊天轉文字</li>
<li>遊戲內語音指令</li>
</ul>
<h3 id="7-iot-設備"><a class="header" href="#7-iot-設備">7. IoT 設備</a></h3>
<ul>
<li>ESP32 語音控制</li>
<li>Raspberry Pi 智能裝置</li>
<li>機器人語音互動</li>
</ul>
<h3 id="8-醫療應用"><a class="header" href="#8-醫療應用">8. 醫療應用</a></h3>
<ul>
<li>病歷語音輸入</li>
<li>醫療記錄轉錄</li>
</ul>
<hr />
<h2 id="更多資源"><a class="header" href="#更多資源">更多資源</a></h2>
<h3 id="官方資源"><a class="header" href="#官方資源">官方資源</a></h3>
<ul>
<li><strong>GitHub</strong>: https://github.com/k2-fsa/sherpa-onnx</li>
<li><strong>文檔</strong>: https://k2-fsa.github.io/sherpa/</li>
<li><strong>發布版本</strong>: https://github.com/k2-fsa/sherpa-onnx/releases</li>
</ul>
<h3 id="預訓練模型"><a class="header" href="#預訓練模型">預訓練模型</a></h3>
<ul>
<li><strong>ASR 模型</strong>: https://github.com/k2-fsa/sherpa-onnx/releases/tag/asr-models</li>
<li><strong>TTS 模型</strong>: https://github.com/k2-fsa/sherpa-onnx/releases/tag/tts-models</li>
<li><strong>模型庫</strong>: https://huggingface.co/csukuangfj</li>
</ul>
<h3 id="範例程式碼"><a class="header" href="#範例程式碼">範例程式碼</a></h3>
<ul>
<li><strong>Python 範例</strong>: https://github.com/k2-fsa/sherpa-onnx/tree/master/python-api-examples</li>
<li><strong>Android 範例</strong>: https://github.com/k2-fsa/sherpa-onnx/tree/master/android</li>
<li><strong>iOS 範例</strong>: https://github.com/k2-fsa/sherpa-onnx/tree/master/ios</li>
<li><strong>WebAssembly 範例</strong>: https://github.com/k2-fsa/sherpa-onnx/tree/master/wasm</li>
</ul>
<h3 id="社群"><a class="header" href="#社群">社群</a></h3>
<ul>
<li><strong>討論區</strong>: https://github.com/k2-fsa/sherpa-onnx/discussions</li>
<li><strong>問題回報</strong>: https://github.com/k2-fsa/sherpa-onnx/issues</li>
</ul>
<h3 id="相關項目"><a class="header" href="#相關項目">相關項目</a></h3>
<ul>
<li><strong>Next-gen Kaldi</strong>: https://github.com/k2-fsa</li>
<li><strong>Icefall</strong>: https://github.com/k2-fsa/icefall</li>
<li><strong>ONNX Runtime</strong>: https://onnxruntime.ai/</li>
</ul>
<hr />
<h2 id="中文-tts-工具"><a class="header" href="#中文-tts-工具">中文 TTS 工具</a></h2>
<h3 id="簡介"><a class="header" href="#簡介">簡介</a></h3>
<p>專案提供了易用的中文文字轉語音工具，支援自動模型偵測和多種使用方式。</p>
<h3 id="下載中文模型"><a class="header" href="#下載中文模型">下載中文模型</a></h3>
<pre><code class="language-bash"># 推薦：中文單說話人模型 (huayan)
wget https://github.com/k2-fsa/sherpa-onnx/releases/download/tts-models/vits-piper-zh_CN-huayan-medium.tar.bz2
tar -xjf vits-piper-zh_CN-huayan-medium.tar.bz2

# 或：中文多說話人模型 (aishell3，支援 66 個不同聲音)
wget https://github.com/k2-fsa/sherpa-onnx/releases/download/tts-models/vits-zh-aishell3.tar.bz2
tar -xjf vits-zh-aishell3.tar.bz2
</code></pre>
<h3 id="使用方式"><a class="header" href="#使用方式">使用方式</a></h3>
<h4 id="方法-1-命令行模式推薦"><a class="header" href="#方法-1-命令行模式推薦">方法 1: 命令行模式（推薦）</a></h4>
<pre><code class="language-bash"># 基本使用
python src/sherpa_onnx/text_to_speech_cn.py -t "你好世界" -o hello.wav

# 調整語速
python src/sherpa_onnx/text_to_speech_cn.py -t "快速朗讀" -o fast.wav -s 1.5

# 慢速朗讀
python src/sherpa_onnx/text_to_speech_cn.py -t "慢速朗讀" -o slow.wav -s 0.8
</code></pre>
<h4 id="方法-2-從檔案讀取"><a class="header" href="#方法-2-從檔案讀取">方法 2: 從檔案讀取</a></h4>
<pre><code class="language-bash"># 將歌詞或長文本存入檔案
echo "本來應該從從容容遊刃有餘" &gt; lyrics.txt

# 轉換為語音
python src/sherpa_onnx/text_to_speech_cn.py -f lyrics.txt -o song.wav
</code></pre>
<h4 id="方法-3-互動模式"><a class="header" href="#方法-3-互動模式">方法 3: 互動模式</a></h4>
<pre><code class="language-bash"># 啟動互動式介面
python src/sherpa_onnx/text_to_speech_cn.py

# 按提示輸入：
# 1. 文字內容
# 2. 輸出檔案名稱
# 3. 語速設定
# 4. 說話人選擇（僅 aishell3 模型）
</code></pre>
<h4 id="方法-4-多說話人模型aishell3"><a class="header" href="#方法-4-多說話人模型aishell3">方法 4: 多說話人模型（aishell3）</a></h4>
<pre><code class="language-bash"># 使用不同的說話人 (0-65)
python src/sherpa_onnx/text_to_speech_cn.py -t "測試不同聲音" -o voice1.wav --speaker 0
python src/sherpa_onnx/text_to_speech_cn.py -t "測試不同聲音" -o voice2.wav --speaker 10
python src/sherpa_onnx/text_to_speech_cn.py -t "測試不同聲音" -o voice3.wav --speaker 30
</code></pre>
<h3 id="完整參數說明"><a class="header" href="#完整參數說明">完整參數說明</a></h3>
<pre><code class="language-bash">python src/sherpa_onnx/text_to_speech_cn.py --help

參數:
  -t, --text TEXT        要轉換的中文文字內容
  -f, --file FILE        從檔案讀取中文文字內容
  -o, --output FILE      輸出檔案名稱 (預設: output.wav)
  -s, --speed SPEED      語速 (0.5-2.0，預設: 1.0)
  -m, --model MODEL      指定模型 (aishell3 或 huayan)
  --speaker ID           說話人 ID (僅 aishell3 有效，0-65，預設: 0)
</code></pre>
<h3 id="功能特色"><a class="header" href="#功能特色">功能特色</a></h3>
<ul>
<li>✅ <strong>自動模型偵測</strong>：無需手動指定，自動找到可用的中文模型</li>
<li>✅ <strong>多種輸入方式</strong>：命令行、檔案、互動式</li>
<li>✅ <strong>語速調整</strong>：支援 0.5-2.0 倍速調整</li>
<li>✅ <strong>多說話人</strong>：aishell3 模型支援 66 種不同聲音</li>
<li>✅ <strong>完全離線</strong>：無需網路連線</li>
<li>✅ <strong>高品質</strong>：清晰自然的中文發音</li>
</ul>
<h3 id="工具檔案位置"><a class="header" href="#工具檔案位置">工具檔案位置</a></h3>
<pre><code>src/sherpa_onnx/
├── text_to_speech_cn.py        # 中文 TTS 工具 ⭐
├── text_to_speech.py           # 英文 TTS 工具
├── simple_tts_example.py       # 簡單範例
├── correct_tts_example.py      # 正確 API 範例
└── test_tts_validation.py      # 完整測試腳本
</code></pre>
<hr />
<h2 id="快速開始總結"><a class="header" href="#快速開始總結">快速開始總結</a></h2>
<h3 id="1-安裝"><a class="header" href="#1-安裝">1. 安裝</a></h3>
<pre><code class="language-bash">pip install sherpa-onnx numpy
</code></pre>
<h3 id="2-最簡單測試tts"><a class="header" href="#2-最簡單測試tts">2. 最簡單測試（TTS）</a></h3>
<pre><code class="language-bash">python src/sherpa_onnx/simple_tts_example.py
</code></pre>
<h3 id="3-中文-tts-工具推薦"><a class="header" href="#3-中文-tts-工具推薦">3. 中文 TTS 工具（推薦）⭐</a></h3>
<pre><code class="language-bash"># 先下載中文模型
wget https://github.com/k2-fsa/sherpa-onnx/releases/download/tts-models/vits-piper-zh_CN-huayan-medium.tar.bz2
tar -xjf vits-piper-zh_CN-huayan-medium.tar.bz2

# 使用中文 TTS
python src/sherpa_onnx/text_to_speech_cn.py -t "你好世界" -o hello.wav
</code></pre>
<h3 id="4-完整測試"><a class="header" href="#4-完整測試">4. 完整測試</a></h3>
<pre><code class="language-bash">python src/sherpa_onnx/test_tts_validation.py
</code></pre>
<h3 id="5-線上體驗無需安裝"><a class="header" href="#5-線上體驗無需安裝">5. 線上體驗（無需安裝）</a></h3>
<p>訪問 Hugging Face Spaces 直接在瀏覽器中試用。</p>
<hr />
<h2 id="結語"><a class="header" href="#結語">結語</a></h2>
<p>sherpa-onnx 是一個功能強大、易於使用、完全離線的語音處理工具庫。無論你是：</p>
<ul>
<li>想要為應用添加語音功能的開發者</li>
<li>需要離線語音處理的項目</li>
<li>研究語音技術的學生</li>
<li>想要打造智能助手的愛好者</li>
</ul>
<p>sherpa-onnx 都是一個很好的選擇！</p>
<p><strong>特別適合</strong>：</p>
<ul>
<li>✅ 注重隱私的應用</li>
<li>✅ 需要離線運行的場景</li>
<li>✅ 嵌入式和 IoT 設備</li>
<li>✅ 跨平台應用開發</li>
</ul>
<hr />
<p><strong>最後更新</strong>: 2025-10-24<br />
<strong>文檔版本</strong>: 1.0<br />
<strong>sherpa-onnx 版本</strong>: 1.12.14+</p>
<p>如有問題或建議，歡迎到 GitHub 提出 Issue 或參與討論！</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../speech_tech/speech-tech-overview.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../ml/ml.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../speech_tech/speech-tech-overview.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../ml/ml.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
